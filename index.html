
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LeituraPRO ‚Äî Treine sua Leitura e Fala</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&family=DM+Mono:wght@400;500&display=swap');
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#faf8f4;--paper:#fffef9;--ink:#1a1410;--ink2:#4a4030;--ink3:#9a8870;
  --line:#e8e0d0;--easy:#2d7a3a;--easy-bg:#eaf7ec;--medio:#b06a00;
  --medio-bg:#fff4e0;--dificil:#c0392b;--dificil-bg:#fdecea;
  --avancado:#6a1fc2;--avancado-bg:#f3eaff;--extremo:#0a0a0a;
  --extremo-bg:#1a1410;--accent:#e85d04;--accent-light:#fff0e8;
  --speech:#0077cc;--speech-bg:#e8f4ff;
}
html{font-size:19px}
body{background:var(--bg);color:var(--ink);font-family:'DM Sans',sans-serif;min-height:100vh}

/* SCREENS */
.screen{display:none;min-height:100vh}
.screen.active{display:block}

/* TOPBAR */
.topbar{position:fixed;top:0;left:0;right:0;height:56px;background:rgba(250,248,244,0.95);backdrop-filter:blur(12px);border-bottom:1px solid var(--line);display:flex;align-items:center;padding:0 24px;gap:12px;z-index:100}
.brand{font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:900;color:var(--ink);letter-spacing:-0.02em}
.brand em{color:var(--accent);font-style:italic}
.topbar-right{margin-left:auto;display:flex;align-items:center;gap:8px}
.topbar-tabs{display:flex;gap:2px;background:var(--line);border-radius:8px;padding:3px}
.topbar-tab{padding:5px 14px;border-radius:6px;font-size:0.78rem;font-weight:600;cursor:pointer;transition:all .15s;color:var(--ink3);border:none;background:transparent}
.topbar-tab.active{background:var(--paper);color:var(--ink);box-shadow:0 1px 4px rgba(0,0,0,.08)}

/* BTNS */
.btn{font-family:'DM Sans',sans-serif;font-size:0.8rem;font-weight:600;padding:8px 18px;border-radius:8px;border:none;cursor:pointer;transition:all .18s}
.btn-ghost{background:transparent;color:var(--ink2);border:1.5px solid var(--line)}
.btn-ghost:hover{border-color:var(--ink3);color:var(--ink)}
.btn-solid{background:var(--ink);color:#fff}
.btn-solid:hover{background:var(--accent)}
.btn-accent{background:var(--accent);color:#fff;font-size:.9rem;padding:12px 28px;border-radius:10px}
.btn-accent:hover{background:#c44a00;transform:translateY(-2px);box-shadow:0 6px 20px rgba(232,93,4,.3)}
.btn-speech{background:var(--speech);color:#fff;font-size:.85rem;padding:10px 22px;border-radius:10px;display:flex;align-items:center;gap:8px}
.btn-speech:hover{background:#005fa3;transform:translateY(-1px)}
.btn-speech.recording{background:#c0392b;animation:pulse-rec .8s ease-in-out infinite}
@keyframes pulse-rec{0%,100%{box-shadow:0 0 0 0 rgba(192,57,43,.4)}50%{box-shadow:0 0 0 8px rgba(192,57,43,0)}}

/* HOME */
.home-wrap{padding-top:80px;max-width:900px;margin:0 auto;padding-left:24px;padding-right:24px;padding-bottom:60px}
.home-hero{text-align:center;padding:40px 0 36px;border-bottom:1px solid var(--line);margin-bottom:32px}
.home-hero h1{font-family:'Playfair Display',serif;font-size:2.8rem;font-weight:900;letter-spacing:-0.04em;line-height:1.1;margin-bottom:12px}
.home-hero h1 em{color:var(--accent);font-style:italic}
.home-hero p{font-size:.95rem;color:var(--ink2);font-weight:300;max-width:480px;margin:0 auto 24px;line-height:1.7}
.stats-row{display:flex;justify-content:center;gap:32px;margin-top:24px}
.stat-item{text-align:center}
.stat-num{font-family:'Playfair Display',serif;font-size:1.8rem;font-weight:700;display:block}
.stat-label{font-size:.7rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.08em}
.section-title{font-family:'Playfair Display',serif;font-size:1.3rem;font-weight:700;margin-bottom:4px}
.section-sub{font-size:.8rem;color:var(--ink3);margin-bottom:18px}

/* LEVEL CARDS */
.levels-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:32px}
.level-card{border-radius:12px;padding:14px 10px;cursor:pointer;border:2px solid transparent;transition:all .2s;text-align:center}
.level-card.selected{transform:translateY(-3px)}
.level-card:hover{transform:translateY(-2px)}
.level-card.easy{background:var(--easy-bg)}.level-card.easy.selected{border-color:var(--easy);box-shadow:0 6px 20px rgba(45,122,58,.15)}
.level-card.medio{background:var(--medio-bg)}.level-card.medio.selected{border-color:var(--medio);box-shadow:0 6px 20px rgba(176,106,0,.15)}
.level-card.dificil{background:var(--dificil-bg)}.level-card.dificil.selected{border-color:var(--dificil);box-shadow:0 6px 20px rgba(192,57,43,.15)}
.level-card.avancado{background:var(--avancado-bg)}.level-card.avancado.selected{border-color:var(--avancado);box-shadow:0 6px 20px rgba(106,31,194,.15)}
.level-card.extremo{background:var(--extremo-bg)}.level-card.extremo.selected{border-color:#555;box-shadow:0 6px 20px rgba(0,0,0,.3)}
.level-emoji{font-size:1.5rem;display:block;margin-bottom:5px}
.level-name{font-weight:600;font-size:.78rem;display:block;margin-bottom:2px}
.level-card.easy .level-name{color:var(--easy)}.level-card.medio .level-name{color:var(--medio)}
.level-card.dificil .level-name{color:var(--dificil)}.level-card.avancado .level-name{color:var(--avancado)}
.level-card.extremo .level-name{color:#fff}.level-card.extremo .level-desc{color:#888}
.level-desc{font-size:.66rem;color:var(--ink3);line-height:1.3}

/* TEXT SELECTOR */
.text-selector{background:var(--paper);border:1px solid var(--line);border-radius:14px;overflow:hidden;margin-bottom:18px}
.text-tabs{display:flex;border-bottom:1px solid var(--line);background:var(--bg)}
.text-tab{padding:11px 18px;font-size:.78rem;font-weight:500;color:var(--ink3);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s}
.text-tab.active{color:var(--ink);border-bottom-color:var(--accent);background:var(--paper)}
.text-tab-content{display:none;padding:14px}.text-tab-content.active{display:block}
.text-list{display:flex;flex-direction:column;gap:6px}
.text-item{display:flex;align-items:center;gap:12px;padding:10px 14px;border-radius:10px;border:1.5px solid transparent;cursor:pointer;transition:all .18s;background:var(--bg)}
.text-item:hover{border-color:var(--line);background:var(--paper)}
.text-item.selected{border-color:var(--accent);background:var(--accent-light)}
.text-item-badge{font-size:.6rem;font-weight:600;padding:3px 8px;border-radius:20px;white-space:nowrap;flex-shrink:0;font-family:'DM Mono',monospace}
.badge-easy{background:var(--easy-bg);color:var(--easy)}.badge-medio{background:var(--medio-bg);color:var(--medio)}
.badge-dificil{background:var(--dificil-bg);color:var(--dificil)}.badge-avancado{background:var(--avancado-bg);color:var(--avancado)}
.badge-extremo{background:#1a1410;color:#ccc}
.text-item-info{flex:1}.text-item-title{font-size:.83rem;font-weight:600;margin-bottom:2px}
.text-item-meta{font-size:.68rem;color:var(--ink3);font-family:'DM Mono',monospace}
.custom-area{width:100%;min-height:140px;border:1.5px solid var(--line);border-radius:10px;padding:12px;font-family:'DM Sans',sans-serif;font-size:.9rem;color:var(--ink);background:var(--paper);resize:vertical;outline:none;line-height:1.6}
.custom-area:focus{border-color:var(--accent)}
.custom-meta{display:flex;gap:10px;margin-top:8px;align-items:center}
.custom-input{border:1.5px solid var(--line);border-radius:8px;padding:7px 12px;font-family:'DM Sans',sans-serif;font-size:.8rem;color:var(--ink);background:var(--paper);outline:none;flex:1}
.custom-input:focus{border-color:var(--accent)}
.char-count{font-size:.7rem;color:var(--ink3);font-family:'DM Mono',monospace;margin-left:auto}
.start-row{display:flex;align-items:center;justify-content:space-between;padding-top:6px}

/* READING SCREEN */
.reading-wrap{padding-top:72px;max-width:760px;margin:0 auto;padding-left:24px;padding-right:24px}
.reading-header{padding:16px 0 14px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--line);margin-bottom:20px}
.reading-info{display:flex;align-items:center;gap:14px}
.timer-display{font-family:'DM Mono',monospace;font-size:2rem;font-weight:500;color:var(--ink);letter-spacing:-0.02em;min-width:100px}
.timer-display.running{color:var(--accent)}.timer-display.paused{color:var(--ink3)}
.reading-meta-box{display:flex;flex-direction:column;gap:2px}
.reading-meta{font-size:.7rem;color:var(--ink3);font-family:'DM Mono',monospace}
.timer-controls{display:flex;gap:8px;align-items:center}
.ctrl{border:none;cursor:pointer;border-radius:8px;font-family:'DM Sans',sans-serif;font-weight:600;font-size:.76rem;padding:8px 14px;transition:all .15s}
.ctrl-start{background:var(--accent);color:#fff}.ctrl-start:hover{background:#c44a00}
.ctrl-pause{background:var(--line);color:var(--ink2)}.ctrl-pause:hover{background:#ddd}
.ctrl-stop{background:var(--dificil-bg);color:var(--dificil);border:1.5px solid var(--dificil)}.ctrl-stop:hover{background:var(--dificil);color:#fff}
.progress-bar-wrap{position:fixed;top:56px;left:0;right:0;height:3px;background:var(--line);z-index:99}
.progress-bar-fill{height:100%;background:var(--accent);transition:width .5s;width:0%}
.reading-level-badge{display:inline-flex;align-items:center;gap:6px;font-size:.7rem;font-weight:600;padding:3px 10px;border-radius:20px;margin-bottom:14px;font-family:'DM Mono',monospace}
.text-title-display{font-family:'Playfair Display',serif;font-size:1.9rem;font-weight:700;letter-spacing:-0.02em;margin-bottom:22px;line-height:1.2}
.text-body{font-family:'DM Sans',sans-serif;font-size:1.35rem;line-height:2.1;color:var(--ink);font-weight:400;padding-bottom:80px;user-select:none}
.text-body.level-extremo{font-size:1.15rem;line-height:1.9;font-weight:400}

/* SPEECH TAB on home */
.speech-hero{text-align:center;padding:40px 0 32px;border-bottom:1px solid var(--line);margin-bottom:28px}
.speech-hero h2{font-family:'Playfair Display',serif;font-size:2rem;font-weight:900;letter-spacing:-0.04em;margin-bottom:10px}
.speech-hero h2 em{color:var(--speech);font-style:italic}
.speech-hero p{font-size:.9rem;color:var(--ink2);font-weight:300;max-width:460px;margin:0 auto;line-height:1.7}

/* SPEECH ANALYZER */
.speech-modes{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:24px}
.speech-mode-card{background:var(--paper);border:2px solid var(--line);border-radius:14px;padding:20px;cursor:pointer;transition:all .2s;text-align:center}
.speech-mode-card:hover{border-color:#aac8e8;transform:translateY(-2px)}
.speech-mode-card.selected{border-color:var(--speech);background:var(--speech-bg);box-shadow:0 4px 16px rgba(0,119,204,.1)}
.speech-mode-icon{font-size:2rem;display:block;margin-bottom:8px}
.speech-mode-title{font-weight:700;font-size:.9rem;margin-bottom:4px}
.speech-mode-desc{font-size:.74rem;color:var(--ink3);line-height:1.4}

/* SPEECH PANEL */
.speech-panel{background:var(--paper);border:1px solid var(--line);border-radius:14px;overflow:hidden;margin-bottom:20px}
.speech-panel-header{padding:16px 20px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between}
.speech-panel-title{font-family:'Playfair Display',serif;font-size:1rem;font-weight:700}
.speech-panel-body{padding:20px}

/* Waveform canvas */
.waveform-wrap{background:#0d1117;border-radius:10px;overflow:hidden;margin-bottom:16px;position:relative;height:80px;display:flex;align-items:center;justify-content:center}
#waveformCanvas{width:100%;height:80px;display:block}
.wave-idle-msg{position:absolute;font-size:.78rem;color:#555;font-family:'DM Mono',monospace;pointer-events:none}

/* Transcription */
.transcript-box{background:var(--bg);border:1px solid var(--line);border-radius:10px;padding:14px;min-height:80px;font-size:.9rem;line-height:1.7;color:var(--ink2);margin-bottom:16px;position:relative}
.transcript-placeholder{color:var(--ink3);font-style:italic;font-size:.85rem}
.transcript-word{display:inline}
.transcript-word.problem{background:#ffeaea;color:#c0392b;border-radius:3px;padding:0 2px;border-bottom:2px solid #c0392b;cursor:help;position:relative}
.transcript-word.slow{background:#fff3cd;color:#856404;border-radius:3px;padding:0 2px;border-bottom:2px dotted #856404}
.transcript-word.hesitation{background:#e8f0fe;color:#1a73e8;border-radius:3px;padding:0 2px}

/* Speech metrics */
.speech-metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:16px}
.speech-metric{background:var(--bg);border:1px solid var(--line);border-radius:10px;padding:12px;text-align:center}
.speech-metric-val{font-family:'Playfair Display',serif;font-size:1.4rem;font-weight:700;display:block;margin-bottom:2px}
.speech-metric-label{font-size:.65rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.06em}

/* Problems list */
.problems-list{display:flex;flex-direction:column;gap:8px}
.problem-item{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;border-radius:10px;font-size:.9rem;line-height:1.6}
.problem-item.error{background:#fdecea;border-left:3px solid var(--dificil)}
.problem-item.warning{background:#fff4e0;border-left:3px solid var(--medio)}
.problem-item.info{background:var(--speech-bg);border-left:3px solid var(--speech)}
.problem-item.success{background:var(--easy-bg);border-left:3px solid var(--easy)}
.problem-icon{font-size:1rem;flex-shrink:0;margin-top:1px}
.problem-text{flex:1}
.problem-text strong{font-weight:600}

/* Speech text selector */
.speech-text-select{margin-bottom:16px}
.speech-text-select label{font-size:.78rem;font-weight:600;color:var(--ink2);display:block;margin-bottom:6px}
.speech-select{width:100%;border:1.5px solid var(--line);border-radius:8px;padding:8px 12px;font-family:'DM Sans',sans-serif;font-size:.82rem;color:var(--ink);background:var(--paper);outline:none;cursor:pointer}
.speech-select:focus{border-color:var(--speech)}

/* Reference text for speech */
.speech-ref-text{background:var(--bg);border:1px solid var(--line);border-radius:10px;padding:14px;margin-bottom:16px;font-size:.88rem;line-height:1.8;color:var(--ink2);max-height:180px;overflow-y:auto}
.speech-ref-word{display:inline}
.speech-ref-word.spoken-correct{background:rgba(45,122,58,.15);color:var(--easy);border-radius:2px;padding:0 1px}
.speech-ref-word.spoken-wrong{background:rgba(192,57,43,.15);color:var(--dificil);border-radius:2px;padding:0 1px;text-decoration:line-through}
.speech-ref-word.current{background:var(--accent);color:#fff;border-radius:3px;padding:0 3px}

/* Recording status */
.rec-status{display:flex;align-items:center;gap:10px;margin-bottom:14px;padding:10px 14px;border-radius:10px;background:var(--bg);border:1px solid var(--line);font-size:.82rem}
.rec-dot{width:10px;height:10px;border-radius:50%;background:var(--ink3);flex-shrink:0}
.rec-dot.active{background:#c0392b;animation:blink-rec .6s ease-in-out infinite}
.rec-dot.ready{background:var(--easy)}
@keyframes blink-rec{0%,100%{opacity:1}50%{opacity:.2}}
.rec-status-text{flex:1;color:var(--ink2)}
.rec-timer{font-family:'DM Mono',monospace;font-size:.8rem;color:var(--ink3);margin-left:auto}

/* Controls row */
.speech-controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

/* RESULT SCREEN */
.result-wrap{padding-top:80px;max-width:760px;margin:0 auto;padding-left:24px;padding-right:24px;padding-bottom:60px}
.result-hero{text-align:center;padding:32px 0 28px;border-bottom:1px solid var(--line);margin-bottom:28px}
.result-grade{font-family:'Playfair Display',serif;font-size:4.5rem;font-weight:900;letter-spacing:-0.05em;line-height:1;margin-bottom:6px}
.result-label{font-size:.95rem;color:var(--ink2);font-weight:300}
.result-cards{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:24px}
.result-card{background:var(--paper);border:1px solid var(--line);border-radius:12px;padding:16px 12px;text-align:center}
.result-card-val{font-family:'Playfair Display',serif;font-size:1.7rem;font-weight:700;margin-bottom:3px;display:block}
.result-card-label{font-size:.68rem;color:var(--ink3);text-transform:uppercase;letter-spacing:.05em}
.wpm-gauge{background:var(--paper);border:1px solid var(--line);border-radius:14px;padding:22px;margin-bottom:18px}
.gauge-title{font-weight:600;font-size:.83rem;margin-bottom:18px;display:flex;justify-content:space-between;align-items:center}
.gauge-scale{position:relative;height:40px}
.gauge-track{height:10px;border-radius:6px;background:linear-gradient(to right,var(--easy-bg) 0%,var(--easy) 20%,var(--medio) 40%,var(--dificil) 60%,var(--avancado) 80%,#000 100%);position:relative;margin-top:14px}
.gauge-marker{position:absolute;top:-14px;transform:translateX(-50%);transition:left 1s cubic-bezier(.34,1.56,.64,1)}
.gauge-arrow{width:0;height:0;border-left:7px solid transparent;border-right:7px solid transparent;border-top:10px solid var(--accent);margin:0 auto}
.gauge-marker-val{font-family:'DM Mono',monospace;font-size:.68rem;font-weight:500;white-space:nowrap;text-align:center;color:var(--accent);margin-bottom:2px}
.gauge-labels{display:flex;justify-content:space-between;margin-top:6px;font-size:.6rem;color:var(--ink3);font-family:'DM Mono',monospace}
.analysis-box{background:var(--paper);border:1px solid var(--line);border-radius:14px;padding:22px;margin-bottom:18px}
.analysis-box h3{font-family:'Playfair Display',serif;font-size:1.15rem;font-weight:700;margin-bottom:14px}
.analysis-item{display:flex;align-items:flex-start;gap:12px;padding:12px 0;border-bottom:1px solid var(--line);font-size:.9rem;line-height:1.65;color:var(--ink2)}
.analysis-item:last-child{border-bottom:none}
.analysis-icon{font-size:.95rem;flex-shrink:0;margin-top:1px}
.result-actions{display:flex;gap:10px;justify-content:center;padding-top:6px}

/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;background:var(--ink);color:#fff;padding:11px 18px;border-radius:10px;font-size:.8rem;font-weight:500;z-index:999;transform:translateY(80px);opacity:0;transition:all .3s cubic-bezier(.34,1.56,.64,1)}
.toast.show{transform:translateY(0);opacity:1}

/* Animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.result-card{animation:fadeUp .4s ease both}
.result-card:nth-child(1){animation-delay:.05s}.result-card:nth-child(2){animation-delay:.1s}
.result-card:nth-child(3){animation-delay:.15s}.result-card:nth-child(4){animation-delay:.2s}

/* Scrollbar */
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--line);border-radius:2px}

@media(max-width:640px){
  .levels-grid{grid-template-columns:repeat(3,1fr)}
  .result-cards{grid-template-columns:repeat(2,1fr)}
  .speech-metrics{grid-template-columns:repeat(2,1fr)}
  .speech-modes{grid-template-columns:1fr}
  .home-hero h1{font-size:2rem}
  .timer-display{font-size:1.6rem}
}
</style>
</head>
<body>
<div class="toast" id="toast"></div>

<!-- ===== HOME ===== -->
<div class="screen active" id="screen-home">
  <div class="topbar">
    <div class="brand">Leitura<em>PRO</em></div>
    <div class="topbar-tabs">
      <button class="topbar-tab active" id="tabBtnReading" onclick="switchMainTab('reading')">üìñ Leitura</button>
      <button class="topbar-tab" id="tabBtnSpeech" onclick="switchMainTab('speech')">üé§ Fala</button>
    </div>
    <div class="topbar-right">
      <button class="btn btn-ghost" onclick="showHistory()">üìä Hist√≥rico</button>
    </div>
  </div>

  <!-- TAB: LEITURA -->
  <div id="mainTabReading" class="home-wrap">
    <div class="home-hero">
      <h1>Treine sua<br><em>velocidade de leitura</em></h1>
      <p>Cronometre, analise e evolua ‚Äî do texto f√°cil ao desafio extremo.</p>
      <div class="stats-row">
        <div class="stat-item"><span class="stat-num" id="statSessions">0</span><span class="stat-label">Sess√µes</span></div>
        <div class="stat-item"><span class="stat-num" id="statAvgWPM">‚Äî</span><span class="stat-label">M√©d. PPM</span></div>
        <div class="stat-item"><span class="stat-num" id="statBestWPM">‚Äî</span><span class="stat-label">Melhor PPM</span></div>
      </div>
    </div>

    <div style="margin-bottom:10px"><div class="section-title">Escolha o N√≠vel</div><div class="section-sub">Do relaxante ao extremamente desafiador</div></div>
    <div class="levels-grid">
      <div class="level-card easy selected" data-level="easy" onclick="selectLevel('easy')"><span class="level-emoji">üå±</span><span class="level-name">F√°cil</span><span class="level-desc">Textos simples</span></div>
      <div class="level-card medio" data-level="medio" onclick="selectLevel('medio')"><span class="level-emoji">üìñ</span><span class="level-name">M√©dio</span><span class="level-desc">Vocabul√°rio variado</span></div>
      <div class="level-card dificil" data-level="dificil" onclick="selectLevel('dificil')"><span class="level-emoji">‚ö°</span><span class="level-name">Dif√≠cil</span><span class="level-desc">Textos t√©cnicos</span></div>
      <div class="level-card avancado" data-level="avancado" onclick="selectLevel('avancado')"><span class="level-emoji">üß†</span><span class="level-name">Avan√ßado</span><span class="level-desc">Linguagem complexa</span></div>
      <div class="level-card extremo" data-level="extremo" onclick="selectLevel('extremo')"><span class="level-emoji">üíÄ</span><span class="level-name">Extremo</span><span class="level-desc">M√°ximo desafio</span></div>
    </div>

    <div style="margin-bottom:10px"><div class="section-title">Escolha o Texto</div><div class="section-sub">Textos prontos ou insira o seu</div></div>
    <div class="text-selector">
      <div class="text-tabs">
        <div class="text-tab active" onclick="switchTab('library')">üìö Biblioteca</div>
        <div class="text-tab" onclick="switchTab('custom')">‚úèÔ∏è Meu Texto</div>
      </div>
      <div class="text-tab-content active" id="tab-library"><div class="text-list" id="textList"></div></div>
      <div class="text-tab-content" id="tab-custom">
        <textarea class="custom-area" id="customText" placeholder="Cole ou escreva seu texto aqui..." oninput="updateCharCount()"></textarea>
        <div class="custom-meta">
          <input type="text" class="custom-input" id="customTitle" placeholder="T√≠tulo (opcional)">
          <span class="char-count" id="charCount">0 palavras</span>
        </div>
      </div>
    </div>
    <div class="start-row">
      <div style="font-size:.78rem;color:var(--ink3)">Selecionado: <strong id="selectedTextName" style="color:var(--ink)">Nenhum</strong></div>
      <button class="btn btn-accent" onclick="startReading()">‚ñ∂ Come√ßar Leitura</button>
    </div>
  </div>

  <!-- TAB: FALA -->
  <div id="mainTabSpeech" class="home-wrap" style="display:none">
    <div class="speech-hero">
      <h2>Analise sua <em>fala</em></h2>
      <p>Grave sua voz lendo em voz alta ou fale livremente. O sistema identifica problemas de dic√ß√£o, ritmo, hesita√ß√µes e muito mais.</p>
    </div>

    <div class="speech-modes">
      <div class="speech-mode-card selected" id="modeCard-free" onclick="selectSpeechMode('free')">
        <span class="speech-mode-icon">üéôÔ∏è</span>
        <div class="speech-mode-title">Fala Livre</div>
        <div class="speech-mode-desc">Fale qualquer coisa. O sistema analisa ritmo, flu√™ncia, pausas e v√≠cios de linguagem.</div>
      </div>
      <div class="speech-mode-card" id="modeCard-text" onclick="selectSpeechMode('text')">
        <span class="speech-mode-icon">üìÑ</span>
        <div class="speech-mode-title">Leitura em Voz Alta</div>
        <div class="speech-mode-desc">Escolha um texto e leia em voz alta. Detecta erros de pron√∫ncia e palavras puladas.</div>
      </div>
    </div>

    <!-- Text select (only for text mode) -->
    <div id="speechTextSelector" style="display:none" class="speech-panel">
      <div class="speech-panel-header"><div class="speech-panel-title">Texto para Leitura</div></div>
      <div class="speech-panel-body">
        <div class="speech-text-select">
          <label>Escolha um texto da biblioteca:</label>
          <select class="speech-select" id="speechTextSelect" onchange="loadSpeechText()">
            <option value="">‚Äî selecione ‚Äî</option>
          </select>
        </div>
        <div id="speechRefText" class="speech-ref-text" style="display:none"></div>
      </div>
    </div>

    <!-- Recorder Panel -->
    <div class="speech-panel">
      <div class="speech-panel-header">
        <div class="speech-panel-title">üé§ Grava√ß√£o e An√°lise</div>
        <div id="speechSupportBadge" style="font-size:.7rem;font-family:'DM Mono',monospace;color:var(--easy)">‚óè API dispon√≠vel</div>
      </div>
      <div class="speech-panel-body">

        <!-- BOT√ÉO NO TOPO -->
        <div style="text-align:center;margin-bottom:20px">
          <button class="btn btn-speech" id="btnRecord" onclick="toggleRecord()" style="font-size:1.15rem;padding:18px 40px;border-radius:14px;width:100%;justify-content:center;gap:12px;font-weight:700">
            <span id="btnRecIcon" style="font-size:1.4rem">‚è∫</span>
            <span id="btnRecText">üéô INICIAR GRAVA√á√ÉO</span>
          </button>
          <div style="font-size:0.75rem;color:var(--ink3);margin-top:8px;font-family:'DM Mono',monospace">‚ñ≤ Clique para come√ßar a gravar</div>
        </div>

        <div class="rec-status" id="recStatus">
          <div class="rec-dot" id="recDot"></div>
          <div class="rec-status-text" id="recStatusText">Pronto para gravar. Clique em Iniciar.</div>
          <div class="rec-timer" id="recTimer">00:00</div>
        </div>

        <div class="waveform-wrap">
          <canvas id="waveformCanvas"></canvas>
          <div class="wave-idle-msg" id="waveIdleMsg">üé§ aguardando grava√ß√£o‚Ä¶</div>
        </div>

        <div class="transcript-box" id="transcriptBox">
          <span class="transcript-placeholder" id="transcriptPlaceholder">A transcri√ß√£o da sua fala aparecer√° aqui durante a grava√ß√£o...</span>
          <span id="transcriptContent" style="display:none"></span>
        </div>

        <div class="speech-metrics" id="speechMetrics" style="display:none">
          <div class="speech-metric"><span class="speech-metric-val" id="metWPM">‚Äî</span><span class="speech-metric-label">PPM</span></div>
          <div class="speech-metric"><span class="speech-metric-val" id="metPauses">‚Äî</span><span class="speech-metric-label">Pausas</span></div>
          <div class="speech-metric"><span class="speech-metric-val" id="metHesit">‚Äî</span><span class="speech-metric-label">Hesita√ß√µes</span></div>
          <div class="speech-metric"><span class="speech-metric-val" id="metScore">‚Äî</span><span class="speech-metric-label">Score</span></div>
        </div>

        <div class="speech-controls">
          <button class="btn btn-ghost" id="btnAnalyze" onclick="analyzeCurrentSpeech()" style="display:none">üîç Analisar Agora</button>
          <button class="btn btn-ghost" onclick="clearSpeech()">üóë Limpar</button>
        </div>
      </div>
    </div>

    <!-- Problems found -->
    <div class="speech-panel" id="problemsPanel" style="display:none">
      <div class="speech-panel-header"><div class="speech-panel-title">üìã Relat√≥rio Completo da Fala</div></div>
      <div class="speech-panel-body">
        <div class="problems-list" id="problemsList"></div>
      </div>
    </div>
  </div>
</div>

<!-- ===== LEITURA ===== -->
<div class="screen" id="screen-reading">
  <div class="topbar">
    <div class="brand">Leitura<em>PRO</em></div>
    <div class="topbar-right"><button class="btn btn-ghost" onclick="goHome()">‚Üê Voltar</button></div>
  </div>
  <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBar"></div></div>
  <div class="reading-wrap">
    <div class="reading-header">
      <div class="reading-info">
        <div class="timer-display" id="timerDisplay">00:00</div>
        <div class="reading-meta-box">
          <span class="reading-meta" id="wpmLive">‚Äî PPM</span>
          <span class="reading-meta" id="wordCount">0 palavras</span>
        </div>
      </div>
      <div class="timer-controls">
        <button class="ctrl ctrl-start" id="btnStart" onclick="startTimer()">‚ñ∂ Iniciar</button>
        <button class="ctrl ctrl-pause" id="btnPause" onclick="pauseTimer()" style="display:none">‚è∏ Pausar</button>
        <button class="ctrl ctrl-stop" onclick="stopTimer()">‚ñ† Finalizar</button>
      </div>
    </div>
    <div id="readingLevelBadge" class="reading-level-badge"></div>
    <div class="text-title-display" id="readingTitle"></div>
    <div class="text-body" id="readingBody"></div>
  </div>
</div>

<!-- ===== RESULTADO ===== -->
<div class="screen" id="screen-result">
  <div class="topbar">
    <div class="brand">Leitura<em>PRO</em></div>
    <div class="topbar-right"><button class="btn btn-ghost" onclick="goHome()">‚Üê In√≠cio</button></div>
  </div>
  <div class="result-wrap">

    <!-- HERO: Nota e t√≠tulo -->
    <div class="result-hero">
      <div class="result-grade" id="resultGrade">A</div>
      <div class="result-label" id="resultLabel">Excelente desempenho!</div>
      <div id="resultSubLabel" style="font-size:.85rem;color:var(--ink3);margin-top:6px;font-family:'DM Mono',monospace"></div>
    </div>

    <!-- CARDS DE M√âTRICAS -->
    <div class="result-cards">
      <div class="result-card"><span class="result-card-val" id="res-wpm">‚Äî</span><span class="result-card-label">Palavras/min</span></div>
      <div class="result-card"><span class="result-card-val" id="res-time">‚Äî</span><span class="result-card-label">Tempo Total</span></div>
      <div class="result-card"><span class="result-card-val" id="res-words">‚Äî</span><span class="result-card-label">Palavras lidas</span></div>
      <div class="result-card"><span class="result-card-val" id="res-level">‚Äî</span><span class="result-card-label">N√≠vel</span></div>
    </div>

    <!-- VELOC√çMETRO -->
    <div class="wpm-gauge">
      <div class="gauge-title">Velocidade de Leitura <span style="font-size:.7rem;color:var(--ink3);font-family:'DM Mono',monospace">M√©dia adulta: 200‚Äì300 PPM</span></div>
      <div class="gauge-scale">
        <div class="gauge-marker" id="gaugeMarker" style="left:30%"><div class="gauge-marker-val" id="gaugeVal">‚Äî</div><div class="gauge-arrow"></div></div>
        <div class="gauge-track"></div>
      </div>
      <div class="gauge-labels"><span>0</span><span>100</span><span>200</span><span>300</span><span>400</span><span>500+</span></div>
    </div>

    <!-- RELAT√ìRIO COMPLETO -->
    <div class="analysis-box">
      <h3>üìã Relat√≥rio Completo de Leitura</h3>
      <div id="analysisItems"></div>
    </div>

    <!-- DIAGN√ìSTICO DE PROBLEMAS -->
    <div class="analysis-box" id="diagBox" style="display:none">
      <h3>‚ö†Ô∏è Problemas Identificados &amp; Como Corrigir</h3>
      <div id="diagItems"></div>
    </div>

    <!-- PONTOS FORTES -->
    <div class="analysis-box" id="strongBox" style="display:none">
      <h3>‚úÖ Pontos Fortes Detectados</h3>
      <div id="strongItems"></div>
    </div>

    <!-- PLANO DE TREINO -->
    <div class="analysis-box">
      <h3>üéØ Plano de Melhoria Personalizado</h3>
      <div id="planItems"></div>
    </div>

    <div class="result-actions">
      <button class="btn btn-ghost" onclick="goHome()">üè† In√≠cio</button>
      <button class="btn btn-solid" onclick="tryAgain()">üîÑ Tentar Novamente</button>
      <button class="btn btn-accent" onclick="nextText()">‚Üí Pr√≥ximo Texto</button>
    </div>
  </div>
</div>

<script>
const TEXTS = {
  easy: [
    {
      id:'e1', title:'O Jardim da Vov√≥', level:'easy',
      body:`A vov√≥ Maria acordava todos os dias √†s seis da manh√£ para cuidar do seu jardim. Ela regava as flores com carinho, tirava o mato ruim e conversava com os passarinhos que vinham cantar nas √°rvores.

Seu jardim era famoso em toda a rua. As rosas vermelhas eram as mais bonitas, e o jasmim perfumava o ar de um jeito que todo mundo parava para sentir.

Um dia, a neta Ana foi visitar a vov√≥. Ela ficou encantada com tantas cores e cheiros. A vov√≥ ensinou a menina a plantar uma semente. Juntas, elas cuidaram da terra com amor.

Semanas depois, uma flor pequenininha nasceu. Ana ficou feliz demais e prometeu que tamb√©m teria um jardim um dia. A vov√≥ sorriu e disse que um jardim √© sempre uma promessa que se cumpre devagar, com paci√™ncia e muita √°gua.`
    },
    {
      id:'e2', title:'A Viagem de Trem', level:'easy',
      body:`Pedro nunca tinha andado de trem. Quando sua m√£e disse que iam viajar para a cidade da av√≥ de trem, ele ficou animado de um jeito que mal conseguia dormir na noite anterior.

Na esta√ß√£o, o trem estava enorme. As rodas de ferro brilhavam e a fuma√ßa sa√≠a com um barulho forte. Pedro segurou a m√£o da m√£e com for√ßa enquanto subiam as escadas.

Dentro do trem, a janela era grande. Pedro ficou colado no vidro olhando as casas, as √°rvores e os campos passarem rapidinho. Uma vez, at√© viu um cavalo correndo junto com o trem por um bom tempo, como se quisesse uma corrida.

A viagem durou tr√™s horas, mas para Pedro pareceu um sonho. Quando chegaram, ele j√° queria voltar de trem de novo. A av√≥ disse que da pr√≥xima vez eles poderiam ir at√© o vag√£o restaurante tomar um chocolate quente no caminho.`
    },
    {
      id:'e3', title:'O Cachorro Esperto', level:'easy',
      body:`Tobi era um cachorro pequeno e muito esperto. Ele morava numa casa verde no fim da rua e adorava brincar no quintal. Seu dono, seu Z√©, sempre lhe dava um osso depois do jantar.

Numa tarde quente, Tobi pegou seu osso e foi at√© o quintal. Quando passava pela cerca, escorregou e o osso caiu num buraco fundo. Tobi ficou olhando tristinho para o buraco, resmungando baixinho.

Ele foi at√© a garagem, pegou um graveto no bico e voltou ao buraco. Enfiou o graveto devagarzinho e, depois de muito tentar, conseguiu empurrar o osso para um lado e pegar com a patinha.

Seu Z√© viu tudo da janela e deu uma gargalhada. Chamou a fam√≠lia toda para contar a fa√ßanha do cachorrinho. Daquele dia em diante, Tobi ganhou dois ossos por jantar, como recompensa por ser t√£o inteligente.`
    },
    {
      id:'e4', title:'A Festa da Escola', level:'easy',
      body:`Hoje era dia de festa na escola de Lu√≠sa. Ela tinha ensaiado a dan√ßa por duas semanas inteiras, todo dia depois do almo√ßo, at√© acertar todos os passos. A fantasia de borboleta estava guardada numa caixa especial desde o s√°bado.

De manh√£, a m√£e ajudou a prender as asas coloridas nas costas de Lu√≠sa. O pai tirou foto antes de sair. O irm√£o mais novo ficou com inveja e pediu para ser uma borboleta tamb√©m, mas n√£o havia fantasia para ele.

Na escola, o p√°tio estava todo enfeitado com bandeirinhas e bal√µes. Cada turma apresentou uma coisa diferente. A turma do terceiro ano cantou. A turma do quarto dan√ßou com chap√©us engra√ßados.

Quando chegou a vez da turma de Lu√≠sa, ela sentiu o cora√ß√£o bater r√°pido. Mas quando a m√∫sica come√ßou, os p√©s foram sozinhos. Ela dan√ßou e sorriu o tempo todo. No final, todo mundo bateu palmas muito forte.`
    },
    {
      id:'e5', title:'O Peixe Dourado do Rio', level:'easy',
      body:`Todo ver√£o, a fam√≠lia de Marcos ia pescar no Rio das Pedras. Era uma tradi√ß√£o que come√ßou com o av√¥, passou para o pai e chegou at√© Marcos, que tinha onze anos e j√° sabia preparar a vara sozinho.

Naquele ano, o pai prometeu que se Marcos pescasse um peixe grande, ele mesmo cozinharia no fog√£o √† lenha. Marcos adorava o cheiro do fogo de lenha e ficou animado com o desafio.

Eles acordaram antes do sol nascer e foram at√© a margem com os p√©s descal√ßos na lama fria. Por horas, nada. Marcos estava quase desistindo quando sentiu uma puxada forte na linha.

Era o maior peixe que ele j√° tinha visto. Dourado, com escamas que brilhavam como moedas. O pai olhou e assoviou de admira√ß√£o. Soltaram o peixe de volta na √°gua, porque pescar era sobre o momento, n√£o sobre o peixe. E esse momento, Marcos nunca esqueceu.`
    },
    {
      id:'e6', title:'A Carta Perdida', level:'easy',
      body:`Na gaveta da mesa de cabeceira da vov√≥ Tereza havia uma carta amarelada que ningu√©m tinha lido. Estava l√° desde sempre, com a letra cursiva na frente e o envelope fechado com lacre vermelho quebrado.

Certo domingo, enquanto ajudava a organizar o quarto da vov√≥, a neta J√∫lia encontrou a carta. Perguntou de quem era. A vov√≥ pegou com cuidado, olhou por um momento e sorriu daquele jeito que s√≥ os velhos sabem sorrir.

Era de um amigo de inf√¢ncia que tinha ido morar em outro pa√≠s muitos anos atr√°s. Eles tinham prometido se escrever para sempre. E se escreveram. Essa era a √∫ltima carta que ele mandou antes de morrer.

A vov√≥ leu em voz alta para J√∫lia. A carta falava de saudade, de um jardim com macieiras, de um idioma novo que ele estava aprendendo. Ao terminar, as duas ficaram em sil√™ncio por um tempo. √Äs vezes as palavras mais bonitas s√£o as que ficam guardadas na gaveta esperando a hora certa de serem lidas.`
    },
    {
      id:'e7', title:'O Dia da Chuva', level:'easy',
      body:`Naquele s√°bado choveu tanto que o telhado velho da casa do tio Geraldo come√ßou a pingar. Primeiro foram tr√™s gotinhas na sala. Depois mais umas cinco na cozinha. Logo havia baldes e bacias espalhados por todo lado, cada um pingando num ritmo diferente.

Tio Geraldo n√£o ficou bravo. Chamou as crian√ßas e disse que iam transformar aquilo numa orquestra. Cada balde tinha um som diferente dependendo do quanto de √°gua tinha dentro. Eles passaram a tarde toda tocando m√∫sica com colheres de pau.

A vizinha ouviu o barulho e foi ver o que estava acontecendo. Achou t√£o engra√ßado que ficou para jantar. Tio Geraldo fez um macarr√£o rapidinho e a chuva foi a trilha sonora do jantar mais divertido que as crian√ßas j√° tinham tido.

No dia seguinte, um pedreiro veio consertar o telhado. As crian√ßas ficaram um pouco tristes. A orquestra tinha durado s√≥ um dia, mas a lembran√ßa durou a vida toda.`
    },
    {
      id:'e8', title:'O Coelho Diferente', level:'easy',
      body:`Pipoca era um coelho branco com uma orelha preta e outra laranja, e tinha um segredo envergonhado: ele detestava cenouras. Toda vez que sua dona Beatriz trazia uma cenoura fresquinha, Pipoca desviava o nariz e fingia n√£o ver.

Beatriz n√£o entendia. Todos os livros diziam que coelhos adoram cenouras. Ela tentou cenoura crua, cenoura cozida, cenoura ralada. Pipoca ignorava todas. O que ele realmente amava, ela descobriu por acidente, era banana.

Numa manh√£, Beatriz estava descascando bananas para o caf√© e jogou as cascas perto da gaiola. Pipoca ficou louco. Fungava, batia as patinhas, tentava chegar perto. Beatriz deu um peda√ßo pequenininho. Pipoca comeu e pediu mais.

Dali em diante, Pipoca ganhava um pedacinho de banana todo dia. Beatriz contou para as amigas e todo mundo achou gra√ßa. O coelho que n√£o gostava de cenouras virou a atra√ß√£o mais famosa do bairro.`
    },
    {
      id:'e9', title:'A Bicicleta Laranja', level:'easy',
      body:`No dia do anivers√°rio de oito anos de Sofia, o pai trouxe uma bicicleta laranja com cestinha na frente e uma campainha que tocava duas vezes. Sofia ficou t√£o feliz que ficou andando em c√≠rculos no quintal por uma hora sem parar.

O problema era o equil√≠brio. Toda vez que tentava andar mais r√°pido, a bicicleta tombava para o lado. O joelho j√° estava arranhado e o cotovelo tamb√©m. Mas Sofia n√£o chorou. Mordeu o l√°bio e levantou de novo.

O av√¥ estava sentado na varanda vendo tudo. Quando Sofia caiu pela s√©tima vez, ele foi at√© l√°, ficou ao lado da bicicleta e disse apenas: olha para frente, n√£o para baixo. Sofia tentou. Andou tr√™s metros. Depois cinco. Depois chegou at√© o port√£o.

O av√¥ bateu palmas devagar. Sofia voltou ped–∞–ªando e quase bateu na cerca, mas riu muito. No fim da tarde, ela j√° andava pela cal√ßada inteira. A bicicleta laranja se tornou a coisa mais importante que ela possu√≠a por muitos anos.`
    }
  ],
  medio: [
    {
      id:'m1', title:'O Mercado das Mem√≥rias', level:'medio',
      body:`Existia na cidade velha um mercado que a maioria das pessoas nem sabia que existia. Ficava numa viela estreita entre dois pr√©dios antigos, e s√≥ aparecia nas tardes de s√°bado quando a luz batia de um jeito diferente na pedra do cal√ßamento.

L√° vendiam de tudo: um pote de cheiro de chuva engarrafada, o som de uma risada que voc√™ j√° ouviu e esqueceu, a sensa√ß√£o exata de acordar cedo num dia frio de f√©rias escolares.

A moeda era mem√≥ria. Voc√™ entrava, escolhia algo, e pagava com uma lembran√ßa que abria m√£o de ter. N√£o do√≠a. Simplesmente, num estalo, aquele momento deixava de existir dentro de voc√™.

Marina entrou pela primeira vez numa tarde de mar√ßo. Saiu com o cheiro do cabelo da m√£e que havia morrido dois anos antes, e deixou para tr√°s o √∫ltimo desentendimento que tiveram. Pareceu um neg√≥cio justo.

O mercado estava l√° na semana seguinte. Mas Marina n√£o lembrava mais do caminho para chegar at√© ele.`
    },
    {
      id:'m2', title:'Carta ao Oceano', level:'medio',
      body:`Nunca fui de escrever cartas, mas voc√™ n√£o tem endere√ßo de e-mail e seria estranho te mandar uma mensagem no celular. Por isso escrevo no papel, com caneta, do jeito que aprendi que cartas devem ser escritas.

Nos vimos h√° tr√™s ver√µes. Eu estava naquele penhasco de pedra vermelha e voc√™ estava sendo voc√™ mesmo ‚Äî imenso, barulhento, absolutamente indiferente. Joguei um pedregulho em voc√™ e voc√™ nem percebeu.

Foi a√≠ que entendi o que os fil√≥sofos tentam dizer sobre a nossa irrelev√¢ncia. N√£o como uma tristeza, mas como um al√≠vio. Ningu√©m era t√£o importante quanto pensava. Nem eu, nem minhas preocupa√ß√µes de vinte e tr√™s anos.

Hoje tenho vinte e oito. As preocupa√ß√µes mudaram, mas o tamanho delas parece o mesmo. Quando fico pequeno demais pra cabe√ßa, lembro de voc√™. Aquela imensid√£o azul que simplesmente continua.

Obrigado por existir. Sei que voc√™ n√£o leu isso. Mas escrevi mesmo assim.`
    },
    {
      id:'m3', title:'A √öltima Livraria', level:'medio',
      body:`A cidade tinha uma √∫nica livraria ainda aberta, e ela resistia com a teimosia t√≠pica das coisas velhas que recusam morrer de vez. As paredes eram de madeira escurecida pelo tempo, os livros se empilhavam sem muita ordem l√≥gica, e o dono, seu Benedito, tinha setenta e tr√™s anos e a mem√≥ria de um catalogador de museu.

Voc√™ entrava e dizia o que estava sentindo ‚Äî n√£o o que queria ler, mas o que estava sentindo ‚Äî e Benedito ia at√© algum canto do labirinto de prateleiras e voltava com um livro. Sempre o certo.

Para a mo√ßa que chorava sem saber por qu√™, ele trouxe um conto curto de Clarice. Para o rapaz que estava com raiva do pai, uma biografia de algu√©m que tamb√©m teve. Para a crian√ßa que sentia medo do escuro, um livro de astronomia sobre como as estrelas s√£o feitas de explos√µes.

A prefeitura queria o espa√ßo para construir um estacionamento. Benedito disse que esperariam ele morrer. E ele, por pura teimosia liter√°ria, se recusava a morrer antes de ter lido tudo que ainda restava.`
    },
    {
      id:'m4', title:'O Homem que Colecionava Despedidas', level:'medio',
      body:`Henrique tinha o h√°bito estranho de colecionar despedidas. N√£o as pessoas ‚Äî as pessoas iam embora e ficavam onde a vida as levava. O que ele guardava eram os momentos: o √∫ltimo aperto de m√£o de um amigo que embarcou para a Europa sem data de volta, o beijo apressado numa plataforma de metr√¥, a voz do pai na √∫ltima liga√ß√£o antes do enfarte.

Ele n√£o chamava de cole√ß√£o por morbidez. Era o oposto. Cada despedida guardada era uma prova de que algo tinha valido a pena ao ponto de doer na hora de acabar.

Sua filha certa vez perguntou por que ele ficava t√£o calmo nas despedidas de aeroporto, sem choro, sem drama. Ele disse que era porque j√° havia ensaiado aquele momento mil vezes dentro de si. Que despedir-se bem era uma forma de respeito.

Quando ele mesmo partiu, no hospital, com a fam√≠lia ao redor, foi ele quem disse tchau primeiro. Com um sorriso que parecia guardado para aquela ocasi√£o espec√≠fica. J√° estava pronto fazia tempo.`
    },
    {
      id:'m5', title:'Receita para Dias Ruins', level:'medio',
      body:`Ingredientes: uma tarde livre, preferencialmente cinzenta. Uma x√≠cara de caf√© feita com calma, sem m√°quina autom√°tica. Alguma m√∫sica que voc√™ n√£o escuta faz tempo porque te lembra de algo que voc√™ ainda n√£o sabe exatamente o qu√™.

Modo de preparo: sente-se sem objetivo definido. Resista ao impulso de pegar o celular nos primeiros dez minutos. Deixe o pensamento vagar sem rota ‚Äî n√£o √© medita√ß√£o, √© o oposto, √© deixar o barulho da cabe√ßa fazer o que quiser sem julgamento.

Alguma coisa vai aparecer. Uma saudade que voc√™ esqueceu que tinha. Uma ideia que estava esperando sil√™ncio para surgir. Uma pergunta para a qual voc√™ ainda n√£o formulou a resposta certa.

N√£o force. Dias ruins n√£o pedem resolu√ß√£o. Pedem presen√ßa. Ficar com ele, em vez de correr dele, costuma transformar a textura do dia de uma forma que voc√™ s√≥ percebe depois, quando j√° passou.

Rende: um dia um pouco menos ruim. Tempo de preparo: o quanto precisar.`
    },
    {
      id:'m6', title:'O Bairro que Sumiu', level:'medio',
      body:`Voltei ao bairro onde cresci depois de quinze anos. O quarteir√£o onde ficava a padaria do seu Armindo agora tem uma loja de roupas com m√∫sica alta vazando pela porta. A √°rvore que n√≥s sub√≠amos ‚Äî uma figueira enorme com galhos que pareciam bra√ßos ‚Äî foi cortada para ampliar o estacionamento do supermercado.

Caminhei devagar, tentando reconstruir o mapa mental que guardei quando tinha doze anos. A maioria das refer√™ncias havia desaparecido. Sobravam algumas fachadas, alguns port√µes, a inclina√ß√£o familiar de uma rua.

Me dei conta de que o lugar que eu amava nunca foi exatamente aquele lugar f√≠sico. Era uma camada de tempo depositada sobre as pedras, uma narrativa que eu havia constru√≠do e que s√≥ existia dentro de mim.

O bairro n√£o sumiu. Eu √© que fui embora, e levei comigo a √∫nica vers√£o dele que realmente importava.`
    }
  ],
  dificil: [
    {
      id:'d1', title:'Sobre a Dissolu√ß√£o do Tempo Percebido', level:'dificil',
      body:`A percep√ß√£o humana do tempo √©, por defini√ß√£o, uma constru√ß√£o retroativa. O instante presente ‚Äî aquilo que designamos coloquialmente como "agora" ‚Äî √©, em sentido estrito, inacess√≠vel √† consci√™ncia no momento em que ocorre. O que percebemos como presente √©, invariavelmente, um passado imediato processado e reconstru√≠do pelo aparato cognitivo em fra√ß√µes de segundo.

William James, ao cunhar o conceito de "presente especioso", j√° intu√≠a essa defasagem constitutiva entre evento e percep√ß√£o. O que a neuroci√™ncia contempor√¢nea confirma, com aparato experimental que James n√£o dispunha, √© que essa lacuna varia conforme estado emocional, n√≠vel de aten√ß√£o e at√© temperatura corporal.

H√° uma implica√ß√£o filos√≥fica perturbadora nessa constata√ß√£o: se o presente √© ilus√≥rio, e o passado irrecuper√°vel enquanto evento bruto, e o futuro apenas proje√ß√£o probabil√≠stica, em que registro ontol√≥gico habitamos? A resposta mais honesta √©: no registro da narrativa. Somos, antes de tudo, animais que constroem coer√™ncia onde h√° apenas fluxo.

A mem√≥ria, nesse contexto, n√£o √© arquivo ‚Äî √© fic√ß√£o com pretens√£o documental. Cada vez que lembramos, reescrevemos. A vers√£o acessada n√£o √© o evento original, mas a √∫ltima vers√£o que lembramos, j√° ela mesma uma vers√£o anterior reescrita. A fidelidade decai a cada itera√ß√£o. Isso n√£o √© trag√©dia epistemol√≥gica ‚Äî √©, talvez, a condi√ß√£o de possibilidade da identidade. Somos o ac√∫mulo das nossas revis√µes.`
    },
    {
      id:'d2', title:'A Geometria das Decis√µes Irrevers√≠veis', level:'dificil',
      body:`Existe uma categoria espec√≠fica de decis√£o que os te√≥ricos da escolha racional insistem em subestimar: a decis√£o cujo custo n√£o √© mensur√°vel antes de ser tomada, porque o custo √© precisamente a impossibilidade de tom√°-la novamente. Chama-se, em alguns contextos, de "ponto de bifurca√ß√£o existencial" ‚Äî embora o termo carregue um peso dram√°tico que nem sempre corresponde √† dimens√£o dos eventos em quest√£o.

Aceitar um emprego em outra cidade. N√£o ligar numa madrugada quando se deveria ter ligado. Dizer uma palavra que n√£o pode ser desagendada do registro de outra pessoa. Essas s√£o as decis√µes que n√£o cabem em matrizes de utilidade esperada, porque seu horizonte temporal √© indefinido e seus efeitos frequentemente se manifestam em dimens√µes que n√£o estavam no conjunto de vari√°veis consideradas no momento da escolha.

O que torna esses momentos geometricamente interessantes ‚Äî e psicologicamente √°rduos ‚Äî √© que eles possuem a estrutura topol√≥gica de um n√≥: uma vez atravessado, o espa√ßo de possibilidades se reconfigura de maneira irredut√≠vel. N√£o √© que o caminho n√£o percorrido desapare√ßa; ele persiste como espectro contrafactual, presente exatamente por sua aus√™ncia, habitando a consci√™ncia com a for√ßa das coisas que n√£o aconteceram.

A sabedoria convencional aconselha a n√£o olhar para tr√°s. A sabedoria n√£o convencional reconhece que olhar para tr√°s com lucidez ‚Äî sem nostalgia paralisante, mas tamb√©m sem a amn√©sia conveniente ‚Äî √© precisamente o que permite que o pr√≥ximo ponto de bifurca√ß√£o seja navegado com maior integridade.`
    },
    {
      id:'d3', title:'Neuroplasticidade e o Mito do C√©rebro Fixo', level:'dificil',
      body:`Durante grande parte do s√©culo XX, a neuroci√™ncia operou sob o dogma da imutabilidade cerebral p√≥s-desenvolvimento: o sistema nervoso adulto seria essencialmente est√°tico, incapaz de reorganiza√ß√£o estrutural significativa. Les√µes, nessa perspectiva, eram permanentes; habilidades n√£o desenvolvidas na inf√¢ncia, irrecuper√°veis; a arquitetura neuronal, um destino e n√£o uma constru√ß√£o.

O trabalho de Michael Merzenich e colaboradores, a partir dos anos 1980, desestabilizou esse paradigma de forma irrevers√≠vel. Experimentos com macacos submetidos a estimula√ß√£o sensorial espec√≠fica mostraram reorganiza√ß√£o mensur√°vel dos mapas corticais ‚Äî regi√µes do c√©rebro dedicadas ao processamento de informa√ß√µes de determinados dedos expandindo-se √†s custas de regi√µes adjacentes em fun√ß√£o do uso diferencial.

O conceito de neuroplasticidade ‚Äî a capacidade do sistema nervoso de modificar sua estrutura e fun√ß√£o em resposta √† experi√™ncia ‚Äî emergiu como princ√≠pio organizador de uma nova neuroci√™ncia. Suas implica√ß√µes s√£o vastas e, em alguns casos, perturbadoras: se o c√©rebro √© literalmente moldado pelo que fazemos repetidamente, ent√£o nossos h√°bitos n√£o s√£o apenas comportamentos ‚Äî s√£o arquitetura. O que praticamos, constru√≠mos. O que evitamos, desmontamos.

Isso confere nova seriedade √† ideia de responsabilidade sobre os pr√≥prios padr√µes de pensamento. Rumina√ß√£o cr√¥nica n√£o √© apenas h√°bito psicol√≥gico ruim ‚Äî √©, em sentido literal, a constru√ß√£o de infraestrutura neural dedicada √† rumina√ß√£o. A boa not√≠cia, claro, √© que a plasticidade √© bidirecional.`
    },
    {
      id:'d4', title:'A Linguagem como Habitat', level:'dificil',
      body:`Existe uma diferen√ßa fundamental entre usar uma l√≠ngua e habit√°-la. O turista usa o ingl√™s para pedir dire√ß√µes e verificar o card√°pio. O imigrante que sonha em ingl√™s depois de dez anos n√£o est√° mais usando uma ferramenta ‚Äî est√° existindo dentro de um sistema que reorganizou sua maneira de categorizar o mundo, de experimentar emo√ß√µes, de construir humor.

Benjamin Lee Whorf, em sua forma mais radical, prop√¥s que a l√≠ngua determina o pensamento ‚Äî que n√£o h√° cogni√ß√£o fora do c√≥digo lingu√≠stico dispon√≠vel. A hip√≥tese foi amplamente criticada e sua vers√£o forte hoje n√£o encontra muitos defensores s√©rios. Mas sua vers√£o fraca ‚Äî de que a l√≠ngua influencia, molda, facilita ou dificulta certos tipos de pensamento ‚Äî recebe suporte experimental crescente.

O russo distingue linguisticamente azul claro de azul escuro com palavras diferentes, sem rela√ß√£o de hip√¥nimo-hiper√¥nimo. Falantes de russo demonstram, em experimentos de discrimina√ß√£o de cor, tempo de resposta menor para distinguir esses tons do que falantes de ingl√™s ou portugu√™s. A l√≠ngua n√£o cria a percep√ß√£o, mas afina determinadas discrimina√ß√µes.

Aprender uma l√≠ngua estrangeira na idade adulta √©, nessa perspectiva, mais do que adquirir um novo c√≥digo ‚Äî √© cultivar uma perspectiva alternativa, um segundo √¢ngulo de vis√£o sobre o mundo. N√£o como substitui√ß√£o, mas como expans√£o do horizonte do diz√≠vel e, portanto, do pens√°vel.`
    },
    {
      id:'d5', title:'O Paradoxo da Escolha Abundante', level:'dificil',
      body:`Barry Schwartz, em sua an√°lise da cultura da escolha contempor√¢nea, identificou um paradoxo que contraria a intui√ß√£o liberal cl√°ssica: mais op√ß√µes, acima de certo limiar, n√£o aumentam o bem-estar ‚Äî diminuem-no. A liberdade de escolha irrestrita, longe de ser o bem supremo, pode tornar-se fonte de paralisia, arrependimento e insatisfa√ß√£o cr√¥nica.

O mecanismo √© relativamente bem compreendido. Com poucas op√ß√µes, a escolha errada √© atribu√≠vel √†s circunst√¢ncias ‚Äî havia pouco dispon√≠vel. Com muitas op√ß√µes, a responsabilidade pela escolha recai inteiramente sobre o indiv√≠duo. Se o resultado n√£o √© satisfat√≥rio, a conclus√£o √© inevit√°vel: voc√™ escolheu mal dentre um leque amplo. A culpa √© sua.

Acrescenta-se a isso o fen√¥meno do custo de oportunidade cognitivo: quanto maior o conjunto de alternativas n√£o escolhidas, maior o peso mental daquilo que foi deixado para tr√°s. Cada op√ß√£o descartada √© uma perda potencial. E perdas, como demonstrou Kahneman, pesam cognitivamente mais do que ganhos de magnitude equivalente.

A solu√ß√£o n√£o √©, evidentemente, a elimina√ß√£o da escolha ‚Äî isso seria trocar um problema por outro, infinitamente pior. √â, antes, desenvolver a habilidade de escolher com comprometimento, de assumir a op√ß√£o feita sem carregar permanentemente o peso do que poderia ter sido diferente. Escolher bem n√£o √© encontrar a op√ß√£o √≥tima; √© fazer da op√ß√£o escolhida a melhor poss√≠vel pelo investimento de aten√ß√£o e cuidado.`
    },
    {
      id:'d6', title:'Vi√©s de Confirma√ß√£o e a Arquitetura da Cren√ßa', level:'dificil',
      body:`O vi√©s de confirma√ß√£o ‚Äî a tend√™ncia cognitiva de buscar, interpretar e lembrar informa√ß√µes de maneira que confirme cren√ßas preexistentes ‚Äî √© provavelmente o mais estudado e ao mesmo tempo o mais resistente de todos os vieses documentados pela psicologia cognitiva. Sua persist√™ncia n√£o √© acidental: reflete uma caracter√≠stica estrutural do modo como o sistema cognitivo humano foi moldado evolutivamente.

Em ambientes de alta incerteza e baixo custo de erro falso-negativo, cren√ßas est√°veis e resistentes √† revis√£o t√™m vantagem adaptativa sobre sistemas permanentemente abertos √† atualiza√ß√£o. Um ancestral que acredita firmemente que determinada planta √© venenosa ‚Äî e resiste a evid√™ncias contr√°rias ‚Äî comete menos erros fatais do que um que constantemente reavalia. A rigidez cognitiva, em contextos espec√≠ficos, √© funcional.

O problema emerge quando esses mecanismos operam em dom√≠nios para os quais n√£o foram selecionados: pol√≠tica, economia, rela√ß√µes interpessoais, ci√™ncia. Nesses contextos, a resist√™ncia adaptativa √† revis√£o produz cren√ßas que persistem n√£o pela for√ßa das evid√™ncias que as sustentam, mas pela sele√ß√£o e distor√ß√£o das evid√™ncias dispon√≠veis.

A solu√ß√£o geralmente proposta ‚Äî mais educa√ß√£o, mais acesso √† informa√ß√£o ‚Äî esbarra em evid√™ncias perturbadoras: estudos mostram que indiv√≠duos mais informados em dom√≠nios politicamente carregados frequentemente demonstram vi√©s de confirma√ß√£o mais sofisticado, n√£o menor. O acesso √† informa√ß√£o, sem as ferramentas metacognitivas para avaliar os pr√≥prios processos de avalia√ß√£o, pode amplificar o problema em vez de resolv√™-lo.`
    }
  ],
  avancado: [
    {
      id:'a1', title:'Fenomenologia da Incompreens√£o M√∫tua', level:'avancado',
      body:`A incompreens√£o entre sujeitos n√£o √©, como frequentemente se sup√µe no imagin√°rio popular, um d√©ficit comunicativo remedi√°vel pela adi√ß√£o de palavras. √â, antes, uma propriedade estrutural da intersubjetividade ‚Äî condi√ß√£o que Husserl denominaria a "alteridade irredut√≠vel" do outro e que Wittgenstein abordaria obliquamente ao afirmar que, mesmo que um le√£o pudesse falar, n√£o o compreender√≠amos.

O problema n√£o reside na insufici√™ncia do c√≥digo lingu√≠stico compartilhado, mas na assimetria constitutiva das perspectivas fenomenol√≥gicas. Cada sujeito habita um horizonte intencional constru√≠do a partir de sedimenta√ß√µes biogr√°ficas, afetivas e corporais que s√£o, por princ√≠pio, intransmiss√≠veis em sua integralidade. A linguagem funciona, nesse registro, n√£o como canal de transposi√ß√£o de conte√∫do, mas como dispositivo de coordena√ß√£o de comportamentos e negocia√ß√£o de aproxima√ß√µes suficientemente funcionais ‚Äî o que Wittgenstein chamaria de "jogos de linguagem" ‚Äî nunca como ve√≠culo de coincid√™ncia mental.

Da√≠ a paradoxalidade fundamental das rela√ß√µes humanas mais intensas: quanto maior a intimidade, mais vis√≠vel se torna a opacidade do outro. O estranho pode ser tratado como cifra temporariamente ileg√≠vel ‚Äî cuja decifra√ß√£o se projeta no horizonte do poss√≠vel. O pr√≥ximo, cujo horizonte parcialmente conhecemos, revela por exatamente essa proximidade os contornos do que permanece e permanecer√° inacess√≠vel.

Amar algu√©m, nessa perspectiva fenomenol√≥gica, n√£o seria eliminar essa dist√¢ncia ‚Äî projeto imposs√≠vel e, se poss√≠vel, sufocante ‚Äî mas aprender a habit√°-la com toler√¢ncia, √†s vezes com rever√™ncia. A incompreens√£o que subsiste n√£o como falha, mas como signo de que h√° ali, irredut√≠vel, um outro.`
    },
    {
      id:'a2', title:'Entropia, Informa√ß√£o e o Custo da Ordem', level:'avancado',
      body:`A segunda lei da termodin√¢mica tem uma beleza austera que transcende a f√≠sica e contamina, com raz√£o, a teoria da informa√ß√£o, a biologia evolutiva e, com alguma licen√ßa metaf√≥rica controlada, a filosofia da hist√≥ria. Em sua formula√ß√£o mais geral: sistemas isolados tendem espontaneamente a estados de maior entropia ‚Äî maior desordem, menor disponibilidade energ√©tica, maior distribui√ß√£o homog√™nea.

Shannon, ao desenvolver a teoria matem√°tica da comunica√ß√£o em 1948, realizou um movimento epistemol√≥gico de consequ√™ncias inesperadas: utilizou o mesmo formalismo matem√°tico da entropia termodin√¢mica para medir a informa√ß√£o. Nessa formula√ß√£o, informa√ß√£o √© precisamente a quantidade de surpresa ‚Äî ou improbabilidade ‚Äî de uma mensagem. Uma mensagem completamente previs√≠vel n√£o transmite informa√ß√£o. √â o inesperado, o improv√°vel, que carrega conte√∫do informacional.

H√° uma ironia estrutural nisso: a ordem ‚Äî baixa entropia ‚Äî √© o que torna poss√≠vel a comunica√ß√£o (requer c√≥digos est√°veis, estruturas reconhec√≠veis), mas √© exatamente a desordem relativa ‚Äî o desvio da expectativa ‚Äî que constitui a informa√ß√£o em si. Comunicar √©, portanto, dan√ßar no limite entre estrutura suficiente para ser compreendido e varia√ß√£o suficiente para dizer algo.

Para sistemas biol√≥gicos, a implica√ß√£o √© ainda mais perturbadora. Manter a organiza√ß√£o ‚Äî a baixa entropia local que caracteriza um organismo vivo ‚Äî exige importa√ß√£o cont√≠nua de energia do ambiente e exporta√ß√£o de entropia para fora do sistema. Viver √©, literalmente, adiar o equil√≠brio termodin√¢mico ‚Äî que √© a morte ‚Äî √†s custas do ambiente. Somos bols√µes tempor√°rios de improv√°vel ordem num universo que caminha inexoravelmente para a homogeneidade.`
    },
    {
      id:'a3', title:'A Constru√ß√£o Social da Realidade e seus Limites', level:'avancado',
      body:`Berger e Luckmann, em sua obra seminal de 1966, propuseram que a realidade cotidiana √© uma constru√ß√£o social ‚Äî produto de processos hist√≥ricos de institucionaliza√ß√£o, legitima√ß√£o e internaliza√ß√£o que transformam pr√°ticas contingentes em estruturas que parecem naturais, inevit√°veis, dadas. O que experimentamos como "o modo como as coisas s√£o" √©, em larga medida, sedimenta√ß√£o de escolhas coletivas que foram esquecendo a pr√≥pria natureza de escolha.

Essa perspectiva tem valor cr√≠tico evidente: exp√µe a conting√™ncia do que se apresenta como necess√°rio, abre espa√ßo para questionamento daquilo que pareceria inquestion√°vel, fundamenta programas de transforma√ß√£o social ao demonstrar que o que foi constru√≠do pode ser desconstru√≠do e reconstru√≠do diferentemente.

Seu limite, por√©m, √© igualmente real. A tese construtivista, levada ao extremo, enfrenta o problema da autorrefer√™ncia: a pr√≥pria afirma√ß√£o de que "a realidade √© socialmente constru√≠da" √© ela mesma um produto social, sujeito ao mesmo questionamento que aplica a qualquer outra cren√ßa. A tentativa de escapar do c√≠rculo hermen√™utico pela eleva√ß√£o ao meta-n√≠vel n√£o resolve o problema ‚Äî apenas o desloca.

Mais fundamentalmente, h√° aspectos da realidade que resistem com not√°vel obstina√ß√£o √†s tentativas de renegocia√ß√£o social. A gravidade n√£o se importa com o consenso cultural. A dor f√≠sica n√£o dissolve ao ser desconstru√≠da discursivamente. O construtivismo social √© ferramenta indispens√°vel para an√°lise cultural e pol√≠tica, mas precisa ser operado com consci√™ncia de seus limites ontol√≥gicos.`
    },
    {
      id:'a4', title:'Cogni√ß√£o Incorporada e o Fim do Cognitivismo Cl√°ssico', level:'avancado',
      body:`O paradigma cognitivista cl√°ssico, dominante nas ci√™ncias cognitivas desde os anos 1950, concebeu a mente como processador de informa√ß√µes simb√≥licas ‚Äî um software executando sobre o hardware cerebral, em princ√≠pio independente das especificidades corporais do sistema que o hospeda. A intelig√™ncia artificial simb√≥lica era sua express√£o tecnol√≥gica; a met√°fora do computador, seu principal instrumento heur√≠stico.

A partir dos anos 1980 e 1990, um conjunto heterog√™neo de cr√≠ticas convergiu para desafiar esse paradigma. Francisco Varela, Evan Thompson e Eleanor Rosch, em "The Embodied Mind" (1991), articularam a proposta da cogni√ß√£o incorporada: que processos cognitivos n√£o ocorrem em um sistema cerebral abstrato, mas s√£o fundamentalmente moldados pela morfologia corporal espec√≠fica do organismo, pelo tipo de sensoriomotricidade que possui, pela maneira como seu corpo particular interage com ambientes particulares.

A implica√ß√£o √© radical: n√£o h√° cogni√ß√£o universal, independente do corpo que a realiza. Um polvo, com seus neur√¥nios distribu√≠dos pelos tent√°culos, tem uma forma de cogni√ß√£o estruturalmente diferente da de um vertebrado centralizado. N√£o apenas diferentes conte√∫dos ‚Äî diferentes arquiteturas de pensamento.

Para humanos, isso significa que abstra√ß√µes que parecem puramente conceptuais t√™m ra√≠zes metaf√≥ricas no funcionamento corporal. "Compreender" vem de pegar fisicamente. "Acima" e "abaixo" s√£o orienta√ß√µes aprendidas via postura b√≠pede. O pensamento abstrato √©, na perspectiva incorporada, sempre met√°fora de experi√™ncia corporal ‚Äî o que muda a natureza da matem√°tica, da linguagem e da consci√™ncia enquanto fen√¥menos.`
    }
  ],
  extremo: [
    {
      id:'x1', title:'Aporia da Autodetermina√ß√£o em Sistemas Reflexivos', level:'extremo',
      body:`A quest√£o da autodetermina√ß√£o ‚Äî entendida como capacidade de um sistema de estabelecer, a partir de si mesmo, as condi√ß√µes normativas de sua pr√≥pria opera√ß√£o ‚Äî constitui um dos n√≥s gordianos da filosofia pr√°tica contempor√¢nea, particularmente quando confrontada com as descobertas das ci√™ncias cognitivas sobre os mecanismos subpessoais que subjazem ao que fenomenologicamente se apresenta como decis√£o deliberada.

Libet e colaboradores demonstraram experimentalmente, nos anos oitenta, que a atividade neural precursora de um movimento volunt√°rio (o "Bereitschaftspotential") antecede em aproximadamente trezentos a quinhentos milissegundos a consci√™ncia subjetiva de ter decidido mover-se. Se a decis√£o consciente √© epifen√¥meno de processos que j√° determinaram seu conte√∫do antes de emergir √† consci√™ncia, em que sentido ontol√≥gico o sujeito √© autor de suas a√ß√µes?

As respostas deflacion√°rias ‚Äî de que o livre-arb√≠trio √© simplesmente compat√≠vel com o determinismo neurol√≥gico porque se refere a uma capacidade de n√≠vel de descri√ß√£o diferente ‚Äî preservam o vocabul√°rio pr√°tico da ag√™ncia √†s custas de esvaziar seu conte√∫do intuitivo. O sujeito que "poderia ter agido de outra forma" nessa leitura compatibilista significa apenas que, em condi√ß√µes contrafactuais diferentes (outros estados cerebrais), a a√ß√£o resultante seria diferente ‚Äî o que √© trivialmente verdadeiro e n√£o restaura a intui√ß√£o que se buscava preservar.

A alternativa incompatibilista ‚Äî que o livre-arb√≠trio genu√≠no requer a possibilidade real de alternativas causais ‚Äî esbarra tanto no determinismo quanto, paradoxalmente, no indeterminismo qu√¢ntico: aleatoriedade n√£o √© autonomia. Um evento causado por flutua√ß√µes qu√¢nticas n√£o √© mais "meu" do que um causado por condicionamento determin√≠stico.

O que permanece quando se dissolve a ilus√£o de uma ag√™ncia metafisicamente robusta? Talvez o que Strawson chamou de "atitudes reativas" ‚Äî a gram√°tica pr√°tica do elogio, da culpa, do ressentimento e da gratid√£o ‚Äî que n√£o requer funda√ß√£o metaf√≠sica para ser operacionalmente indispens√°vel. A responsabilidade como pr√°tica social, n√£o como correspond√™ncia a um fato ontol√≥gico. Mas isso n√£o responde √† quest√£o; apenas a transloca para o registro das pr√°ticas.`
    },
    {
      id:'x2', title:'Colapso Epist√™mico e a Pragm√°tica da Certeza Funcional', level:'extremo',
      body:`A epistemologia tradicional, desde Descartes, operou sob a premissa impl√≠cita de que a tarefa do conhecimento √© a elimina√ß√£o da d√∫vida ‚Äî a funda√ß√£o de cren√ßas em bases indubit√°veis que sirvam de ancoragem para uma estrutura cognitiva est√°vel. O projeto cartesiano, mesmo em suas revis√µes p√≥s-kantianas e anal√≠ticas, preservou essa orienta√ß√£o fundamentalista: conhecer bem √© conhecer com garantias.

O pragmatismo americano ‚Äî de Peirce a Dewey, com a radicaliza√ß√£o posterior de Rorty ‚Äî subverteu essa orienta√ß√£o ao propor que a pergunta relevante n√£o √© "o que justifica esta cren√ßa?" mas "que diferen√ßa faz t√™-la?". Verdade, nessa perspectiva, n√£o √© correspond√™ncia entre proposi√ß√£o e estado de coisas independente, mas propriedade funcional de cren√ßas que funcionam bem ‚Äî que permitem navegar o ambiente, coordenar a√ß√£o com outros agentes, resolver problemas.

Wittgenstein, em "Da Certeza", chegou a uma posi√ß√£o estruturalmente an√°loga por caminho diferente. Analisando as chamadas "proposi√ß√µes de dobradi√ßa" ‚Äî aquelas que n√£o s√£o verificadas, mas que sustentam a verifica√ß√£o de outras ‚Äî concluiu que a base do edif√≠cio epist√™mico n√£o √© conhecimento, mas a√ß√£o. "No come√ßo era o ato." Certas cren√ßas n√£o s√£o justificadas porque s√£o incorrig√≠veis; s√£o incorrig√≠veis porque sua revis√£o desestabilizaria o sistema inteiro de pr√°ticas no qual o conhecimento se insere.

Isso tem implica√ß√µes radicais para a racionalidade em condi√ß√µes de incerteza genu√≠na ‚Äî que √© a condi√ß√£o normal de decis√£o, n√£o uma patologia excepcional. Se a certeza fundacional √© inacess√≠vel e a demanda por ela √© paralisante, a alternativa racional √© desenvolver o que poder√≠amos chamar de "certeza funcional calibrada": comprometimento operacional com premissas suficientemente bem-testadas para sustentar a√ß√£o, combinado com disposi√ß√£o estrutural para revis√£o quando as consequ√™ncias pr√°ticas sinalizam inadequa√ß√£o do modelo.`
    },
    {
      id:'x3', title:'Ontologia do Capital Simb√≥lico em Campos de Poder Diferenciados', level:'extremo',
      body:`A sociologia de Pierre Bourdieu introduziu um aparato conceitual que permitiu analisar rela√ß√µes de poder social sem reduzi-las √† dimens√£o econ√¥mica, sem, contudo, abandonar o rigor estrutural que caracterizava as an√°lises marxistas que buscava superar. O conceito de campo ‚Äî espa√ßo social estruturado por posi√ß√µes relativas de agentes em disputa por formas espec√≠ficas de capital ‚Äî articulou-se com o conceito de habitus para produzir uma teoria da reprodu√ß√£o social que operava simultaneamente nos registros objetivo e subjetivo.

O capital simb√≥lico, em particular, designa as formas de poder que operam pelo desconhecimento de sua pr√≥pria natureza ‚Äî pelo reconhecimento daquilo que √©, em √∫ltima inst√¢ncia, arbitr√°rio hist√≥rico como leg√≠timo, natural, necess√°rio. O prest√≠gio acad√™mico, a distin√ß√£o est√©tica, a autoridade religiosa: todas essas formas de poder social dependem, para sua efic√°cia, de que os dominados participem ativamente de sua pr√≥pria domina√ß√£o, internalizando as categorias de percep√ß√£o e aprecia√ß√£o que tornam natural a hierarquia em que se encontram subalternizados.

A contribui√ß√£o epistemol√≥gica de Bourdieu reside em demonstrar que essa participa√ß√£o n√£o √© falsa consci√™ncia remedi√°vel pela informa√ß√£o correta ‚Äî √© incorporada no habitus, inscrita no esquema corporal de disposi√ß√µes, na hexis corporal que precede e organiza qualquer tomada de posi√ß√£o reflexiva. Mudar rela√ß√µes de domina√ß√£o simb√≥lica n√£o basta com convencer cognitivamente os agentes de sua situa√ß√£o; requer transforma√ß√£o das condi√ß√µes objetivas que produzem os habitus que tornam a domina√ß√£o impercept√≠vel enquanto tal.

Essa an√°lise tem implica√ß√µes inc√¥modas para projetos emancipat√≥rios que operam exclusivamente no registro da consci√™ncia cr√≠tica: a cr√≠tica intelectual da domina√ß√£o pode ela mesma ser forma de distin√ß√£o simb√≥lica ‚Äî capital cultural revertido em capital simb√≥lico pelo campo acad√™mico que produz e legitima a cr√≠tica ‚Äî perpetuando, em n√≠vel diferente, a l√≥gica que pretende desmontar.`
    },
    {
      id:'x4', title:'Meta√©tica da Normatividade: Entre Realismo e Expressivismo', level:'extremo',
      body:`O debate meta√©tico contempor√¢neo entre realismo moral e suas alternativas antirrealistas constitui talvez o campo mais tecnicamente √°rido da filosofia pr√°tica, mas tamb√©m o mais fundamental: as respostas dadas aqui determinam o tipo de raz√£o que pode ser invocada para justificar julgamentos morais, e portanto o tipo de discurso moral que √© poss√≠vel sem autocontradi√ß√£o performativa.

O realismo moral cognitivista ‚Äî na vers√£o robusta de Russ Shafer-Landau ou no naturalismo normativo de Peter Railton ‚Äî sustenta que proposi√ß√µes morais s√£o genuinamente verdadeiras ou falsas, que h√° fatos morais independentes das atitudes e cren√ßas dos agentes, e que esses fatos podem, em princ√≠pio, ser objeto de conhecimento. As dificuldades epistemol√≥gicas s√£o enormes: como se teria acesso cognitivo a fatos morais? Qual seria o mecanismo causal que conectaria o fato moral objetivo √† cren√ßa moral no sujeito?

O expressivismo ‚Äî de Blackburn a Gibbard ‚Äî resolve o problema epistemol√≥gico ao negar que julgamentos morais sejam proposi√ß√µes com valor de verdade: s√£o express√µes de atitudes, compromissos, normas. "Tortura √© errada" n√£o descreve um fato ‚Äî expressa uma atitude de reprova√ß√£o. O problema √© o chamado Frege-Geach: como tratar logicamente constru√ß√µes como "Se tortura √© errada, persuadir pessoas a torturar √© errado"? O "tortura √© errada" nessa constru√ß√£o condicional n√£o pode ser express√£o de atitude sem tornar inv√°lida a forma l√≥gica do argumento.

Gibbard desenvolveu o "expressivismo normativo" precisamente para resolver esse problema, introduzindo a no√ß√£o de "plano" como objeto de atitudes normativas que podem ser encadeados logicamente. Mas a controv√©rsia permanece aberta, e sua abertura n√£o √© meramente t√©cnica ‚Äî √© sintoma de que a quest√£o do que significa fazer um julgamento moral ainda n√£o encontrou resposta satisfat√≥ria que acomode simultaneamente nossas intui√ß√µes sobre objetividade, motiva√ß√£o e l√≥gica.`
    },
    {
      id:'x5', title:'Complexidade Irredut√≠vel e os Limites da Modelagem Computacional', level:'extremo',
      body:`A tese da computabilidade universal ‚Äî de que qualquer processo f√≠sico suficientemente bem descrito pode ser simulado por uma m√°quina de Turing com recursos computacionais adequados ‚Äî opera como premissa impl√≠cita de amplos segmentos da ci√™ncia contempor√¢nea, da neuroci√™ncia computacional √† economia comportamental. Sua plausibilidade deriva em parte de sua imprecis√£o: "suficientemente bem descrito" e "recursos computacionais adequados" s√£o locu√ß√µes cujos limites pr√°ticos raramente s√£o explicitados.

A teoria da complexidade computacional imp√µe restri√ß√µes formais precisas a essa tese. Problemas NP-completos n√£o s√£o apenas dif√≠ceis em termos computacionais ‚Äî s√£o dif√≠ceis de uma maneira que escala de forma que torna invi√°vel sua resolu√ß√£o por qualquer algoritmo determin√≠stico em tempo polinomial, dada a hip√≥tese P‚â†NP (amplamente, mas n√£o definitivamente, aceita). A modelagem de sistemas com intera√ß√µes exponencialmente crescentes ‚Äî como ecossistemas, mercados financeiros ou redes neurais biol√≥gicas ‚Äî pode estar fundamentalmente al√©m das capacidades de qualquer arquitetura computacional cl√°ssica, independentemente de recursos.

A f√≠sica qu√¢ntica adiciona outra camada de complica√ß√£o: o problema da mensura√ß√£o ‚Äî o colapso da fun√ß√£o de onda pela observa√ß√£o ‚Äî sugere que o ato de modelar um sistema f√≠sico altera o sistema modelado de maneiras que impedem correspond√™ncia perfeita entre modelo e realidade. Para sistemas macrosc√≥picos, os efeitos qu√¢nticos s√£o geralmente negligenci√°veis. Mas para processos nos quais flutua√ß√µes microsc√≥picas s√£o amplificadas n√£o-linearmente ‚Äî e h√° argumentos de que o c√©rebro pode ser um desses sistemas ‚Äî a fronteira entre o model√°vel e o fundamentalmente irredut√≠vel permanece empiricamente aberta.

O que est√° em jogo n√£o √© apenas capacidade computacional futura, mas a quest√£o ontol√≥gica mais profunda de se a realidade √©, em princ√≠pio, esgot√°vel por representa√ß√µes formais ‚Äî ou se h√° dimens√µes do real que resistem √† formaliza√ß√£o n√£o por limita√ß√£o tecnol√≥gica, mas por natureza.`
    }
  ]
};

// ===== STATE =====
let currentLevel = 'easy';
let currentTextId = null;
let currentText = null;
let isCustom = false;
let timerSeconds = 0;
let timerInterval = null;
let timerRunning = false;
let timerStarted = false;
let timerPaused = false;
let history = [];
try { history = JSON.parse(localStorage.getItem('leitura_history') || '[]'); } catch(e){ history = []; }

// ===== MAIN TAB SWITCH =====
function switchMainTab(tab) {
  document.getElementById('mainTabReading').style.display = tab === 'reading' ? '' : 'none';
  document.getElementById('mainTabSpeech').style.display = tab === 'speech' ? '' : 'none';
  document.getElementById('tabBtnReading').classList.toggle('active', tab === 'reading');
  document.getElementById('tabBtnSpeech').classList.toggle('active', tab === 'speech');
}

// ===== INIT =====
function init() {
  updateStats();
  renderTextList();
  populateSpeechTextSelect();
  checkSpeechSupport();
}

function updateStats() {
  document.getElementById('statSessions').textContent = history.length;
  if (!history.length) return;
  const wpms = history.map(h => h.wpm);
  document.getElementById('statAvgWPM').textContent = Math.round(wpms.reduce((a,b)=>a+b,0)/wpms.length);
  document.getElementById('statBestWPM').textContent = Math.max(...wpms);
}

function renderTextList() {
  const list = document.getElementById('textList');
  list.innerHTML = '';
  const texts = TEXTS[currentLevel] || [];
  const lvlLabels = {easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};
  texts.forEach(t => {
    const wc = t.body.trim().split(/\s+/).length;
    const el = document.createElement('div');
    el.className = 'text-item' + (currentTextId === t.id ? ' selected' : '');
    el.onclick = () => { selectText(t); document.querySelectorAll('.text-item').forEach(x => x.classList.remove('selected')); el.classList.add('selected'); };
    el.innerHTML = `<span class="text-item-badge badge-${t.level}">${lvlLabels[t.level]||t.level}</span><div class="text-item-info"><div class="text-item-title">${t.title}</div><div class="text-item-meta">${wc} palavras ¬∑ ~${Math.ceil(wc/200)} min</div></div>`;
    list.appendChild(el);
  });
}

function selectLevel(l) {
  currentLevel = l;
  currentTextId = null;
  isCustom = false;
  document.getElementById('selectedTextName').textContent = 'Nenhum';
  document.querySelectorAll('.level-card').forEach(c => c.classList.remove('selected'));
  document.querySelector(`.level-card[data-level="${l}"]`).classList.add('selected');
  renderTextList();
  // go back to library tab
  document.querySelectorAll('.text-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.text-tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.text-tab')[0].classList.add('active');
  document.getElementById('tab-library').classList.add('active');
  isCustom = false;
}

function switchTab(tab) {
  document.querySelectorAll('.text-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.text-tab-content').forEach(t => t.classList.remove('active'));
  if (tab === 'library') {
    document.querySelectorAll('.text-tab')[0].classList.add('active');
    document.getElementById('tab-library').classList.add('active');
    isCustom = false;
  } else {
    document.querySelectorAll('.text-tab')[1].classList.add('active');
    document.getElementById('tab-custom').classList.add('active');
    isCustom = true;
    currentTextId = '__custom__';
    document.getElementById('selectedTextName').textContent = 'Meu texto';
  }
}

function selectText(t) {
  currentTextId = t.id;
  currentText = t;
  isCustom = false;
  document.getElementById('selectedTextName').textContent = t.title;
}

function updateCharCount() {
  const v = document.getElementById('customText').value.trim();
  const words = v ? v.split(/\s+/).length : 0;
  document.getElementById('charCount').textContent = words + ' palavras';
}

// ===== START READING =====
function startReading() {
  if (isCustom) {
    const body = document.getElementById('customText').value.trim();
    if (!body) { showToast('Cole seu texto antes de come√ßar!'); return; }
    const title = document.getElementById('customTitle').value.trim() || 'Meu Texto';
    currentText = { id:'__custom__', title, level: currentLevel, body };
  } else {
    if (!currentText) { showToast('Selecione um texto da biblioteca!'); return; }
  }

  const lvlMap = {
    easy:{label:'üå± F√°cil',bg:'var(--easy-bg)',color:'var(--easy)'},
    medio:{label:'üìñ M√©dio',bg:'var(--medio-bg)',color:'var(--medio)'},
    dificil:{label:'‚ö° Dif√≠cil',bg:'var(--dificil-bg)',color:'var(--dificil)'},
    avancado:{label:'üß† Avan√ßado',bg:'var(--avancado-bg)',color:'var(--avancado)'},
    extremo:{label:'üíÄ Extremo',bg:'var(--extremo-bg)',color:'#ccc'}
  };
  const lvl = lvlMap[currentText.level] || lvlMap.easy;
  const badge = document.getElementById('readingLevelBadge');
  badge.textContent = lvl.label;
  badge.style.background = lvl.bg;
  badge.style.color = lvl.color;

  document.getElementById('readingTitle').textContent = currentText.title;
  const body = document.getElementById('readingBody');
  body.textContent = currentText.body;
  body.className = 'text-body' + (currentText.level === 'extremo' ? ' level-extremo' : '');

  const words = currentText.body.trim().split(/\s+/).length;
  document.getElementById('wordCount').textContent = words + ' palavras';

  timerSeconds = 0;
  timerRunning = false;
  timerStarted = false;
  timerPaused = false;
  clearInterval(timerInterval);
  document.getElementById('timerDisplay').textContent = '00:00';
  document.getElementById('timerDisplay').className = 'timer-display';
  document.getElementById('wpmLive').textContent = '‚Äî PPM';
  document.getElementById('progressBar').style.width = '0%';
  document.getElementById('btnStart').style.display = '';
  document.getElementById('btnStart').textContent = '‚ñ∂ Iniciar';
  document.getElementById('btnPause').style.display = 'none';

  showScreen('reading');
  window.scrollTo(0,0);
}

// ===== TIMER =====
function startTimer() {
  if (timerRunning) return;
  timerRunning = true;
  timerStarted = true;
  timerPaused = false;
  document.getElementById('timerDisplay').className = 'timer-display running';
  document.getElementById('btnStart').style.display = 'none';
  document.getElementById('btnPause').style.display = '';
  clearInterval(timerInterval);
  timerInterval = setInterval(() => { timerSeconds++; updateTimerDisplay(); }, 1000);
}

function pauseTimer() {
  if (!timerRunning) return;
  clearInterval(timerInterval);
  timerRunning = false;
  timerPaused = true;
  document.getElementById('timerDisplay').className = 'timer-display paused';
  document.getElementById('btnPause').style.display = 'none';
  document.getElementById('btnStart').textContent = '‚ñ∂ Continuar';
  document.getElementById('btnStart').style.display = '';
}

function stopTimer() {
  if (!timerStarted) { showToast('Inicie o cron√¥metro primeiro!'); return; }
  clearInterval(timerInterval);
  timerRunning = false;
  showResult();
}

function updateTimerDisplay() {
  const m = Math.floor(timerSeconds/60);
  const s = timerSeconds%60;
  document.getElementById('timerDisplay').textContent = pad(m)+':'+pad(s);
  if (timerSeconds > 5) {
    const wc = currentText.body.trim().split(/\s+/).length;
    document.getElementById('wpmLive').textContent = Math.round((wc/timerSeconds)*60)+' PPM';
  }
  const wc = currentText.body.trim().split(/\s+/).length;
  const exp = (wc/200)*60;
  document.getElementById('progressBar').style.width = Math.min(100,(timerSeconds/exp)*100)+'%';
}
function pad(n){ return String(n).padStart(2,'0'); }

// ===== RESULT =====
function showResult() {
  const words = currentText.body.trim().split(/\s+/).length;
  const wpm = timerSeconds > 0 ? Math.round((words/timerSeconds)*60) : 0;
  const m = Math.floor(timerSeconds/60), s = timerSeconds%60;
  const timeStr = pad(m)+':'+pad(s);

  const lvlBonus = {easy:0,medio:20,dificil:50,avancado:80,extremo:120};
  const adj = wpm + (lvlBonus[currentText.level]||0);
  let grade, label, color;
  if(adj>=350){grade='S';label='Leitura excepcional!';color='#c8a000';}
  else if(adj>=280){grade='A';label='Excelente desempenho!';color='#2d7a3a';}
  else if(adj>=220){grade='B';label='Bom desempenho!';color='#4caf50';}
  else if(adj>=160){grade='C';label='Desempenho m√©dio';color='#b06a00';}
  else if(adj>=100){grade='D';label='Continue praticando!';color:'#c0392b';}
  else{grade='F';label='Pratique mais!';color='#888';}

  document.getElementById('resultGrade').textContent = grade;
  document.getElementById('resultGrade').style.color = color;
  document.getElementById('resultLabel').textContent = label;
  document.getElementById('res-wpm').textContent = wpm;
  document.getElementById('res-time').textContent = timeStr;
  document.getElementById('res-words').textContent = words;
  const lvlNames={easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};
  document.getElementById('res-level').textContent = lvlNames[currentText.level]||'‚Äî';

  const pct = Math.min(98,Math.max(2,(wpm/500)*100));
  setTimeout(()=>{
    document.getElementById('gaugeMarker').style.left = pct+'%';
    document.getElementById('gaugeVal').textContent = wpm+' PPM';
  },300);

  const items = [];
  const box = document.getElementById('analysisItems');
  box.innerHTML = '';

  history.unshift({wpm,time:timeStr,words,level:currentText.level,title:currentText.title,grade,date:new Date().toLocaleDateString('pt-BR')});
  if(history.length>50) history.pop();
  try { localStorage.setItem('leitura_history',JSON.stringify(history)); } catch(e){}

  showScreen('result');
  window.scrollTo(0,0);
}

// ===== RESULT =====
function showResult() {
  const words = currentText.body.trim().split(/\s+/).length;
  const wpm = timerSeconds > 0 ? Math.round((words/timerSeconds)*60) : 0;
  const m = Math.floor(timerSeconds/60), s = timerSeconds%60;
  const timeStr = pad(m)+':'+pad(s);
  const mins = timerSeconds / 60;

  const lvlBonus = {easy:0,medio:20,dificil:50,avancado:80,extremo:120};
  const adj = wpm + (lvlBonus[currentText.level]||0);
  let grade, label, color;
  if(adj>=350){grade='S';label='Leitura excepcional!';color='#c8a000';}
  else if(adj>=280){grade='A';label='Excelente desempenho!';color='#2d7a3a';}
  else if(adj>=220){grade='B';label='Bom desempenho!';color='#4caf50';}
  else if(adj>=160){grade='C';label='Desempenho m√©dio';color='#b06a00';}
  else if(adj>=100){grade='D';label='Continue praticando!';color='#c0392b';}
  else{grade='F';label='Pratique mais!';color='#888';}

  document.getElementById('resultGrade').textContent = grade;
  document.getElementById('resultGrade').style.color = color;
  document.getElementById('resultLabel').textContent = label;
  document.getElementById('resultSubLabel').textContent = `Texto: "${currentText.title}" ¬∑ N√≠vel ${({easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'})[currentText.level]}`;

  document.getElementById('res-wpm').textContent = wpm;
  document.getElementById('res-time').textContent = timeStr;
  document.getElementById('res-words').textContent = words;
  const lvlNames={easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};
  document.getElementById('res-level').textContent = lvlNames[currentText.level]||'‚Äî';

  const pct = Math.min(98,Math.max(2,(wpm/500)*100));
  setTimeout(()=>{
    document.getElementById('gaugeMarker').style.left = pct+'%';
    document.getElementById('gaugeVal').textContent = wpm+' PPM';
  },300);

  // Gerar relat√≥rio completo
  buildFullReport(wpm, timerSeconds, words, currentText.level, grade);

  history.unshift({wpm,time:timeStr,words,level:currentText.level,title:currentText.title,grade,date:new Date().toLocaleDateString('pt-BR')});
  if(history.length>50) history.pop();
  try { localStorage.setItem('leitura_history',JSON.stringify(history)); } catch(e){}

  showScreen('result');
  window.scrollTo(0,0);
}

function buildFullReport(wpm, secs, words, level, grade) {
  const mins = secs / 60;
  const lvlNames={easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};

  // ‚îÄ‚îÄ AN√ÅLISE GERAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const mainItems = [];

  // 1. Velocidade com classifica√ß√£o detalhada
  let velClass, velDesc, velDica;
  if(wpm < 80){
    velClass='üî¥'; velDesc='Muito lenta (abaixo de 80 PPM)';
    velDica='Leitura sil√°bica ou subvocaliza√ß√£o excessiva. Voc√™ provavelmente l√™ cada palavra individualmente em voz interior. Treino: use um l√°pis como guia, acelerando o ritmo a cada p√°gina.';
  } else if(wpm < 150){
    velClass='üü†'; velDesc='Lenta (80‚Äì150 PPM)';
    velDica='Leitura palavra por palavra com pausas frequentes. Tente capturar grupos de 2‚Äì3 palavras por fixa√ß√£o. Leia textos f√°ceis cronometrado para ganhar flu√™ncia.';
  } else if(wpm < 200){
    velClass='üü°'; velDesc='Moderada (150‚Äì200 PPM)';
    velDica='Ritmo pr√≥ximo √† m√©dia. Para avan√ßar, reduza a subvocaliza√ß√£o e amplie seu campo de vis√£o perif√©rica durante a leitura.';
  } else if(wpm < 300){
    velClass='üü¢'; velDesc='M√©dia adulta (200‚Äì300 PPM)';
    velDica='Velocidade saud√°vel e produtiva. Foque em manter a compreens√£o enquanto aumenta gradualmente o ritmo com textos variados.';
  } else if(wpm < 400){
    velClass='üîµ'; velDesc='Acima da m√©dia (300‚Äì400 PPM)';
    velDica='√ìtima velocidade! Voc√™ est√° na faixa de leitores √°vidos. Continue desafiando-se com textos complexos para consolidar esse n√≠vel.';
  } else if(wpm < 600){
    velClass='‚≠ê'; velDesc='R√°pida (400‚Äì600 PPM)';
    velDica='Leitura de alto desempenho. Certifique-se que a compreens√£o acompanha ‚Äî teste-se resumindo o que leu sem reler.';
  } else {
    velClass='üöÄ'; velDesc='Excepcional (600+ PPM)';
    velDica='Velocidade de leitura de elite. Monitore sempre a compreens√£o; nessa velocidade o risco √© "passar os olhos" sem absorver.';
  }
  mainItems.push({icon:velClass, text:`<strong>Velocidade:</strong> ${wpm} PPM ‚Äî ${velDesc}`});

  // 2. Tempo e produtividade
  if(mins < 1){
    mainItems.push({icon:'‚è±Ô∏è', text:`<strong>Dura√ß√£o:</strong> ${Math.round(secs)}s ‚Äî sess√£o muito curta. Sess√µes de 10‚Äì20 minutos produzem resultados menores, mas s√£o um bom come√ßo.`});
  } else if(mins < 5){
    mainItems.push({icon:'‚è±Ô∏è', text:`<strong>Dura√ß√£o:</strong> ${Math.round(mins)} min ‚Äî sess√£o curta. Tente aumentar para 10‚Äì15 minutos por pr√°tica para ganhos consistentes.`});
  } else if(mins < 15){
    mainItems.push({icon:'‚è±Ô∏è', text:`<strong>Dura√ß√£o:</strong> ${Math.round(mins)} min ‚Äî sess√£o produtiva. Boa janela de concentra√ß√£o. Experimente sess√µes de 20 min com pausa de 5 min (Pomodoro).`});
  } else {
    mainItems.push({icon:'‚è±Ô∏è', text:`<strong>Dura√ß√£o:</strong> ${Math.round(mins)} min ‚Äî sess√£o longa! Excelente resist√™ncia de foco. Se sentir cansa√ßo, adote pausas curtas a cada 25 min.`});
  }

  // 3. Contexto do n√≠vel
  const levelInsight = {
    easy: `Textos f√°ceis s√£o ideais para medir sua <strong>velocidade base pura</strong>, sem carga cognitiva extra. Seu PPM aqui √© sua refer√™ncia de partida.`,
    medio: `N√≠vel m√©dio equilibra desafio e fluidez. √â o mais recomendado para <strong>treino regular</strong> de velocidade + compreens√£o.`,
    dificil: `Textos dif√≠ceis naturalmente reduzem o PPM ‚Äî isso √© normal e esperado. O ganho real aqui √© <strong>vocabul√°rio e resist√™ncia cognitiva</strong>.`,
    avancado: `N√≠vel avan√ßado √© para leitores experientes. A queda no PPM √© saud√°vel; priorize a <strong>compreens√£o profunda</strong> sobre a velocidade.`,
    extremo: `N√≠vel extremo representa o m√°ximo desafio. PPM reduzido √© inevit√°vel. O benef√≠cio √© o treino de <strong>racioc√≠nio anal√≠tico e concentra√ß√£o</strong>.`
  };
  mainItems.push({icon:'üìä', text:levelInsight[level]});

  // 4. Comparativo com m√©dias
  mainItems.push({icon:'üìà', text:`<strong>Comparativo:</strong> Crian√ßas 8‚Äì10 anos: ~100‚Äì150 PPM | Adultos casuais: 150‚Äì250 PPM | Leitores frequentes: 300‚Äì400 PPM | Speed readers: 600‚Äì1000 PPM. <em>Voc√™ est√° em ${wpm} PPM.</em>`});

  // 5. Estimativa de livro
  const pagesPerHour = Math.round((wpm * 60) / 250); // ~250 palavras por p√°gina
  mainItems.push({icon:'üìñ', text:`<strong>Estimativa de leitura:</strong> No seu ritmo atual, voc√™ leria aproximadamente <strong>${pagesPerHour} p√°ginas por hora</strong> (livro padr√£o de ~250 palavras/p√°gina). Um romance de 300 p√°ginas levaria cerca de <strong>${Math.round(300/pagesPerHour)} horas</strong>.`});

  renderItems('analysisItems', mainItems);

  // ‚îÄ‚îÄ PROBLEMAS IDENTIFICADOS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const problems = [];

  if(wpm < 100){
    problems.push({icon:'üê¢', text:`<strong>Velocidade muito baixa (${wpm} PPM):</strong> Prov√°vel causa: subvocaliza√ß√£o intensa (ouvir cada palavra mentalmente) ou leitura palavra por palavra. <em>Corre√ß√£o:</em> Treine com textos simples cronometrados, for√ßando-se a avan√ßar antes de terminar a vocaliza√ß√£o interna.`});
  }
  if(wpm > 500){
    problems.push({icon:'‚ö°', text:`<strong>Velocidade muito alta (${wpm} PPM):</strong> Em velocidades acima de 500 PPM h√° risco de perda de compreens√£o. <em>Corre√ß√£o:</em> Ap√≥s cada p√°gina, pare e resuma mentalmente o que leu. Se n√£o conseguir, reduza o ritmo.`});
  }
  if(mins < 2 && secs > 0){
    problems.push({icon:'‚è∞', text:`<strong>Tempo muito curto (${Math.round(secs)}s):</strong> Sess√µes abaixo de 2 minutos n√£o s√£o suficientes para medir velocidade real ou desenvolver resist√™ncia de leitura. <em>Corre√ß√£o:</em> Fa√ßa sess√µes de pelo menos 5 minutos por texto.`});
  }
  if(level==='easy' && wpm < 150){
    problems.push({icon:'üìö', text:`<strong>PPM baixo em texto f√°cil:</strong> Em textos f√°ceis o esperado √© PPM mais alto, pois h√° pouca carga cognitiva. Velocidade de ${wpm} PPM aqui indica dificuldade de flu√™ncia b√°sica. <em>Corre√ß√£o:</em> Leia em voz alta diariamente por 10 minutos, depois evolua para leitura silenciosa acelerada.`});
  }
  if(level==='avancado' && wpm > 350){
    problems.push({icon:'üß†', text:`<strong>Velocidade alta em n√≠vel avan√ßado:</strong> ${wpm} PPM em texto avan√ßado pode indicar leitura superficial ‚Äî os olhos passam mas o c√©rebro n√£o processa totalmente. <em>Corre√ß√£o:</em> Teste sua compreens√£o escrevendo 3 ideias principais do texto sem reler.`});
  }

  if(problems.length > 0){
    document.getElementById('diagBox').style.display = '';
    renderItems('diagItems', problems);
  } else {
    document.getElementById('diagBox').style.display = 'none';
  }

  // ‚îÄ‚îÄ PONTOS FORTES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const strengths = [];

  if(wpm >= 200 && wpm < 500){
    strengths.push({icon:'‚úÖ', text:`<strong>Velocidade dentro da faixa saud√°vel (${wpm} PPM):</strong> Voc√™ l√™ na faixa ideal para combinar velocidade e compreens√£o. Isso demonstra h√°bito de leitura consistente.`});
  }
  if(mins >= 5){
    strengths.push({icon:'üßò', text:`<strong>Boa resist√™ncia de foco:</strong> Voc√™ manteve aten√ß√£o por ${Math.round(mins)} minutos cont√≠nuos. Isso √© uma habilidade cognitiva cada vez mais rara no mundo digital.`});
  }
  if(level === 'dificil' || level === 'avancado' || level === 'extremo'){
    strengths.push({icon:'üí™', text:`<strong>Coragem no desafio:</strong> Voc√™ escolheu o n√≠vel <strong>${lvlNames[level]}</strong> ‚Äî isso demonstra disposi√ß√£o para sair da zona de conforto, o que √© o principal motor do desenvolvimento.`});
  }
  if(wpm >= 150){
    strengths.push({icon:'üëÅÔ∏è', text:`<strong>Flu√™ncia de leitura:</strong> Sua velocidade sugere que voc√™ n√£o solethra palavras individualmente, indicando boa automatiza√ß√£o da decodifica√ß√£o ‚Äî base fundamental da leitura eficiente.`});
  }

  if(strengths.length > 0){
    document.getElementById('strongBox').style.display = '';
    renderItems('strongItems', strengths);
  } else {
    document.getElementById('strongBox').style.display = 'none';
  }

  // ‚îÄ‚îÄ PLANO DE MELHORIA PERSONALIZADO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const plan = [];

  // Prioridade 1: velocidade
  if(wpm < 150){
    plan.push({icon:'1Ô∏è‚É£', text:`<strong>PRIORIDADE 1 ‚Äî Flu√™ncia b√°sica:</strong> Leia 10 min/dia em voz alta, textos f√°ceis. Depois repita o mesmo trecho silenciosamente tentando ser mais r√°pido. Esse ciclo dissolve a subvocaliza√ß√£o.`});
  } else if(wpm < 250){
    plan.push({icon:'1Ô∏è‚É£', text:`<strong>PRIORIDADE 1 ‚Äî Ampliar campo visual:</strong> Treine focar no centro da linha e capturar as palavras laterais com vis√£o perif√©rica. Evite regredir (reler palavras j√° lidas) ‚Äî uma passada s√≥ pelo par√°grafo.`});
  } else {
    plan.push({icon:'1Ô∏è‚É£', text:`<strong>PRIORIDADE 1 ‚Äî Manter e consolidar:</strong> Voc√™ est√° em boa velocidade. Agora varie os g√™neros: t√©cnicos, liter√°rios, cient√≠ficos. Cada tipo treina um aspecto diferente da cogni√ß√£o.`});
  }

  // Prioridade 2: tempo de pr√°tica
  if(mins < 5){
    plan.push({icon:'2Ô∏è‚É£', text:`<strong>PRIORIDADE 2 ‚Äî Aumentar dura√ß√£o:</strong> Estabele√ßa meta de 10 minutos de leitura cont√≠nua diariamente. Use o m√©todo Pomodoro: 25 min leitura + 5 min pausa. A consist√™ncia supera a intensidade.`});
  } else {
    plan.push({icon:'2Ô∏è‚É£', text:`<strong>PRIORIDADE 2 ‚Äî Compreens√£o ativa:</strong> Ap√≥s cada texto, escreva (ou diga em voz alta) 3 ideias que reteve. Isso treina a mem√≥ria ativa e revela se a velocidade est√° superando a absor√ß√£o.`});
  }

  // Prioridade 3: progress√£o de n√≠vel
  if(level === 'easy' && wpm >= 200){
    plan.push({icon:'3Ô∏è‚É£', text:`<strong>PRIORIDADE 3 ‚Äî Avan√ßar de n√≠vel:</strong> Voc√™ est√° pronto para textos m√©dios! Suba um n√≠vel na pr√≥xima sess√£o. A resist√™ncia a textos mais densos expande seu vocabul√°rio e velocidade nos textos f√°ceis.`});
  } else if(level === 'medio' && wpm >= 250){
    plan.push({icon:'3Ô∏è‚É£', text:`<strong>PRIORIDADE 3 ‚Äî Experimentar n√≠vel Dif√≠cil:</strong> Seu desempenho no n√≠vel m√©dio indica que voc√™ pode aguentar textos mais densos. Experimente 1 sess√£o dif√≠cil por semana.`});
  } else {
    plan.push({icon:'3Ô∏è‚É£', text:`<strong>PRIORIDADE 3 ‚Äî Manter o n√≠vel atual:</strong> Foque em estabilizar seu PPM no n√≠vel <strong>${lvlNames[level]}</strong> antes de subir. Repita o mesmo texto em dias diferentes e observe a evolu√ß√£o.`});
  }

  // Meta semanal
  const meta = Math.round(wpm * 1.12);
  plan.push({icon:'üéØ', text:`<strong>Meta para a pr√≥xima semana:</strong> Alcan√ßar <strong>${meta} PPM</strong> no mesmo n√≠vel (${lvlNames[level]}). Um aumento de 10‚Äì15% por semana √© realista e sustent√°vel com pr√°tica di√°ria de 10‚Äì15 minutos.`});

  renderItems('planItems', plan);
}

function renderItems(containerId, items){
  const box = document.getElementById(containerId);
  box.innerHTML = '';
  items.forEach(item => {
    const d = document.createElement('div');
    d.className = 'analysis-item';
    d.innerHTML = `<span class="analysis-icon" style="font-size:1.1rem">${item.icon}</span><div style="font-size:.9rem;line-height:1.65">${item.text}</div>`;
    box.appendChild(d);
  });
}

// Mantido para compatibilidade
function buildAnalysis(wpm,secs,words,level){ return []; }

function tryAgain(){ startReading(); }
function nextText(){
  const texts = TEXTS[currentLevel]||[];
  const idx = texts.findIndex(t=>t.id===currentTextId);
  const next = texts[(idx+1)%texts.length];
  if(next){ currentTextId=next.id; currentText=next; startReading(); }
  else goHome();
}

// ===== SPEECH ANALYZER =====
let speechMode = 'free';
let mediaRecorder = null;
let audioContext = null;
let analyserNode = null;
let recognition = null;
let recSeconds = 0;
let recInterval = null;
let isRecording = false;
let fullTranscript = '';
let wordTimestamps = [];
let pauseCount = 0;
let hesitationCount = 0;
let speechWordCount = 0;
let lastWordTime = 0;
let speechTextWords = [];
let spokenWordIndex = 0;

const HESITATION_WORDS = ['√£','√™','n√©','tipo','assim','ent√£o','sabe','t√°','√©','ahn','hm','hmm','ah','uh','eh','uhm'];
const FILLER_WORDS = ['n√©','tipo','assim','ent√£o','sabe','literalmente','basicamente','enfim','ali√°s','inclusive','meio que','tipo assim'];

function checkSpeechSupport(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){
    document.getElementById('speechSupportBadge').textContent = '‚ö† Use Chrome/Edge';
    document.getElementById('speechSupportBadge').style.color = 'var(--medio)';
  }
}

function selectSpeechMode(mode){
  speechMode = mode;
  document.getElementById('modeCard-free').classList.toggle('selected', mode==='free');
  document.getElementById('modeCard-text').classList.toggle('selected', mode==='text');
  document.getElementById('speechTextSelector').style.display = mode==='text' ? '' : 'none';
}

function populateSpeechTextSelect(){
  const sel = document.getElementById('speechTextSelect');
  const lvlNames={easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};
  Object.values(TEXTS).flat().forEach(t=>{
    const opt = document.createElement('option');
    opt.value = t.id;
    opt.textContent = `[${lvlNames[t.level]}] ${t.title}`;
    sel.appendChild(opt);
  });
}

function loadSpeechText(){
  const id = document.getElementById('speechTextSelect').value;
  if(!id){ document.getElementById('speechRefText').style.display='none'; return; }
  const text = Object.values(TEXTS).flat().find(t=>t.id===id);
  if(!text) return;
  const box = document.getElementById('speechRefText');
  box.style.display = '';
  speechTextWords = text.body.trim().split(/\s+/);
  spokenWordIndex = 0;
  box.innerHTML = speechTextWords.map((w,i)=>`<span class="speech-ref-word" id="rw${i}">${w}</span> `).join('');
  if(speechTextWords[0]) document.getElementById('rw0').className = 'speech-ref-word current';
}

function toggleRecord(){
  if(isRecording) stopRecording();
  else startRecording();
}

function startRecording(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){ showToast('Use Chrome ou Edge para o analisador de fala!'); return; }

  isRecording = true;
  fullTranscript = '';
  wordTimestamps = [];
  pauseCount = 0;
  hesitationCount = 0;
  speechWordCount = 0;
  lastWordTime = Date.now();
  spokenWordIndex = 0;
  recSeconds = 0;
  speechTextWords = speechMode==='text' ? (()=>{
    const id=document.getElementById('speechTextSelect').value;
    const t=id?Object.values(TEXTS).flat().find(x=>x.id===id):null;
    return t?t.body.trim().split(/\s+/):[];
  })() : [];

  // Reset ref text
  if(speechMode==='text') loadSpeechText();

  document.getElementById('transcriptPlaceholder').style.display='none';
  document.getElementById('transcriptContent').style.display='';
  document.getElementById('transcriptContent').innerHTML='';
  document.getElementById('speechMetrics').style.display='none';
  document.getElementById('problemsPanel').style.display='none';

  document.getElementById('recDot').className='rec-dot active';
  document.getElementById('recStatusText').textContent='Gravando... fale agora!';
  document.getElementById('btnRecIcon').textContent='‚èπ';
  document.getElementById('btnRecText').textContent='Parar Grava√ß√£o';
  document.getElementById('btnRecord').classList.add('recording');
  document.getElementById('btnAnalyze').style.display='none';
  document.getElementById('waveIdleMsg').style.display='none';

  recInterval = setInterval(()=>{
    recSeconds++;
    document.getElementById('recTimer').textContent=pad(Math.floor(recSeconds/60))+':'+pad(recSeconds%60);
    checkForPause();
  },1000);

  startWaveform();
  startRecognition();
}

function stopRecording(){
  isRecording = false;
  clearInterval(recInterval);
  if(recognition) try{ recognition.stop(); }catch(e){}
  stopWaveform();

  document.getElementById('recDot').className='rec-dot ready';
  document.getElementById('recStatusText').textContent=`Grava√ß√£o conclu√≠da ‚Äî ${recSeconds}s`;
  document.getElementById('btnRecIcon').textContent='‚è∫';
  document.getElementById('btnRecText').textContent='Nova Grava√ß√£o';
  document.getElementById('btnRecord').classList.remove('recording');

  if(fullTranscript.trim()) {
    document.getElementById('btnAnalyze').style.display='';
    setTimeout(analyzeCurrentSpeech, 400);
  }
}

function startRecognition(){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SR();
  recognition.lang = 'pt-BR';
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.maxAlternatives = 1;

  let interimEl = null;

  recognition.onresult = (e) => {
    let interim = '';
    for(let i=e.resultIndex;i<e.results.length;i++){
      const res = e.results[i];
      if(res.isFinal){
        const text = res[0].transcript.trim();
        processFinalText(text);
        if(interimEl){ interimEl.remove(); interimEl=null; }
      } else {
        interim = res[0].transcript;
      }
    }
    if(interim){
      if(!interimEl){
        interimEl=document.createElement('span');
        interimEl.style.cssText='color:var(--ink3);font-style:italic';
        document.getElementById('transcriptContent').appendChild(interimEl);
      }
      interimEl.textContent=' '+interim;
    }
  };

  recognition.onerror = (e) => {
    if(e.error==='no-speech') return;
    if(isRecording && e.error!=='aborted') setTimeout(()=>{ if(isRecording) startRecognition(); },500);
  };

  recognition.onend = () => {
    if(isRecording) setTimeout(()=>{ if(isRecording) startRecognition(); },200);
  };

  try { recognition.start(); } catch(e){}
}

function processFinalText(text){
  if(!text) return;
  lastWordTime = Date.now();
  const words = text.split(/\s+/).filter(Boolean);
  const container = document.getElementById('transcriptContent');

  words.forEach(raw => {
    const word = raw.toLowerCase().replace(/[.,!?;:]/g,'');
    speechWordCount++;
    wordTimestamps.push({word,time:Date.now()});

    const span = document.createElement('span');
    span.className = 'transcript-word';

    const isHesit = HESITATION_WORDS.includes(word);
    const isFiller = FILLER_WORDS.includes(word);

    if(isHesit){ span.className+=' hesitation'; hesitationCount++; }
    else if(isFiller){ span.className+=' problem'; }

    span.textContent = raw + ' ';
    span.title = isHesit ? '‚ö† Hesita√ß√£o detectada' : isFiller ? '‚ö† V√≠cio de linguagem' : '';
    container.appendChild(span);

    // Text mode: highlight reference
    if(speechMode==='text' && speechTextWords.length){
      const refWord = speechTextWords[spokenWordIndex]?.toLowerCase().replace(/[.,!?;:]/g,'');
      if(refWord){
        const refEl = document.getElementById('rw'+spokenWordIndex);
        if(refEl){
          if(word === refWord || levenshtein(word,refWord)<=1){
            refEl.className='speech-ref-word spoken-correct';
          } else {
            refEl.className='speech-ref-word spoken-wrong';
          }
        }
        spokenWordIndex++;
        const nextEl = document.getElementById('rw'+spokenWordIndex);
        if(nextEl) nextEl.className='speech-ref-word current';
      }
    }
  });

  fullTranscript += ' ' + text;
}

function checkForPause(){
  if(!isRecording || !speechWordCount) return;
  const elapsed = (Date.now() - lastWordTime)/1000;
  if(elapsed > 3) pauseCount++;
}

// Waveform
let animFrame = null;
let streamRef = null;
function startWaveform(){
  navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
    streamRef = stream;
    audioContext = new (window.AudioContext||window.webkitAudioContext)();
    const source = audioContext.createMediaStreamSource(stream);
    analyserNode = audioContext.createAnalyser();
    analyserNode.fftSize = 256;
    source.connect(analyserNode);
    drawWaveform();
  }).catch(()=>{
    document.getElementById('waveIdleMsg').textContent='üîá Microfone n√£o autorizado';
    document.getElementById('waveIdleMsg').style.display='';
  });
}

function drawWaveform(){
  const canvas = document.getElementById('waveformCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = canvas.offsetWidth;
  canvas.height = 80;
  const buf = new Uint8Array(analyserNode.frequencyBinCount);

  function draw(){
    animFrame = requestAnimationFrame(draw);
    analyserNode.getByteFrequencyData(buf);
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#0d1117';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    const barW = canvas.width/buf.length;
    buf.forEach((v,i)=>{
      const h = (v/255)*canvas.height;
      const hue = 200+i*0.5;
      ctx.fillStyle=`hsl(${hue},80%,${40+v*0.15}%)`;
      ctx.fillRect(i*barW, canvas.height-h, barW-1, h);
    });
  }
  draw();
}

function stopWaveform(){
  if(animFrame) cancelAnimationFrame(animFrame);
  if(streamRef) streamRef.getTracks().forEach(t=>t.stop());
  if(audioContext) audioContext.close().catch(()=>{});
  const canvas = document.getElementById('waveformCanvas');
  const ctx = canvas.getContext('2d');
  ctx.fillStyle='#0d1117';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  document.getElementById('waveIdleMsg').style.display='';
  document.getElementById('waveIdleMsg').textContent='üé§ aguardando grava√ß√£o‚Ä¶';
}

// ===== SPEECH ANALYSIS - COMPLETA =====
function analyzeCurrentSpeech(){
  if(!fullTranscript.trim()){ showToast('Grave algo primeiro!'); return; }

  const words = fullTranscript.trim().split(/\s+/).filter(Boolean);
  const totalWords = words.length;
  const wpm = recSeconds>0 ? Math.round((totalWords/recSeconds)*60) : 0;
  const durationMin = recSeconds/60;

  // Filler detection
  const fillerFound = {};
  words.forEach(w=>{
    const clean = w.toLowerCase().replace(/[.,!?;:]/g,'');
    if(FILLER_WORDS.includes(clean)) fillerFound[clean]=(fillerFound[clean]||0)+1;
  });

  // Repetition detection
  const repeated = {};
  for(let i=0;i<words.length-1;i++){
    const a=words[i].toLowerCase().replace(/[.,!?;:]/g,'');
    const b=words[i+1].toLowerCase().replace(/[.,!?;:]/g,'');
    if(a===b && a.length>2) repeated[a]=(repeated[a]||0)+1;
  }

  // Speed classification
  let speedClass, speedLabel, speedColor, speedDica;
  if(wpm<60){
    speedClass='error'; speedLabel='‚ö†Ô∏è MUITO LENTA'; speedColor='var(--dificil)';
    speedDica='Sua fala est√° extremamente lenta. Isso pode causar perda de aten√ß√£o do ouvinte. Treine leitura em voz alta diariamente para ganhar fluidez natural.';
  } else if(wpm<80){
    speedClass='warning'; speedLabel='üê¢ LENTA'; speedColor='var(--medio)';
    speedDica='Velocidade abaixo do ideal. Fale com mais confian√ßa ‚Äî inseguran√ßa costuma deixar a fala arrastada. Respire fundo antes de come√ßar e mantenha o ritmo.';
  } else if(wpm<=100){
    speedClass='info'; speedLabel='üö∂ BOA (Moderada)'; speedColor='var(--speech)';
    speedDica='Velocidade levemente abaixo da ideal, mas ainda boa. Adequada para explica√ß√µes t√©cnicas ou audi√™ncias que precisam absorver muito conte√∫do.';
  } else if(wpm<=160){
    speedClass='success'; speedLabel='‚úÖ IDEAL'; speedColor='var(--easy)';
    speedDica='Parab√©ns! Velocidade ideal para comunica√ß√£o clara e profissional. Continue mantendo esse ritmo.';
  } else if(wpm<=180){
    speedClass='info'; speedLabel='üöÄ BOA (Animada)'; speedColor='var(--speech)';
    speedDica='Velocidade um pouco elevada, mas ainda aceit√°vel. Lembre-se de respirar entre os per√≠odos e dar pausas de √™nfase nas palavras importantes.';
  } else if(wpm<=220){
    speedClass='warning'; speedLabel='üèéÔ∏è R√ÅPIDA'; speedColor='var(--medio)';
    speedDica='Voc√™ est√° falando r√°pido demais. O ouvinte pode perder partes. Tente desacelerar conscientemente, especialmente em trechos importantes.';
  } else {
    speedClass='error'; speedLabel='‚ö° MUITO R√ÅPIDA'; speedColor='var(--dificil)';
    speedDica='Velocidade extremamente alta. Dificilmente algu√©m consegue acompanhar. Fa√ßa exerc√≠cios de respira√ß√£o diafragm√°tica e pratique falar mais devagar.';
  }

  // Hesitation ratio
  const hesitRatio = totalWords>0 ? Math.round((hesitationCount/totalWords)*100) : 0;

  // Score 0-100
  let score = 100;
  if(wpm<60) score-=25; else if(wpm<80) score-=15; else if(wpm>220) score-=25; else if(wpm>180) score-=10;
  score -= Math.min(30, Object.values(fillerFound).reduce((a,b)=>a+b,0)*5);
  score -= Math.min(20, hesitationCount*3);
  score -= Math.min(15, pauseCount*3);
  score -= Math.min(10, Object.values(repeated).reduce((a,b)=>a+b,0)*4);
  score = Math.max(0, Math.min(100, score));

  // Grade
  const grade = score>=90?'S':score>=80?'A':score>=70?'B':score>=60?'C':score>=50?'D':'F';
  const gradeDesc = {S:'Excepcional',A:'√ìtimo',B:'Bom',C:'Regular',D:'Fraco',F:'Cr√≠tico'}[grade];

  // Update metrics display
  document.getElementById('metWPM').textContent = wpm;
  document.getElementById('metPauses').textContent = pauseCount;
  document.getElementById('metHesit').textContent = hesitationCount;
  document.getElementById('metScore').textContent = score;
  document.getElementById('metWPM').style.color = speedColor;
  document.getElementById('metScore').style.color = score>=80?'var(--easy)':score>=60?'var(--medio)':'var(--dificil)';
  document.getElementById('speechMetrics').style.display='';

  // Build problems list
  const problems = [];

  // 1. SCORE GERAL com grade
  const scoreEmoji = score>=80?'üèÜ':score>=60?'üìà':'üìâ';
  const scoreTipo = score>=80?'success':score>=60?'info':'error';
  problems.push({type:scoreTipo, icon:scoreEmoji, title:`Score Geral: ${score}/100 ‚Äî Nota ${grade} (${gradeDesc})`,
    desc:`Voc√™ falou ${totalWords} palavras em ${Math.floor(recSeconds/60)}m${recSeconds%60}s. ${score>=80?'√ìtima performance! Continue praticando para manter o n√≠vel.':score>=60?'Desempenho satisfat√≥rio. Com foco nos pontos abaixo voc√™ melhora rapidamente.':'V√°rios aspectos precisam de aten√ß√£o. Foque em um ponto de cada vez.'}`});

  // 2. VELOCIDADE - bloco detalhado
  problems.push({type:speedClass, icon:'üéôÔ∏è', title:`Velocidade: ${wpm} PPM ‚Äî ${speedLabel}`,
    desc:`${speedDica} Refer√™ncia: abaixo de 80 = lenta | 80‚Äì100 = moderada | 100‚Äì160 = ideal | 160‚Äì180 = animada | acima de 180 = r√°pida demais.`});

  // 3. HESITA√á√ïES
  if(hesitationCount===0){
    problems.push({type:'success',icon:'üéØ',title:'Zero hesita√ß√µes! Fala muito fluente',desc:'Voc√™ n√£o usou sons de hesita√ß√£o como "√£", "√™", "hm" ou "ah". Isso demonstra dom√≠nio do conte√∫do e seguran√ßa ao falar.'});
  } else if(hesitationCount<=2){
    problems.push({type:'info',icon:'üí¨',title:`${hesitationCount} hesita√ß√£o(√µes) detectada(s)`,desc:`Ocorr√™ncia leve de "√£", "√™", "hm" ‚Äî normal em fala espont√¢nea. Se quiser eliminar, tente pausar em sil√™ncio em vez de emitir sons de preenchimento.`});
  } else if(hesitationCount<=5){
    problems.push({type:'warning',icon:'üòê',title:`${hesitationCount} hesita√ß√µes ‚Äî n√≠vel moderado`,desc:`Hesita√ß√µes frequentes podem indicar falta de familiaridade com o conte√∫do ou nervosismo. Dica: grave mais vezes o mesmo texto at√© fluir naturalmente.`});
  } else {
    problems.push({type:'error',icon:'üò¨',title:`${hesitationCount} hesita√ß√µes ‚Äî n√≠vel alto (${hesitRatio}% das palavras)`,desc:`Alta taxa de hesita√ß√µes. Sons como "√£", "√™", "hm", "ah" enfraquecem sua comunica√ß√£o e transmitem inseguran√ßa. Pratique pausas em sil√™ncio ‚Äî o sil√™ncio √© mais profissional do que sons de hesita√ß√£o.`});
  }

  // 4. V√çCIOS DE LINGUAGEM
  const fillerTotal = Object.values(fillerFound).reduce((a,b)=>a+b,0);
  if(fillerTotal===0){
    problems.push({type:'success',icon:'‚ú®',title:'Nenhum v√≠cio de linguagem detectado',desc:'Excelente! Voc√™ n√£o usou palavras-v√≠cio como "n√©", "tipo", "assim", "basicamente" etc. Isso demonstra vocabul√°rio rico e comunica√ß√£o limpa.'});
  } else {
    const fillerList = Object.entries(fillerFound).sort((a,b)=>b[1]-a[1]).map(([w,c])=>`"${w}" ${c}x`).join(' ¬∑ ');
    problems.push({type: fillerTotal>5?'error':'warning', icon:'üîÅ', title:`${fillerTotal} v√≠cios de linguagem detectados`,
      desc:`Palavras-v√≠cio encontradas: ${fillerList}. Essas express√µes enfraquecem sua comunica√ß√£o. Quando sentir vontade de us√°-las, substitua por uma pausa curta em sil√™ncio.`});
  }

  // 5. REPETI√á√ïES
  const repTotal = Object.values(repeated).reduce((a,b)=>a+b,0);
  if(repTotal>0){
    const repList = Object.keys(repeated).map(w=>`"${w}"`).join(', ');
    problems.push({type:'warning',icon:'üîÑ',title:`${repTotal} repeti√ß√£o(√µes) consecutiva(s) de palavras`,
      desc:`Palavras ditas duas vezes seguidas: ${repList}. Isso pode indicar distra√ß√£o ou nervosismo. Releia o conte√∫do antes de gravar e mantenha o foco.`});
  }

  // 6. PAUSAS
  if(pauseCount===0){
    problems.push({type:'success',icon:'‚ñ∂Ô∏è',title:'Fala sem pausas longas excessivas',desc:'Voc√™ manteve um fluxo cont√≠nuo sem interrup√ß√µes longas. √ìtimo para demonstrar dom√≠nio do conte√∫do.'});
  } else if(pauseCount<=2){
    problems.push({type:'info',icon:'‚è∏Ô∏è',title:`${pauseCount} pausa(s) longa(s) ‚Äî aceit√°vel`,desc:'Pausas ocasionais s√£o normais e podem at√© criar √™nfase. Apenas cuide para n√£o interromper o racioc√≠nio do ouvinte.'});
  } else if(pauseCount<=4){
    problems.push({type:'warning',icon:'‚è∏Ô∏è',title:`${pauseCount} pausas longas detectadas`,desc:'Muitas pausas longas quebram o ritmo e fazem o ouvinte perder o fio. Tente manter o fluxo e organize seu racioc√≠nio antes de falar.'});
  } else {
    problems.push({type:'error',icon:'üõë',title:`${pauseCount} pausas longas ‚Äî impacto alto`,desc:`${pauseCount} interrup√ß√µes longas (>3s) foram identificadas. Isso prejudica significativamente a experi√™ncia do ouvinte. Pratique o conte√∫do at√© dominar bem, e evite improvisar sem prepara√ß√£o.`});
  }

  // 7. COBERTURA DE TEXTO (modo texto)
  if(speechMode==='text' && speechTextWords.length>0){
    const coverage = Math.min(100,Math.round((spokenWordIndex/speechTextWords.length)*100));
    const missed = speechTextWords.length - spokenWordIndex;
    if(coverage<70){
      problems.push({type:'error',icon:'üìÑ',title:`Apenas ${coverage}% do texto foi coberto`,desc:`${missed} palavras foram puladas ou n√£o reconhecidas. Fale mais claramente e devagar para o reconhecimento de voz funcionar melhor. Tente novamente cobrindo todo o texto.`});
    } else if(coverage<90){
      problems.push({type:'warning',icon:'üìÑ',title:`${coverage}% do texto coberto ‚Äî bom!`,desc:`Quase l√°! Algumas palavras n√£o foram reconhecidas. Trabalhe a dic√ß√£o especialmente em palavras dif√≠ceis ou t√©cnicas.`});
    } else {
      problems.push({type:'success',icon:'üìÑ',title:`${coverage}% do texto coberto ‚Äî excelente!`,desc:'Voc√™ leu praticamente todo o texto com clareza suficiente para o reconhecimento de voz captar. √ìtima dic√ß√£o!'});
    }
  }

  // 8. DICA PERSONALIZADA FINAL
  const topProblem = score<60?'hesita√ß√µes e v√≠cios':hesitationCount>3?'hesita√ß√µes':fillerTotal>3?'v√≠cios de linguagem':pauseCount>3?'pausas longas':'ritmo';
  problems.push({type:'info',icon:'üí°',title:'Dica personalizada para voc√™',
    desc:`Com base na sua an√°lise, o foco principal deve ser: ${topProblem}. Grave-se todos os dias por 5 minutos lendo em voz alta. A consist√™ncia √© mais importante que a dura√ß√£o da pr√°tica.`});

  // Render
  const list = document.getElementById('problemsList');
  list.innerHTML = '';
  problems.forEach(p=>{
    const d = document.createElement('div');
    d.className = `problem-item ${p.type}`;
    d.innerHTML = `<span class="problem-icon" style="font-size:1.2rem">${p.icon}</span><div class="problem-text"><strong style="font-size:.9rem">${p.title}</strong><br><span style="font-size:.82rem">${p.desc}</span></div>`;
    list.appendChild(d);
  });
  document.getElementById('problemsPanel').style.display='';
  document.getElementById('problemsPanel').scrollIntoView({behavior:'smooth',block:'start'});
}

function clearSpeech(){
  fullTranscript='';
  speechWordCount=0;
  hesitationCount=0;
  pauseCount=0;
  recSeconds=0;
  document.getElementById('transcriptContent').innerHTML='';
  document.getElementById('transcriptPlaceholder').style.display='';
  document.getElementById('transcriptContent').style.display='none';
  document.getElementById('speechMetrics').style.display='none';
  document.getElementById('problemsPanel').style.display='none';
  document.getElementById('btnAnalyze').style.display='none';
  document.getElementById('recTimer').textContent='00:00';
  document.getElementById('recStatusText').textContent='Pronto para gravar.';
  document.getElementById('recDot').className='rec-dot';
  if(speechMode==='text') loadSpeechText();
}

// Levenshtein for word comparison
function levenshtein(a,b){
  const m=a.length,n=b.length;
  const dp=Array.from({length:m+1},(_,i)=>Array.from({length:n+1},(_,j)=>i===0?j:j===0?i:0));
  for(let i=1;i<=m;i++) for(let j=1;j<=n;j++) dp[i][j]=a[i-1]===b[j-1]?dp[i-1][j-1]:1+Math.min(dp[i-1][j],dp[i][j-1],dp[i-1][j-1]);
  return dp[m][n];
}

// ===== NAVIGATION =====
function showScreen(name){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen-'+name).classList.add('active');
}
function goHome(){
  clearInterval(timerInterval);
  timerRunning=false;
  showScreen('home');
  updateStats();
}

// ===== HISTORY =====
function showHistory(){
  if(!history.length){ showToast('Nenhum hist√≥rico ainda!'); return; }
  const lvlNames={easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};
  const gc={S:'#c8a000',A:'#2d7a3a',B:'#4caf50',C:'#b06a00',D:'#c0392b',F:'#888'};
  const html=history.slice(0,15).map(h=>`
    <div style="display:flex;align-items:center;gap:14px;padding:10px 16px;background:#fff;border:1px solid #e8e0d0;border-radius:10px;margin-bottom:8px">
      <div style="font-family:serif;font-size:1.3rem;font-weight:700;color:${gc[h.grade]||'#333'};min-width:55px">${h.wpm}</div>
      <div style="flex:1"><div style="font-weight:500;font-size:.83rem;margin-bottom:2px">${h.title}</div><div style="font-size:.68rem;color:#9a8870;font-family:monospace">${h.date} ¬∑ ${lvlNames[h.level]||h.level} ¬∑ ${h.time}</div></div>
      <div style="font-size:.7rem;font-weight:700;padding:3px 10px;border-radius:20px;background:${gc[h.grade]}22;color:${gc[h.grade]}">${h.grade}</div>
    </div>`).join('');
  const w=window.open('','_blank','width=560,height=620');
  w.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Hist√≥rico</title><style>body{font-family:sans-serif;background:#faf8f4;padding:24px;color:#1a1410}h2{font-family:serif;font-size:1.4rem;margin-bottom:18px}</style></head><body><h2>üìä Hist√≥rico de Leituras</h2>${html}</body></html>`);
}

// ===== TOAST =====
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2800);
}

// ===== RUN =====
init();
</script>
</body>
</html>
