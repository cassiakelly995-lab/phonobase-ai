<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHONOBASE 3.0 ¬∑ Avalia√ß√£o & Desafios Fonoaudiol√≥gicos</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=IBM+Plex+Mono:wght@300;400;500;700&family=Syne:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#050608;--s1:#090b10;--s2:#0e1118;--s3:#13171f;--s4:#1a1f2c;--s5:#222738;
  --border:rgba(255,255,255,.07);--border2:rgba(255,255,255,.04);
  --t0:#dce8ff;--t1:#8a9dc0;--t2:#4a566e;--t3:#252d3f;
  --cyan:#00d4ff;--cyanD:rgba(0,212,255,.1);
  --grn:#00e5a0;--grnD:rgba(0,229,160,.1);
  --amb:#ffb340;--ambD:rgba(255,179,64,.1);
  --red:#ff4f6b;--redD:rgba(255,79,107,.1);
  --pur:#b06cff;--purD:rgba(176,108,255,.1);
  --rose:#ff6b9d;--gold:#ffd700;
}
html,body{height:100%;background:var(--bg);color:var(--t0);font-family:'Syne',sans-serif;font-size:13px;overflow:hidden}
::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-thumb{background:var(--s5)}
::-webkit-scrollbar-track{background:transparent}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  background-size:256px;opacity:.4}

/* ‚ïê‚ïê LAYOUT ‚ïê‚ïê */
.app{display:grid;grid-template-rows:52px 1fr;height:100vh;position:relative;z-index:1}
.top{background:rgba(9,11,16,.97);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);
  display:flex;align-items:center;padding:0 12px;gap:6px;z-index:200;flex-shrink:0}
.brand{font-family:'IBM Plex Mono',monospace;font-weight:700;font-size:11px;letter-spacing:3px;
  color:var(--t0);padding-right:12px;border-right:1px solid var(--border);
  display:flex;align-items:center;gap:7px;flex-shrink:0;white-space:nowrap}
.brand-icon{width:20px;height:20px;border-radius:50%;background:conic-gradient(var(--cyan),var(--pur),var(--rose),var(--cyan));flex-shrink:0}
.brand em{color:var(--cyan);font-style:normal}
.brand sup{font-size:7px;color:var(--gold);vertical-align:super}
.ttabs{display:flex;overflow-x:auto;gap:0;flex-shrink:0}
.ttabs::-webkit-scrollbar{height:0}
.ttab{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;
  padding:0 11px;height:52px;display:flex;align-items:center;gap:4px;background:none;border:none;
  color:var(--t3);cursor:pointer;transition:all .15s;border-bottom:2px solid transparent;white-space:nowrap}
.ttab:hover{color:var(--t1)}
.ttab.on{color:var(--cyan);border-bottom-color:var(--cyan)}
.top-r{display:flex;align-items:center;gap:6px;margin-left:auto;flex-shrink:0}
.streak-badge{font-family:'IBM Plex Mono',monospace;font-size:9px;padding:3px 8px;
  border:1px solid rgba(255,215,0,.3);color:var(--gold);display:flex;align-items:center;gap:4px}
.pts-badge{font-family:'IBM Plex Mono',monospace;font-size:9px;padding:3px 8px;
  border:1px solid rgba(0,229,160,.3);color:var(--grn)}
.ver-b{font-family:'IBM Plex Mono',monospace;font-size:8px;padding:3px 7px;border:1px solid rgba(0,212,255,.3);color:var(--cyan)}

/* ‚ïê‚ïê BODY ‚ïê‚ïê */
.body{display:grid;grid-template-columns:230px 1fr;overflow:hidden}

/* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
.sidebar{background:var(--s1);border-right:1px solid var(--border);overflow-y:auto;display:flex;flex-direction:column}
.slbl{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:3px;text-transform:uppercase;color:var(--t3)}
.pat-sec{padding:10px 12px;border-bottom:1px solid var(--border2)}
.pat-sec .slbl{margin-bottom:7px}
.fi{margin-bottom:6px}
.fi label{font-size:8px;color:var(--t2);display:block;margin-bottom:2px;font-family:'IBM Plex Mono',monospace;letter-spacing:1px;text-transform:uppercase}
.fi input,.fi select{width:100%;background:var(--s2);border:1px solid var(--border);color:var(--t0);
  font-family:'IBM Plex Mono',monospace;font-size:9px;padding:4px 6px;outline:none;transition:border .15s}
.fi input:focus,.fi select:focus{border-color:var(--cyan)}
.fi select option{background:var(--s2)}
.fi-row{display:grid;grid-template-columns:1fr 1fr;gap:5px}

/* Mode selector */
.mode-sec{padding:10px 12px;border-bottom:1px solid var(--border2)}
.mode-sec .slbl{margin-bottom:7px}
.mode-grid{display:grid;grid-template-columns:1fr 1fr;gap:3px}
.mode-btn{padding:7px 4px;background:var(--s2);border:1px solid var(--border);cursor:pointer;
  font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:.5px;text-transform:uppercase;
  color:var(--t2);transition:all .15s;text-align:center;line-height:1.4}
.mode-btn:hover{border-color:var(--t1);color:var(--t1)}
.mode-btn.active{color:#000;font-weight:700;background:var(--cyan);border-color:var(--cyan)}
.mode-btn[data-mode="travalinguaz"].active{background:var(--red);border-color:var(--red)}
.mode-btn[data-mode="diadoco"].active{background:var(--grn);border-color:var(--grn)}
.mode-btn[data-mode="metronomo"].active{background:var(--amb);border-color:var(--amb)}
.mode-btn[data-mode="invertido"].active{background:var(--pur);border-color:var(--pur)}
.mode-btn[data-mode="sons"].active{background:var(--rose);border-color:var(--rose)}
.mode-btn[data-mode="pseudo"].active{background:#4ecdc4;border-color:#4ecdc4}
.mode-btn[data-mode="lacunas"].active{background:#95e1d3;border-color:#95e1d3}
.mode-btn[data-mode="progressivo"].active{background:var(--gold);border-color:var(--gold)}
.mode-btn[data-mode="leitura"].active{background:#6c8ebf;border-color:#6c8ebf;color:#fff}

/* Items list */
.items-sec{padding:10px 12px;flex:1}
.items-sec .slbl{margin-bottom:7px}
.item-card{padding:7px 8px;background:var(--s2);border:1px solid var(--border);margin-bottom:3px;cursor:pointer;transition:all .12s}
.item-card:hover{border-color:var(--t2);background:var(--s3)}
.item-card.sel{border-left:2px solid var(--cyan);background:rgba(0,212,255,.05)}
.item-name{font-size:10px;color:var(--t1);margin-bottom:1px}
.item-meta{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);letter-spacing:.5px}
.item-diff{display:inline-block;font-family:'IBM Plex Mono',monospace;font-size:6px;padding:1px 4px;border:1px solid;margin-left:4px;vertical-align:middle}

/* VAS */
.vas-sec{padding:8px 12px;border-top:1px solid var(--border2)}
.vas-row{display:flex;align-items:center;gap:5px;margin-top:4px}
.vas-row label{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t2);width:48px;flex-shrink:0}
.vas-row input[type=range]{flex:1;-webkit-appearance:none;height:2px;background:var(--s3);outline:none}
.vas-row input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:10px;height:10px;background:var(--cyan);cursor:pointer}
.vas-v{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--cyan);width:16px;text-align:right;flex-shrink:0}

/* ‚ïê‚ïê MAIN ‚ïê‚ïê */
.main{display:flex;flex-direction:column;overflow:hidden;position:relative}

/* Control bar */
.ctrl-bar{background:var(--s2);border-bottom:1px solid var(--border);padding:8px 14px;
  display:flex;align-items:center;gap:8px;flex-wrap:wrap;flex-shrink:0}
.timer-disp{font-family:'IBM Plex Mono',monospace;font-size:28px;font-weight:700;letter-spacing:3px;
  color:var(--t0);min-width:85px;flex-shrink:0;transition:color .3s}
.timer-disp.run{color:var(--cyan);text-shadow:0 0 16px rgba(0,212,255,.3)}
.timer-disp.done{color:var(--grn)}
.ctrl-btns{display:flex;gap:3px;flex-wrap:wrap}
.cb{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:1px;text-transform:uppercase;
  padding:5px 9px;border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;transition:all .12s}
.cb:hover{border-color:var(--t1);color:var(--t1)}
.cb.go{border-color:rgba(0,229,160,.4);color:var(--grn)}
.cb.go:hover{background:var(--grnD)}
.cb.pause{border-color:rgba(255,179,64,.4);color:var(--amb)}
.cb.stop{border-color:rgba(255,79,107,.4);color:var(--red)}
.cb.rep{border-color:rgba(176,108,255,.4);color:var(--pur)}
.cb.rec-b{border-color:rgba(255,79,107,.3);color:var(--red)}
.cb.rec-b.on{background:rgba(255,79,107,.15);animation:rp 1.5s infinite}
.cb:disabled{opacity:.25;cursor:not-allowed;pointer-events:none}
@keyframes rp{0%,100%{box-shadow:0 0 0 0 rgba(255,79,107,.4)}50%{box-shadow:0 0 0 5px transparent}}

.metrics{display:flex;gap:6px;align-items:center;flex-wrap:wrap;margin-left:auto}
.met{text-align:center;padding:4px 8px;background:var(--s3);border:1px solid var(--border);flex-shrink:0;min-width:44px}
.met-v{font-family:'IBM Plex Mono',monospace;font-size:14px;font-weight:700;color:var(--t0);line-height:1}
.met-l{font-family:'IBM Plex Mono',monospace;font-size:6px;letter-spacing:1.5px;color:var(--t3);text-transform:uppercase;margin-top:1px}
.score-flash{animation:scoreflash .4s ease}
@keyframes scoreflash{0%{transform:scale(1)}50%{transform:scale(1.3);color:var(--gold)}100%{transform:scale(1)}}

/* Mark bar */
.mark-bar{padding:5px 14px;background:rgba(9,11,16,.8);border-bottom:1px solid var(--border2);
  display:flex;align-items:center;gap:5px;flex-wrap:wrap;flex-shrink:0}
.mb{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:.5px;text-transform:uppercase;
  padding:3px 7px;border:1px solid;background:none;cursor:pointer;transition:all .1s}
.mb.e{color:var(--red);border-color:rgba(255,79,107,.3)}
.mb.e.on,.mb.e:hover{background:rgba(255,79,107,.12)}
.mb.h{color:var(--amb);border-color:rgba(255,179,64,.3)}
.mb.h.on,.mb.h:hover{background:rgba(255,179,64,.12)}
.mb.s{color:var(--pur);border-color:rgba(176,108,255,.3)}
.mb.s.on,.mb.s:hover{background:rgba(176,108,255,.12)}
.mb.o{color:var(--rose);border-color:rgba(255,107,157,.3)}
.mb.o.on,.mb.o:hover{background:rgba(255,107,157,.12)}
.mb.a{color:var(--cyan);border-color:rgba(0,212,255,.3)}
.mb.a.on,.mb.a:hover{background:var(--cyanD)}
.mb.clr{color:var(--t2);border-color:var(--border)}
.mb.clr:hover{border-color:var(--t1);color:var(--t1)}
.prog-bar{height:2px;background:var(--s3);flex-shrink:0}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--cyan),var(--pur));transition:width .5s;width:0%}

/* ‚ïê‚ïê WORK AREA ‚ïê‚ïê */
.work-area{flex:1;overflow-y:auto;padding:24px 32px}
.work-inner{max-width:820px;margin:0 auto}

/* Empty */
.empty{text-align:center;padding:50px 20px;color:var(--t2)}
.empty-ico{font-size:44px;margin-bottom:12px;opacity:.3}
.empty-ttl{font-family:'DM Serif Display',serif;font-size:18px;color:var(--t1);margin-bottom:5px}
.empty-sub{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t3);letter-spacing:1px}

/* Text display */
.txt-meta{margin-bottom:14px}
.txt-title{font-family:'DM Serif Display',serif;font-size:20px;color:var(--t0);margin-bottom:3px;line-height:1.3}
.txt-sub{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t2);letter-spacing:1.5px}
.reading-txt{font-size:18px;line-height:2;color:var(--t1);font-family:'DM Serif Display',serif;user-select:none}
.reading-txt .w{cursor:pointer;padding:1px 2px;border-radius:2px;display:inline;transition:background .1s,color .1s}
.reading-txt .w:hover{color:var(--t0)}
.reading-txt .w.we{background:rgba(255,79,107,.25);color:var(--red);text-decoration:line-through}
.reading-txt .w.wh{background:rgba(255,179,64,.2);color:var(--amb)}
.reading-txt .w.ws{background:rgba(176,108,255,.2);color:var(--pur);text-decoration:underline dotted}
.reading-txt .w.wo{background:rgba(255,107,157,.2);color:var(--rose);opacity:.6}
.reading-txt .w.wa{background:rgba(0,212,255,.15);color:var(--cyan)}

/* ‚ïê‚ïê CHALLENGE MODES ‚ïê‚ïê */

/* Trava-l√≠nguas */
.trava-display{font-family:'DM Serif Display',serif;font-size:24px;line-height:1.8;color:var(--t0);
  text-align:center;padding:24px;background:var(--s2);border:1px solid var(--border);margin-bottom:14px;user-select:none}
.trava-display.highlight{animation:travapulse .3s ease}
@keyframes travapulse{0%,100%{border-color:var(--border)}50%{border-color:var(--cyan);box-shadow:0 0 20px rgba(0,212,255,.15)}}
.trava-round{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--t2);letter-spacing:2px;text-align:center;margin-bottom:8px}
.trava-score-bar{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
.trava-rep{font-family:'IBM Plex Mono',monospace;font-size:8px;padding:3px 8px;border:1px solid var(--border);color:var(--t3)}
.trava-rep.done{border-color:rgba(0,229,160,.4);color:var(--grn);background:rgba(0,229,160,.08)}
.trava-rep.fail{border-color:rgba(255,79,107,.4);color:var(--red);background:rgba(255,79,107,.08)}

/* Diadoco */
.diadoco-word{font-family:'IBM Plex Mono',monospace;font-size:42px;font-weight:700;letter-spacing:6px;
  text-align:center;color:var(--t0);padding:20px;user-select:none;transition:all .15s}
.diadoco-word.flash{animation:dflash .15s ease}
@keyframes dflash{0%,100%{opacity:1}50%{opacity:.3;transform:scale(.97)}}
.diadoco-count{font-family:'IBM Plex Mono',monospace;font-size:56px;font-weight:700;
  text-align:center;color:var(--cyan);line-height:1}
.diadoco-target{font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--t2);text-align:center;letter-spacing:2px;margin-top:4px}
.tap-btn{font-family:'IBM Plex Mono',monospace;font-size:14px;letter-spacing:2px;padding:18px 40px;
  border:2px solid var(--cyan);background:rgba(0,212,255,.05);color:var(--cyan);cursor:pointer;
  transition:all .1s;display:block;margin:16px auto;text-align:center;width:100%;max-width:320px}
.tap-btn:active{background:rgba(0,212,255,.15);transform:scale(.98)}
.diadoco-result{font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--t1);text-align:center;
  padding:10px;background:var(--s2);border:1px solid var(--border);margin-top:8px}

/* Metr√¥nomo */
.metro-display{display:flex;flex-direction:column;align-items:center;gap:16px;padding:20px}
.metro-beat{width:60px;height:60px;border-radius:50%;background:var(--s3);border:3px solid var(--border);
  display:flex;align-items:center;justify-content:center;font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--t2);
  transition:all .08s}
.metro-beat.on{background:var(--cyan);border-color:var(--cyan);color:#000;transform:scale(1.15);
  box-shadow:0 0 24px rgba(0,212,255,.5)}
.metro-bpm{font-family:'IBM Plex Mono',monospace;font-size:40px;font-weight:700;color:var(--t0);line-height:1}
.metro-bpm-label{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--t2);letter-spacing:2px;text-align:center}
.metro-controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center}
.metro-slider{-webkit-appearance:none;width:220px;height:4px;background:var(--s3);outline:none;border-radius:0}
.metro-slider::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;background:var(--amb);cursor:pointer;border-radius:0}
.metro-txt-area{font-size:20px;line-height:2.2;color:var(--t1);font-family:'DM Serif Display',serif;
  text-align:center;padding:16px;background:var(--s2);border:1px solid var(--border);user-select:none}
.metro-txt-area .beat-word{transition:color .15s,background .15s;padding:2px 4px;border-radius:2px}
.metro-txt-area .beat-word.lit{color:var(--t0);background:rgba(255,179,64,.15)}

/* Sons espec√≠ficos */
.sons-display{display:flex;flex-direction:column;gap:14px}
.sons-phoneme{font-family:'IBM Plex Mono',monospace;font-size:52px;font-weight:700;
  text-align:center;color:var(--cyan);letter-spacing:8px;padding:20px;background:var(--s2);border:1px solid var(--border)}
.sons-word-list{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;padding:12px}
.sons-word{font-family:'DM Serif Display',serif;font-size:18px;color:var(--t1);padding:6px 12px;
  background:var(--s2);border:1px solid var(--border);cursor:pointer;transition:all .12s;user-select:none}
.sons-word:hover{border-color:var(--cyan);color:var(--t0)}
.sons-word.done{border-color:rgba(0,229,160,.4);color:var(--grn);background:rgba(0,229,160,.06)}
.sons-word.err{border-color:rgba(255,79,107,.4);color:var(--red);background:rgba(255,79,107,.06)}
.sons-progress{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--t2);text-align:center;letter-spacing:1px;margin-top:4px}

/* Pseudopalavras */
.pseudo-word{font-family:'IBM Plex Mono',monospace;font-size:38px;font-weight:700;
  text-align:center;color:var(--pur);letter-spacing:4px;padding:22px;background:var(--s2);border:1px solid var(--border);
  margin-bottom:10px;user-select:none}
.pseudo-syllables{font-family:'IBM Plex Mono',monospace;font-size:13px;color:var(--t2);
  text-align:center;letter-spacing:3px;margin-bottom:16px}
.pseudo-btns{display:flex;gap:8px;justify-content:center}
.pseudo-btn{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:1px;text-transform:uppercase;
  padding:8px 18px;border:1px solid;background:none;cursor:pointer;transition:all .12s}
.pseudo-btn.ok{color:var(--grn);border-color:rgba(0,229,160,.4)}
.pseudo-btn.ok:hover{background:var(--grnD)}
.pseudo-btn.bad{color:var(--red);border-color:rgba(255,79,107,.4)}
.pseudo-btn.bad:hover{background:var(--redD)}
.pseudo-btn.nxt{color:var(--cyan);border-color:rgba(0,212,255,.4)}
.pseudo-btn.nxt:hover{background:var(--cyanD)}
.pseudo-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-top:14px}
.pstat{padding:8px;background:var(--s2);border:1px solid var(--border);text-align:center}
.pstat-v{font-family:'IBM Plex Mono',monospace;font-size:18px;font-weight:700;color:var(--t0)}
.pstat-l{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);letter-spacing:1px;text-transform:uppercase;margin-top:2px}

/* Lacunas / Gap fill */
.gap-sentence{font-family:'DM Serif Display',serif;font-size:19px;line-height:2.1;color:var(--t1);
  padding:16px;background:var(--s2);border:1px solid var(--border);margin-bottom:12px;text-align:center}
.gap-blank{display:inline-block;border-bottom:2px solid var(--cyan);min-width:80px;padding:0 6px;
  color:var(--cyan);font-family:'IBM Plex Mono',monospace;font-size:16px;text-align:center;cursor:pointer;
  transition:all .15s;vertical-align:bottom}
.gap-blank.filled-correct{border-bottom-color:var(--grn);color:var(--grn)}
.gap-blank.filled-wrong{border-bottom-color:var(--red);color:var(--red)}
.gap-opts{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;margin-bottom:12px}
.gap-opt{font-family:'IBM Plex Mono',monospace;font-size:11px;padding:6px 14px;border:1px solid var(--border);
  background:var(--s2);color:var(--t1);cursor:pointer;transition:all .12s}
.gap-opt:hover{border-color:var(--cyan);color:var(--cyan)}
.gap-opt.used{opacity:.3;pointer-events:none}
.gap-feedback{font-family:'IBM Plex Mono',monospace;font-size:10px;text-align:center;padding:8px;
  background:var(--s2);border:1px solid var(--border);color:var(--t1);min-height:36px}

/* Progressivo */
.prog-sentences{display:flex;flex-direction:column;gap:8px}
.prog-sent{font-family:'DM Serif Display',serif;padding:10px 14px;border:1px solid var(--border);
  background:var(--s2);color:var(--t2);cursor:pointer;transition:all .15s;line-height:1.7}
.prog-sent.current{border-left:3px solid var(--cyan);color:var(--t0);background:rgba(0,212,255,.04);font-size:17px}
.prog-sent.completed{border-color:rgba(0,229,160,.3);color:var(--grn);background:rgba(0,229,160,.04)}
.prog-sent.active-err{border-color:rgba(255,79,107,.4);color:var(--red)}
.prog-sent-num{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t3);letter-spacing:1px;margin-bottom:3px}
.prog-actions{display:flex;gap:6px;margin-top:10px}

/* Invertido */
.invert-display{font-family:'IBM Plex Mono',monospace;font-size:22px;font-weight:700;
  letter-spacing:4px;color:var(--pur);padding:20px;background:var(--s2);border:1px solid var(--border);
  text-align:center;margin-bottom:12px;user-select:none;word-break:break-all;line-height:1.8}
.invert-original{font-family:'DM Serif Display',serif;font-size:14px;color:var(--t3);
  text-align:center;margin-bottom:14px;padding:8px;border-top:1px solid var(--border2)}

/* Notes */
.notes-area{margin-top:12px;padding:10px;background:var(--s2);border:1px solid var(--border)}
.notes-lbl{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:2px;color:var(--t3);text-transform:uppercase;margin-bottom:4px}
.notes-ta{width:100%;background:transparent;border:none;color:var(--t1);font-family:'Syne',sans-serif;
  font-size:11px;resize:none;outline:none;line-height:1.6}

/* Audio */
.audio-row{display:flex;align-items:center;gap:8px;padding:6px 10px;background:var(--s3);border:1px solid var(--border);margin-top:8px}
.audio-row audio{flex:1;height:26px;filter:invert(.8) hue-rotate(180deg)}
.audio-del{font-family:'IBM Plex Mono',monospace;font-size:8px;padding:3px 7px;border:1px solid rgba(255,79,107,.3);
  color:var(--red);background:none;cursor:pointer}

/* ‚ïê‚ïê PANELS ‚ïê‚ïê */
.panel{flex:1;overflow-y:auto;padding:20px;display:none;flex-direction:column;gap:14px}
.panel.on{display:flex}
.panel-title{font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:2px;color:var(--t0);
  text-transform:uppercase;border-bottom:1px solid var(--border);padding-bottom:8px;display:flex;align-items:center;justify-content:space-between}

/* ‚ïê‚ïê RANKING ‚ïê‚ïê */
.rank-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.rank-card{background:var(--s2);border:1px solid var(--border);padding:12px}
.rank-pos{font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--t3);letter-spacing:1px;margin-bottom:4px}
.rank-name{font-size:13px;color:var(--t0);font-family:'DM Serif Display',serif;margin-bottom:4px}
.rank-pts{font-family:'IBM Plex Mono',monospace;font-size:20px;font-weight:700;color:var(--gold)}
.rank-meta{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);margin-top:3px;letter-spacing:1px}
.rank-1{border-color:rgba(255,215,0,.3);background:rgba(255,215,0,.04)}
.rank-2{border-color:rgba(192,192,192,.25)}
.rank-3{border-color:rgba(205,127,50,.25)}

/* ‚ïê‚ïê BADGES ‚ïê‚ïê */
.badge-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px}
.badge-item{background:var(--s2);border:1px solid var(--border);padding:12px 10px;text-align:center;transition:all .2s}
.badge-item.earned{border-color:var(--gold);background:rgba(255,215,0,.06)}
.badge-ico{font-size:28px;margin-bottom:6px}
.badge-name{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1px;color:var(--t1);text-transform:uppercase;margin-bottom:2px}
.badge-desc{font-size:9px;color:var(--t3);line-height:1.4}
.badge-item:not(.earned){filter:grayscale(1);opacity:.35}

/* ‚ïê‚ïê EVOLU√á√ÉO ‚ïê‚ïê */
canvas{background:var(--s2);border:1px solid var(--border)}
.evo-leg{display:flex;gap:10px;flex-wrap:wrap}
.evo-li{display:flex;align-items:center;gap:4px;font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t2)}
.evo-dot{width:7px;height:7px;border-radius:50%}

/* ‚ïê‚ïê MODAL / REPORT ‚ïê‚ïê */
.modal-ov{position:fixed;inset:0;background:rgba(3,4,5,.94);backdrop-filter:blur(12px);
  z-index:999;display:none;align-items:flex-start;justify-content:center;padding:16px;overflow-y:auto}
.modal-ov.open{display:flex}
.modal{background:var(--s1);border:1px solid var(--border);max-width:800px;width:100%;margin:auto}
.modal-hdr{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;
  position:sticky;top:0;background:var(--s1);z-index:10}
.modal-ttl{font-family:'IBM Plex Mono',monospace;font-size:11px;font-weight:700;letter-spacing:2px;color:var(--t0);text-transform:uppercase}
.modal-x{background:none;border:1px solid var(--border);color:var(--t2);width:24px;height:24px;cursor:pointer;font-size:11px}
.modal-x:hover{border-color:var(--red);color:var(--red)}
.rep-body{padding:20px}
.rs{margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--border2)}
.rs:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
.rs-title{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:3px;text-transform:uppercase;
  color:var(--cyan);margin-bottom:10px;display:flex;align-items:center;gap:7px}
.rs-title::after{content:'';flex:1;height:1px;background:var(--border)}
.rg3{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}
.rg2{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}
.rst{padding:9px;background:var(--s2);border:1px solid var(--border)}
.rst-v{font-family:'IBM Plex Mono',monospace;font-size:18px;font-weight:700;color:var(--t0);line-height:1}
.rst-u{font-size:9px;color:var(--t2);margin-left:2px}
.rst-l{font-family:'IBM Plex Mono',monospace;font-size:6px;letter-spacing:2px;color:var(--t3);text-transform:uppercase;margin-top:3px}
.rb{background:var(--s2);border-left:3px solid var(--cyan);padding:9px 12px;margin:5px 0;font-size:11px;line-height:1.6;color:var(--t1)}
.rb strong{color:var(--t0)}
.rb.warn{border-left-color:var(--amb)}
.rb.crit{border-left-color:var(--red)}
.rb.good{border-left-color:var(--grn)}
.rb.info{border-left-color:var(--pur)}
.sb-w{margin:6px 0}
.sb-l{display:flex;justify-content:space-between;margin-bottom:2px}
.sb-n{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t1)}
.sb-v{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t0)}
.sb{height:3px;background:var(--s3)}
.sb-f{height:100%;transition:width 1.2s}
.etag{font-family:'IBM Plex Mono',monospace;font-size:7px;padding:2px 5px;display:inline-block;margin:2px}
.etag.e{background:rgba(255,79,107,.15);border:1px solid rgba(255,79,107,.3);color:var(--red)}
.etag.h{background:rgba(255,179,64,.15);border:1px solid rgba(255,179,64,.3);color:var(--amb)}
.etag.s{background:rgba(176,108,255,.15);border:1px solid rgba(176,108,255,.3);color:var(--pur)}
.etag.o{background:rgba(255,107,157,.15);border:1px solid rgba(255,107,157,.3);color:var(--rose)}
.etag.a{background:rgba(0,212,255,.1);border:1px solid rgba(0,212,255,.3);color:var(--cyan)}
.print-row{display:flex;gap:6px;margin-top:14px;padding-top:14px;border-top:1px solid var(--border2);justify-content:flex-end}
.pbtn{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:1px;text-transform:uppercase;
  padding:6px 12px;border:1px solid;background:none;cursor:pointer;transition:all .12s}
.pbtn.g{color:var(--grn);border-color:rgba(0,229,160,.3)}
.pbtn.g:hover{background:var(--grnD)}
.pbtn.b{color:var(--cyan);border-color:rgba(0,212,255,.3)}
.pbtn.b:hover{background:var(--cyanD)}
.wm{font-family:'IBM Plex Mono',monospace;font-size:6px;color:var(--t3);text-align:center;margin-top:10px;letter-spacing:1.5px;text-transform:uppercase}

/* TOAST */
.toast{position:fixed;bottom:20px;right:20px;padding:10px 16px;background:var(--s2);border:1px solid var(--border);
  font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:1px;color:var(--t0);
  z-index:9999;transform:translateY(60px);opacity:0;transition:all .3s;pointer-events:none}
.toast.show{transform:translateY(0);opacity:1}
.toast.good{border-color:rgba(0,229,160,.4);color:var(--grn)}
.toast.bad{border-color:rgba(255,79,107,.4);color:var(--red)}
.toast.gold{border-color:rgba(255,215,0,.4);color:var(--gold)}

/* FULLSCREEN */
.fs-ov{position:fixed;inset:0;background:#030405;z-index:500;display:none;flex-direction:column;align-items:center;justify-content:center;padding:50px 70px}
.fs-ov.on{display:flex}
.fs-exit{position:absolute;top:16px;right:16px;font-family:'IBM Plex Mono',monospace;font-size:8px;
  letter-spacing:2px;padding:6px 12px;border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;text-transform:uppercase}
.fs-timer{position:absolute;top:18px;left:50%;transform:translateX(-50%);font-family:'IBM Plex Mono',monospace;font-size:16px;color:var(--t2);letter-spacing:3px}
.fs-timer.run{color:var(--cyan)}
.fs-title-lbl{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--t2);letter-spacing:2px;margin-bottom:16px;text-align:center}
.fs-content{font-family:'DM Serif Display',serif;font-size:26px;line-height:2;color:var(--t0);text-align:center;max-width:900px;user-select:none}
.fs-ctrls{position:absolute;bottom:20px;display:flex;gap:7px}
.fs-btn{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1.5px;padding:7px 14px;
  border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;text-transform:uppercase}
.fs-btn.go{border-color:rgba(0,229,160,.4);color:var(--grn)}
.fs-font{position:absolute;bottom:20px;right:16px;display:flex;gap:3px}
.fs-fb{width:26px;height:26px;border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;font-size:10px}
.fs-fb:hover{border-color:var(--cyan);color:var(--cyan)}

/* Rec indicator */
.rec-ind{display:flex;align-items:center;gap:4px;font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--red);
  padding:3px 7px;border:1px solid rgba(255,79,107,.3);opacity:0;transition:opacity .3s}
.rec-ind.on{opacity:1}
.rec-dot{width:5px;height:5px;border-radius:50%;background:var(--red);animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.1}}

/* Norma table */
.nt{width:100%;border-collapse:collapse;font-family:'IBM Plex Mono',monospace;font-size:8px}
.nt th{background:var(--s3);color:var(--t2);padding:5px 7px;text-align:left;letter-spacing:1px;border-bottom:1px solid var(--border)}
.nt td{padding:5px 7px;border-bottom:1px solid var(--border2);color:var(--t1)}
.nt tr.hl td{background:rgba(0,212,255,.05);color:var(--t0)}
.nt .you{color:var(--cyan);font-weight:700}

/* Auto-level indicator */
.auto-lvl{font-family:'IBM Plex Mono',monospace;font-size:8px;padding:3px 8px;border:1px solid;color:var(--amb);border-color:rgba(255,179,64,.3);display:flex;align-items:center;gap:4px}
.lvl-dot{width:5px;height:5px;border-radius:50%;background:var(--amb);animation:blink 2s infinite}

/* Comprehension */
.cq{margin-bottom:10px}
.cq-t{font-size:11px;color:var(--t1);margin-bottom:5px;line-height:1.5}
.cq-opts{display:flex;flex-direction:column;gap:2px}
.cq-opt{display:flex;align-items:center;gap:6px;padding:4px 7px;background:var(--s3);border:1px solid var(--border);cursor:pointer;transition:all .1s;font-size:10px;color:var(--t2)}
.cq-opt:hover{border-color:var(--t2);color:var(--t1)}
.cq-opt.sc{background:rgba(0,229,160,.08);border-color:rgba(0,229,160,.4);color:var(--grn)}
.cq-opt.sw{background:rgba(255,79,107,.08);border-color:rgba(255,79,107,.4);color:var(--red)}
.cq-opt.sh{background:rgba(0,229,160,.05);border-color:rgba(0,229,160,.2);color:var(--grn)}
.opt-l{font-family:'IBM Plex Mono',monospace;font-size:8px;font-weight:700;flex-shrink:0}
.cq-score{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--t1);margin-top:6px;padding:5px 7px;background:var(--s3);border:1px solid var(--border)}

@media print{
  body,html{overflow:visible!important;height:auto!important;background:#fff!important;color:#000!important}
  .modal-ov{position:relative!important;display:block!important;padding:0!important;background:none!important;backdrop-filter:none!important}
  .modal{max-height:none!important;border:none!important}
  .modal-hdr,.print-row,.modal-x,.top,.body{display:none!important}
}
</style>
</head>
<body>
<div class="app">
  <!-- TOP -->
  <div class="top">
    <div class="brand"><div class="brand-icon"></div>PHONO<em>BASE</em><sup>3.0</sup></div>
    <div class="ttabs">
      <button class="ttab on" onclick="goPanel('avaliacao',this)">üìñ Leitura</button>
      <button class="ttab" onclick="goPanel('desafios',this)">üéØ Desafios</button>
      <button class="ttab" onclick="goPanel('ranking',this)">üèÜ Ranking</button>
      <button class="ttab" onclick="goPanel('badges',this)">üéñ Conquistas</button>
      <button class="ttab" onclick="goPanel('evolucao',this)">üìà Evolu√ß√£o</button>
    </div>
    <div class="top-r">
      <div class="rec-ind" id="rec-ind"><div class="rec-dot"></div>REC</div>
      <div class="auto-lvl" id="auto-lvl-badge" style="display:none"><div class="lvl-dot"></div>AUTO-N√çVEL</div>
      <div class="streak-badge">üî• <span id="streak-n">0</span></div>
      <div class="pts-badge">‚ú¶ <span id="pts-total">0</span> pts</div>
      <div class="ver-b">v3.0</div>
    </div>
  </div>

  <div class="body">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <!-- PATIENT -->
      <div class="pat-sec">
        <div class="slbl">Paciente</div>
        <div class="fi"><label>Nome</label><input type="text" id="pat-name" placeholder="Nome completo"></div>
        <div class="fi-row">
          <div class="fi"><label>Nasc.</label><input type="date" id="pat-dob"></div>
          <div class="fi"><label>Escolaridade</label>
            <select id="pat-esc">
              <option value="">‚Äî</option>
              <option>Pr√©-escola</option><option>1¬∫ EF</option><option>2¬∫ EF</option>
              <option>3¬∫ EF</option><option>4‚Äì5¬∫ EF</option><option>6‚Äì9¬∫ EF</option>
              <option>Ens. M√©dio</option><option>Superior</option><option>Adulto</option>
            </select>
          </div>
        </div>
        <div class="fi"><label>Fonoaudi√≥logo(a)</label><input type="text" id="pat-fono" placeholder="Profissional"></div>
        <div class="fi"><label>Diagn√≥stico</label><input type="text" id="pat-diag" placeholder="Hip√≥tese diagn√≥stica"></div>
      </div>

      <!-- MODE -->
      <div class="mode-sec">
        <div class="slbl">Modo</div>
        <div class="mode-grid" style="margin-top:7px">
          <button class="mode-btn active" data-mode="leitura" onclick="setMode('leitura',this)">üìñ Leitura Oral</button>
          <button class="mode-btn" data-mode="travalinguaz" onclick="setMode('travalinguaz',this)">üî¥ Trava-l√≠ngua</button>
          <button class="mode-btn" data-mode="diadoco" onclick="setMode('diadoco',this)">üü¢ Diadoco.</button>
          <button class="mode-btn" data-mode="metronomo" onclick="setMode('metronomo',this)">üü° Metr√¥nomo</button>
          <button class="mode-btn" data-mode="invertido" onclick="setMode('invertido',this)">üü£ Invertido</button>
          <button class="mode-btn" data-mode="sons" onclick="setMode('sons',this)">üî¥ Sons /r/ /l/ /s/</button>
          <button class="mode-btn" data-mode="pseudo" onclick="setMode('pseudo',this)">üîµ Pseudopalavras</button>
          <button class="mode-btn" data-mode="lacunas" onclick="setMode('lacunas',this)">üü§ Lacunas</button>
          <button class="mode-btn" data-mode="progressivo" onclick="setMode('progressivo',this)" style="grid-column:1/-1">üü† Frases Progressivas</button>
        </div>
      </div>

      <!-- ITEMS -->
      <div class="items-sec">
        <div class="slbl">Conte√∫do</div>
        <div id="items-list" style="margin-top:7px"></div>
      </div>

      <!-- VAS -->
      <div class="vas-sec">
        <div class="slbl" style="margin-bottom:5px">Esfor√ßo Vocal (VAS)</div>
        <div class="vas-row"><label>Pr√©</label><input type="range" id="vas-pre" min="0" max="10" value="0" oninput="document.getElementById('vp').textContent=this.value"><span class="vas-v" id="vp">0</span></div>
        <div class="vas-row"><label>P√≥s</label><input type="range" id="vas-pos" min="0" max="10" value="0" oninput="document.getElementById('vo').textContent=this.value"><span class="vas-v" id="vo">0</span></div>
        <div class="vas-row"><label>Fadiga</label><input type="range" id="vas-fat" min="0" max="10" value="0" oninput="document.getElementById('vf').textContent=this.value"><span class="vas-v" id="vf">0</span></div>
      </div>
    </div>

    <!-- ‚ïê‚ïê PANEL: AVALIA√á√ÉO ‚ïê‚ïê -->
    <div class="main on" id="panel-avaliacao">
      <!-- Control bar -->
      <div class="ctrl-bar">
        <div id="timer-disp" class="timer-disp">00:00</div>
        <div class="ctrl-btns">
          <button class="cb go" id="btn-start" onclick="startTimer()" disabled>‚ñ∂ Iniciar</button>
          <button class="cb pause" id="btn-pause" onclick="pauseTimer()" disabled>‚è∏</button>
          <button class="cb stop" id="btn-stop" onclick="stopTimer()" disabled>‚èπ Parar</button>
          <button class="cb" onclick="resetAll()">‚Ü∫ Reset</button>
          <button class="cb rec-b" id="btn-rec" onclick="toggleRec()">‚è∫ Gravar</button>
          <button class="cb" id="btn-fs" onclick="openFS()" disabled>‚õ∂ Tela Cheia</button>
        </div>
        <div class="metrics">
          <div class="met"><div class="met-v" id="m-wpm">‚Äî</div><div class="met-l">PPM</div></div>
          <div class="met"><div class="met-v" id="m-err">0</div><div class="met-l">Erros</div></div>
          <div class="met"><div class="met-v" id="m-hes">0</div><div class="met-l">Hesit.</div></div>
          <div class="met"><div class="met-v" id="m-acc">‚Äî</div><div class="met-l">Precis√£o</div></div>
          <div class="met"><div class="met-v" id="m-pts" style="color:var(--gold)">0</div><div class="met-l">Pts sess.</div></div>
          <button class="cb rep" id="btn-rep" onclick="openReport()" disabled>üìä Relat√≥rio</button>
        </div>
      </div>
      <!-- Mark bar -->
      <div class="mark-bar" id="mark-bar">
        <span style="font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);letter-spacing:1px;text-transform:uppercase">Marcar:</span>
        <button class="mb e on" id="mb-e" onclick="setMark('e')">‚úó Erro</button>
        <button class="mb h" id="mb-h" onclick="setMark('h')">‚è§ Hesit.</button>
        <button class="mb s" id="mb-s" onclick="setMark('s')">‚Üî Subst.</button>
        <button class="mb o" id="mb-o" onclick="setMark('o')">‚óã Omiss.</button>
        <button class="mb a" id="mb-a" onclick="setMark('a')">+ Adi√ß√£o</button>
        <button class="mb clr" onclick="setMark('clear')">‚óå</button>
        <button class="mb clr" style="margin-left:auto" onclick="clearAll()">Limpar tudo</button>
      </div>
      <div class="prog-bar"><div class="prog-fill" id="prog-fill"></div></div>

      <!-- Work area -->
      <div class="work-area">
        <div class="work-inner">
          <div class="empty" id="empty-state">
            <div class="empty-ico">üìñ</div>
            <div class="empty-ttl">Selecione um modo e conte√∫do</div>
            <div class="empty-sub">Use o painel lateral para escolher o modo e o texto</div>
          </div>
          <div id="work-content" style="display:none"></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê PANEL: DESAFIOS ‚ïê‚ïê -->
    <div class="panel" id="panel-desafios">
      <div class="panel-title">Desafios Ativos</div>
      <div id="desafios-content"></div>
    </div>

    <!-- ‚ïê‚ïê PANEL: RANKING ‚ïê‚ïê -->
    <div class="panel" id="panel-ranking">
      <div class="panel-title">Ranking de Sess√µes <button class="mb clr" onclick="clearHistory()" style="font-size:7px">Limpar</button></div>
      <div id="ranking-content"></div>
    </div>

    <!-- ‚ïê‚ïê PANEL: BADGES ‚ïê‚ïê -->
    <div class="panel" id="panel-badges">
      <div class="panel-title">Conquistas Cl√≠nicas</div>
      <div class="badge-grid" id="badges-grid"></div>
    </div>

    <!-- ‚ïê‚ïê PANEL: EVOLU√á√ÉO ‚ïê‚ïê -->
    <div class="panel" id="panel-evolucao">
      <div class="panel-title">Evolu√ß√£o do Paciente</div>
      <div class="evo-leg">
        <div class="evo-li"><div class="evo-dot" style="background:var(--cyan)"></div>PPM</div>
        <div class="evo-li"><div class="evo-dot" style="background:var(--grn)"></div>Precis√£o %</div>
        <div class="evo-li"><div class="evo-dot" style="background:var(--red)"></div>Erros</div>
      </div>
      <canvas id="evo-c1" height="200" style="width:100%"></canvas>
      <canvas id="evo-c2" height="160" style="width:100%"></canvas>
      <div id="evo-empty" style="font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--t3);text-align:center;padding:40px;display:none">Sem sess√µes registradas ainda.</div>
    </div>
  </div>
</div>

<!-- FULLSCREEN -->
<div class="fs-ov" id="fs-ov">
  <div class="fs-timer" id="fs-timer">00:00</div>
  <button class="fs-exit" onclick="closeFS()">‚úï Sair</button>
  <div class="fs-title-lbl" id="fs-lbl"></div>
  <div class="fs-content" id="fs-content"></div>
  <div class="fs-ctrls">
    <button class="fs-btn go" id="fs-go" onclick="fsToggle()">‚ñ∂ Iniciar</button>
    <button class="fs-btn" onclick="closeFS()">‚èπ Encerrar</button>
  </div>
  <div class="fs-font">
    <button class="fs-fb" onclick="fsFZ(-2)">A-</button>
    <button class="fs-fb" onclick="fsFZ(2)">A+</button>
  </div>
</div>

<!-- REPORT MODAL -->
<div class="modal-ov" id="rep-modal">
  <div class="modal">
    <div class="modal-hdr">
      <div class="modal-ttl">üìä Relat√≥rio Fonoaudiol√≥gico</div>
      <button class="modal-x" onclick="closeReport()">‚úï</button>
    </div>
    <div class="rep-body" id="rep-body"></div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DADOS - TEXTOS DE LEITURA (todos os 6 n√≠veis, 4 cada)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const LEITURA = {
1:[
  {id:'1a',name:'O Gato e o Sol',words:80,title:'O Gato e o Sol',subtitle:'N√≠vel 1 ¬∑ F√°cil',
   content:'O gato dorme ao sol. Ele √© preto e tem quatro patas. O gato gosta de leite e de peixe. Ele mia quando quer comer. De manh√£, o gato pula na cama e acorda a mam√£e. √Ä tarde, ele brinca com uma bola de l√£. √Ä noite, o gato dorme no sof√° quentinho. O gato √© um animal muito carinhoso e d√≥cil. Ele gosta de colo e de carinhos suaves. Toda a fam√≠lia ama o gato da casa.',
   qs:[{q:'Onde o gato dorme √† noite?',opts:['Na cama','No sof√°','No ch√£o','Na cadeira'],c:1},{q:'O que o gato faz de manh√£?',opts:['Pula na cama','Come peixe','Brinca','Mia'],c:0},{q:'Como √© descrito o gato?',opts:['Bravo','Carinhoso','Selvagem','T√≠mido'],c:1}]},
  {id:'1b',name:'A Escola da Ana',words:92,title:'A Escola da Ana',subtitle:'N√≠vel 1 ¬∑ F√°cil',
   content:'Ana vai para a escola todo dia de semana. Ela acorda cedo e toma caf√© com leite. A mochila dela √© azul com estrelas. Na escola, Ana aprende a ler, a escrever e a fazer contas. A professora dela se chama Dona Maria e √© muito boa. Ana gosta muito de pintar, de cantar e de contar hist√≥rias. Na hora do recreio, ela brinca com os amigos no p√°tio. Eles jogam bola e pulam corda juntos. √Ä tarde, Ana volta para casa de m√£os dadas com a m√£e.',
   qs:[{q:'Como √© a mochila da Ana?',opts:['Vermelha','Verde','Azul com estrelas','Rosa'],c:2},{q:'Qual o nome da professora?',opts:['Dona L√∫cia','Dona Maria','Dona Ana','Dona Rosa'],c:1},{q:'O que eles fazem no recreio?',opts:['Estudam','Jogam bola e pulam corda','Dormem','Comem'],c:1}]},
  {id:'1c',name:'O Parque',words:88,title:'Um Dia no Parque',subtitle:'N√≠vel 1 ¬∑ F√°cil',
   content:'Jo√£o foi ao parque com o pai. O parque tem muitas √°rvores e flores bonitas. Jo√£o correu no gramado verde e subiu no balan√ßo alto. Ele viu um cachorro branco brincando com uma bola amarela. O pai comprou um sorvete de morango para Jo√£o. Eles sentaram num banco √† sombra de uma √°rvore grande e frondosa. Jo√£o comeu o sorvete devagar para n√£o derrubar. O sol estava quente mas havia um vento fresco e agrad√°vel. Depois de brincar muito, Jo√£o ficou bem cansado. O pai o carregou no colo at√© o carro. Foi um dia muito feliz para os dois.',
   qs:[{q:'Com quem Jo√£o foi ao parque?',opts:['Com a m√£e','Com o pai','Com a vov√≥','Com amigos'],c:1},{q:'Que sabor era o sorvete?',opts:['Chocolate','Baunilha','Morango','Lim√£o'],c:2},{q:'Como Jo√£o voltou at√© o carro?',opts:['Caminhando','Correndo','No colo do pai','De bicicleta'],c:2}]},
  {id:'1d',name:'A Chuva',words:78,title:'A Chuva e o Arco-√≠ris',subtitle:'N√≠vel 1 ¬∑ F√°cil',
   content:'Hoje choveu muito. As crian√ßas ficaram em casa olhando pela janela. A chuva ca√≠a forte no telhado e fazia barulho. As ruas ficaram cheias de √°gua. Os passarinhos se esconderam nas √°rvores. Depois de um tempo a chuva parou. O sol voltou a brilhar no c√©u azul. Ent√£o apareceu um lindo arco-√≠ris com muitas cores. As cores eram vermelho, laranja, amarelo, verde, azul e roxo. As crian√ßas correram para o jardim para ver de perto.',
   qs:[{q:'O que as crian√ßas fizeram durante a chuva?',opts:['Brincaram na rua','Ficaram em casa olhando','Foram √† escola','Dormiram'],c:1},{q:'O que apareceu depois da chuva?',opts:['Trov√£o','Neblina','Arco-√≠ris','Neve'],c:2},{q:'Para onde correram depois?',opts:['Cozinha','Quarto','Jardim','Escola'],c:2}]}
],
2:[
  {id:'2a',name:'A Amaz√¥nia',words:112,title:'A Floresta Amaz√¥nica',subtitle:'N√≠vel 2 ¬∑ M√©dio',
   content:'A floresta amaz√¥nica √© a maior floresta tropical do mundo. Ela cobre grande parte do Brasil e de outros pa√≠ses da Am√©rica do Sul. Na Amaz√¥nia, vivem milhares de esp√©cies de animais e plantas ainda desconhecidas pela ci√™ncia. O rio Amazonas atravessa toda a floresta e des√°gua no oceano Atl√¢ntico. Muitas comunidades ind√≠genas vivem na floresta e conhecem seus segredos h√° s√©culos. A Amaz√¥nia produz oxig√™nio essencial para todo o planeta e regula o clima global de forma decisiva. Por isso, preservar essa floresta t√£o especial √© uma responsabilidade de todos. O desmatamento acelerado representa uma amea√ßa grave que precisa ser combatida urgentemente.',
   qs:[{q:'O que o rio Amazonas faz?',opts:['Nasce no Atl√¢ntico','Atravessa e des√°gua no Atl√¢ntico','Divide o Brasil','Nasce no Peru'],c:1},{q:'O que a Amaz√¥nia produz?',opts:['Chuva','Energia solar','Oxig√™nio','Petr√≥leo'],c:2},{q:'Quem vive na floresta h√° s√©culos?',opts:['Agricultores','Comunidades ind√≠genas','Cientistas','Turistas'],c:1}]},
  {id:'2b',name:'O Sistema Solar',words:108,title:'O Sistema Solar',subtitle:'N√≠vel 2 ¬∑ M√©dio',
   content:'O sistema solar √© formado pelo Sol e por oito planetas que giram ao seu redor. Cada planeta percorre sua pr√≥pria √≥rbita em velocidades diferentes. Merc√∫rio √© o planeta mais pr√≥ximo do Sol. V√™nus tem uma atmosfera densa de di√≥xido de carbono. A Terra √© o √∫nico planeta onde existe vida conhecida no universo. Marte √© vermelho por causa do √≥xido de ferro em sua superf√≠cie rochosa. J√∫piter √© o maior planeta e tem uma grande tempestade chamada de Mancha Vermelha. Saturno tem an√©is formados de gelo e rocha. Urano e Netuno s√£o os planetas mais distantes do sistema.',
   qs:[{q:'Quantos planetas tem o sistema solar?',opts:['7','8','9','10'],c:1},{q:'Por que Marte √© vermelho?',opts:['Lava','√ìxido de ferro','Luz do sol','Poeira azul'],c:1},{q:'Qual o maior planeta?',opts:['Saturno','Terra','J√∫piter','Netuno'],c:2}]},
  {id:'2c',name:'Alimenta√ß√£o Saud√°vel',words:105,title:'Alimenta√ß√£o Saud√°vel',subtitle:'N√≠vel 2 ¬∑ M√©dio',
   content:'Uma alimenta√ß√£o saud√°vel √© fundamental para o bom funcionamento do nosso corpo. Devemos comer frutas, verduras e legumes todos os dias, pois eles fornecem vitaminas e minerais essenciais. As prote√≠nas, encontradas nas carnes, ovos e feij√£o, ajudam a construir e reparar os tecidos do corpo. Os carboidratos, presentes no arroz e na batata, fornecem energia para as atividades di√°rias. Devemos evitar o excesso de a√ß√∫car, sal e gordura, que podem causar doen√ßas como diabetes e hipertens√£o arterial. Beber bastante √°gua tamb√©m √© muito importante para manter o corpo hidratado e funcionando bem.',
   qs:[{q:'Qual alimento fornece prote√≠nas?',opts:['Arroz','Ma√ß√£','Feij√£o','Batata'],c:2},{q:'O que os carboidratos fornecem?',opts:['Vitaminas','Energia','Prote√≠nas','Gorduras'],c:1},{q:'O que deve ser evitado em excesso?',opts:['Frutas','√Ågua','A√ß√∫car e sal','Prote√≠nas'],c:2}]},
  {id:'2d',name:'O Cerrado',words:115,title:'A Fauna do Cerrado',subtitle:'N√≠vel 2 ¬∑ M√©dio',
   content:'O cerrado √© o segundo maior bioma do Brasil e abriga uma fauna rica e diversificada. Entre os animais mais conhecidos est√£o a on√ßa-pintada, o tamandu√°-bandeira e o lobo-guar√°. O lobo-guar√° √© o maior can√≠deo da Am√©rica do Sul e se alimenta de frutos e pequenos mam√≠feros. O tamandu√°-bandeira usa sua longa l√≠ngua pegajosa para capturar formigas e cupins. A ema √© uma ave que n√£o voa mas corre muito r√°pido. O tatu-canastra escava tocas profundas no solo duro do cerrado para se proteger. Muitos desses animais est√£o amea√ßados de extin√ß√£o pelo desmatamento.',
   qs:[{q:'Qual √© o maior can√≠deo da Am√©rica do Sul?',opts:['Cachorro-do-mato','Lobo-guar√°','Raposa','Quati'],c:1},{q:'O que come o tamandu√°-bandeira?',opts:['Frutas e peixes','Formigas e cupins','P√°ssaros','Ra√≠zes'],c:1},{q:'Por que os animais est√£o amea√ßados?',opts:['Predadores','Doen√ßas','Desmatamento','Secas'],c:2}]}
],
3:[
  {id:'3a',name:'Revolu√ß√£o Industrial',words:133,title:'A Revolu√ß√£o Industrial',subtitle:'N√≠vel 3 ¬∑ Dif√≠cil',
   content:'A Revolu√ß√£o Industrial transformou profundamente a sociedade europeia a partir do s√©culo dezoito. Iniciada na Inglaterra, essa transforma√ß√£o marcou a transi√ß√£o da produ√ß√£o artesanal para a produ√ß√£o mecanizada em larga escala. A inven√ß√£o da m√°quina a vapor por James Watt foi fundamental, permitindo a cria√ß√£o de locomotivas, navios e f√°bricas modernas. Trabalhadores abandonaram o campo e migraram para as cidades industriais em busca de emprego. As condi√ß√µes eram prec√°rias: jornadas de doze a dezesseis horas, sal√°rios baix√≠ssimos e aus√™ncia de direitos trabalhistas. Esse contexto gerou os primeiros movimentos oper√°rios e sindicatos. A Revolu√ß√£o Industrial tamb√©m intensificou o colonialismo, pois as pot√™ncias precisavam de mat√©ria-prima e mercados consumidores.',
   qs:[{q:'Onde come√ßou a Revolu√ß√£o Industrial?',opts:['Fran√ßa','EUA','Inglaterra','Alemanha'],c:2},{q:'Quem inventou a m√°quina a vapor?',opts:['Newton','James Watt','Darwin','Edison'],c:1},{q:'O que surgiu como consequ√™ncia?',opts:['Melhoria trabalhista','Movimentos oper√°rios','Redu√ß√£o de horas','Aumento salarial'],c:1}]},
  {id:'3b',name:'Mem√≥ria e C√©rebro',words:128,title:'Como o C√©rebro Forma Mem√≥rias',subtitle:'N√≠vel 3 ¬∑ Dif√≠cil',
   content:'A forma√ß√£o de mem√≥rias √© um processo complexo que envolve diversas estruturas cerebrais interconectadas. O hipocampo desempenha papel central na consolida√ß√£o da mem√≥ria epis√≥dica, aquela relacionada a eventos e experi√™ncias pessoais vividas. Durante o sono, o c√©rebro reprocessa as informa√ß√µes adquiridas durante o dia, transferindo-as da mem√≥ria de curto prazo para a mem√≥ria de longo prazo. A plasticidade sin√°ptica, especialmente a potencia√ß√£o de longa dura√ß√£o, √© o mecanismo celular subjacente ao aprendizado humano. Neurotransmissores como glutamato e dopamina modulam a intensidade com que as mem√≥rias s√£o gravadas. Situa√ß√µes emocionais intensas produzem mem√≥rias mais v√≠vidas porque a am√≠gdala potencializa a atividade hipocampal durante a codifica√ß√£o.',
   qs:[{q:'Qual estrutura consolida a mem√≥ria epis√≥dica?',opts:['Am√≠gdala','C√≥rtex','Hipocampo','Cerebelo'],c:2},{q:'Quando o c√©rebro consolida mem√≥rias?',opts:['Exerc√≠cios','Sono','Refei√ß√µes','Leituras'],c:1},{q:'Por que mem√≥rias emocionais s√£o mais v√≠vidas?',opts:['Hipocampo maior','Am√≠gdala potencializa o hipocampo','Mais dopamina','Mais glutamato'],c:1}]},
  {id:'3c',name:'Mudan√ßas Clim√°ticas',words:130,title:'Mudan√ßas Clim√°ticas',subtitle:'N√≠vel 3 ¬∑ Dif√≠cil',
   content:'As mudan√ßas clim√°ticas representam um dos maiores desafios enfrentados pela humanidade no s√©culo vinte e um. O aquecimento global, causado principalmente pela emiss√£o de gases de efeito estufa como o di√≥xido de carbono e o metano, est√° alterando os padr√µes clim√°ticos em todo o planeta. As consequ√™ncias j√° s√£o vis√≠veis: derretimento das calotas polares, eleva√ß√£o do n√≠vel do mar, eventos clim√°ticos extremos cada vez mais frequentes. A transi√ß√£o para fontes de energia renov√°vel, como a solar e a e√≥lica, √© considerada essencial para reduzir as emiss√µes e limitar o aquecimento a um ponto e meio grau Celsius, conforme o Acordo de Paris. A adapta√ß√£o exige coopera√ß√£o internacional urgente e mudan√ßas profundas nos padr√µes de produ√ß√£o e consumo.',
   qs:[{q:'O que causa o aquecimento global?',opts:['Maremotos','Gases de efeito estufa','Apenas desmatamento','Vulc√µes'],c:1},{q:'Qual √© o limite do Acordo de Paris?',opts:['0,5¬∞C','1,0¬∞C','1,5¬∞C','2,5¬∞C'],c:2},{q:'Exemplos de energia renov√°vel?',opts:['Nuclear e carv√£o','Solar e e√≥lica','Petr√≥leo e g√°s','Hidrel√©trica e nuclear'],c:1}]},
  {id:'3d',name:'Comunica√ß√£o Humana',words:122,title:'Comunica√ß√£o Humana',subtitle:'N√≠vel 3 ¬∑ Dif√≠cil',
   content:'A comunica√ß√£o humana √© um processo complexo que envolve a transmiss√£o e a recep√ß√£o de mensagens entre indiv√≠duos. Para que ocorra de forma eficaz, s√£o necess√°rios um emissor, uma mensagem, um canal e um receptor. A linguagem verbal, oral e escrita, √© a forma mais elaborada de comunica√ß√£o humana e depende de estruturas cerebrais espec√≠ficas para sua produ√ß√£o e compreens√£o. A linguagem n√£o verbal, que inclui gestos, express√µes faciais, postura corporal e olhar, complementa e √†s vezes substitui a comunica√ß√£o verbal. A pros√≥dia, ou seja, a melodia da fala, transmite informa√ß√µes emocionais e pragm√°ticas. Altera√ß√µes em qualquer componente podem comprometer a comunica√ß√£o e a participa√ß√£o social do indiv√≠duo.',
   qs:[{q:'Quais s√£o os elementos da comunica√ß√£o?',opts:['Voz, l√≠ngua, ouvido','Emissor, mensagem, canal, receptor','Palavras, frases, par√°grafos','Tom, ritmo, velocidade'],c:1},{q:'O que a pros√≥dia transmite?',opts:['Apenas conte√∫do','Informa√ß√µes emocionais e pragm√°ticas','A gram√°tica','A escrita'],c:1},{q:'O que pode comprometer a participa√ß√£o social?',opts:['Falar muito','Qualquer altera√ß√£o comunicativa','Falar pouco','Usar gestos'],c:1}]}
],
4:[
  {id:'4a',name:'Disfagia Orofar√≠ngea',words:148,title:'Disfagia Orofar√≠ngea',subtitle:'N√≠vel 4 ¬∑ Avan√ßado',
   content:'A disfagia orofar√≠ngea caracteriza-se por dificuldade na degluti√ß√£o decorrente de altera√ß√µes nas fases oral, far√≠ngea ou na transi√ß√£o faringoesof√°gica do processo deglutit√≥rio. As causas mais frequentes incluem acidente vascular encef√°lico, doen√ßa de Parkinson, esclerose lateral amiotr√≥fica e neoplasias de cabe√ßa e pesco√ßo tratadas com cirurgia ou radioterapia. Do ponto de vista neurofisiol√≥gico, a degluti√ß√£o normal exige coordena√ß√£o precisa de mais de trinta m√∫sculos, regulados pelo tronco encef√°lico e por estruturas supratentoriais bilaterais. A penetra√ß√£o lar√≠ngea e a aspira√ß√£o traqueobr√¥nquica representam as complica√ß√µes mais graves. A avalia√ß√£o cl√≠nica fonoaudiol√≥gica, complementada pela videofluoroscopia e pela videoendoscopia, constitui o padr√£o-ouro diagn√≥stico. O manejo inclui estrat√©gias posturais e modifica√ß√£o de consist√™ncias conforme a IDDSI.',
   qs:[{q:'Quantos m√∫sculos na degluti√ß√£o?',opts:['Mais de 10','Mais de 20','Mais de 30','Mais de 50'],c:2},{q:'Padr√£o-ouro diagn√≥stico?',opts:['Tomografia','Resson√¢ncia','Videofluoroscopia + videoendoscopia','Ultrassom'],c:2},{q:'O que √© aspira√ß√£o traqueobr√¥nquica?',opts:['Tosse','Entrada de material nas vias a√©reas','Dificuldade de mastigar','Refluxo'],c:1}]},
  {id:'4b',name:'Avalia√ß√£o Vocal Ac√∫stica',words:143,title:'Par√¢metros Ac√∫sticos da Voz',subtitle:'N√≠vel 4 ¬∑ Avan√ßado',
   content:'A avalia√ß√£o ac√∫stica da voz constitui instrumento fundamental na pr√°tica fonoaudiol√≥gica contempor√¢nea. Par√¢metros como frequ√™ncia fundamental, jitter, shimmer e propor√ß√£o harm√¥nico-ru√≠do permitem quantificar objetivamente as caracter√≠sticas vibrat√≥rias das pregas vocais. A frequ√™ncia fundamental m√©dia varia entre cento e vinte e duzentos e cinquenta hertz em homens adultos e entre cento e noventa e duzentos e noventa hertz em mulheres. Perturba√ß√µes de frequ√™ncia, mensuradas pelo jitter, acima de um por cento indicam irregularidade vibrat√≥ria significativa. O shimmer, quando superior a tr√™s decib√©is, sugere altera√ß√£o na coapta√ß√£o gl√≥tica. A propor√ß√£o harm√¥nico-ru√≠do abaixo de quinze decib√©is indica excesso de ru√≠do no sinal. Tais medidas devem ser interpretadas em conjunto com a avalia√ß√£o perceptivo-auditiva e laringosc√≥pica.',
   qs:[{q:'O que mede o jitter?',opts:['Amplitude','Frequ√™ncia','Ru√≠do','Fundamental'],c:1},{q:'Software citado?',opts:['Audacity','Praat','GarageBand','MATLAB'],c:1},{q:'HNR abaixo de 15 dB indica?',opts:['Voz normal','Frequ√™ncia alta','Excesso de ru√≠do','Boa coapta√ß√£o'],c:2}]},
  {id:'4c',name:'Afasia',words:145,title:'Afasia: Classifica√ß√£o e Terapia',subtitle:'N√≠vel 4 ¬∑ Avan√ßado',
   content:'A afasia √© um dist√∫rbio adquirido da linguagem resultante de les√£o cerebral, mais frequentemente causada por acidente vascular encef√°lico. As afasias s√£o classificadas pela flu√™ncia do discurso, compreens√£o auditiva, repeti√ß√£o e nomea√ß√£o. A afasia de Broca caracteriza-se por fala n√£o fluente, telegr√°fica e laboriosa, com compreens√£o relativamente preservada. A afasia de Wernicke apresenta fala fluente com parafasias sem√¢nticas e fon√™micas e compreens√£o gravemente comprometida. A afasia de condu√ß√£o distingue-se pela repeti√ß√£o severamente prejudicada com flu√™ncia relativamente preservada. O tratamento baseia-se em abordagens que exploram a neuroplasticidade, como a terapia de entona√ß√£o mel√≥dica e o uso de comunica√ß√£o aumentativa e alternativa para pacientes com afasia grave.',
   qs:[{q:'O que caracteriza a afasia de Broca?',opts:['Fala fluente','Fala n√£o fluente e telegr√°fica','Boa repeti√ß√£o','Apenas nomea√ß√£o'],c:1},{q:'Na afasia de Wernicke, o que est√° comprometido?',opts:['Apenas a fala','Compreens√£o e repeti√ß√£o','S√≥ a nomea√ß√£o','A mem√≥ria'],c:1},{q:'O que √© a terapia de entona√ß√£o mel√≥dica?',opts:['T√©cnica de relaxamento','Abordagem que usa melodia para reabilitar fala','An√°lise de frequ√™ncia','Exerc√≠cio respirat√≥rio'],c:1}]},
  {id:'4d',name:'Marcos de Linguagem',words:138,title:'Marcos de Linguagem na Inf√¢ncia',subtitle:'N√≠vel 4 ¬∑ Avan√ßado',
   content:'O desenvolvimento da linguagem na inf√¢ncia segue uma trajet√≥ria relativamente previs√≠vel, com marcos que servem de refer√™ncia para identifica√ß√£o precoce de altera√ß√µes. Nos primeiros dois meses de vida, o beb√™ emite sons vegetativos e apresenta rea√ß√µes reflexas ao som. Entre tr√™s e seis meses surgem o balbucio e a vocaliza√ß√£o em resposta √† voz humana. Aos doze meses, espera-se que a crian√ßa produza as primeiras palavras com significado. Entre dezoito e vinte e quatro meses, o vocabul√°rio expande-se rapidamente e surgem as primeiras combina√ß√µes de duas palavras. Aos tr√™s anos, a crian√ßa deve produzir frases de tr√™s a quatro palavras e ser compreendida fora do n√∫cleo familiar. Atrasos nesses marcos devem ser investigados por fonoaudi√≥logo, com diferencia√ß√£o entre atraso simples e transtorno espec√≠fico de linguagem.',
   qs:[{q:'Quando surgem as primeiras palavras?',opts:['3 meses','6 meses','12 meses','18 meses'],c:2},{q:'Aos 3 anos, compreendida por quem?',opts:['S√≥ pela m√£e','S√≥ pela fam√≠lia','Pessoas fora do n√∫cleo familiar','S√≥ pelo fono'],c:2},{q:'O que diferencia atraso simples de TEL?',opts:['A idade','Investiga√ß√£o especializada','A intelig√™ncia','O n√∫mero de palavras'],c:1}]}
],
5:[
  {id:'5a',name:'Epigen√©tica e Linguagem',words:162,title:'Epigen√©tica e Aquisi√ß√£o de Linguagem',subtitle:'N√≠vel 5 ¬∑ Expert',
   content:'A intersec√ß√£o entre epigen√©tica e neuroci√™ncia da linguagem tem revelado mecanismos pelos quais a experi√™ncia ambiental modula a express√£o g√™nica em circuitos neuronais subjacentes √† comunica√ß√£o humana. Processos epigen√©ticos como metila√ß√£o do DNA, modifica√ß√µes de histonas e regula√ß√£o por RNA n√£o codificante modulam a transcri√ß√£o de genes relacionados √† sinaptog√™nese e √† mieliniza√ß√£o em regi√µes como o giro frontal inferior, o plano temporal e o fasc√≠culo arqueado. Estudos longitudinais demonstram que a riqueza do input lingu√≠stico nos primeiros trinta e seis meses de vida produz modifica√ß√µes epigen√©ticas duradouras que influenciam trajet√≥rias de desenvolvimento fonol√≥gico, morfossint√°tico e lexical ao longo da escolariza√ß√£o. O FOXP2, cujas variantes al√©licas t√™m sido associadas a transtornos espec√≠ficos da linguagem e da apraxia verbal, √© regulado durante o per√≠odo cr√≠tico. As implica√ß√µes cl√≠nicas para a interven√ß√£o fonoaudiol√≥gica precoce s√£o profundas, sugerindo efeitos potencialmente transgeracionais.',
   qs:[{q:'FOXP2 est√° associado a?',opts:['Audi√ß√£o','Transtornos de linguagem','Disfagia','Voz'],c:1},{q:'Per√≠odo cr√≠tico: quando?',opts:['5‚Äì10 anos','Primeiros 36 meses','Adolesc√™ncia','Vida adulta'],c:1},{q:'O que √© o fasc√≠culo arqueado?',opts:['M√∫sculo','Conex√£o cerebral para linguagem','Estrutura do ouvido','Gl√¢ndula'],c:1}]},
  {id:'5b',name:'Gagueira Neurobiologia',words:158,title:'Neurobiologia da Gagueira',subtitle:'N√≠vel 5 ¬∑ Expert',
   content:'A gagueira desenvolvimental persistente tem substrato neurobiol√≥gico bem estabelecido, evidenciado por d√©cadas de estudos de neuroimagem funcional e estrutural convergentes. Metan√°lises de resson√¢ncia magn√©tica funcional demonstram consistentemente hipoativa√ß√£o do giro frontal inferior esquerdo, especialmente da √°rea de Broca, e hiperativa√ß√£o hom√≥loga direita durante a fala espont√¢nea, sugerindo atipicidade na lateraliza√ß√£o hemisf√©rica do processamento motor da fala. Anormalidades na subst√¢ncia branca do fasc√≠culo arqueado e das vias corticoespinhais foram identificadas por estudos de tensor de difus√£o. A dopamina desempenha papel modulat√≥rio relevante, explicando a efic√°cia parcial de antidopamin√©rgicos em subgrupos espec√≠ficos. A abordagem terap√™utica contempor√¢nea, que combina regula√ß√£o da flu√™ncia com terapias de aceita√ß√£o e comprometimento, reconhece que qualidade de vida supera a supress√£o exclusiva de disflu√™ncias como crit√©rio terap√™utico principal.',
   qs:[{q:'O que mostram os estudos de fMRI na gagueira?',opts:['Hiperativa√ß√£o bilateral','Hipoativa√ß√£o do giro frontal esquerdo','Altera√ß√£o cerebelar','Aumento do hipocampo'],c:1},{q:'Qual neurotransmissor √© modulat√≥rio?',opts:['Serotonina','Glutamato','Dopamina','GABA'],c:2},{q:'O que a ACT prioriza?',opts:['Supress√£o de disflu√™ncias','Qualidade de vida','Medica√ß√£o','An√°lise ac√∫stica'],c:1}]},
  {id:'5c',name:'Presbifonia',words:155,title:'Presbifonia: Voz e Envelhecimento',subtitle:'N√≠vel 5 ¬∑ Expert',
   content:'A presbifonia designa as altera√ß√µes vocais decorrentes do processo fisiol√≥gico de envelhecimento lar√≠ngeo, distinguindo-se das disfonias patol√≥gicas por sua natureza progressiva e multifatorial. As altera√ß√µes incluem atrofia das fibras musculares das pregas vocais, calcifica√ß√£o das cartilagens lar√≠ngeas e ressecamento das mucosas por redu√ß√£o glandular. Do ponto de vista perceptivo-auditivo, manifesta-se por voz tr√™mula, soprosa, redu√ß√£o da intensidade e restri√ß√£o da extens√£o fonat√≥ria. Os par√¢metros ac√∫sticos t√≠picos incluem eleva√ß√£o do jitter e shimmer, redu√ß√£o da propor√ß√£o harm√¥nico-ru√≠do e instabilidade da frequ√™ncia fundamental. A videoestroboscopia lar√≠ngea diferencia a presbifonia fisiol√≥gica de patologias superimpostas. A terapia visa otimizar o suporte respirat√≥rio, aumentar o esfor√ßo gl√≥tico e reorganizar a biomec√¢nica fonat√≥ria, com evid√™ncias de reversibilidade parcial por meio do exerc√≠cio vocal sistematizado.',
   qs:[{q:'O que √© presbifonia?',opts:['Les√£o lar√≠ngea','Altera√ß√£o vocal fisiol√≥gica pelo envelhecimento','Disfonia por uso excessivo','Paralisia de prega'],c:1},{q:'O que diferencia presbifonia de patologias?',opts:['Resson√¢ncia','Tomografia','Videoestroboscopia','Audiometria'],c:2},{q:'O que a terapia visa?',opts:['Cirurgia','Otimizar respira√ß√£o e esfor√ßo gl√≥tico','Sil√™ncio vocal','Medica√ß√£o'],c:1}]},
  {id:'5d',name:'TPAC',words:160,title:'Transtorno do Processamento Auditivo Central',subtitle:'N√≠vel 5 ¬∑ Expert',
   content:'O transtorno do processamento auditivo central, designado TPAC, caracteriza-se por dificuldades no processamento das informa√ß√µes ac√∫sticas pelo sistema nervoso auditivo central, na presen√ßa de limiares auditivos perif√©ricos dentro dos padr√µes de normalidade. O diagn√≥stico diferencial entre TPAC e outros transtornos do neurodesenvolvimento, como TDAH e transtorno do espectro autista, √© um dos maiores desafios cl√≠nicos, pois esses quadros compartilham manifesta√ß√µes e podem coexistir. A avalia√ß√£o inclui testes de escuta dic√≥tica, resolu√ß√£o temporal, localiza√ß√£o sonora e processamento de padr√µes tonais. Testes eletrofisiol√≥gicos como o potencial evocado auditivo de longa lat√™ncia e o mismatch negativity fornecem dados objetivos sobre o processamento cortical. As interven√ß√µes incluem treino auditivo formal, modifica√ß√µes ambientais e uso de sistemas de frequ√™ncia modulada em contextos educacionais.',
   qs:[{q:'O que caracteriza o TPAC?',opts:['Surdez perif√©rica','Dificuldade de processamento central com audi√ß√£o perif√©rica normal','Perda condutiva','Altera√ß√£o do nervo'],c:1},{q:'O que avalia a escuta dic√≥tica?',opts:['Limiares puros','Sons em ambas as orelhas simultaneamente','Reflexo c√≥cleo-palpebral','Emiss√µes otoac√∫sticas'],c:1},{q:'O que fundamenta os efeitos do tratamento?',opts:['Medica√ß√£o','Cirurgia','Plasticidade auditiva cortical','Amplifica√ß√£o'],c:2}]}
],
6:[
  {id:'6a',name:'Fonologia Extrema',words:143,title:'Processamento Fonol√≥gico Extremo',subtitle:'N√≠vel 6 ¬∑ EXTREMO',
   content:'O fonoaudi√≥logo avaliou a fonoarticula√ß√£o: "Pronuncie pseudopalavras polisil√°bicas: frangip√¢nzila, xifop√°gio, estrelitzia, psicotronismo, zaraguat√£o, esternocleidomastoideo, feocromocitoma, hepatoesplenomegalia." O processamento fonol√≥gico suprassegmental pressup√µe representa√ß√µes lexicais especificadas com tra√ßos distintivos de sonoridade, vozeamento, ponto e modo de articula√ß√£o. Fricativas sibilantes interdentais, africadas palatoalveolares, consoantes nasais velares: cada fonema demanda coordena√ß√£o neuromuscular entre laringe, v√©u palatino, l√≠ngua e l√°bios. Transtornos fonol√≥gicos inconsistentes distinguem-se da dispraxia verbal pela preserva√ß√£o relativa da praxis n√£o-verbal orofacial. Avalie: "O peito-azul-grande piou para o pica-pau-an√£o que protegia seus pintinhos no p√© do ip√™-de-jardim purp√∫reo." Respire, controle o fluxo expirat√≥rio subgl√≥tico, coordene fona√ß√£o e articula√ß√£o.',
   qs:[{q:'O que distingue transtorno fonol√≥gico de dispraxia?',opts:['Mais erros','Preserva√ß√£o da praxis n√£o-verbal','Altera√ß√£o vocal','Comprometimento auditivo'],c:1},{q:'O que √© estimulabilidade?',opts:['Imitar sons com modelo','For√ßa muscular','Discrimina√ß√£o auditiva','Velocidade de fala'],c:0},{q:'Tra√ßos distintivos citados?',opts:['Tom e ritmo','Sonoridade, vozeamento, ponto e modo','Frequ√™ncia e amplitude','Jitter e shimmer'],c:1}]},
  {id:'6b',name:'Subsistemas da Fala',words:158,title:'Avalia√ß√£o Multidimensional da Fala',subtitle:'N√≠vel 6 ¬∑ EXTREMO',
   content:'Subsistemas da fala ‚Äî respira√ß√£o, fona√ß√£o, resson√¢ncia, articula√ß√£o, pros√≥dia ‚Äî operam em sinergia neuromuscular que pressup√µe integridade dos nervos cranianos cinco, sete, nove, dez, onze e doze, do nervo fr√™nico e dos intercostais. Leia mantendo qualidade vocal, taxa adequada e pros√≥dia expressiva: pseudopseudohipoparatiroidismo, esternocleidomastoideo, hepatoesplenomegalia, feocromocitoma, pneumonoultramicroscopicosilicovolcanoconiose. Com √™nfase expressiva: "O xenof√≥bico xerife extraordinariamente exc√™ntrico exigiu que expulsassem extemporaneamente os exploradores estrangeiros experientes." Com ritmo regular: "Tr√™s pratos de trigo para tr√™s tigres tristes e magros." Mais: "O rato roeu a roupa do rei de Roma enquanto a rainha rasgava o restante." A leitura oral de textos densos exige integra√ß√£o fonol√≥gica, morfossint√°tica, sem√¢ntica e pragm√°tica simult√¢nea.',
   qs:[{q:'Quantos subsistemas da fala?',opts:['3','4','5','6'],c:2},{q:'Quais nervos cranianos?',opts:['1,2,3,4,5','5,7,9,10,11,12','3,4,5,6,7,8','7,8,9,10,11,12'],c:1},{q:'O que a leitura densa exige?',opts:['S√≥ mem√≥ria','Integra√ß√£o m√∫ltipla simult√¢nea','S√≥ velocidade','S√≥ articula√ß√£o'],c:1}]},
  {id:'6c',name:'Disartrias',words:165,title:'Disartrias: Classifica√ß√£o Neuromotora',subtitle:'N√≠vel 6 ¬∑ EXTREMO',
   content:'As disartrias constituem um conjunto de dist√∫rbios motores da fala decorrentes de les√µes do sistema nervoso que afetam a execu√ß√£o neuromuscular dos subsistemas fonat√≥rio, articulat√≥rio, velofar√≠ngeo e respirat√≥rio. A classifica√ß√£o de Mayo, sistematizada por Darley, Aronson e Brown, distingue seis subtipos: fl√°cida, esp√°stica, at√°xica, hipocin√©tica, hipercin√©tica e mista. A disartria fl√°cida resulta de les√£o do neur√¥nio motor inferior, caracterizando-se por hipotonia, voz soprosa, hipernasalidade e articula√ß√£o distorcida. A disartria esp√°stica associa-se a les√µes bilaterais do neur√¥nio motor superior, com hipertonia, voz for√ßada e estrangulada. A disartria at√°xica resulta de les√£o cerebelar, com pros√≥dia irregular e articula√ß√£o explosiva. A avalia√ß√£o utiliza protocolos como o Frenchay Dysarthria Assessment e exige an√°lise da Diadococinesia Articulat√≥ria, avaliada pela rapidez e regularidade de sequ√™ncias como pataca e badaga.',
   qs:[{q:'Subtipo de les√£o do neur√¥nio motor inferior?',opts:['Esp√°stica','At√°xica','Fl√°cida','Hipocin√©tica'],c:2},{q:'O que avalia a Diadococinesia?',opts:['Qualidade vocal','Rapidez e regularidade de s√≠labas repetidas','Compreens√£o','Flu√™ncia'],c:1},{q:'Les√£o cerebelar causa qual disartria?',opts:['Fl√°cida','Esp√°stica','At√°xica','Hipocin√©tica'],c:2}]},
  {id:'6d',name:'Dislexia e Consci√™ncia Fonol√≥gica',words:152,title:'Dislexia e Consci√™ncia Fonol√≥gica',subtitle:'N√≠vel 6 ¬∑ EXTREMO',
   content:'A consci√™ncia fonol√≥gica, capacidade metalingu√≠stica de refletir e manipular segmentos sonoros da fala, constitui o preditor mais robusto do sucesso na aprendizagem da leitura em sistemas alfab√©ticos. Sua estrutura hier√°rquica compreende habilidades sil√°bica, intrassil√°bica e fon√™mica, sendo esta √∫ltima a mais relacionada √† decodifica√ß√£o grafof√¥nica. A dislexia desenvolvimental, classificada como transtorno espec√≠fico de aprendizagem no DSM-5 e CID-11, manifesta-se por dificuldades persistentes e inesperadas na decodifica√ß√£o fonol√≥gica, flu√™ncia leitora e soletra√ß√£o. O modelo de dupla rota de Coltheart distingue a via lexical, respons√°vel pelo reconhecimento de palavras familiares, da via fonol√≥gica, utilizada para decodifica√ß√£o de palavras novas e pseudopalavras. Interven√ß√µes baseadas em evid√™ncia incluem treino expl√≠cito de consci√™ncia fon√™mica, correspond√™ncia grafema-fonema e leitura repetida cronometrada com feedback corretivo imediato, em frequ√™ncia m√≠nima de tr√™s a quatro sess√µes semanais.',
   qs:[{q:'Preditor mais robusto de sucesso na leitura?',opts:['Mem√≥ria visual','Consci√™ncia fonol√≥gica','Vocabul√°rio oral','Intelig√™ncia'],c:1},{q:'O que distingue via lexical da fonol√≥gica?',opts:['Velocidade','Lexical reconhece familiares; fonol√≥gica decodifica novas','Tipo de letra','Compreens√£o'],c:1},{q:'Frequ√™ncia m√≠nima de interven√ß√£o?',opts:['1x semana','2x semana','3‚Äì4x semana','Di√°rio'],c:2}]}
]};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DESAFIOS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const TRAVALINGUAZ = [
  {id:'t1',name:'O Rato Roeu',diff:1,color:'#00e5a0',reps:5,
   text:'O rato roeu a roupa do rei de Roma, a rainha com raiva rasgou o resto.'},
  {id:'t2',name:'Tr√™s Tigres',diff:1,color:'#00e5a0',reps:5,
   text:'Tr√™s pratos de trigo para tr√™s tigres tristes.'},
  {id:'t3',name:'Pedro Prego',diff:2,color:'#00d4ff',reps:4,
   text:'Pedro pede para o padre Pedro parar de pregar pregos pequenos nos postes.'},
  {id:'t4',name:'Sab√£o Sabia',diff:2,color:'#00d4ff',reps:4,
   text:'O sabi√° sabia que a s√°bia sabia que o sabi√° sabia assobiar.'},
  {id:'t5',name:'Xuxa Xadrez',diff:3,color:'#ffb340',reps:3,
   text:'A Xuxa chorou por causa da chaleira de ch√° que queimou o ch√£o do chal√©.'},
  {id:'t6',name:'Fada Fadiga',diff:3,color:'#ffb340',reps:3,
   text:'A fada fotografou a fotografia da fot√≥grafa que fotografava fadas na floresta.'},
  {id:'t7',name:'Bruxo Branco',diff:4,color:'#ff4f6b',reps:3,
   text:'O bruxo branco bate bravamente no bumbo enquanto o brabo boi berrante berra.'},
  {id:'t8',name:'Cuscuz Cascudo',diff:4,color:'#ff4f6b',reps:2,
   text:'O cuscuz cozido do cascudo cozinheiro causou certa celeuma no castelo do conde.'},
  {id:'t9',name:'Pseudoarr√≠tmico',diff:5,color:'#b06cff',reps:2,
   text:'O esternocleidomastoideo estremeceu extraordinariamente enquanto o espeleologista espirrava espontaneamente.'},
  {id:'t10',name:'Ultra Extremo',diff:6,color:'#ff6b9d',reps:1,
   text:'Pseudopseudohipoparatiroidismo provoca perplexidade nos patologistas que perscrutam a prec√°ria presen√ßa de paratorm√¥nio plasm√°tico.'}
];

const DIADOCO_SETS = [
  {id:'d1',name:'PA-TA-CA (padr√£o)',target:30,time:10,syllables:['pa','ta','ca'],color:'#00e5a0'},
  {id:'d2',name:'BA-DA-GA (vozeado)',target:28,time:10,syllables:['ba','da','ga'],color:'#00d4ff'},
  {id:'d3',name:'PA-PA-PA',target:35,time:10,syllables:['pa'],color:'#ffb340'},
  {id:'d4',name:'LA-LA-LA',target:32,time:10,syllables:['la'],color:'#ff4f6b'},
  {id:'d5',name:'KA-KA-KA (velar)',target:30,time:10,syllables:['ka'],color:'#b06cff'},
  {id:'d6',name:'Alternado PA-KA',target:24,time:10,syllables:['pa','ka'],color:'#ff6b9d'},
  {id:'d7',name:'Avan√ßado BA-TA-KA',target:22,time:10,syllables:['ba','ta','ka'],color:'#ffd700'}
];

const SONS_SETS = [
  {id:'s1',name:'/r/ vibrante',phoneme:'R',color:'#ff4f6b',words:['rato','rua','rola','remo','roxo','rosa','rico','raiz','rins','rixa','Roma','roda','rede','raro','rude']},
  {id:'s2',name:'/l/ lateral',phoneme:'L',color:'#00d4ff',words:['lua','lata','le√£o','lima','lobo','luta','lago','leme','luva','loiro','larva','leal','l√≠rio','lodo','luxo']},
  {id:'s3',name:'/s/ sibilante',phoneme:'S',color:'#00e5a0',words:['sapo','sopa','sino','sumo','sala','sede','solo','suor','saci','seco','sucre','suave','s√©rie','s√≥lido','sutil']},
  {id:'s4',name:'/f/ fricativa',phoneme:'F',color:'#ffb340',words:['faca','fogo','fino','fumo','fala','feto','faro','f√≠sico','favo','feixe','fundo','forte','f√©ria','fluir','fluxo']},
  {id:'s5',name:'/ É/ palatal',phoneme:'X/CH',color:'#b06cff',words:['chuva','xarope','ch√£o','Xavier','chave','x√≠cara','cheio','xerife','cheiro','xadrez','chorar','xer√©m','choupo','xaxim']},
  {id:'s6',name:'/…æ/ tepe',phoneme:'R med.',color:'#ff6b9d',words:['caro','para','moro','fora','tiro','cura','paro','vera','dura','hora','faro','cera','pura','mira','sera']},
  {id:'s7',name:'/n/ + /m/ nasais',phoneme:'N ¬∑ M',color:'#4ecdc4',words:['nata','mato','nuvem','muda','neve','medo','novo','modo','nulo','mulo','na√ß√£o','milho','nariz','milho','nome']}
];

const PSEUDO_SETS = {
  facil:[['fa','lo','ti'],['be','ru','na'],['pi','so','da'],['tu','ma','le'],['ga','ni','bo']],
  medio:[['es','tra','lo','fi'],['pre','di','so','na'],['tra','be','cu','la'],['men','so','pi','da'],['fro','le','sti','na']],
  dificil:[['pra','xin','te','lo','vi'],['es','tro','fi','ban','ta'],['pre','du','xin','so','ma'],['fran','ti','pe','lo','su'],['gra','dis','pe','mo','tia']],
  extremo:[['pse','u','do','pa','ra','ti','roi'],['es','ter','no','clei','do','mas'],['he','pa','to','es','ple','no'],['feo','cro','mo','ci','to','ma'],['pneu','mo','ul','tra','mi','cro']]
};

const LACUNAS_SETS = [
  {id:'l1',name:'Animais B√°sico',diff:1,items:[
    {sentence:'O ___ late para os estranhos.',opts:['gato','cachorro','passarinho','peixe'],correct:1},
    {sentence:'A ___ voa muito alto no c√©u.',opts:['galinha','tartaruga','√°guia','vaca'],correct:2},
    {sentence:'O ___ nada no rio.',opts:['gato','coelho','peixe','burro'],correct:2},
    {sentence:'A ___ produz leite para n√≥s.',opts:['galinha','vaca','cabra','abelha'],correct:1}
  ]},
  {id:'l2',name:'Corpo Humano',diff:2,items:[
    {sentence:'Usamos os ___ para andar.',opts:['bra√ßos','p√©s','olhos','ouvidos'],correct:1},
    {sentence:'O ___ bombeia o sangue pelo corpo.',opts:['pulm√£o','rim','cora√ß√£o','f√≠gado'],correct:2},
    {sentence:'O ___ √© respons√°vel pela respira√ß√£o.',opts:['cora√ß√£o','est√¥mago','pulm√£o','c√©rebro'],correct:2},
    {sentence:'O ___ processa as informa√ß√µes do corpo.',opts:['f√≠gado','rim','pulm√£o','c√©rebro'],correct:3}
  ]},
  {id:'l3',name:'Fonoaudiologia Cl√≠nica',diff:4,items:[
    {sentence:'A ___ orofar√≠ngea √© avaliada pela videofluoroscopia.',opts:['afasia','disfonia','disfagia','apraxia'],correct:2},
    {sentence:'O ___ √© um par√¢metro ac√∫stico de perturba√ß√£o de frequ√™ncia.',opts:['shimmer','jitter','HNR','F0'],correct:1},
    {sentence:'A afasia de ___ caracteriza-se por fala n√£o fluente.',opts:['Wernicke','condu√ß√£o','global','Broca'],correct:3},
    {sentence:'A ___ fon√™mica √© o preditor mais robusto da leitura.',opts:['consci√™ncia','mem√≥ria','aten√ß√£o','percep√ß√£o'],correct:0}
  ]},
  {id:'l4',name:'Neurologia da Fala',diff:5,items:[
    {sentence:'A √°rea de ___ √© respons√°vel pela produ√ß√£o da fala.',opts:['Wernicke','Broca','Heschl','Penfield'],correct:1},
    {sentence:'O fasc√≠culo ___ conecta as √°reas de produ√ß√£o e compreens√£o.',opts:['uncinado','frontal','arqueado','longitudinal'],correct:2},
    {sentence:'A ___ √© o conjunto de dist√∫rbios motores da fala por les√£o neurol√≥gica.',opts:['afasia','apraxia','disartria','dislalia'],correct:2},
    {sentence:'A plasticidade ___ √© o substrato neural da reabilita√ß√£o.',opts:['auditiva','sin√°ptica','lar√≠ngea','muscular'],correct:1}
  ]}
];

const PROGRESSIVO_SETS = [
  {id:'p1',name:'Expans√£o Crescente ‚Äì Animais',sentences:[
    'O c√£o.','O c√£o late.','O c√£o late muito.','O c√£o grande late muito alto.',
    'O c√£o grande e peludo late muito alto.','O c√£o grande e peludo late muito alto para o gato.',
    'O c√£o grande e peludo late muito alto e assusta o gato preto.',
    'O c√£o grande e peludo late muito alto e assusta o gato preto que dorme no sof√°.'
  ]},
  {id:'p2',name:'Frases Cl√≠nicas Progressivas',sentences:[
    'A fala.','A fala fluente.','A fala fluente envolve.','A fala fluente envolve coordena√ß√£o.',
    'A fala fluente envolve coordena√ß√£o neuromuscular.','A fala fluente envolve coordena√ß√£o neuromuscular precisa.',
    'A fala fluente envolve coordena√ß√£o neuromuscular precisa entre laringe.',
    'A fala fluente envolve coordena√ß√£o neuromuscular precisa entre laringe, v√©u palatino e l√≠ngua.',
    'A fala fluente envolve coordena√ß√£o neuromuscular precisa entre laringe, v√©u palatino, l√≠ngua e l√°bios.'
  ]},
  {id:'p3',name:'Progress√£o Fonol√≥gica Extrema',sentences:[
    'Fala.','Fala r√°pida.','Fala r√°pida fluente.','Fala r√°pida fluente e precisa.',
    'Fala r√°pida fluente e precisa pressup√µe.','Fala r√°pida fluente e precisa pressup√µe plasticidade.',
    'Fala r√°pida fluente e precisa pressup√µe plasticidade sin√°ptica.','Fala r√°pida fluente e precisa pressup√µe plasticidade sin√°ptica e coordena√ß√£o.',
    'Fala r√°pida fluente e precisa pressup√µe plasticidade sin√°ptica e coordena√ß√£o laringofaringeal.',
    'Fala r√°pida fluente e precisa pressup√µe plasticidade sin√°ptica e coordena√ß√£o laringofaringeal e articulat√≥ria contempor√¢nea.'
  ]},
  {id:'p4',name:'Trava-L√≠ngua Progressivo',sentences:[
    'Raramente.','Raramente o rato.','Raramente o rato roeu.','Raramente o rato roeu a roupa.',
    'Raramente o rato roeu a roupa rasgada.','Raramente o rato raivoso roeu a roupa rasgada.',
    'Raramente o rato raivoso roeu a roupa rasgada do rei.','Raramente o rato raivoso e r√°pido roeu a roupa rasgada do rei romano.',
    'Raramente o rato raivoso e r√°pido roeu a roupa rasgada do rei romano enquanto a rainha ria.'
  ]}
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BADGES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const ALL_BADGES = [
  {id:'first',ico:'üéØ',name:'Primeira Sess√£o',desc:'Completou a primeira avalia√ß√£o',cond:s=>s.length>=1},
  {id:'streak3',ico:'üî•',name:'Sequ√™ncia x3',desc:'3 sess√µes seguidas',cond:s=>s.length>=3},
  {id:'perfect',ico:'‚≠ê',name:'Leitura Perfeita',desc:'100% de precis√£o em uma sess√£o',cond:s=>s.some(x=>x.accuracy===100)},
  {id:'speed',ico:'‚ö°',name:'Velocista',desc:'PPM acima de 150 em qualquer sess√£o',cond:s=>s.some(x=>x.wpm>150)},
  {id:'trava5',ico:'üî¥',name:'Mestre do Trava',desc:'Completou 5 trava-l√≠nguas',cond:s=>s.filter(x=>x.mode==='travalinguaz').length>=5},
  {id:'diadoco10',ico:'üü¢',name:'Diadocoquinesia',desc:'Realizou 10 sess√µes de diadoco.',cond:s=>s.filter(x=>x.mode==='diadoco').length>=10},
  {id:'extremo',ico:'üíÄ',name:'N√≠vel Extremo',desc:'Completou texto n√≠vel 6',cond:s=>s.some(x=>x.level==6)},
  {id:'allmode',ico:'üåü',name:'Multimodal',desc:'Usou todos os 9 modos',cond:s=>{const ms=new Set(s.map(x=>x.mode));return ms.size>=9}},
  {id:'compreh100',ico:'üß†',name:'Compreens√£o Total',desc:'100% nas quest√µes de compreens√£o',cond:s=>s.some(x=>x.compreh&&x.compreh.pct===100)},
  {id:'sessions20',ico:'üèÜ',name:'Dedica√ß√£o',desc:'20 sess√µes completadas',cond:s=>s.length>=20},
  {id:'pseudo50',ico:'üîµ',name:'Decodificador',desc:'50 pseudopalavras corretas',cond:s=>(s.find(x=>x.pseudoCorrect)||{pseudoCorrect:0}).pseudoCorrect>=50},
  {id:'lowvocal',ico:'üíö',name:'Voz Saud√°vel',desc:'VAS esfor√ßo p√≥s ‚â§ 2',cond:s=>s.some(x=>x.vasPos<=2)}
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let currentMode = 'leitura';
let currentItem = null;
let timerInterval = null;
let elapsedSec = 0;
let timerRunning = false;
let timerStarted = false;
let markMode = 'e';
let wordEls = [];
let marks = {};
let comprehAnswers = {};
let sessionPts = 0;
let totalPts = parseInt(localStorage.getItem('pb_pts')||'0');
let streak = parseInt(localStorage.getItem('pb_streak')||'0');
let mediaRecorder = null, audioChunks = [], audioBlob = null, isRecording = false;
let fsFontSz = 26;
let metroInterval = null, metroBPM = 60, metroOn = false, metroWord = 0;
let diadocoInterval = null, diadocoCount = 0, diadocoRunning = false;
let pseudoStats = {total:0,correct:0,wrong:0};
let progIndex = 0;
let autoLevel = false;
let travaTimes = [];
let sonsDone = {}, sonsFail = {};

document.getElementById('pts-total').textContent = totalPts;
document.getElementById('streak-n').textContent = streak;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PANELS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function goPanel(id, btn) {
  document.querySelectorAll('.ttab').forEach(t=>t.classList.remove('on'));
  btn.classList.add('on');
  document.getElementById('panel-avaliacao').classList.remove('on');
  document.getElementById('panel-avaliacao').style.display = 'none';
  ['desafios','ranking','badges','evolucao'].forEach(p=>{
    const el = document.getElementById('panel-'+p);
    el.classList.remove('on');
  });
  if(id==='avaliacao'){
    document.getElementById('panel-avaliacao').style.display = 'flex';
    document.getElementById('panel-avaliacao').classList.add('on');
  } else {
    const el = document.getElementById('panel-'+id);
    el.classList.add('on');
    if(id==='ranking') renderRanking();
    if(id==='badges') renderBadges();
    if(id==='evolucao') renderEvolution();
    if(id==='desafios') renderDesafios();
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODE SELECT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setMode(mode, btn) {
  currentMode = mode;
  document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentItem = null;
  resetAll();
  renderItemList();
  showEmpty();
}

function renderItemList() {
  const c = document.getElementById('items-list');
  let items = [];
  const diffLabels = {1:'F√°cil',2:'M√©dio',3:'Dif√≠cil',4:'Avan√ßado',5:'Expert',6:'Extremo'};
  const diffColors = {1:'#00e5a0',2:'#00d4ff',3:'#ffb340',4:'#ff4f6b',5:'#b06cff',6:'#ff6b9d'};

  if(currentMode==='leitura'){
    Object.entries(LEITURA).forEach(([lvl,arr])=>arr.forEach(t=>{
      items.push({id:t.id,name:t.name,meta:`${t.words} palavras ¬∑ N√≠vel ${lvl}`,diff:parseInt(lvl),data:t});
    }));
  } else if(currentMode==='travalinguaz'){
    items = TRAVALINGUAZ.map(t=>({id:t.id,name:t.name,meta:`Repeti√ß√µes: ${t.reps} ¬∑ N√≠vel ${t.diff}`,diff:t.diff,data:t}));
  } else if(currentMode==='diadoco'){
    items = DIADOCO_SETS.map(d=>({id:d.id,name:d.name,meta:`Meta: ${d.target} em ${d.time}s`,diff:1,data:d}));
  } else if(currentMode==='metronomo'){
    // All reading texts as options
    Object.entries(LEITURA).forEach(([lvl,arr])=>arr.forEach(t=>{
      items.push({id:'m-'+t.id,name:t.name,meta:`N√≠vel ${lvl} ¬∑ Com metr√¥nomo`,diff:parseInt(lvl),data:{...t,metro:true}});
    }));
  } else if(currentMode==='invertido'){
    Object.entries(LEITURA).slice(0,3).forEach(([lvl,arr])=>arr.slice(0,2).forEach(t=>{
      items.push({id:'inv-'+t.id,name:t.name+' (invertido)',meta:`N√≠vel ${lvl} ¬∑ Leitura invertida`,diff:parseInt(lvl)+2,data:{...t,inverted:true}});
    }));
  } else if(currentMode==='sons'){
    items = SONS_SETS.map(s=>({id:s.id,name:s.name,meta:`Fonema ${s.phoneme} ¬∑ 15 palavras`,diff:2,data:s}));
  } else if(currentMode==='pseudo'){
    items = [
      {id:'pf',name:'Pseudopalavras F√°ceis',meta:'2‚Äì3 s√≠labas',diff:1,data:{level:'facil'}},
      {id:'pm',name:'Pseudopalavras M√©dias',meta:'3‚Äì4 s√≠labas',diff:2,data:{level:'medio'}},
      {id:'pd',name:'Pseudopalavras Dif√≠ceis',meta:'4‚Äì5 s√≠labas',diff:4,data:{level:'dificil'}},
      {id:'pe',name:'Pseudopalavras Extremas',meta:'6‚Äì7 s√≠labas',diff:6,data:{level:'extremo'}}
    ];
  } else if(currentMode==='lacunas'){
    items = LACUNAS_SETS.map(l=>({id:l.id,name:l.name,meta:`${l.items.length} lacunas ¬∑ N√≠vel ${l.diff}`,diff:l.diff,data:l}));
  } else if(currentMode==='progressivo'){
    items = PROGRESSIVO_SETS.map(p=>({id:p.id,name:p.name,meta:`${p.sentences.length} frases crescentes`,diff:3,data:p}));
  }

  c.innerHTML = items.map(item=>`
    <div class="item-card" id="ic-${item.id}" onclick="selectItem('${item.id}')">
      <div class="item-name">${item.name}<span class="item-diff" style="color:${diffColors[item.diff]||'#aaa'};border-color:${diffColors[item.diff]||'#aaa'}33">${diffLabels[item.diff]||'‚Äî'}</span></div>
      <div class="item-meta">${item.meta}</div>
    </div>`).join('');
  window._itemsMap = {};
  items.forEach(i=>window._itemsMap[i.id]=i);
}

function selectItem(id) {
  const item = window._itemsMap[id];
  if(!item) return;
  currentItem = item;
  document.querySelectorAll('.item-card').forEach(el=>el.classList.remove('sel'));
  const el = document.getElementById('ic-'+id);
  if(el) el.classList.add('sel');
  resetAll();
  marks={}; comprehAnswers={};
  goPanel('avaliacao', document.querySelector('.ttab'));
  document.getElementById('panel-avaliacao').style.display='flex';
  document.getElementById('panel-avaliacao').classList.add('on');
  document.querySelectorAll('.ttab').forEach(t=>t.classList.remove('on'));
  document.querySelector('.ttab').classList.add('on');
  document.getElementById('empty-state').style.display='none';
  document.getElementById('work-content').style.display='block';
  renderCurrentMode();
  document.getElementById('btn-start').disabled=false;
  document.getElementById('btn-fs').disabled=false;
}

function showEmpty(){
  document.getElementById('empty-state').style.display='block';
  document.getElementById('work-content').style.display='none';
  document.getElementById('btn-start').disabled=true;
  document.getElementById('btn-fs').disabled=true;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RENDER EACH MODE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderCurrentMode(){
  const wc = document.getElementById('work-content');
  const data = currentItem.data;

  // Show/hide mark bar
  const markBar = document.getElementById('mark-bar');
  markBar.style.display = currentMode==='leitura'||currentMode==='metronomo'||currentMode==='invertido' ? 'flex' : 'none';

  if(currentMode==='leitura') renderLeitura(wc,data);
  else if(currentMode==='travalinguaz') renderTrava(wc,data);
  else if(currentMode==='diadoco') renderDiadoco(wc,data);
  else if(currentMode==='metronomo') renderMetronomo(wc,data);
  else if(currentMode==='invertido') renderInvertido(wc,data);
  else if(currentMode==='sons') renderSons(wc,data);
  else if(currentMode==='pseudo') renderPseudo(wc,data);
  else if(currentMode==='lacunas') renderLacunas(wc,data);
  else if(currentMode==='progressivo') renderProgressivo(wc,data);
}

/* ‚Äî LEITURA ‚Äî */
function renderLeitura(wc,data){
  wordEls = data.content.split(/\s+/);
  const wordsHtml = wordEls.map((w,i)=>`<span class="w" id="w${i}" onclick="markWord(${i})">${w}</span> `).join('');
  const qsHtml = (data.qs||[]).length ? `
    <div style="background:var(--s2);border:1px solid var(--border);padding:12px;margin-top:14px">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--cyan);text-transform:uppercase;margin-bottom:10px">Compreens√£o Leitora</div>
      ${(data.qs||[]).map((q,qi)=>`
        <div class="cq"><div class="cq-t"><strong>${qi+1}.</strong> ${q.q}</div>
        <div class="cq-opts">${q.opts.map((o,oi)=>`<div class="cq-opt" id="qo-${qi}-${oi}" onclick="answerQ(${qi},${oi})"><span class="opt-l">${['A','B','C','D'][oi]}</span>${o}</div>`).join('')}</div></div>`).join('')}
      <div class="cq-score" id="cq-score" style="display:none"></div>
    </div>` : '';
  wc.innerHTML = `
    <div class="txt-meta"><div class="txt-title">${data.title}</div><div class="txt-sub">${data.subtitle}</div></div>
    <div class="reading-txt" id="rtxt">${wordsHtml}</div>
    ${qsHtml}
    <div id="audio-row-container"></div>
    <div class="notes-area" style="margin-top:10px"><div class="notes-lbl">Observa√ß√µes cl√≠nicas</div>
    <textarea class="notes-ta" id="ann-notes" rows="3" placeholder="Qualidade vocal, postura, respira√ß√£o, pros√≥dia..."></textarea></div>`;
}

/* ‚Äî TRAVA-L√çNGUA ‚Äî */
function renderTrava(wc,data){
  travaTimes = [];
  let repsHtml = Array.from({length:data.reps},(_,i)=>`<div class="trava-rep" id="tr${i}">Rep ${i+1}</div>`).join('');
  wc.innerHTML=`
    <div class="txt-meta"><div class="txt-title">${data.name}</div><div class="txt-sub">Repita ${data.reps}x o mais r√°pido e claro poss√≠vel ¬∑ Clique em ‚úì/‚úó ap√≥s cada repeti√ß√£o</div></div>
    <div class="trava-round" id="trava-round">Repeti√ß√£o 1 de ${data.reps}</div>
    <div class="trava-display" id="trava-disp">${data.text}</div>
    <div class="trava-score-bar" id="trava-reps">${repsHtml}</div>
    <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
      <button class="pseudo-btn ok" onclick="travaScore(true)">‚úì Correto</button>
      <button class="pseudo-btn bad" onclick="travaScore(false)">‚úó Erro</button>
    </div>
    <div id="trava-final" style="display:none;margin-top:14px"></div>
    <div class="notes-area" style="margin-top:12px"><div class="notes-lbl">Observa√ß√µes</div>
    <textarea class="notes-ta" id="ann-notes" rows="2" placeholder="Observa√ß√µes cl√≠nicas..."></textarea></div>`;
}
let travaRep = 0, travaData = null;
function travaScore(ok){
  if(!currentItem) return;
  travaData = travaData || currentItem.data;
  const elapsed = elapsedSec;
  travaTimes.push({rep:travaRep+1,ok,time:elapsed});
  const el = document.getElementById('tr'+travaRep);
  if(el) el.classList.add(ok?'done':'fail');
  addPoints(ok?15:2);
  travaRep++;
  if(travaRep >= travaData.reps){
    const correct = travaTimes.filter(t=>t.ok).length;
    const score = Math.round((correct/travaData.reps)*100);
    document.getElementById('trava-final').style.display='block';
    document.getElementById('trava-final').innerHTML=`
      <div class="diadoco-result">
        <strong style="color:${score>=80?'var(--grn)':score>=60?'var(--amb)':'var(--red)'}">Resultado: ${correct}/${travaData.reps} corretos (${score}%)</strong>
        <br>Tempo total: ${elapsedSec}s ¬∑ M√©dia por rep: ${Math.round(elapsedSec/travaData.reps)}s
      </div>`;
    document.getElementById('btn-rep').disabled=false;
    stopTimer();
    saveSession({mode:'travalinguaz',name:currentItem.name,score,correct,total:travaData.reps});
    toast(`Trava-l√≠ngua: ${score}%!`,score>=80?'good':score>=60?'':'bad');
  } else {
    document.getElementById('trava-round').textContent=`Repeti√ß√£o ${travaRep+1} de ${travaData.reps}`;
    document.getElementById('trava-disp').classList.add('highlight');
    setTimeout(()=>document.getElementById('trava-disp').classList.remove('highlight'),300);
  }
}

/* ‚Äî DIADOCO ‚Äî */
function renderDiadoco(wc,data){
  diadocoCount=0; diadocoRunning=false;
  const syl = data.syllables.join(' ‚Äì ').toUpperCase();
  wc.innerHTML=`
    <div class="txt-meta"><div class="txt-title">${data.name}</div><div class="txt-sub">Meta: ${data.target} emiss√µes em ${data.time}s ¬∑ Pressione o bot√£o a cada emiss√£o</div></div>
    <div class="diadoco-word" id="dd-word">${syl}</div>
    <div class="diadoco-count" id="dd-count">0</div>
    <div class="diadoco-target">Meta: ${data.target} emiss√µes ¬∑ Tempo: <span id="dd-time">${data.time}</span>s</div>
    <button class="tap-btn" id="dd-tap" onclick="diadocoTap()">PRESSIONAR AQUI a cada emiss√£o</button>
    <div id="dd-result" class="diadoco-result" style="display:none"></div>
    <div class="notes-area" style="margin-top:10px"><div class="notes-lbl">Observa√ß√µes</div>
    <textarea class="notes-ta" id="ann-notes" rows="2" placeholder="Qualidade articulat√≥ria, regularidade, fadiga..."></textarea></div>`;
}
let diadocoTimeLeft = 0, diadocoData = null;
function diadocoTap(){
  if(!diadocoRunning){
    diadocoData = currentItem.data;
    diadocoTimeLeft = diadocoData.time;
    diadocoRunning=true;
    diadocoCount=0;
    if(!timerStarted) startTimer();
    diadocoInterval = setInterval(()=>{
      diadocoTimeLeft--;
      const te = document.getElementById('dd-time');
      if(te) te.textContent = diadocoTimeLeft;
      if(diadocoTimeLeft<=0){
        clearInterval(diadocoInterval);
        diadocoRunning=false;
        const rate = diadocoCount/diadocoData.time;
        const pct = Math.round((diadocoCount/diadocoData.target)*100);
        const res = document.getElementById('dd-result');
        if(res){
          res.style.display='block';
          res.innerHTML=`<strong style="color:${pct>=90?'var(--grn)':pct>=70?'var(--amb)':'var(--red)'}">${diadocoCount} emiss√µes em ${diadocoData.time}s (meta: ${diadocoData.target})</strong><br>Taxa: ${rate.toFixed(1)} emiss√µes/s ¬∑ ${pct}% da meta`;
        }
        addPoints(Math.round(pct/5));
        stopTimer();
        saveSession({mode:'diadoco',name:currentItem.name,diadocoCount,target:diadocoData.target,pct});
        toast(`Diadoco: ${diadocoCount}/${diadocoData.target} (${pct}%)`,pct>=90?'good':pct>=70?'':'bad');
      }
    },1000);
  }
  if(!diadocoRunning) return;
  diadocoCount++;
  const el = document.getElementById('dd-count');
  if(el){ el.textContent=diadocoCount; el.style.color=diadocoCount>=diadocoData.target?'var(--grn)':'var(--cyan)';}
  const wl = document.getElementById('dd-word');
  if(wl){ wl.classList.add('flash'); setTimeout(()=>wl.classList.remove('flash'),100);}
}

/* ‚Äî METR√îNOMO ‚Äî */
let metroWordIdx=0;
function renderMetronomo(wc,data){
  wordEls = data.content.split(/\s+/);
  const wordsHtml = wordEls.map((w,i)=>`<span class="beat-word" id="bw${i}">${w}</span> `).join('');
  wc.innerHTML=`
    <div class="txt-meta"><div class="txt-title">${data.title} <span style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--amb)">¬∑ com metr√¥nomo</span></div><div class="txt-sub">Leia uma palavra por batida do metr√¥nomo</div></div>
    <div class="metro-display">
      <div class="metro-beat" id="metro-beat">‚ô©</div>
      <div class="metro-bpm" id="metro-bpm">${metroBPM}</div>
      <div class="metro-bpm-label">BPM</div>
      <div class="metro-controls">
        <button class="cb" onclick="changeBPM(-5)">‚àí5</button>
        <input type="range" class="metro-slider" id="metro-sl" min="30" max="200" value="${metroBPM}" oninput="setBPM(this.value)">
        <button class="cb" onclick="changeBPM(5)">+5</button>
      </div>
    </div>
    <div class="metro-txt-area" id="metro-txt">${wordsHtml}</div>
    <div id="audio-row-container"></div>
    <div class="notes-area" style="margin-top:10px"><div class="notes-lbl">Observa√ß√µes</div>
    <textarea class="notes-ta" id="ann-notes" rows="2" placeholder="Ritmo, pausas, pros√≥dia com metr√¥nomo..."></textarea></div>`;
  metroWordIdx=0;
}
function changeBPM(d){ metroBPM=Math.max(30,Math.min(200,metroBPM+d)); setBPM(metroBPM); }
function setBPM(v){ metroBPM=parseInt(v); document.getElementById('metro-bpm').textContent=metroBPM; const sl=document.getElementById('metro-sl'); if(sl)sl.value=metroBPM; if(metroOn){stopMetro();startMetro();}}
function startMetro(){
  metroOn=true;
  metroWordIdx=0;
  const ms=Math.round(60000/metroBPM);
  metroInterval=setInterval(()=>{
    const beat=document.getElementById('metro-beat');
    if(beat){beat.classList.add('on');setTimeout(()=>beat.classList.remove('on'),120);}
    document.querySelectorAll('.beat-word').forEach(el=>el.classList.remove('lit'));
    const bw=document.getElementById('bw'+metroWordIdx);
    if(bw){bw.classList.add('lit');bw.scrollIntoView({block:'nearest',behavior:'smooth'});}
    metroWordIdx=(metroWordIdx+1)%(wordEls.length||1);
  },ms);
}
function stopMetro(){ clearInterval(metroInterval); metroOn=false; const b=document.getElementById('metro-beat'); if(b)b.classList.remove('on'); }

/* ‚Äî INVERTIDO ‚Äî */
function renderInvertido(wc,data){
  const words = data.content.split(/\s+/);
  const inverted = words.map(w=>w.split('').reverse().join('')).join(' ');
  wordEls = words;
  wc.innerHTML=`
    <div class="txt-meta"><div class="txt-title">${data.title} <span style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--pur)">¬∑ Invertido</span></div><div class="txt-sub">Leia as palavras de tr√°s para frente</div></div>
    <div class="invert-display" id="inv-txt">${inverted}</div>
    <div class="invert-original">Original (revelar depois): ${data.content.slice(0,60)}...</div>
    <div class="notes-area" style="margin-top:10px"><div class="notes-lbl">Observa√ß√µes</div>
    <textarea class="notes-ta" id="ann-notes" rows="2" placeholder="Dificuldades, estrat√©gias de decodifica√ß√£o..."></textarea></div>`;
}

/* ‚Äî SONS ‚Äî */
function renderSons(wc,data){
  sonsDone={}; sonsFail={};
  wc.innerHTML=`
    <div class="txt-meta"><div class="txt-title">${data.name}</div><div class="txt-sub">Clique em ‚úì se pronunciou corretamente, ‚úó se errou</div></div>
    <div class="sons-display">
      <div class="sons-phoneme" id="sons-ph" style="color:${data.color}">${data.phoneme}</div>
      <div class="sons-word-list" id="sons-words">
        ${data.words.map((w,i)=>`
          <div style="display:flex;flex-direction:column;align-items:center;gap:3px">
            <div class="sons-word" id="sw${i}">${w}</div>
            <div style="display:flex;gap:3px">
              <button style="font-size:9px;padding:2px 6px;border:1px solid rgba(0,229,160,.3);background:none;color:var(--grn);cursor:pointer;font-family:'IBM Plex Mono',monospace" onclick="scoreSon(${i},true)">‚úì</button>
              <button style="font-size:9px;padding:2px 6px;border:1px solid rgba(255,79,107,.3);background:none;color:var(--red);cursor:pointer;font-family:'IBM Plex Mono',monospace" onclick="scoreSon(${i},false)">‚úó</button>
            </div>
          </div>`).join('')}
      </div>
      <div class="sons-progress" id="sons-prog">0 / ${data.words.length} avaliados</div>
      <div id="sons-result" style="display:none;margin-top:10px"></div>
    </div>
    <div class="notes-area" style="margin-top:10px"><div class="notes-lbl">Observa√ß√µes</div>
    <textarea class="notes-ta" id="ann-notes" rows="2" placeholder="Padr√£o de erros, fonemas alterados..."></textarea></div>`;
}
function scoreSon(i,ok){
  if(ok){ sonsDone[i]=true; const el=document.getElementById('sw'+i); if(el){el.classList.add('done');el.classList.remove('err');}}
  else{ sonsFail[i]=true; const el=document.getElementById('sw'+i); if(el){el.classList.add('err');el.classList.remove('done');}}
  const done=Object.keys(sonsDone).length+Object.keys(sonsFail).length;
  const total=currentItem.data.words.length;
  const prog=document.getElementById('sons-prog');
  if(prog) prog.textContent=`${done} / ${total} avaliados`;
  if(done>=total){
    addPoints(Object.keys(sonsDone).length*5);
    const pct=Math.round((Object.keys(sonsDone).length/total)*100);
    const res=document.getElementById('sons-result');
    if(res){res.style.display='block';res.innerHTML=`<div class="diadoco-result"><strong style="color:${pct>=80?'var(--grn)':'var(--amb)'}">${Object.keys(sonsDone).length}/${total} corretos (${pct}%)</strong></div>`;}
    stopTimer();
    saveSession({mode:'sons',name:currentItem.name,correct:Object.keys(sonsDone).length,total,pct});
    toast(`Sons: ${pct}% corretos`,pct>=80?'good':'');
  }
}

/* ‚Äî PSEUDOPALAVRAS ‚Äî */
let pseudoCurrent=[], pseudoIdx=0, pseudoLevel='facil';
function renderPseudo(wc,data){
  pseudoStats={total:0,correct:0,wrong:0};
  pseudoLevel=data.level;
  pseudoIdx=0;
  wc.innerHTML=`
    <div class="txt-meta"><div class="txt-title">Pseudopalavras ‚Äì ${data.level}</div><div class="txt-sub">Leia em voz alta. Marque se pronunciou correto ou errado.</div></div>
    <div id="pseudo-area"></div>
    <div class="pseudo-stats">
      <div class="pstat"><div class="pstat-v" id="ps-total">0</div><div class="pstat-l">Total</div></div>
      <div class="pstat"><div class="pstat-v" style="color:var(--grn)" id="ps-correct">0</div><div class="pstat-l">Corretas</div></div>
      <div class="pstat"><div class="pstat-v" style="color:var(--red)" id="ps-wrong">0</div><div class="pstat-l">Erradas</div></div>
    </div>
    <div class="notes-area" style="margin-top:10px"><div class="notes-lbl">Observa√ß√µes</div>
    <textarea class="notes-ta" id="ann-notes" rows="2" placeholder="Estrat√©gias, erros espec√≠ficos..."></textarea></div>`;
  nextPseudo();
}
function nextPseudo(){
  const syllables = PSEUDO_SETS[pseudoLevel];
  const set = syllables[Math.floor(Math.random()*syllables.length)];
  pseudoCurrent = set;
  const word = set.join('');
  const sylDisp = set.join('¬∑');
  document.getElementById('pseudo-area').innerHTML=`
    <div class="pseudo-word" id="pseudo-w">${word}</div>
    <div class="pseudo-syllables">${sylDisp}</div>
    <div class="pseudo-btns">
      <button class="pseudo-btn ok" onclick="scorePseudo(true)">‚úì Correto</button>
      <button class="pseudo-btn bad" onclick="scorePseudo(false)">‚úó Erro</button>
      <button class="pseudo-btn nxt" onclick="nextPseudo()">‚Üí Pr√≥xima</button>
    </div>`;
}
function scorePseudo(ok){
  pseudoStats.total++;
  if(ok){ pseudoStats.correct++; addPoints(10); } else pseudoStats.wrong++;
  document.getElementById('ps-total').textContent=pseudoStats.total;
  document.getElementById('ps-correct').textContent=pseudoStats.correct;
  document.getElementById('ps-wrong').textContent=pseudoStats.wrong;
  const pw=document.getElementById('pseudo-w');
  if(pw){ pw.style.color=ok?'var(--grn)':'var(--red)'; setTimeout(()=>{pw.style.color='';nextPseudo();},400); }
  if(pseudoStats.total>=1) document.getElementById('btn-rep').disabled=false;
}

/* ‚Äî LACUNAS ‚Äî */
let lacunaIdx=0, lacunaData=null, lacunaAnswers={};
function renderLacunas(wc,data){
  lacunaData=data; lacunaIdx=0; lacunaAnswers={};
  wc.innerHTML=`
    <div class="txt-meta"><div class="txt-title">${data.name}</div><div class="txt-sub">Selecione a palavra correta para completar a frase</div></div>
    <div id="lacuna-area"></div>
    <div id="lacuna-score" style="display:none;margin-top:10px"></div>
    <div class="notes-area" style="margin-top:10px"><div class="notes-lbl">Observa√ß√µes</div>
    <textarea class="notes-ta" id="ann-notes" rows="2" placeholder="Dificuldades lexicais, estrat√©gias..."></textarea></div>`;
  renderLacunaItem();
}
function renderLacunaItem(){
  const item=lacunaData.items[lacunaIdx];
  if(!item){
    const correct=Object.values(lacunaAnswers).filter(v=>v).length;
    const total=lacunaData.items.length;
    const pct=Math.round((correct/total)*100);
    document.getElementById('lacuna-area').innerHTML='';
    const ls=document.getElementById('lacuna-score');
    ls.style.display='block';
    ls.innerHTML=`<div class="diadoco-result"><strong style="color:${pct>=80?'var(--grn)':'var(--amb)'}">${correct}/${total} corretas (${pct}%)</strong><br>Completou todas as lacunas!</div>`;
    addPoints(pct);
    stopTimer();
    saveSession({mode:'lacunas',name:currentItem.name,correct,total,pct});
    toast(`Lacunas: ${pct}%!`,pct>=80?'good':'');
    return;
  }
  const sentence=item.sentence.replace('___',`<span class="gap-blank" id="gap-b">___</span>`);
  document.getElementById('lacuna-area').innerHTML=`
    <div style="font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t3);letter-spacing:1px;margin-bottom:6px">QUEST√ÉO ${lacunaIdx+1} de ${lacunaData.items.length}</div>
    <div class="gap-sentence">${sentence}</div>
    <div class="gap-opts" id="gap-opts">
      ${item.opts.map((o,i)=>`<div class="gap-opt" id="go${i}" onclick="answerLacuna(${i})">${o}</div>`).join('')}
    </div>
    <div class="gap-feedback" id="gap-fb"></div>`;
}
function answerLacuna(chosen){
  const item=lacunaData.items[lacunaIdx];
  const ok=chosen===item.correct;
  lacunaAnswers[lacunaIdx]=ok;
  const gb=document.getElementById('gap-b');
  if(gb){gb.textContent=item.opts[chosen];gb.className=`gap-blank ${ok?'filled-correct':'filled-wrong'}`;}
  document.querySelectorAll('.gap-opt').forEach((el,i)=>{
    el.style.pointerEvents='none';
    if(i===item.correct) el.style.borderColor='rgba(0,229,160,.5)';
    if(i===chosen&&!ok) el.style.borderColor='rgba(255,79,107,.5)';
  });
  const fb=document.getElementById('gap-fb');
  if(fb) fb.innerHTML=ok?`<span style="color:var(--grn)">‚úì Correto!</span>`:`<span style="color:var(--red)">‚úó Resposta correta: <strong>${item.opts[item.correct]}</strong></span>`;
  addPoints(ok?20:2);
  setTimeout(()=>{lacunaIdx++;renderLacunaItem();},1200);
}

/* ‚Äî PROGRESSIVO ‚Äî */
function renderProgressivo(wc,data){
  progIndex=0;
  const sentences=data.sentences;
  wc.innerHTML=`
    <div class="txt-meta"><div class="txt-title">${data.name}</div><div class="txt-sub">Leia cada frase. Avance quando estiver pronto.</div></div>
    <div class="prog-sentences" id="prog-sents">
      ${sentences.map((s,i)=>`
        <div class="prog-sent ${i===0?'current':''}" id="ps${i}">
          <div class="prog-sent-num">Frase ${i+1} ¬∑ ${s.split(' ').length} palavras</div>
          ${s}
        </div>`).join('')}
    </div>
    <div class="prog-actions">
      <button class="cb go" onclick="progAdvance(true)">‚úì Correto ¬∑ Pr√≥xima</button>
      <button class="cb stop" onclick="progAdvance(false)">‚úó Erro ¬∑ Pr√≥xima</button>
    </div>
    <div id="prog-result" style="display:none;margin-top:12px"></div>
    <div class="notes-area" style="margin-top:10px"><div class="notes-lbl">Observa√ß√µes</div>
    <textarea class="notes-ta" id="ann-notes" rows="2" placeholder="Em qual extens√£o ocorreram erros..."></textarea></div>`;
}
let progCorrect=0,progTotal=0;
function progAdvance(ok){
  const data=currentItem.data;
  const ps=document.getElementById('ps'+progIndex);
  if(ps){ ps.classList.remove('current'); ps.classList.add(ok?'completed':'active-err'); }
  progTotal++; if(ok) progCorrect++;
  addPoints(ok?15:3);
  progIndex++;
  if(progIndex>=data.sentences.length){
    const pct=Math.round((progCorrect/progTotal)*100);
    document.getElementById('prog-result').style.display='block';
    document.getElementById('prog-result').innerHTML=`<div class="diadoco-result"><strong style="color:${pct>=80?'var(--grn)':'var(--amb)'}">${progCorrect}/${progTotal} frases corretas (${pct}%)</strong><br>Comprimento m√°ximo atingido: ${data.sentences[progTotal-1].split(' ').length} palavras</div>`;
    stopTimer();
    saveSession({mode:'progressivo',name:currentItem.name,maxLen:data.sentences[progTotal-1].split(' ').length,pct});
    toast(`Progressivo: ${pct}%!`,pct>=80?'good':'');
  } else {
    const np=document.getElementById('ps'+progIndex);
    if(np){np.classList.add('current');np.scrollIntoView({behavior:'smooth',block:'nearest'});}
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MARKS & READING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setMark(mode){
  markMode=mode;
  document.querySelectorAll('.mb').forEach(b=>b.classList.remove('on'));
  const map={e:'mb-e',h:'mb-h',s:'mb-s',o:'mb-o',a:'mb-a'};
  if(map[mode]) document.getElementById(map[mode]).classList.add('on');
}
function markWord(idx){
  idx=Number(idx);
  const el=document.getElementById('w'+idx);
  if(!el) return;
  const tc={e:'we',h:'wh',s:'ws',o:'wo',a:'wa'};
  if(markMode==='clear'){delete marks[idx];el.className='w';}
  else{ if(marks[idx]===markMode){delete marks[idx];el.className='w';}
  else{marks[idx]=markMode;el.className='w '+(tc[markMode]||'');}}
  updateMetrics();
}
function clearAll(){
  marks={};
  const c=document.getElementById('rtxt')||document.getElementById('metro-txt');
  if(c) c.querySelectorAll('.w').forEach(el=>el.className='w');
  updateMetrics();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   COMPREHENSION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function answerQ(qi,oi){
  const data=currentItem?.data; if(!data||!data.qs) return;
  const q=data.qs[qi]; comprehAnswers[qi]=oi;
  document.querySelectorAll(`[id^="qo-${qi}-"]`).forEach((el,i)=>{
    el.className='cq-opt';
    if(i===q.c) el.classList.add('sh');
    if(i===oi&&oi!==q.c) el.classList.add('sw');
    if(i===oi&&oi===q.c) el.classList.add('sc');
    el.style.pointerEvents='none';
  });
  const answered=Object.keys(comprehAnswers).length;
  if(answered>=data.qs.length){
    const correct=Object.entries(comprehAnswers).filter(([qi,oi])=>Number(oi)===data.qs[Number(qi)].c).length;
    const pct=Math.round((correct/data.qs.length)*100);
    const sc=document.getElementById('cq-score');
    if(sc){sc.style.display='block';sc.innerHTML=`Compreens√£o: <strong style="color:${pct>=80?'var(--grn)':pct>=60?'var(--amb)':'var(--red)'}">${correct}/${data.qs.length} (${pct}%)</strong>`;}
    addPoints(pct/5);
  }
}
function getCompreh(){
  const data=currentItem?.data; if(!data||!data.qs||!data.qs.length) return null;
  const total=data.qs.length; const answered=Object.keys(comprehAnswers).length; if(!answered) return null;
  const correct=Object.entries(comprehAnswers).filter(([qi,oi])=>Number(oi)===data.qs[Number(qi)].c).length;
  return{correct,total,pct:Math.round((correct/total)*100)};
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TIMER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function startTimer(){
  if(timerRunning) return;
  timerRunning=timerStarted=true;
  document.getElementById('btn-start').disabled=true;
  document.getElementById('btn-pause').disabled=false;
  document.getElementById('btn-stop').disabled=false;
  document.getElementById('timer-disp').className='timer-disp run';
  if(currentMode==='metronomo') startMetro();
  timerInterval=setInterval(()=>{elapsedSec++;updateTimerDisp();updateMetrics();},1000);
}
function pauseTimer(){
  clearInterval(timerInterval);timerRunning=false;
  document.getElementById('btn-start').disabled=false;
  document.getElementById('btn-pause').disabled=true;
  document.getElementById('timer-disp').className='timer-disp';
  if(currentMode==='metronomo') stopMetro();
}
function stopTimer(){
  clearInterval(timerInterval);timerRunning=false;
  document.getElementById('btn-start').disabled=true;
  document.getElementById('btn-pause').disabled=true;
  document.getElementById('btn-stop').disabled=true;
  document.getElementById('timer-disp').className='timer-disp done';
  if(currentMode==='metronomo') stopMetro();
  if(isRecording) toggleRec();
  if(timerStarted&&currentMode==='leitura') document.getElementById('btn-rep').disabled=false;
  updateMetrics();
}
function resetAll(){
  clearInterval(timerInterval); clearInterval(diadocoInterval); stopMetro();
  timerRunning=timerStarted=false; elapsedSec=0; diadocoCount=0; diadocoRunning=false;
  travaTimes=[]; travaRep=0; travaData=null; progIndex=0; progCorrect=0; progTotal=0;
  pseudoStats={total:0,correct:0,wrong:0}; sonsDone={}; sonsFail={};
  sessionPts=0; marks={}; comprehAnswers={};
  updateTimerDisp();
  document.getElementById('timer-disp').className='timer-disp';
  document.getElementById('btn-start').disabled=!currentItem;
  document.getElementById('btn-pause').disabled=true;
  document.getElementById('btn-stop').disabled=true;
  document.getElementById('btn-rep').disabled=true;
  document.getElementById('m-wpm').textContent='‚Äî';
  document.getElementById('m-acc').textContent='‚Äî';
  document.getElementById('m-err').textContent='0';
  document.getElementById('m-hes').textContent='0';
  document.getElementById('m-pts').textContent='0';
  document.getElementById('prog-fill').style.width='0%';
}
function updateTimerDisp(){
  const m=Math.floor(elapsedSec/60),s=elapsedSec%60;
  const str=String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
  document.getElementById('timer-disp').textContent=str;
  document.getElementById('fs-timer').textContent=str;
}
function updateMetrics(){
  const vals=Object.values(marks);
  const errCnt=vals.filter(v=>v==='e').length;
  const hesCnt=vals.filter(v=>v==='h').length;
  const subCnt=vals.filter(v=>v==='s').length;
  const omiCnt=vals.filter(v=>v==='o').length;
  const addCnt=vals.filter(v=>v==='a').length;
  const totalErr=errCnt+subCnt+omiCnt+addCnt;
  document.getElementById('m-err').textContent=totalErr;
  document.getElementById('m-hes').textContent=hesCnt;
  document.getElementById('m-pts').textContent=sessionPts;
  if(elapsedSec>0&&currentItem&&currentMode==='leitura'){
    const total=wordEls.length;
    const wpm=Math.round((total/elapsedSec)*60);
    const acc=Math.max(0,Math.round(((total-totalErr)/total)*100));
    document.getElementById('m-wpm').textContent=wpm;
    document.getElementById('m-acc').textContent=acc+'%';
    document.getElementById('prog-fill').style.width=Math.min(100,Math.round((elapsedSec/Math.max(30,elapsedSec))*100))+'%';
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   POINTS & GAMIFICATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function addPoints(pts){
  pts=Math.round(pts);
  sessionPts+=pts; totalPts+=pts;
  localStorage.setItem('pb_pts',totalPts);
  document.getElementById('pts-total').textContent=totalPts;
  document.getElementById('m-pts').textContent=sessionPts;
  const el=document.getElementById('m-pts');
  el.classList.remove('score-flash');
  void el.offsetWidth;
  el.classList.add('score-flash');
}

function saveSession(extra){
  const sessions=JSON.parse(localStorage.getItem('pb_sessions')||'[]');
  const compreh=getCompreh();
  const vals=Object.values(marks);
  const errCnt=vals.filter(v=>v==='e').length;
  const subCnt=vals.filter(v=>v==='s').length;
  const omiCnt=vals.filter(v=>v==='o').length;
  const hesCnt=vals.filter(v=>v==='h').length;
  const totalErr=errCnt+subCnt+omiCnt;
  const total=wordEls.length||1;
  const wpm=elapsedSec>0?Math.round((total/elapsedSec)*60):0;
  const accuracy=Math.max(0,Math.round(((total-totalErr)/total)*100));
  const d=new Date();
  const sess={
    id:Date.now(),mode:currentMode,
    name:extra.name||currentItem?.name||'‚Äî',
    patName:document.getElementById('pat-name').value||'‚Äî',
    level:currentItem?.diff||1,
    wpm,accuracy,errCnt:totalErr,hesCnt,
    pts:sessionPts,elapsedSec,
    vasPost:parseInt(document.getElementById('vas-pos').value),
    vasPos:parseInt(document.getElementById('vas-pos').value),
    compreh,
    date:d.toLocaleDateString('pt-BR'),
    hour:d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'}),
    ...extra
  };
  sessions.unshift(sess);
  if(sessions.length>100) sessions.splice(100);
  localStorage.setItem('pb_sessions',JSON.stringify(sessions));
  // streak
  streak++;
  localStorage.setItem('pb_streak',streak);
  document.getElementById('streak-n').textContent=streak;
  checkBadges(sessions);
}

function checkBadges(sessions){
  const earned=JSON.parse(localStorage.getItem('pb_badges')||'[]');
  let newBadge=false;
  ALL_BADGES.forEach(b=>{
    if(!earned.includes(b.id)&&b.cond(sessions)){
      earned.push(b.id);
      newBadge=true;
      toast(`üéñ Conquista desbloqueada: ${b.name}!`,'gold');
    }
  });
  localStorage.setItem('pb_badges',JSON.stringify(earned));
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RECORDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function toggleRec(){
  const btn=document.getElementById('btn-rec');
  const ind=document.getElementById('rec-ind');
  if(!isRecording){
    try{
      const stream=await navigator.mediaDevices.getUserMedia({audio:true});
      mediaRecorder=new MediaRecorder(stream);audioChunks=[];
      mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
      mediaRecorder.onstop=()=>{
        audioBlob=new Blob(audioChunks,{type:'audio/webm'});
        const url=URL.createObjectURL(audioBlob);
        const rc=document.getElementById('audio-row-container');
        if(rc) rc.innerHTML=`<div class="audio-row"><span style="font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t2);letter-spacing:1px">GRAVA√á√ÉO</span><audio controls src="${url}" style="flex:1;height:26px;filter:invert(.8) hue-rotate(180deg)"></audio><button class="audio-del" onclick="this.parentElement.remove()">‚úï</button></div>`;
        stream.getTracks().forEach(t=>t.stop());
      };
      mediaRecorder.start();isRecording=true;
      btn.classList.add('on');btn.textContent='‚èπ Parar Grav.';
      ind.classList.add('on');
    }catch(e){alert('Microfone n√£o dispon√≠vel.');}
  }else{
    mediaRecorder.stop();isRecording=false;
    btn.classList.remove('on');btn.textContent='‚è∫ Gravar';
    ind.classList.remove('on');
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FULLSCREEN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openFS(){
  if(!currentItem) return;
  const data=currentItem.data;
  document.getElementById('fs-lbl').textContent=data.title||currentItem.name;
  document.getElementById('fs-content').style.fontSize=fsFontSz+'px';
  if(currentMode==='invertido'){
    const words=(data.content||'').split(/\s+/);
    document.getElementById('fs-content').textContent=words.map(w=>w.split('').reverse().join('')).join(' ');
  }else if(currentMode==='travalinguaz'){
    document.getElementById('fs-content').textContent=data.text||'';
  }else{
    document.getElementById('fs-content').textContent=data.content||currentItem.name;
  }
  document.getElementById('fs-ov').classList.add('on');
  document.getElementById('fs-go').textContent=timerRunning?'‚è∏ Pausar':'‚ñ∂ Iniciar';
}
function closeFS(){ document.getElementById('fs-ov').classList.remove('on'); }
function fsToggle(){ if(timerRunning){pauseTimer();document.getElementById('fs-go').textContent='‚ñ∂ Retomar';}else{startTimer();document.getElementById('fs-go').textContent='‚è∏ Pausar';} }
function fsFZ(d){ fsFontSz=Math.max(16,Math.min(50,fsFontSz+d)); document.getElementById('fs-content').style.fontSize=fsFontSz+'px'; }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   REPORT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openReport(){
  if(!currentItem) return;
  buildReport();
  document.getElementById('rep-modal').classList.add('open');
  if(currentMode==='leitura') saveSession({mode:'leitura',level:currentItem.diff||1});
}
function closeReport(){ document.getElementById('rep-modal').classList.remove('open'); }

function buildReport(){
  const vals=Object.values(marks);
  const errCnt=vals.filter(v=>v==='e').length;
  const hesCnt=vals.filter(v=>v==='h').length;
  const subCnt=vals.filter(v=>v==='s').length;
  const omiCnt=vals.filter(v=>v==='o').length;
  const addCnt=vals.filter(v=>v==='a').length;
  const totalErr=errCnt+subCnt+omiCnt+addCnt;
  const total=wordEls.length||1;
  const wpm=elapsedSec>0?Math.round((total/elapsedSec)*60):0;
  const acc=Math.max(0,Math.round(((total-totalErr)/total)*100));
  const timeStr=String(Math.floor(elapsedSec/60)).padStart(2,'0')+':'+String(elapsedSec%60).padStart(2,'0');
  const patName=document.getElementById('pat-name').value||'‚Äî';
  const patFono=document.getElementById('pat-fono').value||'‚Äî';
  const patDiag=document.getElementById('pat-diag').value||'‚Äî';
  const vasPre=document.getElementById('vas-pre').value;
  const vasPos=document.getElementById('vas-pos').value;
  const vasFat=document.getElementById('vas-fat').value;
  const notes=document.getElementById('ann-notes')?.value||'';
  const compreh=getCompreh();
  const today=new Date().toLocaleDateString('pt-BR');
  const hour=new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});

  const NORMS={1:{p25:55,p50:85,p75:115},2:{p25:75,p50:105,p75:135},3:{p25:90,p50:120,p75:150},4:{p25:105,p50:135,p75:165},5:{p25:115,p50:145,p75:180},6:{p25:120,p50:150,p75:185}};
  const norm=NORMS[currentItem.diff||1]||NORMS[1];

  let classif,classifType;
  if(acc>=97&&hesCnt<=2){classif='N√≠vel Independente';classifType='good';}
  else if(acc>=90){classif='N√≠vel Instrucional';classifType='';}
  else if(acc>=80){classif='N√≠vel Frustracional';classifType='warn';}
  else{classif='N√≠vel Cr√≠tico';classifType='crit';}

  let wpmClassif;
  if(wpm>=norm.p75) wpmClassif='Acima do P75 ‚Äì fluente';
  else if(wpm>=norm.p50) wpmClassif='P50‚ÄìP75 ‚Äì adequado';
  else if(wpm>=norm.p25) wpmClassif='P25‚ÄìP50 ‚Äì abaixo da m√©dia';
  else wpmClassif='Abaixo do P25 ‚Äì lento';

  const intel=Math.max(0,Math.min(100,acc-(hesCnt*0.5)));
  const errWords=Object.entries(marks).filter(([,v])=>v==='e').map(([i])=>wordEls[Number(i)]).filter(Boolean);
  const hesWords=Object.entries(marks).filter(([,v])=>v==='h').map(([i])=>wordEls[Number(i)]).filter(Boolean);
  const subWords=Object.entries(marks).filter(([,v])=>v==='s').map(([i])=>wordEls[Number(i)]).filter(Boolean);
  const omiWords=Object.entries(marks).filter(([,v])=>v==='o').map(([i])=>wordEls[Number(i)]).filter(Boolean);
  const addWords=Object.entries(marks).filter(([,v])=>v==='a').map(([i])=>wordEls[Number(i)]).filter(Boolean);
  const vasDiff=parseInt(vasPos)-parseInt(vasPre);

  document.getElementById('rep-body').innerHTML=`
  <div class="rs">
    <div class="rs-title">Identifica√ß√£o</div>
    <div class="rg3">
      <div class="rst"><div class="rst-v">${patName}</div><div class="rst-l">Paciente</div></div>
      <div class="rst"><div class="rst-v">${today} ¬∑ ${hour}</div><div class="rst-l">Data / Hora</div></div>
      <div class="rst"><div class="rst-v">${patFono}</div><div class="rst-l">Fonoaudi√≥logo(a)</div></div>
    </div>
    <div class="rg2" style="margin-top:6px">
      <div class="rst"><div class="rst-v">${currentItem.name}</div><div class="rst-l">Conte√∫do avaliado</div></div>
      <div class="rst"><div class="rst-v">${patDiag||'‚Äî'}</div><div class="rst-l">Diagn√≥stico</div></div>
    </div>
  </div>

  <div class="rs">
    <div class="rs-title">Classifica√ß√£o</div>
    <div style="display:inline-flex;align-items:center;gap:7px;padding:7px 12px;border:1px solid;font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:8px;
      color:${classifType==='good'?'var(--grn)':classifType==='warn'?'var(--amb)':classifType==='crit'?'var(--red)':'var(--cyan)'};
      border-color:${classifType==='good'?'rgba(0,229,160,.3)':classifType==='warn'?'rgba(255,179,64,.3)':classifType==='crit'?'rgba(255,79,107,.3)':'rgba(0,212,255,.3)'}">
      ‚óè ${classif}
    </div>
    <div class="rb ${classifType}">${acc>=97?'Precis√£o excelente. Leitura com total autonomia neste n√≠vel.':acc>=90?'N√≠vel instrucional. Progress√£o indicada com monitoramento.':acc>=80?'Dificuldade significativa. Ajustar n√≠vel ou intensificar suporte.':'Comprometimento severo. Avalia√ß√£o multidisciplinar indicada.'}</div>
  </div>

  <div class="rs">
    <div class="rs-title">Indicadores Quantitativos</div>
    <div class="rg3">
      <div class="rst"><div class="rst-v">${wpm}<span class="rst-u">PPM</span></div><div class="rst-l">Palavras por minuto</div></div>
      <div class="rst"><div class="rst-v">${acc}<span class="rst-u">%</span></div><div class="rst-l">Precis√£o leitora</div></div>
      <div class="rst"><div class="rst-v">${timeStr}</div><div class="rst-l">Tempo total</div></div>
    </div>
    <div class="rg3" style="margin-top:6px">
      <div class="rst"><div class="rst-v">${totalErr}</div><div class="rst-l">Total erros</div></div>
      <div class="rst"><div class="rst-v">${hesCnt}</div><div class="rst-l">Hesita√ß√µes</div></div>
      <div class="rst"><div class="rst-v">${Math.round(intel)}<span class="rst-u">%</span></div><div class="rst-l">Inteligibilidade est.</div></div>
    </div>
    ${sbar('Precis√£o',acc,100,acc>=97?'var(--grn)':acc>=90?'var(--cyan)':acc>=80?'var(--amb)':'var(--red)',acc+'%')}
    ${sbar('Velocidade vs. P50',Math.min(100,Math.round((wpm/norm.p50)*100)),100,wpm>=norm.p50?'var(--grn)':wpm>=norm.p25?'var(--amb)':'var(--red)',wpm+' PPM')}
    ${sbar('Flu√™ncia (inv. hesit.)',Math.max(0,100-hesCnt*5),100,hesCnt<=2?'var(--grn)':hesCnt<=8?'var(--amb)':'var(--red)',hesCnt+'% hes.')}
  </div>

  <div class="rs">
    <div class="rs-title">Normas Brasileiras ¬∑ PPM</div>
    <table class="nt">
      <tr><th>N√≠vel</th><th>P25</th><th>P50</th><th>P75</th><th>Paciente</th></tr>
      <tr class="hl"><td>N√≠vel ${currentItem.diff||1}</td><td>${norm.p25}</td><td>${norm.p50}</td><td>${norm.p75}</td><td class="you">${wpm} PPM ¬∑ ${wpmClassif}</td></tr>
    </table>
  </div>

  <div class="rs">
    <div class="rs-title">An√°lise por Tipo de Erro</div>
    <div class="rg3">
      <div class="rst"><div class="rst-v" style="color:var(--red)">${errCnt}</div><div class="rst-l">Erros (geral)</div></div>
      <div class="rst"><div class="rst-v" style="color:var(--pur)">${subCnt}</div><div class="rst-l">Substitui√ß√µes</div></div>
      <div class="rst"><div class="rst-v" style="color:var(--rose)">${omiCnt}</div><div class="rst-l">Omiss√µes</div></div>
    </div>
    <div class="rg2" style="margin-top:6px">
      <div class="rst"><div class="rst-v" style="color:var(--amb)">${hesCnt}</div><div class="rst-l">Hesita√ß√µes</div></div>
      <div class="rst"><div class="rst-v" style="color:var(--cyan)">${addCnt}</div><div class="rst-l">Adi√ß√µes</div></div>
    </div>
    ${errWords.length?`<div style="margin-top:8px"><div style="font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--red);margin-bottom:3px;letter-spacing:1px">ERROS</div><div>${errWords.map(w=>`<span class="etag e">${w}</span>`).join('')}</div></div>`:''}
    ${hesWords.length?`<div style="margin-top:5px"><div style="font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--amb);margin-bottom:3px;letter-spacing:1px">HESITA√á√ïES</div><div>${hesWords.map(w=>`<span class="etag h">${w}</span>`).join('')}</div></div>`:''}
    ${subWords.length?`<div style="margin-top:5px"><div style="font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--pur);margin-bottom:3px;letter-spacing:1px">SUBSTITUI√á√ïES</div><div>${subWords.map(w=>`<span class="etag s">${w}</span>`).join('')}</div></div>`:''}
    ${omiWords.length?`<div style="margin-top:5px"><div style="font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--rose);margin-bottom:3px;letter-spacing:1px">OMISS√ïES</div><div>${omiWords.map(w=>`<span class="etag o">${w}</span>`).join('')}</div></div>`:''}
    ${!totalErr&&!hesCnt?'<div class="rb good">Nenhum erro ou hesita√ß√£o registrado.</div>':''}
  </div>

  ${compreh?`
  <div class="rs">
    <div class="rs-title">Compreens√£o Leitora</div>
    <div class="rg2">
      <div class="rst"><div class="rst-v" style="color:${compreh.pct>=80?'var(--grn)':'var(--amb)'}">${compreh.pct}<span class="rst-u">%</span></div><div class="rst-l">Compreens√£o</div></div>
      <div class="rst"><div class="rst-v">${compreh.correct}/${compreh.total}</div><div class="rst-l">Quest√µes corretas</div></div>
    </div>
    <div class="rb ${compreh.pct>=80?'good':compreh.pct>=60?'warn':'crit'}">${compreh.pct>=80?'Compreens√£o preservada.':compreh.pct>=60?'Compreens√£o parcial. Investigar estrat√©gias metacognitivas.':'Compreens√£o comprometida. Avaliar vocabul√°rio e mem√≥ria de trabalho verbal.'}</div>
  </div>`:``}

  <div class="rs">
    <div class="rs-title">Escala de Esfor√ßo Vocal (VAS)</div>
    <div class="rg3">
      <div class="rst"><div class="rst-v">${vasPre}<span class="rst-u">/10</span></div><div class="rst-l">Pr√©-leitura</div></div>
      <div class="rst"><div class="rst-v">${vasPos}<span class="rst-u">/10</span></div><div class="rst-l">P√≥s-leitura</div></div>
      <div class="rst"><div class="rst-v" style="color:${vasDiff>3?'var(--red)':vasDiff>1?'var(--amb)':'var(--grn)'}">${vasDiff>0?'+':''}${vasDiff}</div><div class="rst-l">Varia√ß√£o esfor√ßo</div></div>
    </div>
    <div class="rst" style="margin-top:6px"><div class="rst-v">${vasFat}<span class="rst-u">/10</span></div><div class="rst-l">Fadiga vocal autorrelatada</div></div>
    ${vasDiff>3?'<div class="rb crit" style="margin-top:7px"><strong>Aumento significativo de esfor√ßo (delta ‚â•4):</strong> Investigar tens√£o lar√≠ngea, t√©cnica vocal inadequada ou patologia subjacente.</div>':vasDiff>1?'<div class="rb warn" style="margin-top:7px">Aumento moderado. Monitorar fadiga em sess√µes prolongadas. Orientar higiene vocal.</div>':'<div class="rb good" style="margin-top:7px">Esfor√ßo vocal est√°vel.</div>'}
  </div>

  ${notes?`<div class="rs"><div class="rs-title">Observa√ß√µes do Fonoaudi√≥logo</div><div class="rb info">${notes.replace(/\n/g,'<br>')}</div></div>`:''}

  <div class="rs">
    <div class="rs-title">Pontua√ß√£o da Sess√£o</div>
    <div class="rst"><div class="rst-v" style="color:var(--gold)">${sessionPts}<span class="rst-u">pts</span></div><div class="rst-l">Pontos conquistados nesta sess√£o</div></div>
    <div class="rst" style="margin-top:6px"><div class="rst-v">${totalPts}</div><div class="rst-l">Total acumulado</div></div>
  </div>

  <div class="print-row">
    <button class="pbtn b" onclick="window.print()">üñ® Imprimir / PDF</button>
    <button class="pbtn g" onclick="exportTXT()">‚¨á Exportar TXT</button>
  </div>
  <div class="wm">PHONOBASE 3.0 ¬∑ Avalia√ß√£o Fonoaudiol√≥gica ¬∑ ${today} ${hour}</div>`;
}

function sbar(label,value,max,color,display){
  const pct=Math.min(100,Math.max(0,Math.round((value/max)*100)));
  return`<div class="sb-w"><div class="sb-l"><span class="sb-n">${label}</span><span class="sb-v">${display}</span></div><div class="sb"><div class="sb-f" style="width:${pct}%;background:${color}"></div></div></div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   RANKING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderRanking(){
  const sessions=JSON.parse(localStorage.getItem('pb_sessions')||'[]');
  const sorted=[...sessions].sort((a,b)=>(b.pts||0)-(a.pts||0));
  const el=document.getElementById('ranking-content');
  if(!sessions.length){el.innerHTML='<div style="font-family:\'IBM Plex Mono\',monospace;font-size:9px;color:var(--t3);padding:30px;text-align:center">Nenhuma sess√£o ainda.</div>';return;}
  const posColors=['#ffd700','#c0c0c0','#cd7f32'];
  el.innerHTML=`<div class="rank-grid">${sorted.slice(0,8).map((s,i)=>`
    <div class="rank-card ${i<3?'rank-'+(i+1):''}">
      <div class="rank-pos">${i+1}¬∫ ¬∑ ${s.date||''} ${s.hour||''}</div>
      <div class="rank-name">${s.patName||'‚Äî'}</div>
      <div class="rank-pts">${s.pts||0} <span style="font-size:10px;color:var(--t2)">pts</span></div>
      <div class="rank-meta">${s.name||'‚Äî'} ¬∑ ${s.mode||'‚Äî'} ¬∑ ${s.accuracy||'‚Äî'}% precis√£o</div>
    </div>`).join('')}</div>
  <div style="margin-top:14px">
    <table class="nt"><tr><th>#</th><th>Paciente</th><th>Modo</th><th>PPM</th><th>Precis√£o</th><th>Pts</th><th>Data</th></tr>
    ${sorted.slice(0,20).map((s,i)=>`<tr${i<3?` class="hl"`:``}><td>${i+1}</td><td>${s.patName||'‚Äî'}</td><td style="font-family:'IBM Plex Mono',monospace;font-size:7px">${s.mode||'‚Äî'}</td><td>${s.wpm||'‚Äî'}</td><td>${s.accuracy!=null?s.accuracy+'%':'‚Äî'}</td><td style="color:var(--gold);font-weight:700">${s.pts||0}</td><td style="font-size:7px">${s.date||''}</td></tr>`).join('')}
    </table>
  </div>`;
}
function clearHistory(){if(confirm('Limpar todo o hist√≥rico?')){localStorage.removeItem('pb_sessions');renderRanking();renderEvolution();}}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   BADGES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderBadges(){
  const sessions=JSON.parse(localStorage.getItem('pb_sessions')||'[]');
  const earned=JSON.parse(localStorage.getItem('pb_badges')||'[]');
  document.getElementById('badges-grid').innerHTML=ALL_BADGES.map(b=>`
    <div class="badge-item ${earned.includes(b.id)?'earned':''}">
      <div class="badge-ico">${b.ico}</div>
      <div class="badge-name">${b.name}</div>
      <div class="badge-desc">${b.desc}</div>
    </div>`).join('');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DESAFIOS PANEL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderDesafios(){
  const sessions=JSON.parse(localStorage.getItem('pb_sessions')||'[]');
  const travaSess=sessions.filter(s=>s.mode==='travalinguaz').length;
  const diadocoSess=sessions.filter(s=>s.mode==='diadoco').length;
  document.getElementById('desafios-content').innerHTML=`
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <div class="rank-card"><div class="rank-pos">Trava-l√≠nguas</div><div class="rank-pts">${travaSess}</div><div class="rank-meta">sess√µes completadas ¬∑ Meta: 10</div>
        <div class="sb" style="margin-top:8px"><div class="sb-f" style="width:${Math.min(100,travaSess*10)}%;background:var(--red)"></div></div></div>
      <div class="rank-card"><div class="rank-pos">Diadococinesia</div><div class="rank-pts">${diadocoSess}</div><div class="rank-meta">sess√µes completadas ¬∑ Meta: 10</div>
        <div class="sb" style="margin-top:8px"><div class="sb-f" style="width:${Math.min(100,diadocoSess*10)}%;background:var(--grn)"></div></div></div>
      <div class="rank-card"><div class="rank-pos">Total de Sess√µes</div><div class="rank-pts">${sessions.length}</div><div class="rank-meta">registradas ¬∑ Meta: 20</div>
        <div class="sb" style="margin-top:8px"><div class="sb-f" style="width:${Math.min(100,sessions.length*5)}%;background:var(--cyan)"></div></div></div>
      <div class="rank-card"><div class="rank-pos">Pontua√ß√£o Total</div><div class="rank-pts" style="color:var(--gold)">${totalPts}</div><div class="rank-meta">pontos acumulados ¬∑ Meta: 1000</div>
        <div class="sb" style="margin-top:8px"><div class="sb-f" style="width:${Math.min(100,totalPts/10)}%;background:var(--gold)"></div></div></div>
    </div>
    <div style="margin-top:14px;font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--cyan);text-transform:uppercase;margin-bottom:8px">Desafios Semanais</div>
    <div style="display:flex;flex-direction:column;gap:6px">
      <div class="rank-card"><div class="rank-pos">üî¥ Trava-l√≠ngua Ultra Extremo</div><div class="rank-meta">Complete "Pseudoarr√≠tmico" 2x sem erro ¬∑ Recompensa: 200pts</div></div>
      <div class="rank-card"><div class="rank-pos">üü¢ Diadoco Perfeito</div><div class="rank-meta">Supere a meta em PA-TA-CA em 10s ¬∑ Recompensa: 150pts</div></div>
      <div class="rank-card"><div class="rank-pos">üíÄ Texto Extremo Completo</div><div class="rank-meta">Conclua texto N√≠vel 6 com ‚â•85% precis√£o ¬∑ Recompensa: 300pts</div></div>
      <div class="rank-card"><div class="rank-pos">üß† Lacunas Perfeitas</div><div class="rank-meta">100% nas lacunas de Neurologia da Fala ¬∑ Recompensa: 250pts</div></div>
    </div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EVOLUTION CHARTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderEvolution(){
  const sessions=JSON.parse(localStorage.getItem('pb_sessions')||'[]').filter(s=>s.mode==='leitura').reverse();
  const empty=document.getElementById('evo-empty');
  if(!sessions.length){empty.style.display='block';return;}
  empty.style.display='none';
  const labels=sessions.map((_,i)=>'S'+(i+1));
  drawChart('evo-c1',labels,[
    {data:sessions.map(s=>s.wpm||0),color:'rgba(0,212,255,1)',fill:'rgba(0,212,255,.08)',label:'PPM'},
    {data:sessions.map(s=>s.accuracy||0),color:'rgba(0,229,160,1)',fill:'rgba(0,229,160,.06)',label:'Precis√£o %'}
  ],'PPM e Precis√£o');
  drawChart('evo-c2',labels,[
    {data:sessions.map(s=>s.errCnt||0),color:'rgba(255,79,107,1)',fill:'rgba(255,79,107,.08)',label:'Erros'},
    {data:sessions.map(s=>s.pts||0),color:'rgba(255,215,0,1)',fill:'rgba(255,215,0,.06)',label:'Pts'}
  ],'Erros e Pontua√ß√£o');
}
function drawChart(cid,labels,datasets,title){
  const canvas=document.getElementById(cid);if(!canvas)return;
  const ctx=canvas.getContext('2d');
  const W=canvas.offsetWidth||600,H=canvas.height||200;
  canvas.width=W;
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle='#0e1118';ctx.fillRect(0,0,W,H);
  const pad={t:28,r:16,b:32,l:40};
  const cW=W-pad.l-pad.r,cH=H-pad.t-pad.b;
  ctx.fillStyle='#4a566e';ctx.font='9px IBM Plex Mono,monospace';ctx.fillText(title,pad.l,18);
  if(!labels.length)return;
  const all=datasets.flatMap(d=>d.data);
  const maxV=Math.max(...all,10),minV=0;
  for(let i=0;i<=4;i++){
    const y=pad.t+cH-(i/4)*cH;
    ctx.strokeStyle='rgba(255,255,255,.04)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(pad.l,y);ctx.lineTo(pad.l+cW,y);ctx.stroke();
    ctx.fillStyle='#252d3f';ctx.font='8px IBM Plex Mono,monospace';ctx.fillText(Math.round(minV+(i/4)*(maxV-minV)),2,y+3);
  }
  labels.forEach((l,i)=>{
    const x=pad.l+(i/(labels.length-1||1))*cW;
    ctx.fillStyle='#252d3f';ctx.font='7px IBM Plex Mono,monospace';ctx.fillText(l,x-8,H-6);
  });
  datasets.forEach(ds=>{
    const pts=ds.data.map((v,i)=>({x:pad.l+(i/(labels.length-1||1))*cW,y:pad.t+cH-((v-minV)/(maxV-minV||1))*cH}));
    ctx.beginPath();ctx.moveTo(pts[0].x,pad.t+cH);pts.forEach(p=>ctx.lineTo(p.x,p.y));ctx.lineTo(pts[pts.length-1].x,pad.t+cH);ctx.closePath();ctx.fillStyle=ds.fill;ctx.fill();
    ctx.beginPath();pts.forEach((p,i)=>i===0?ctx.moveTo(p.x,p.y):ctx.lineTo(p.x,p.y));ctx.strokeStyle=ds.color;ctx.lineWidth=2;ctx.stroke();
    pts.forEach(p=>{ctx.beginPath();ctx.arc(p.x,p.y,3,0,Math.PI*2);ctx.fillStyle=ds.color;ctx.fill();});
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EXPORT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function exportTXT(){
  const body=document.getElementById('rep-body');
  const blob=new Blob([body?body.innerText:''],{type:'text/plain;charset=utf-8'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='phonobase-relatorio-'+Date.now()+'.txt';a.click();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function toast(msg,type=''){
  const t=document.getElementById('toast');
  t.textContent=msg;t.className='toast '+(type||'');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3200);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
setMode('leitura',document.querySelector('.mode-btn[data-mode="leitura"]'));
setMark('e');
goPanel('avaliacao',document.querySelector('.ttab'));
</script>
</body>
</html>
