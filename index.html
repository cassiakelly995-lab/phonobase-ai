<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHONOBASE 2.0 ¬∑ Avalia√ß√£o de Leitura Oral</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=IBM+Plex+Mono:wght@300;400;500;700&family=Syne:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#050608;--s1:#090b10;--s2:#0e1118;--s3:#13171f;--s4:#1a1f2c;--s5:#222738;
  --glass:rgba(255,255,255,.04);--border:rgba(255,255,255,.07);--border2:rgba(255,255,255,.04);
  --t0:#dce8ff;--t1:#8a9dc0;--t2:#4a566e;--t3:#252d3f;
  --cyan:#00d4ff;--cyanD:rgba(0,212,255,.1);--cyanD2:rgba(0,212,255,.06);
  --grn:#00e5a0;--grnD:rgba(0,229,160,.1);
  --amb:#ffb340;--ambD:rgba(255,179,64,.1);
  --red:#ff4f6b;--redD:rgba(255,79,107,.1);
  --pur:#b06cff;--purD:rgba(176,108,255,.1);
  --rose:#ff6b9d;
}
html,body{height:100%;background:var(--bg);color:var(--t0);font-family:'Syne',sans-serif;font-size:13px}
body{overflow:hidden}
::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-thumb{background:var(--s5)}
::-webkit-scrollbar-track{background:transparent}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  background-size:256px;opacity:.4}

/* ‚ïê‚ïê LAYOUT ‚ïê‚ïê */
.app{display:grid;grid-template-rows:52px 1fr;height:100vh;position:relative;z-index:1}
.top{background:rgba(9,11,16,.97);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);
  display:flex;align-items:center;padding:0 16px;gap:10px;z-index:200;position:relative;flex-shrink:0}
.brand{font-family:'IBM Plex Mono',monospace;font-weight:700;font-size:11px;letter-spacing:3px;
  color:var(--t0);padding-right:14px;border-right:1px solid var(--border);white-space:nowrap;
  display:flex;align-items:center;gap:8px;flex-shrink:0}
.brand-icon{width:22px;height:22px;border-radius:50%;background:conic-gradient(var(--cyan),var(--pur),var(--rose),var(--cyan));flex-shrink:0}
.brand em{color:var(--cyan);font-style:normal}
.brand sup{font-size:7px;color:var(--pur);vertical-align:super;margin-left:1px}
.top-tabs{display:flex;overflow-x:auto;gap:0;flex-shrink:0}
.top-tabs::-webkit-scrollbar{height:0}
.ttab{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;
  padding:0 14px;height:52px;display:flex;align-items:center;background:none;border:none;
  color:var(--t3);cursor:pointer;transition:all .15s;border-bottom:2px solid transparent;white-space:nowrap;gap:5px}
.ttab:hover{color:var(--t1)}
.ttab.on{color:var(--cyan);border-bottom-color:var(--cyan)}
.top-r{display:flex;align-items:center;gap:6px;margin-left:auto;flex-shrink:0}
.rec-indicator{display:flex;align-items:center;gap:5px;font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--red);
  padding:4px 8px;border:1px solid rgba(255,79,107,.3);opacity:0;transition:opacity .3s}
.rec-indicator.on{opacity:1}
.rec-dot{width:6px;height:6px;border-radius:50%;background:var(--red);animation:blink 1s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.1}}
.top-badge{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1px;
  padding:3px 8px;border:1px solid var(--border);color:var(--t3);text-transform:uppercase}
.ver-badge{color:var(--cyan);border-color:rgba(0,212,255,.3)}

/* ‚ïê‚ïê BODY ‚ïê‚ïê */
.body{display:grid;grid-template-columns:240px 1fr;overflow:hidden;height:100%}

/* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
.sidebar{background:var(--s1);border-right:1px solid var(--border);overflow-y:auto;display:flex;flex-direction:column;flex-shrink:0}
.sec-label{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:3px;text-transform:uppercase;color:var(--t3)}
.pat-form{padding:12px;border-bottom:1px solid var(--border2)}
.pat-form .sec-label{margin-bottom:8px}
.field{margin-bottom:7px}
.field label{font-size:9px;color:var(--t2);display:block;margin-bottom:2px;font-family:'IBM Plex Mono',monospace;letter-spacing:1px;text-transform:uppercase}
.field input,.field select,.field textarea{width:100%;background:var(--s2);border:1px solid var(--border);color:var(--t0);
  font-family:'IBM Plex Mono',monospace;font-size:10px;padding:5px 7px;outline:none;transition:border .15s;resize:none}
.field input:focus,.field select:focus,.field textarea:focus{border-color:var(--cyan)}
.field select option{background:var(--s2)}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:6px}

/* Vocal effort scale */
.vas-scale{display:flex;flex-direction:column;gap:4px}
.vas-track{display:flex;align-items:center;gap:6px}
.vas-track label{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t2);width:52px;flex-shrink:0}
.vas-track input[type=range]{flex:1;-webkit-appearance:none;height:3px;background:var(--s3);outline:none;border-radius:0}
.vas-track input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:12px;height:12px;background:var(--cyan);border-radius:0;cursor:pointer}
.vas-val{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--cyan);width:24px;text-align:right;flex-shrink:0}

/* Level selector */
.levels-sec{padding:12px;border-bottom:1px solid var(--border2)}
.level-grid{display:grid;grid-template-columns:1fr 1fr;gap:3px;margin-top:8px}
.lvl-btn{padding:6px 4px;background:var(--s2);border:1px solid var(--border);cursor:pointer;
  font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;
  color:var(--t2);transition:all .15s;text-align:center;display:flex;align-items:center;justify-content:center;gap:4px}
.lvl-btn:hover{border-color:var(--t2);color:var(--t1)}
.lvl-btn.active{color:#000;font-weight:700}
.lvl-btn[data-lvl="1"].active{background:#00e5a0;border-color:#00e5a0}
.lvl-btn[data-lvl="2"].active{background:#00d4ff;border-color:#00d4ff}
.lvl-btn[data-lvl="3"].active{background:#ffb340;border-color:#ffb340}
.lvl-btn[data-lvl="4"].active{background:#ff4f6b;border-color:#ff4f6b}
.lvl-btn[data-lvl="5"].active{background:#b06cff;border-color:#b06cff}
.lvl-btn[data-lvl="6"].active{background:linear-gradient(135deg,#ff4f6b,#b06cff);border-color:#b06cff;color:#fff}
.lvl-btn[data-lvl="custom"].active{background:var(--amb);border-color:var(--amb)}

/* Text list */
.text-list{padding:12px;flex:1}
.text-list .sec-label{margin-bottom:8px}
.text-item{padding:7px 8px;background:var(--s2);border:1px solid var(--border);margin-bottom:3px;cursor:pointer;transition:all .12s}
.text-item:hover{border-color:var(--t2);background:var(--s3)}
.text-item.selected{border-left:2px solid var(--cyan);background:rgba(0,212,255,.05)}
.text-item-name{font-size:11px;color:var(--t1);margin-bottom:1px}
.text-item-meta{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t3);letter-spacing:1px}

/* Custom text */
.custom-text-form{padding:12px;border-top:1px solid var(--border2)}
.custom-text-form .sec-label{margin-bottom:8px}
.btn-small{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;
  padding:5px 10px;border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;transition:all .12s;width:100%;margin-top:4px}
.btn-small:hover{border-color:var(--cyan);color:var(--cyan)}
.btn-small.green{border-color:rgba(0,229,160,.4);color:var(--grn)}
.btn-small.green:hover{background:var(--grnD)}

/* ‚ïê‚ïê MAIN ‚ïê‚ïê */
.main{display:flex;flex-direction:column;overflow:hidden;position:relative}

/* Reading header */
.reading-header{background:var(--s2);border-bottom:1px solid var(--border);padding:10px 16px;
  display:flex;align-items:center;gap:12px;flex-wrap:wrap;flex-shrink:0}
.timer-display{font-family:'IBM Plex Mono',monospace;font-size:30px;font-weight:700;letter-spacing:4px;
  color:var(--t0);min-width:90px;flex-shrink:0;transition:color .3s}
.timer-display.running{color:var(--cyan);text-shadow:0 0 20px rgba(0,212,255,.3)}
.timer-display.stopped{color:var(--grn)}
.timer-btns{display:flex;gap:4px;flex-wrap:wrap}
.tbtn{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;
  padding:6px 11px;border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;transition:all .12s;white-space:nowrap}
.tbtn:hover{border-color:var(--t1);color:var(--t1)}
.tbtn.start{border-color:rgba(0,229,160,.4);color:var(--grn)}
.tbtn.start:hover{background:var(--grnD)}
.tbtn.pause{border-color:rgba(255,179,64,.4);color:var(--amb)}
.tbtn.stop{border-color:rgba(255,79,107,.4);color:var(--red)}
.tbtn.report{border-color:rgba(176,108,255,.4);color:var(--pur)}
.tbtn.report:hover{background:var(--purD)}
.tbtn.rec-btn{border-color:rgba(255,79,107,.3);color:var(--red)}
.tbtn.rec-btn.recording{background:rgba(255,79,107,.15);animation:recpulse 1.5s infinite}
@keyframes recpulse{0%,100%{box-shadow:0 0 0 0 rgba(255,79,107,.4)}50%{box-shadow:0 0 0 6px rgba(255,79,107,0)}}
.tbtn:disabled{opacity:.3;cursor:not-allowed;pointer-events:none}

.metrics-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-left:auto}
.metric{text-align:center;padding:5px 10px;background:var(--s3);border:1px solid var(--border);flex-shrink:0}
.metric-val{font-family:'IBM Plex Mono',monospace;font-size:15px;font-weight:700;color:var(--t0);line-height:1}
.metric-lbl{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:2px;color:var(--t3);text-transform:uppercase;margin-top:1px}

/* Mark bar */
.mark-bar{padding:6px 16px;background:rgba(9,11,16,.8);border-bottom:1px solid var(--border2);
  display:flex;align-items:center;gap:6px;flex-wrap:wrap;flex-shrink:0}
.mark-btn{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;
  padding:4px 9px;border:1px solid;background:none;cursor:pointer;transition:all .12s}
.mark-btn.err{color:var(--red);border-color:rgba(255,79,107,.3)}
.mark-btn.err.active,.mark-btn.err:hover{background:rgba(255,79,107,.12)}
.mark-btn.hes{color:var(--amb);border-color:rgba(255,179,64,.3)}
.mark-btn.hes.active,.mark-btn.hes:hover{background:rgba(255,179,64,.12)}
.mark-btn.sub{color:var(--pur);border-color:rgba(176,108,255,.3)}
.mark-btn.sub.active,.mark-btn.sub:hover{background:rgba(176,108,255,.12)}
.mark-btn.omi{color:var(--rose);border-color:rgba(255,107,157,.3)}
.mark-btn.omi.active,.mark-btn.omi:hover{background:rgba(255,107,157,.12)}
.mark-btn.add{color:var(--cyan);border-color:rgba(0,212,255,.3)}
.mark-btn.add.active,.mark-btn.add:hover{background:var(--cyanD)}
.mark-btn.clr{color:var(--t2);border-color:var(--border)}
.mark-btn.clr:hover{border-color:var(--t1);color:var(--t1)}
.mark-legend{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);letter-spacing:1px;margin-left:4px}

/* Progress bar */
.progress-bar{height:2px;background:var(--s3);position:relative;overflow:hidden;flex-shrink:0}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--cyan),var(--pur));transition:width .8s;width:0%}

/* Text area */
.text-area{flex:1;overflow-y:auto;padding:28px 36px;display:flex;flex-direction:column;gap:12px}
.text-container{max-width:800px;margin:0 auto;width:100%}
.text-meta{margin-bottom:18px}
.text-title{font-family:'DM Serif Display',serif;font-size:22px;color:var(--t0);margin-bottom:4px;line-height:1.3}
.text-subtitle{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--t2);letter-spacing:2px}
.reading-text{font-size:18px;line-height:2;color:var(--t1);font-family:'DM Serif Display',serif;user-select:none}
.reading-text .word{cursor:pointer;transition:all .1s;padding:1px 2px;border-radius:2px;display:inline}
.reading-text .word:hover{color:var(--t0)}
.reading-text .word.w-error{background:rgba(255,79,107,.25);color:var(--red);text-decoration:line-through}
.reading-text .word.w-hesit{background:rgba(255,179,64,.2);color:var(--amb)}
.reading-text .word.w-subst{background:rgba(176,108,255,.2);color:var(--pur);text-decoration:underline dotted}
.reading-text .word.w-omiss{background:rgba(255,107,157,.2);color:var(--rose);opacity:.6}
.reading-text .word.w-add{background:rgba(0,212,255,.15);color:var(--cyan)}

/* Comprehension */
.compreh-section{background:var(--s2);border:1px solid var(--border);padding:14px;margin-top:16px}
.compreh-title{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:2px;color:var(--cyan);text-transform:uppercase;margin-bottom:10px}
.compreh-q{margin-bottom:10px}
.compreh-q-text{font-size:12px;color:var(--t1);margin-bottom:6px;line-height:1.5}
.compreh-opts{display:flex;flex-direction:column;gap:3px}
.compreh-opt{display:flex;align-items:center;gap:7px;padding:5px 8px;background:var(--s3);border:1px solid var(--border);cursor:pointer;transition:all .12s;font-size:11px;color:var(--t2)}
.compreh-opt:hover{border-color:var(--t2);color:var(--t1)}
.compreh-opt.selected-correct{background:rgba(0,229,160,.1);border-color:rgba(0,229,160,.4);color:var(--grn)}
.compreh-opt.selected-wrong{background:rgba(255,79,107,.1);border-color:rgba(255,79,107,.4);color:var(--red)}
.compreh-opt.show-correct{background:rgba(0,229,160,.07);border-color:rgba(0,229,160,.25);color:var(--grn)}
.opt-letter{font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:700;flex-shrink:0}
.compreh-score{font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--t1);margin-top:8px;padding:6px 8px;background:var(--s3);border:1px solid var(--border)}

/* Annotations */
.annotations{background:var(--s2);border:1px solid var(--border);padding:10px;margin-top:10px}
.ann-label{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:2px;color:var(--t3);text-transform:uppercase;margin-bottom:5px}
.ann-textarea{width:100%;background:transparent;border:none;color:var(--t1);font-family:'Syne',sans-serif;font-size:12px;
  resize:none;outline:none;line-height:1.6}

/* Audio player */
.audio-player{display:none;background:var(--s3);border:1px solid var(--border);padding:8px 10px;margin-top:8px;align-items:center;gap:8px;flex-wrap:wrap}
.audio-player.visible{display:flex}
.audio-player audio{flex:1;min-width:200px;height:28px;filter:invert(0.8) hue-rotate(180deg)}

/* Empty */
.empty-state{text-align:center;padding:60px 20px;color:var(--t2)}
.empty-icon{font-size:48px;margin-bottom:14px;opacity:.3}
.empty-title{font-family:'DM Serif Display',serif;font-size:20px;color:var(--t1);margin-bottom:6px}
.empty-sub{font-family:'IBM Plex Mono',monospace;font-size:9px;color:var(--t3);letter-spacing:1px}

/* ‚ïê‚ïê HISTORY PANEL ‚ïê‚ïê */
.history-panel{height:100%;overflow-y:auto;padding:20px;display:none;flex-direction:column;gap:12px}
.history-panel.on{display:flex}
.hist-empty{text-align:center;padding:40px;color:var(--t3);font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:1px}
.hist-card{background:var(--s2);border:1px solid var(--border);padding:14px;transition:border .15s;cursor:pointer}
.hist-card:hover{border-color:var(--t2)}
.hist-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;gap:8px}
.hist-card-name{font-size:13px;color:var(--t0);font-family:'DM Serif Display',serif}
.hist-card-date{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t3);letter-spacing:1px;white-space:nowrap}
.hist-card-meta{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:8px}
.hist-chip{font-family:'IBM Plex Mono',monospace;font-size:8px;padding:2px 6px;border:1px solid var(--border);color:var(--t2);letter-spacing:1px}
.hist-chip.good{color:var(--grn);border-color:rgba(0,229,160,.3)}
.hist-chip.warn{color:var(--amb);border-color:rgba(255,179,64,.3)}
.hist-chip.bad{color:var(--red);border-color:rgba(255,79,107,.3)}
.hist-bars{display:grid;grid-template-columns:1fr 1fr 1fr;gap:4px}
.hist-bar-item{background:var(--s3);padding:5px 7px}
.hist-bar-val{font-family:'IBM Plex Mono',monospace;font-size:13px;font-weight:700;color:var(--t0)}
.hist-bar-lbl{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);letter-spacing:1px;text-transform:uppercase;margin-top:1px}
.hist-actions{display:flex;gap:4px;margin-top:8px}
.hist-del{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:1px;padding:3px 7px;border:1px solid rgba(255,79,107,.25);background:none;color:rgba(255,79,107,.5);cursor:pointer;text-transform:uppercase}
.hist-del:hover{color:var(--red);border-color:var(--red)}
.hist-view{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:1px;padding:3px 7px;border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;text-transform:uppercase}
.hist-view:hover{border-color:var(--cyan);color:var(--cyan)}

/* Evolution chart area */
.evo-section{padding:20px;display:none;flex-direction:column;gap:16px;overflow-y:auto}
.evo-section.on{display:flex}
.evo-header{font-family:'IBM Plex Mono',monospace;font-size:11px;letter-spacing:2px;color:var(--t0);text-transform:uppercase;border-bottom:1px solid var(--border);padding-bottom:8px}
canvas.evo-chart{background:var(--s2);border:1px solid var(--border);border-radius:0;max-height:220px}
.evo-legend{display:flex;gap:12px;flex-wrap:wrap}
.evo-leg-item{display:flex;align-items:center;gap:5px;font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t2);letter-spacing:1px}
.evo-leg-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.evo-no-data{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--t3);letter-spacing:1px;padding:40px;text-align:center}

/* ‚ïê‚ïê FULLSCREEN MODE ‚ïê‚ïê */
.fullscreen-overlay{position:fixed;inset:0;background:#030405;z-index:500;display:none;
  flex-direction:column;align-items:center;justify-content:center;padding:60px 80px}
.fullscreen-overlay.on{display:flex}
.fs-exit{position:absolute;top:20px;right:20px;font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:2px;padding:7px 14px;border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;text-transform:uppercase}
.fs-exit:hover{border-color:var(--red);color:var(--red)}
.fs-timer{font-family:'IBM Plex Mono',monospace;font-size:18px;color:var(--t2);letter-spacing:3px;margin-bottom:30px;position:absolute;top:20px;left:50%;transform:translateX(-50%)}
.fs-timer.running{color:var(--cyan)}
.fs-title{font-family:'DM Serif Display',serif;font-size:18px;color:var(--t2);margin-bottom:24px;text-align:center;letter-spacing:.5px}
.fs-text{font-family:'DM Serif Display',serif;font-size:26px;line-height:2.1;color:var(--t0);text-align:center;max-width:900px;user-select:none}
.fs-controls{position:absolute;bottom:24px;display:flex;gap:8px}
.fs-btn{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:2px;padding:8px 18px;
  border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;text-transform:uppercase}
.fs-btn.go{border-color:rgba(0,229,160,.4);color:var(--grn)}
.fs-btn.go:hover{background:var(--grnD)}
.fs-btn:hover{border-color:var(--t1);color:var(--t1)}
.fs-font-ctrl{position:absolute;bottom:24px;right:20px;display:flex;gap:4px}
.fs-font-btn{font-family:'IBM Plex Mono',monospace;font-size:11px;width:28px;height:28px;
  border:1px solid var(--border);background:none;color:var(--t2);cursor:pointer;display:flex;align-items:center;justify-content:center}
.fs-font-btn:hover{border-color:var(--cyan);color:var(--cyan)}

/* ‚ïê‚ïê MODAL ‚ïê‚ïê */
.modal-overlay{position:fixed;inset:0;background:rgba(3,4,5,.94);backdrop-filter:blur(12px);
  z-index:999;display:none;align-items:flex-start;justify-content:center;padding:20px;overflow-y:auto}
.modal-overlay.open{display:flex}
.modal{background:var(--s1);border:1px solid var(--border);max-width:820px;width:100%;position:relative;margin:auto}
.modal-header{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background:var(--s1);z-index:10}
.modal-title{font-family:'IBM Plex Mono',monospace;font-size:12px;font-weight:700;letter-spacing:2px;color:var(--t0);text-transform:uppercase}
.modal-close{background:none;border:1px solid var(--border);color:var(--t2);width:26px;height:26px;cursor:pointer;font-size:12px;transition:all .15s}
.modal-close:hover{border-color:var(--red);color:var(--red)}
.report-body{padding:22px}

/* Report components */
.r-section{margin-bottom:22px;padding-bottom:22px;border-bottom:1px solid var(--border2)}
.r-section:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
.r-sec-title{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:3px;text-transform:uppercase;
  color:var(--cyan);margin-bottom:12px;display:flex;align-items:center;gap:8px}
.r-sec-title::after{content:'';flex:1;height:1px;background:var(--border)}
.r-grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:7px}
.r-grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:7px}
.rstat{padding:10px;background:var(--s2);border:1px solid var(--border)}
.rstat-val{font-family:'IBM Plex Mono',monospace;font-size:20px;font-weight:700;color:var(--t0);line-height:1}
.rstat-unit{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--t2);margin-left:2px}
.rstat-lbl{font-family:'IBM Plex Mono',monospace;font-size:7px;letter-spacing:2px;color:var(--t3);text-transform:uppercase;margin-top:3px}
.sbar-wrap{margin:8px 0}
.sbar-label{display:flex;justify-content:space-between;margin-bottom:3px}
.sbar-name{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t1)}
.sbar-val{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t0)}
.sbar{height:3px;background:var(--s3)}
.sbar-fill{height:100%;transition:width 1.2s cubic-bezier(.4,0,.2,1)}
.rblock{background:var(--s2);border-left:3px solid var(--cyan);padding:10px 14px;margin:6px 0;font-size:12px;line-height:1.7;color:var(--t1)}
.rblock strong{color:var(--t0)}
.rblock.warn{border-left-color:var(--amb)}
.rblock.crit{border-left-color:var(--red)}
.rblock.good{border-left-color:var(--grn)}
.rblock.info{border-left-color:var(--pur)}
.classif-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border:1px solid;
  font-family:'IBM Plex Mono',monospace;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-bottom:10px}
.etag{font-family:'IBM Plex Mono',monospace;font-size:8px;padding:2px 6px;display:inline-block;margin:2px}
.etag.err{background:rgba(255,79,107,.15);border:1px solid rgba(255,79,107,.3);color:var(--red)}
.etag.hes{background:rgba(255,179,64,.15);border:1px solid rgba(255,179,64,.3);color:var(--amb)}
.etag.sub{background:rgba(176,108,255,.15);border:1px solid rgba(176,108,255,.3);color:var(--pur)}
.etag.omi{background:rgba(255,107,157,.15);border:1px solid rgba(255,107,157,.3);color:var(--rose)}
.etag.add{background:rgba(0,212,255,.1);border:1px solid rgba(0,212,255,.3);color:var(--cyan)}
.phono-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px}
.phono-item{padding:7px 9px;background:var(--s2);border:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.phono-left .phono-name{font-size:10px;color:var(--t1)}
.phono-left .phono-sub{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3)}
.phono-right{font-family:'IBM Plex Mono',monospace;font-size:14px;font-weight:700}
.norma-table{width:100%;border-collapse:collapse;font-family:'IBM Plex Mono',monospace;font-size:9px}
.norma-table th{background:var(--s3);color:var(--t2);padding:5px 8px;text-align:left;letter-spacing:1px;border-bottom:1px solid var(--border)}
.norma-table td{padding:5px 8px;border-bottom:1px solid var(--border2);color:var(--t1)}
.norma-table tr.highlight td{background:rgba(0,212,255,.06);color:var(--t0)}
.norma-table .you{color:var(--cyan);font-weight:700}
.print-actions{display:flex;gap:8px;margin-top:16px;padding-top:16px;border-top:1px solid var(--border2);justify-content:flex-end}
.print-btn{font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;
  padding:7px 14px;border:1px solid;background:none;cursor:pointer;transition:all .15s}
.print-btn.green{color:var(--grn);border-color:rgba(0,229,160,.3)}
.print-btn.green:hover{background:var(--grnD)}
.print-btn.blue{color:var(--cyan);border-color:rgba(0,212,255,.3)}
.print-btn.blue:hover{background:var(--cyanD)}
.watermark{font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);letter-spacing:2px;text-align:center;margin-top:12px;text-transform:uppercase}

/* Comprehension score in report */
.compreh-report{background:var(--s2);border:1px solid var(--border);padding:10px}
.compreh-report-score{display:flex;align-items:baseline;gap:6px;margin-bottom:6px}
.compreh-report-val{font-family:'IBM Plex Mono',monospace;font-size:24px;font-weight:700;color:var(--t0)}
.compreh-report-lbl{font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t3);letter-spacing:1px}

/* Norm comparison */
.norm-indicator{display:inline-flex;align-items:center;gap:4px;font-family:'IBM Plex Mono',monospace;font-size:9px;padding:3px 7px;border:1px solid}

@media print{
  body,html{overflow:visible!important;height:auto!important;background:#fff!important;color:#000!important}
  .modal-overlay{position:relative!important;display:block!important;padding:0!important;background:none!important;backdrop-filter:none!important}
  .modal{max-height:none!important;border:none!important}
  .modal-header,.print-actions,.modal-close,.top,.body{display:none!important}
  .report-body{padding:0!important}
  .rblock,.rstat,.phono-item,.hist-card{background:#f5f5f5!important;color:#000!important;border-color:#ddd!important}
  .rstat-val,.rstat-lbl,.rstat-unit,.phono-left .phono-name,.phono-left .phono-sub,.phono-right{color:#000!important}
}
</style>
</head>
<body>
<div class="app">

  <!-- TOP BAR -->
  <div class="top">
    <div class="brand">
      <div class="brand-icon"></div>
      PHONO<em>BASE</em><sup>2.0</sup>
    </div>
    <div class="top-tabs">
      <button class="ttab on" onclick="showPanel('avaliacao',this)">üìñ Avalia√ß√£o</button>
      <button class="ttab" onclick="showPanel('historico',this)">üìã Hist√≥rico</button>
      <button class="ttab" onclick="showPanel('evolucao',this)">üìà Evolu√ß√£o</button>
    </div>
    <div class="top-r">
      <div class="rec-indicator" id="rec-ind"><div class="rec-dot"></div>REC</div>
      <div class="top-badge ver-badge">v2.0</div>
      <div class="top-badge" id="sess-badge">‚Äî</div>
    </div>
  </div>

  <div class="body">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <!-- PATIENT -->
      <div class="pat-form">
        <div class="sec-label">Dados do Paciente</div>
        <div class="field"><label>Nome</label><input type="text" id="pat-name" placeholder="Nome completo"></div>
        <div class="field-row">
          <div class="field"><label>Nasc.</label><input type="date" id="pat-dob"></div>
          <div class="field"><label>Escola</label>
            <select id="pat-escola">
              <option value="">‚Äî</option>
              <option>Pr√©-escola</option><option>1¬∫ EF</option><option>2¬∫ EF</option>
              <option>3¬∫ EF</option><option>4‚Äì5¬∫ EF</option><option>6‚Äì9¬∫ EF</option>
              <option>Ens. M√©dio</option><option>Superior</option><option>Adulto</option>
            </select>
          </div>
        </div>
        <div class="field"><label>Fonoaudi√≥logo(a)</label><input type="text" id="pat-fono" placeholder="Nome do profissional"></div>
        <div class="field"><label>Diagn√≥stico / Hip√≥tese</label><input type="text" id="pat-diag" placeholder="Ex: Dislexia, gagueira..."></div>
        <!-- VOCAL EFFORT SCALE -->
        <div class="sec-label" style="margin-top:8px;margin-bottom:6px">Escala de Esfor√ßo Vocal (VAS)</div>
        <div class="vas-scale">
          <div class="vas-track">
            <label>Pr√©-leitura</label>
            <input type="range" id="vas-pre" min="0" max="10" value="0" oninput="document.getElementById('vas-pre-val').textContent=this.value">
            <span class="vas-val" id="vas-pre-val">0</span>
          </div>
          <div class="vas-track">
            <label>P√≥s-leitura</label>
            <input type="range" id="vas-post" min="0" max="10" value="0" oninput="document.getElementById('vas-post-val').textContent=this.value">
            <span class="vas-val" id="vas-post-val">0</span>
          </div>
          <div class="vas-track">
            <label>Fadiga vocal</label>
            <input type="range" id="vas-fat" min="0" max="10" value="0" oninput="document.getElementById('vas-fat-val').textContent=this.value">
            <span class="vas-val" id="vas-fat-val">0</span>
          </div>
        </div>
      </div>

      <!-- LEVEL -->
      <div class="levels-sec" style="padding:10px 12px;border-bottom:1px solid var(--border2)">
        <div class="sec-label">N√≠vel de dificuldade</div>
        <div class="level-grid">
          <button class="lvl-btn active" data-lvl="1" onclick="selectLevel(1,this)">üü¢ F√°cil</button>
          <button class="lvl-btn" data-lvl="2" onclick="selectLevel(2,this)">üîµ M√©dio</button>
          <button class="lvl-btn" data-lvl="3" onclick="selectLevel(3,this)">üü° Dif√≠cil</button>
          <button class="lvl-btn" data-lvl="4" onclick="selectLevel(4,this)">üî¥ Avan√ßado</button>
          <button class="lvl-btn" data-lvl="5" onclick="selectLevel(5,this)">üü£ Expert</button>
          <button class="lvl-btn" data-lvl="6" onclick="selectLevel(6,this)">üíÄ Extremo</button>
          <button class="lvl-btn" data-lvl="custom" onclick="selectLevel('custom',this)" style="grid-column:1/-1">‚úèÔ∏è Texto Personalizado</button>
        </div>
      </div>

      <!-- TEXT LIST -->
      <div class="text-list" id="text-list-section">
        <div class="sec-label">Textos dispon√≠veis</div>
        <div id="text-list-container" style="margin-top:8px"></div>
      </div>

      <!-- CUSTOM TEXT FORM -->
      <div class="custom-text-form" id="custom-form" style="display:none">
        <div class="sec-label">Texto Personalizado</div>
        <div class="field" style="margin-top:8px"><label>T√≠tulo</label><input type="text" id="custom-title" placeholder="Nome do texto"></div>
        <div class="field"><label>Texto</label><textarea id="custom-body" rows="5" placeholder="Cole ou digite o texto aqui..."></textarea></div>
        <button class="btn-small green" onclick="loadCustomText()">‚úì Carregar Texto</button>
        <button class="btn-small" onclick="saveCustomText()">üíæ Salvar na Biblioteca</button>
      </div>
    </div>

    <!-- MAIN PANEL: ASSESSMENT -->
    <div class="main" id="panel-avaliacao">

      <!-- TIMER HEADER -->
      <div class="reading-header">
        <div id="timer-display" class="timer-display">00:00</div>
        <div class="timer-btns">
          <button class="tbtn start" id="btn-start" onclick="startTimer()" disabled>‚ñ∂ Iniciar</button>
          <button class="tbtn pause" id="btn-pause" onclick="pauseTimer()" disabled>‚è∏ Pausar</button>
          <button class="tbtn stop" id="btn-stop" onclick="stopTimer()" disabled>‚èπ Parar</button>
          <button class="tbtn" onclick="resetTimer()">‚Ü∫ Reset</button>
          <button class="tbtn rec-btn" id="btn-rec" onclick="toggleRecording()">‚è∫ Gravar</button>
          <button class="tbtn" onclick="openFullscreen()" id="btn-fs" disabled>‚õ∂ Tela Cheia</button>
        </div>
        <div class="metrics-row">
          <div class="metric"><div class="metric-val" id="m-wpm">‚Äî</div><div class="metric-lbl">PPM</div></div>
          <div class="metric"><div class="metric-val" id="m-errors">0</div><div class="metric-lbl">Erros</div></div>
          <div class="metric"><div class="metric-val" id="m-hesit">0</div><div class="metric-lbl">Hesit.</div></div>
          <div class="metric"><div class="metric-val" id="m-accuracy">‚Äî</div><div class="metric-lbl">Precis√£o</div></div>
          <button class="tbtn report" id="btn-report" onclick="openReport()" disabled>üìä Relat√≥rio</button>
        </div>
      </div>

      <!-- MARK BAR -->
      <div class="mark-bar">
        <span style="font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);letter-spacing:1px;text-transform:uppercase">Marcar:</span>
        <button class="mark-btn err active" id="mb-err" onclick="setMark('error')">‚úó Erro</button>
        <button class="mark-btn hes" id="mb-hes" onclick="setMark('hesit')">‚è§ Hesita√ß√£o</button>
        <button class="mark-btn sub" id="mb-sub" onclick="setMark('subst')">‚Üî Substitui√ß√£o</button>
        <button class="mark-btn omi" id="mb-omi" onclick="setMark('omiss')">‚óã Omiss√£o</button>
        <button class="mark-btn add" id="mb-add" onclick="setMark('add')">+ Adi√ß√£o</button>
        <button class="mark-btn clr" onclick="setMark('clear')">‚óå Limpar</button>
        <span class="mark-legend">Clique nas palavras</span>
        <button class="mark-btn clr" style="margin-left:auto" onclick="clearAll()">Limpar tudo</button>
      </div>

      <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

      <!-- TEXT AREA -->
      <div class="text-area" id="text-area">
        <div class="text-container">
          <div class="empty-state" id="empty-state">
            <div class="empty-icon">üìñ</div>
            <div class="empty-title">Selecione um texto</div>
            <div class="empty-sub">Escolha o n√≠vel e o texto na barra lateral<br>ou crie um texto personalizado</div>
          </div>
          <div id="text-content" style="display:none">
            <div class="text-meta">
              <div class="text-title" id="tc-title"></div>
              <div class="text-subtitle" id="tc-sub"></div>
            </div>
            <div class="reading-text" id="tc-words"></div>
            <div class="audio-player" id="audio-player">
              <span style="font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--t2);letter-spacing:1px">GRAVA√á√ÉO</span>
              <audio id="audio-elem" controls></audio>
              <button class="mark-btn clr" onclick="deleteRecording()">‚úï</button>
            </div>
            <div id="compreh-section"></div>
            <div class="annotations" style="margin-top:10px">
              <div class="ann-label">Observa√ß√µes cl√≠nicas ‚Äî qualidade vocal, postura, respira√ß√£o, pros√≥dia</div>
              <textarea class="ann-textarea" id="ann-notes" rows="3" placeholder="Anota√ß√µes do fonoaudi√≥logo..."></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PANEL: HISTORY -->
    <div class="history-panel" id="panel-historico">
      <div style="font-family:'IBM Plex Mono',monospace;font-size:11px;letter-spacing:2px;color:var(--t0);text-transform:uppercase;border-bottom:1px solid var(--border);padding-bottom:10px;display:flex;justify-content:space-between;align-items:center">
        Hist√≥rico de Sess√µes
        <button class="mark-btn clr" onclick="clearHistory()" style="font-size:7px">Limpar tudo</button>
      </div>
      <div id="history-list"></div>
    </div>

    <!-- PANEL: EVOLUTION -->
    <div class="evo-section" id="panel-evolucao">
      <div class="evo-header">Evolu√ß√£o do Paciente</div>
      <div class="evo-legend">
        <div class="evo-leg-item"><div class="evo-leg-dot" style="background:var(--cyan)"></div>PPM</div>
        <div class="evo-leg-item"><div class="evo-leg-dot" style="background:var(--grn)"></div>Precis√£o %</div>
        <div class="evo-leg-item"><div class="evo-leg-dot" style="background:var(--red)"></div>Erros</div>
      </div>
      <canvas id="evo-chart" class="evo-chart" height="200"></canvas>
      <canvas id="evo-chart2" class="evo-chart" height="180"></canvas>
      <div id="evo-no-data" class="evo-no-data" style="display:none">Nenhuma sess√£o registrada ainda.<br>Complete uma avalia√ß√£o e salve o relat√≥rio.</div>
    </div>
  </div>
</div>

<!-- FULLSCREEN READING MODE -->
<div class="fullscreen-overlay" id="fs-overlay">
  <div class="fs-timer" id="fs-timer">00:00</div>
  <button class="fs-exit" onclick="closeFullscreen()">‚úï Sair</button>
  <div class="fs-title" id="fs-title"></div>
  <div class="fs-text" id="fs-text"></div>
  <div class="fs-controls">
    <button class="fs-btn go" id="fs-start-btn" onclick="fsToggleTimer()">‚ñ∂ Iniciar Leitura</button>
    <button class="fs-btn" onclick="closeFullscreen()">‚èπ Encerrar</button>
  </div>
  <div class="fs-font-ctrl">
    <button class="fs-font-btn" onclick="fsFontSize(-2)">A-</button>
    <button class="fs-font-btn" onclick="fsFontSize(2)">A+</button>
  </div>
</div>

<!-- REPORT MODAL -->
<div class="modal-overlay" id="report-modal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">üìä Relat√≥rio Fonoaudiol√≥gico ¬∑ Leitura Oral</div>
      <button class="modal-close" onclick="closeReport()">‚úï</button>
    </div>
    <div class="report-body" id="report-body"></div>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   DATA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const TEXTS = {
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê N√çVEL 1 ¬∑ F√ÅCIL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
1:[
  {id:'1a',name:'O Gato e o Sol',words:80,
   title:'O Gato e o Sol',subtitle:'N√≠vel 1 ¬∑ F√°cil ¬∑ Vocabul√°rio b√°sico ¬∑ Alta frequ√™ncia',
   content:'O gato dorme ao sol. Ele √© preto e tem quatro patas. O gato gosta de leite e de peixe. Ele mia quando quer comer. De manh√£, o gato pula na cama e acorda a mam√£e. √Ä tarde, ele brinca com uma bola de l√£. √Ä noite, o gato dorme no sof√° quentinho. O gato √© um animal muito carinhoso e d√≥cil. Ele gosta de colo e de carinhos suaves. Toda a fam√≠lia ama o gato da casa.',
   questions:[
     {q:'Onde o gato dorme √† noite?',opts:['Na cama','No sof√°','No ch√£o','Na cadeira'],correct:1},
     {q:'O que o gato faz de manh√£?',opts:['Pula na cama','Come peixe','Brinca com bola','Mia'],correct:0},
     {q:'Como √© o gato descrito no texto?',opts:['Bravo','Carinhoso','Selvagem','Pregui√ßoso'],correct:1}
   ]},
  {id:'1b',name:'A Escola da Ana',words:92,
   title:'A Escola da Ana',subtitle:'N√≠vel 1 ¬∑ F√°cil ¬∑ Frases simples ¬∑ Rotina',
   content:'Ana vai para a escola todo dia de semana. Ela acorda cedo e toma caf√© com leite. A mochila dela √© azul com estrelas. Na escola, Ana aprende a ler, a escrever e a fazer contas. A professora dela se chama Dona Maria e √© muito boa. Ana gosta muito de pintar, de cantar e de contar hist√≥rias. Na hora do recreio, ela brinca com os amigos no p√°tio. Eles jogam bola e pulam corda juntos. √Ä tarde, Ana volta para casa de m√£os dadas com a m√£e. Ela faz o dever e depois assiste a um desenho animado.',
   questions:[
     {q:'Como √© a mochila da Ana?',opts:['Vermelha','Verde','Azul com estrelas','Rosa'],correct:2},
     {q:'Qual o nome da professora?',opts:['Dona L√∫cia','Dona Maria','Dona Ana','Dona Rosa'],correct:1},
     {q:'O que Ana faz depois do dever?',opts:['Dorme','Assiste desenho','Brinca','L√™'],correct:1}
   ]},
  {id:'1c',name:'O Parque',words:85,
   title:'Um Dia no Parque',subtitle:'N√≠vel 1 ¬∑ F√°cil ¬∑ Narrativa simples ¬∑ Frases curtas',
   content:'Jo√£o foi ao parque com o pai. O parque tem muitas √°rvores e flores bonitas. Jo√£o correu no gramado verde e subiu no balan√ßo. Ele viu um cachorro branco brincando com uma bola. O pai comprou um sorvete de morango para Jo√£o. Eles sentaram num banco √† sombra de uma √°rvore grande. Jo√£o comeu o sorvete devagar para n√£o derrubar. O sol estava quente mas havia um vento fresco. Depois de brincar muito, Jo√£o ficou cansado. O pai o carregou no colo at√© o carro. Foi um dia muito feliz para os dois.',
   questions:[
     {q:'Com quem Jo√£o foi ao parque?',opts:['Com a m√£e','Com o pai','Com a vov√≥','Com amigos'],correct:1},
     {q:'Que sabor era o sorvete de Jo√£o?',opts:['Chocolate','Baunilha','Morango','Lim√£o'],correct:2},
     {q:'Como Jo√£o voltou at√© o carro?',opts:['Caminhando','Correndo','No colo do pai','De bicicleta'],correct:2}
   ]},
  {id:'1d',name:'A Chuva',words:78,
   title:'A Chuva e o Arco-√≠ris',subtitle:'N√≠vel 1 ¬∑ F√°cil ¬∑ Natureza ¬∑ Palavras simples',
   content:'Hoje choveu muito. As crian√ßas ficaram em casa olhando pela janela. A chuva ca√≠a forte no telhado e fazia barulho. As ruas ficaram cheias de √°gua. Os passarinhos se esconderam nas √°rvores. Depois de um tempo, a chuva parou. O sol voltou a brilhar no c√©u azul. Ent√£o apareceu um lindo arco-√≠ris com muitas cores. As cores eram vermelho, laranja, amarelo, verde, azul e roxo. As crian√ßas correram para o jardim para ver de perto. Que coisa bonita √© a natureza depois da chuva.',
   questions:[
     {q:'O que as crian√ßas fizeram durante a chuva?',opts:['Brincaram na rua','Ficaram em casa olhando pela janela','Foram √† escola','Dormiram'],correct:1},
     {q:'O que apareceu depois que a chuva parou?',opts:['Trov√£o','Neblina','Arco-√≠ris','Neve'],correct:2},
     {q:'Para onde as crian√ßas correram depois?',opts:['Para a cozinha','Para o quarto','Para o jardim','Para a escola'],correct:2}
   ]}
],
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê N√çVEL 2 ¬∑ M√âDIO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
2:[
  {id:'2a',name:'A Floresta Amaz√¥nica',words:112,
   title:'A Floresta Amaz√¥nica',subtitle:'N√≠vel 2 ¬∑ M√©dio ¬∑ Vocabul√°rio intermedi√°rio ¬∑ Frases compostas',
   content:'A floresta amaz√¥nica √© a maior floresta tropical do mundo. Ela cobre grande parte do Brasil e de outros pa√≠ses da Am√©rica do Sul. Na Amaz√¥nia, vivem milhares de esp√©cies de animais e plantas ainda desconhecidas pela ci√™ncia. O rio Amazonas atravessa toda a floresta e des√°gua no oceano Atl√¢ntico. Muitas comunidades ind√≠genas vivem na floresta e conhecem seus segredos h√° s√©culos. A Amaz√¥nia produz oxig√™nio essencial para todo o planeta e regula o clima global de forma decisiva. Por isso, preservar essa floresta t√£o especial √© uma responsabilidade de todos. O desmatamento acelerado representa uma amea√ßa grave que precisa ser combatida urgentemente.',
   questions:[
     {q:'O que o rio Amazonas faz?',opts:['Nasce no Atl√¢ntico','Atravessa a floresta e des√°gua no Atl√¢ntico','Divide o Brasil ao meio','Nasce no Peru'],correct:1},
     {q:'O que a Amaz√¥nia produz para o planeta?',opts:['Chuva','Energia solar','Oxig√™nio','Petr√≥leo'],correct:2},
     {q:'Quem vive na floresta h√° s√©culos?',opts:['Agricultores','Comunidades ind√≠genas','Cientistas','Turistas'],correct:1}
   ]},
  {id:'2b',name:'O Sistema Solar',words:108,
   title:'O Sistema Solar',subtitle:'N√≠vel 2 ¬∑ M√©dio ¬∑ Ci√™ncias ¬∑ Vocabul√°rio espec√≠fico',
   content:'O sistema solar √© formado pelo Sol e por oito planetas que giram ao seu redor. Cada planeta percorre sua pr√≥pria √≥rbita em velocidades diferentes. Merc√∫rio √© o planeta mais pr√≥ximo do Sol e tem temperaturas extremas. V√™nus tem uma atmosfera densa de di√≥xido de carbono. A Terra √© o √∫nico planeta onde existe vida conhecida no universo. Marte √© vermelho por causa do √≥xido de ferro em sua superf√≠cie rochosa. J√∫piter √© o maior planeta e tem uma grande tempestade chamada de Mancha Vermelha. Saturno tem an√©is formados de gelo e rocha. Urano e Netuno s√£o os planetas mais distantes e mais gelados do sistema.',
   questions:[
     {q:'Quantos planetas tem o sistema solar?',opts:['7','8','9','10'],correct:1},
     {q:'Por que Marte √© vermelho?',opts:['Lava vulc√¢nica','√ìxido de ferro','Luz do sol','Poeira azul'],correct:1},
     {q:'Qual o maior planeta?',opts:['Saturno','Terra','J√∫piter','Netuno'],correct:2}
   ]},
  {id:'2c',name:'Alimenta√ß√£o Saud√°vel',words:105,
   title:'A Import√¢ncia da Alimenta√ß√£o Saud√°vel',subtitle:'N√≠vel 2 ¬∑ M√©dio ¬∑ Sa√∫de ¬∑ Frases compostas',
   content:'Uma alimenta√ß√£o saud√°vel √© fundamental para o bom funcionamento do nosso corpo. Devemos comer frutas, verduras e legumes todos os dias, pois eles fornecem vitaminas e minerais essenciais. As prote√≠nas, encontradas nas carnes, ovos e feij√£o, ajudam a construir e reparar os tecidos do corpo. Os carboidratos, presentes no arroz, no p√£o e na batata, fornecem energia para as atividades di√°rias. Devemos evitar o excesso de a√ß√∫car, sal e gordura, que podem causar doen√ßas como diabetes e hipertens√£o. Beber bastante √°gua tamb√©m √© muito importante para manter o corpo hidratado. Fazer refei√ß√µes em hor√°rios regulares e comer devagar ajuda na digest√£o. Uma boa alimenta√ß√£o, combinada com exerc√≠cios f√≠sicos, garante uma vida mais saud√°vel e feliz.',
   questions:[
     {q:'Qual alimento fornece prote√≠nas?',opts:['Arroz','Ma√ß√£','Feij√£o','Batata'],correct:2},
     {q:'O que os carboidratos fornecem ao corpo?',opts:['Vitaminas','Energia','Prote√≠nas','Gorduras'],correct:1},
     {q:'O que deve ser evitado em excesso?',opts:['Frutas e verduras','√Ågua','A√ß√∫car, sal e gordura','Prote√≠nas'],correct:2}
   ]},
  {id:'2d',name:'Os Animais do Cerrado',words:115,
   title:'A Fauna do Cerrado Brasileiro',subtitle:'N√≠vel 2 ¬∑ M√©dio ¬∑ Natureza ¬∑ Brasil ¬∑ Frases m√©dias',
   content:'O cerrado √© o segundo maior bioma do Brasil e abriga uma fauna rica e diversificada. Entre os animais mais conhecidos do cerrado est√£o a on√ßa-pintada, o tamandu√°-bandeira e o lobo-guar√°. O lobo-guar√° √© o maior can√≠deo da Am√©rica do Sul e se alimenta principalmente de frutos, pequenos mam√≠feros e aves. O tamandu√°-bandeira usa sua longa l√≠ngua pegajosa para capturar formigas e cupins nos ninhos. A ema √© uma ave que n√£o voa, mas corre muito r√°pido pelo campo aberto. O tatu-canastra escava tocas profundas no solo duro do cerrado para se proteger. Muitos desses animais est√£o amea√ßados de extin√ß√£o por causa do desmatamento e da expans√£o agropecu√°ria. Preservar o cerrado √© essencial para manter viva essa biodiversidade √∫nica.',
   questions:[
     {q:'Qual √© o maior can√≠deo da Am√©rica do Sul?',opts:['Cachorro-do-mato','Lobo-guar√°','Raposa','Quati'],correct:1},
     {q:'Do que se alimenta o tamandu√°-bandeira?',opts:['Frutas e peixes','Formigas e cupins','Pequenos p√°ssaros','Ra√≠zes'],correct:1},
     {q:'Por que os animais do cerrado est√£o amea√ßados?',opts:['Por predadores naturais','Por doen√ßas','Por desmatamento e expans√£o agropecu√°ria','Por secas extremas'],correct:2}
   ]}
],
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê N√çVEL 3 ¬∑ DIF√çCIL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
3:[
  {id:'3a',name:'Revolu√ß√£o Industrial',words:133,
   title:'A Revolu√ß√£o Industrial',subtitle:'N√≠vel 3 ¬∑ Dif√≠cil ¬∑ Texto hist√≥rico ¬∑ Vocabul√°rio t√©cnico',
   content:'A Revolu√ß√£o Industrial transformou profundamente a sociedade europeia a partir do s√©culo dezoito. Iniciada na Inglaterra, essa transforma√ß√£o radical marcou a transi√ß√£o da produ√ß√£o artesanal para a produ√ß√£o mecanizada em larga escala. A inven√ß√£o da m√°quina a vapor por James Watt foi fundamental para esse processo, permitindo a cria√ß√£o de locomotivas, navios a vapor e f√°bricas modernas. Trabalhadores abandonaram o campo em massa e migraram para as cidades industriais em busca de emprego. As condi√ß√µes de trabalho eram prec√°rias: jornadas de doze a dezesseis horas, sal√°rios baix√≠ssimos e aus√™ncia total de direitos trabalhistas. Esse contexto desumano gerou os primeiros movimentos oper√°rios e sindicatos, que lutaram corajosamente por melhores condi√ß√µes de vida. A Revolu√ß√£o Industrial tamb√©m intensificou o colonialismo europeu, pois as pot√™ncias precisavam de mat√©ria-prima barata e mercados consumidores para seus produtos.',
   questions:[
     {q:'Onde come√ßou a Revolu√ß√£o Industrial?',opts:['Fran√ßa','Estados Unidos','Inglaterra','Alemanha'],correct:2},
     {q:'Qual inventor criou a m√°quina a vapor?',opts:['Newton','James Watt','Darwin','Edison'],correct:1},
     {q:'Qual foi uma consequ√™ncia social da industrializa√ß√£o?',opts:['Melhoria imediata nas condi√ß√µes de trabalho','Surgimento de movimentos oper√°rios','Redu√ß√£o das horas de trabalho','Aumento dos sal√°rios'],correct:1}
   ]},
  {id:'3b',name:'Mem√≥ria e C√©rebro',words:128,
   title:'Como o C√©rebro Forma Mem√≥rias',subtitle:'N√≠vel 3 ¬∑ Dif√≠cil ¬∑ Ci√™ncias da sa√∫de ¬∑ Termos t√©cnicos',
   content:'A forma√ß√£o de mem√≥rias √© um processo complexo que envolve diversas estruturas cerebrais interconectadas. O hipocampo desempenha papel central na consolida√ß√£o da mem√≥ria epis√≥dica, aquela relacionada a eventos e experi√™ncias pessoais vividas. Durante o sono, o c√©rebro reprocessa as informa√ß√µes adquiridas durante o dia, transferindo-as da mem√≥ria de curto prazo para a mem√≥ria de longo prazo de forma eficiente. A plasticidade sin√°ptica, especialmente o fen√¥meno denominado potencia√ß√£o de longa dura√ß√£o, √© o mecanismo celular subjacente ao aprendizado humano. Neurotransmissores como glutamato e dopamina modulam a intensidade com que as mem√≥rias s√£o gravadas no c√≥rtex cerebral. Situa√ß√µes emocionalmente intensas produzem mem√≥rias mais v√≠vidas e duradouras porque a am√≠gdala, estrutura relacionada √†s emo√ß√µes, potencializa a atividade hipocampal durante a codifica√ß√£o e a consolida√ß√£o da mem√≥ria.',
   questions:[
     {q:'Qual estrutura √© central na mem√≥ria epis√≥dica?',opts:['Am√≠gdala','C√≥rtex pr√©-frontal','Hipocampo','Cerebelo'],correct:2},
     {q:'Quando o c√©rebro consolida mem√≥rias?',opts:['Durante exerc√≠cios','Durante o sono','Durante refei√ß√µes','Durante leituras'],correct:1},
     {q:'Por que mem√≥rias emocionais s√£o mais v√≠vidas?',opts:['Pelo hipocampo maior','Pela am√≠gdala potencializando o hipocampo','Por mais dopamina','Por mais glutamato'],correct:1}
   ]},
  {id:'3c',name:'Mudan√ßas Clim√°ticas',words:135,
   title:'As Mudan√ßas Clim√°ticas e Seus Efeitos',subtitle:'N√≠vel 3 ¬∑ Dif√≠cil ¬∑ Atualidades ¬∑ Ci√™ncia ambiental',
   content:'As mudan√ßas clim√°ticas representam um dos maiores desafios enfrentados pela humanidade no s√©culo vinte e um. O aquecimento global, causado principalmente pela emiss√£o de gases de efeito estufa como o di√≥xido de carbono e o metano, est√° alterando os padr√µes clim√°ticos em todo o planeta. As consequ√™ncias j√° s√£o vis√≠veis: derretimento das calotas polares, eleva√ß√£o do n√≠vel do mar, eventos clim√°ticos extremos cada vez mais frequentes e intensos, como furac√µes, secas prolongadas e enchentes devastadoras. Popula√ß√µes vulner√°veis, especialmente em pa√≠ses em desenvolvimento, s√£o as mais afetadas por essas transforma√ß√µes. A transi√ß√£o para fontes de energia renov√°vel, como a solar e a e√≥lica, √© considerada essencial para reduzir as emiss√µes e limitar o aumento da temperatura global a um ponto e meio grau Celsius, conforme estabelecido pelo Acordo de Paris. A adapta√ß√£o e a mitiga√ß√£o exigem coopera√ß√£o internacional urgente e mudan√ßas profundas nos padr√µes de produ√ß√£o e consumo.',
   questions:[
     {q:'O que causa o aquecimento global?',opts:['Maremotos e terremotos','Emiss√£o de gases de efeito estufa','Desmatamento apenas','Erup√ß√µes vulc√¢nicas'],correct:1},
     {q:'Qual √© o limite de temperatura do Acordo de Paris?',opts:['0,5¬∞C','1,0¬∞C','1,5¬∞C','2,5¬∞C'],correct:2},
     {q:'Quais s√£o exemplos de energia renov√°vel citados?',opts:['Nuclear e carv√£o','Solar e e√≥lica','Petr√≥leo e g√°s','Hidrel√©trica e nuclear'],correct:1}
   ]},
  {id:'3d',name:'Comunica√ß√£o Humana',words:122,
   title:'A Comunica√ß√£o Humana e Seus Componentes',subtitle:'N√≠vel 3 ¬∑ Dif√≠cil ¬∑ Linguagem ¬∑ Fonoaudiologia introdut√≥ria',
   content:'A comunica√ß√£o humana √© um processo complexo que envolve a transmiss√£o e a recep√ß√£o de mensagens entre indiv√≠duos. Para que a comunica√ß√£o ocorra de forma eficaz, s√£o necess√°rios um emissor, uma mensagem, um canal e um receptor. A linguagem verbal, oral e escrita, √© a forma mais elaborada de comunica√ß√£o humana e depende de estruturas cerebrais espec√≠ficas para sua produ√ß√£o e compreens√£o. A linguagem n√£o verbal, que inclui gestos, express√µes faciais, postura corporal e olhar, complementa e √†s vezes substitui a comunica√ß√£o verbal. A pros√≥dia, ou seja, a melodia da fala, transmite informa√ß√µes emocionais e pragm√°ticas que o conte√∫do verbal sozinho n√£o consegue expressar. Altera√ß√µes em qualquer componente desse sistema complexo podem comprometer a comunica√ß√£o e a participa√ß√£o social do indiv√≠duo, gerando necessidade de avalia√ß√£o e interven√ß√£o fonoaudiol√≥gica especializada.',
   questions:[
     {q:'Quais s√£o os elementos b√°sicos da comunica√ß√£o?',opts:['Voz, l√≠ngua, ouvido','Emissor, mensagem, canal, receptor','Palavras, frases, par√°grafos','Tom, ritmo, velocidade'],correct:1},
     {q:'O que a pros√≥dia transmite?',opts:['Apenas o conte√∫do das palavras','Informa√ß√µes emocionais e pragm√°ticas','A escrita correta','A gram√°tica da l√≠ngua'],correct:1},
     {q:'O que pode comprometer a participa√ß√£o social?',opts:['Falar muito','Altera√ß√µes em qualquer componente comunicativo','Falar pouco','Usar gestos'],correct:1}
   ]}
],
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê N√çVEL 4 ¬∑ AVAN√áADO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
4:[
  {id:'4a',name:'Disfagia Orofar√≠ngea',words:148,
   title:'Fisiopatologia da Disfagia Orofar√≠ngea',subtitle:'N√≠vel 4 ¬∑ Avan√ßado ¬∑ Terminologia fonoaudiol√≥gica cl√≠nica',
   content:'A disfagia orofar√≠ngea caracteriza-se por dificuldade na degluti√ß√£o decorrente de altera√ß√µes nas fases oral, far√≠ngea ou na transi√ß√£o faringoesof√°gica do processo deglutit√≥rio. As causas mais frequentes incluem acidente vascular encef√°lico, doen√ßa de Parkinson, esclerose lateral amiotr√≥fica e neoplasias de cabe√ßa e pesco√ßo tratadas com cirurgia ou radioterapia. Do ponto de vista neurofisiol√≥gico, a degluti√ß√£o normal exige coordena√ß√£o precisa de mais de trinta m√∫sculos, regulados pelo tronco encef√°lico e por estruturas supratentoriais bilaterais. A penetra√ß√£o lar√≠ngea e a aspira√ß√£o traqueobr√¥nquica representam as complica√ß√µes mais graves da disfagia, podendo resultar em pneumonia aspirativa com significativa morbimortalidade hospitalar. A avalia√ß√£o cl√≠nica fonoaudiol√≥gica, complementada pela videofluoroscopia da degluti√ß√£o e pela videoendoscopia com fibra √≥ptica, constitui o padr√£o-ouro diagn√≥stico contempor√¢neo. O manejo terap√™utico inclui estrat√©gias posturais, manobras de degluti√ß√£o e modifica√ß√£o de consist√™ncias alimentares conforme a International Dysphagia Diet Standardisation Initiative.',
   questions:[
     {q:'Quantos m√∫sculos envolvem a degluti√ß√£o normal?',opts:['Mais de 10','Mais de 20','Mais de 30','Mais de 50'],correct:2},
     {q:'Qual o padr√£o-ouro diagn√≥stico para disfagia?',opts:['Tomografia','Resson√¢ncia','Videofluoroscopia + videoendoscopia','Ultrassonografia'],correct:2},
     {q:'O que √© aspira√ß√£o traqueobr√¥nquica?',opts:['Tosse produtiva','Entrada de material nas vias a√©reas','Dificuldade de mastiga√ß√£o','Refluxo esof√°gico'],correct:1}
   ]},
  {id:'4b',name:'An√°lise Ac√∫stica Vocal',words:143,
   title:'Par√¢metros Ac√∫sticos na Avalia√ß√£o Vocal',subtitle:'N√≠vel 4 ¬∑ Avan√ßado ¬∑ Fonoaudiologia ¬∑ Terminologia especializada',
   content:'A avalia√ß√£o ac√∫stica da voz constitui instrumento fundamental na pr√°tica fonoaudiol√≥gica contempor√¢nea baseada em evid√™ncias. Par√¢metros como frequ√™ncia fundamental, jitter, shimmer e propor√ß√£o harm√¥nico-ru√≠do permitem quantificar objetivamente as caracter√≠sticas vibrat√≥rias das pregas vocais. A frequ√™ncia fundamental m√©dia varia entre cento e vinte e duzentos e cinquenta hertz em homens adultos e entre cento e noventa e duzentos e noventa hertz em mulheres adultas jovens. Perturba√ß√µes de frequ√™ncia, mensuradas pelo jitter, acima de um por cento indicam irregularidade vibrat√≥ria clinicamente significativa. O shimmer, perturba√ß√£o de amplitude ciclo a ciclo, quando superior a tr√™s decib√©is, sugere altera√ß√£o na coapta√ß√£o gl√≥tica. A propor√ß√£o harm√¥nico-ru√≠do abaixo de quinze decib√©is indica excesso de ru√≠do aperi√≥dico no sinal vocal. Tais medidas, obtidas por softwares especializados como o Praat e o Multi-Dimensional Voice Program, devem ser interpretadas sempre em conjunto com a avalia√ß√£o perceptivo-auditiva padronizada e com o exame laringosc√≥pico direto.',
   questions:[
     {q:'O que mede o jitter?',opts:['Perturba√ß√£o de amplitude','Perturba√ß√£o de frequ√™ncia','Ru√≠do aperi√≥dico','Frequ√™ncia fundamental'],correct:1},
     {q:'Qual software √© citado para an√°lise ac√∫stica?',opts:['Audacity','Praat','GarageBand','MATLAB'],correct:1},
     {q:'HNR abaixo de 15 dB indica o qu√™?',opts:['Voz normal','Frequ√™ncia alta','Excesso de ru√≠do aperi√≥dico','Boa coapta√ß√£o gl√≥tica'],correct:2}
   ]},
  {id:'4c',name:'Afasia e Reabilita√ß√£o',words:145,
   title:'Afasia: Classifica√ß√£o e Abordagem Terap√™utica',subtitle:'N√≠vel 4 ¬∑ Avan√ßado ¬∑ Neurologia ¬∑ Fonoaudiologia',
   content:'A afasia √© um dist√∫rbio adquirido da linguagem resultante de les√£o cerebral, mais frequentemente causada por acidente vascular encef√°lico isqu√™mico ou hemorr√°gico. As afasias s√£o classificadas de acordo com a flu√™ncia do discurso, a compreens√£o auditiva, a repeti√ß√£o e a nomea√ß√£o. A afasia de Broca caracteriza-se por fala n√£o fluente, telegr√°fica e laboriosa, com compreens√£o relativamente preservada e comprometimento da repeti√ß√£o. A afasia de Wernicke apresenta fala fluente com parafasias sem√¢nticas e fon√™micas, compreens√£o gravemente comprometida e repeti√ß√£o alterada. A afasia de condu√ß√£o distingue-se pela repeti√ß√£o severamente prejudicada com flu√™ncia e compreens√£o relativamente preservadas. O tratamento fonoaudiol√≥gico baseia-se em abordagens que exploram a neuroplasticidade, como a terapia de indu√ß√£o por restri√ß√£o do membro afetado adaptada para a linguagem, a terapia de entona√ß√£o mel√≥dica e o uso de comunica√ß√£o aumentativa e alternativa para pacientes com afasia grave e n√£o fluente.',
   questions:[
     {q:'O que caracteriza a afasia de Broca?',opts:['Fala fluente com parafasias','Fala n√£o fluente e telegr√°fica','Boa repeti√ß√£o mas sem compreens√£o','Apenas dificuldade de nomea√ß√£o'],correct:1},
     {q:'Na afasia de Wernicke, o que est√° comprometido?',opts:['Apenas a fala','Compreens√£o e repeti√ß√£o','Somente a nomea√ß√£o','A mem√≥ria de trabalho'],correct:1},
     {q:'O que √© a terapia de entona√ß√£o mel√≥dica?',opts:['T√©cnica de canto para relaxamento','Abordagem que usa melodia para reabilitar a fala','An√°lise de frequ√™ncia fundamental','Exerc√≠cio respirat√≥rio'],correct:1}
   ]},
  {id:'4d',name:'Desenvolvimento da Linguagem',words:138,
   title:'Marcos do Desenvolvimento de Linguagem na Inf√¢ncia',subtitle:'N√≠vel 4 ¬∑ Avan√ßado ¬∑ Fonoaudiologia pedi√°trica ¬∑ Desenvolvimento',
   content:'O desenvolvimento da linguagem na inf√¢ncia segue uma trajet√≥ria relativamente previs√≠vel, com marcos que servem de refer√™ncia para a identifica√ß√£o precoce de altera√ß√µes. Nos primeiros dois meses de vida, o beb√™ j√° emite sons vegetativos e apresenta rea√ß√µes reflexas ao som. Entre tr√™s e seis meses surgem o sorriso responsivo, o balbucio e a vocaliza√ß√£o em resposta √† voz humana. Aos doze meses, espera-se que a crian√ßa produza as primeiras palavras com significado, geralmente associadas a pessoas ou objetos do cotidiano. Entre dezoito e vinte e quatro meses, o vocabul√°rio expande-se rapidamente e surgem as primeiras combina√ß√µes de duas palavras. Aos tr√™s anos, a crian√ßa deve produzir frases de tr√™s a quatro palavras e ser compreendida por pessoas fora do n√∫cleo familiar. A partir dos quatro anos, a estrutura morfossint√°tica torna-se progressivamente mais complexa. Atrasos nesses marcos devem ser investigados por fonoaudi√≥logo, com diferencia√ß√£o entre atraso simples de linguagem e transtorno espec√≠fico de linguagem.',
   questions:[
     {q:'Quando surgem as primeiras palavras com significado?',opts:['3 meses','6 meses','12 meses','18 meses'],correct:2},
     {q:'Aos 3 anos, a crian√ßa deve ser compreendida por quem?',opts:['Apenas pela m√£e','Apenas pela fam√≠lia pr√≥xima','Pessoas fora do n√∫cleo familiar','Apenas pelo fonoaudi√≥logo'],correct:2},
     {q:'O que diferencia atraso simples de transtorno espec√≠fico de linguagem?',opts:['A idade da crian√ßa','Investiga√ß√£o fonoaudiol√≥gica especializada','A intelig√™ncia da crian√ßa','O n√∫mero de palavras'],correct:1}
   ]}
],
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê N√çVEL 5 ¬∑ EXPERT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
5:[
  {id:'5a',name:'Epigen√©tica e Linguagem',words:162,
   title:'Epigen√©tica, Plasticidade Cerebral e Aquisi√ß√£o de Linguagem',subtitle:'N√≠vel 5 ¬∑ Expert ¬∑ Alta complexidade cient√≠fica',
   content:'A intersec√ß√£o entre epigen√©tica e neuroci√™ncia da linguagem tem revelado mecanismos surpreendentes pelos quais a experi√™ncia ambiental modula a express√£o g√™nica em circuitos neuronais subjacentes √† comunica√ß√£o humana. Processos epigen√©ticos como metila√ß√£o do DNA, modifica√ß√µes de histonas e regula√ß√£o por RNA n√£o codificante modulam a transcri√ß√£o de genes relacionados √† sinaptog√™nese e √† mieliniza√ß√£o em regi√µes como o giro frontal inferior, o plano temporal e o fasc√≠culo arqueado. Estudos longitudinais demonstram que a riqueza do input lingu√≠stico nos primeiros trinta e seis meses de vida produz modifica√ß√µes epigen√©ticas duradouras que influenciam trajet√≥rias de desenvolvimento fonol√≥gico, morfossint√°tico e lexical ao longo da escolariza√ß√£o. O fen√¥meno conhecido como per√≠odo cr√≠tico, durante o qual a plasticidade sin√°ptica est√° maximizada, √© parcialmente regulado pela express√£o de fatores de transcri√ß√£o como o FOXP2, cujas variantes al√©licas t√™m sido associadas a transtornos espec√≠ficos da linguagem e da apraxia verbal. As implica√ß√µes cl√≠nicas desse campo emergente para a interven√ß√£o fonoaudiol√≥gica precoce s√£o profundas: sugerem que o timing e a qualidade da estimula√ß√£o comunicativa na primeira inf√¢ncia transcendem o n√≠vel comportamental, operando em substratos moleculares com efeitos potencialmente transgeracionais documentados em modelos animais.',
   questions:[
     {q:'O gene FOXP2 est√° associado a qu√™?',opts:['Audi√ß√£o','Transtornos espec√≠ficos de linguagem','Disfagia','Voz'],correct:1},
     {q:'Qual per√≠odo √© cr√≠tico para a linguagem?',opts:['Dos 5 aos 10 anos','Primeiros 36 meses','Adolesc√™ncia','Vida adulta'],correct:1},
     {q:'O que √© o fasc√≠culo arqueado?',opts:['M√∫sculo lar√≠ngeo','Regi√£o de conex√£o cerebral para linguagem','Estrutura do ouvido m√©dio','Gl√¢ndula salivar'],correct:1}
   ]},
  {id:'5b',name:'Neurobiologia da Gagueira',words:158,
   title:'Neurobiologia da Gagueira: Da Disfun√ß√£o √† Interven√ß√£o',subtitle:'N√≠vel 5 ¬∑ Expert ¬∑ Fonoaudiologia avan√ßada ¬∑ Literatura internacional',
   content:'A gagueira desenvolvimental persistente tem substrato neurobiol√≥gico bem estabelecido, evidenciado por d√©cadas de estudos de neuroimagem funcional e estrutural convergentes. Metan√°lises de exames por resson√¢ncia magn√©tica funcional demonstram consistentemente hipoativa√ß√£o do giro frontal inferior esquerdo, especialmente da √°rea de Broca, e hiperativa√ß√£o hom√≥loga direita durante a fala espont√¢nea, sugerindo atipicidade na lateraliza√ß√£o hemisf√©rica do processamento motor da fala. Anormalidades na subst√¢ncia branca do fasc√≠culo arqueado, do fasc√≠culo frontal orbital e das vias corticoespinhais foram identificadas por estudos de tensor de difus√£o, indicando comprometimento na transmiss√£o de sinal entre regi√µes de planejamento e execu√ß√£o motora da fala. A dopamina desempenha papel modulat√≥rio relevante nessa fisiopatologia, explicando a efic√°cia parcial de agentes antidopamin√©rgicos em subgrupos espec√≠ficos de pessoas que gaguejam. A abordagem terap√™utica contempor√¢nea, fundamentada nas terapias de regula√ß√£o da flu√™ncia combinadas com as abordagens de aceita√ß√£o e comprometimento, reconhece que os desfechos em qualidade de vida e participa√ß√£o comunicativa s√£o superiores ao crit√©rio hist√≥rico de supress√£o exclusiva de disflu√™ncias, demandando compet√™ncias integradas em neurocogni√ß√£o e psicologia da identidade.',
   questions:[
     {q:'O que demonstram as metan√°lises de fMRI na gagueira?',opts:['Hiperativa√ß√£o bilateral','Hipoativa√ß√£o do giro frontal esquerdo','Altera√ß√£o no cerebelo','Aumento do hipocampo'],correct:1},
     {q:'Qual neurotransmissor √© modulat√≥rio na gagueira?',opts:['Serotonina','Glutamato','Dopamina','GABA'],correct:2},
     {q:'O que a abordagem ACT prioriza na gagueira?',opts:['Supress√£o de disflu√™ncias','Qualidade de vida e participa√ß√£o comunicativa','Medica√ß√£o antidopamin√©rgica','An√°lise ac√∫stica'],correct:1}
   ]},
  {id:'5c',name:'Presbifonia e Envelhecimento',words:155,
   title:'Presbifonia: Altera√ß√µes Vocais no Envelhecimento',subtitle:'N√≠vel 5 ¬∑ Expert ¬∑ Gerontologia ¬∑ Fonoaudiologia ¬∑ Texto t√©cnico',
   content:'A presbifonia designa as altera√ß√µes vocais decorrentes do processo fisiol√≥gico de envelhecimento lar√≠ngeo, distinguindo-se das disfonias de etiologia patol√≥gica por sua natureza progressiva e multifatorial. As altera√ß√µes morfol√≥gicas subjacentes incluem atrofia das fibras musculares da camada muscular das pregas vocais, calcifica√ß√£o das cartilagens lar√≠ngeas, altera√ß√µes na l√¢mina pr√≥pria e ressecamento das mucosas por redu√ß√£o da produ√ß√£o glandular. Do ponto de vista perceptivo-auditivo, a presbifonia manifesta-se por voz tr√™mula, soprosa, redu√ß√£o da intensidade vocal e restri√ß√£o da extens√£o fonat√≥ria. Os par√¢metros ac√∫sticos t√≠picos incluem eleva√ß√£o do jitter e shimmer, redu√ß√£o da propor√ß√£o harm√¥nico-ru√≠do e instabilidade da frequ√™ncia fundamental. A diferencia√ß√£o entre presbifonia fisiol√≥gica e patologias superimpostas, como paralisia de prega vocal, les√µes benignas ou malignas, exige videoestroboscopia lar√≠ngea. A terapia vocal na presbifonia tem como objetivos funcionais a otimiza√ß√£o do suporte respirat√≥rio, o aumento do esfor√ßo gl√≥tico e a reorganiza√ß√£o da biomec√¢nica fonat√≥ria, com evid√™ncias crescentes de reversibilidade parcial das altera√ß√µes musculares por meio do exerc√≠cio vocal sistematizado.',
   questions:[
     {q:'O que √© presbifonia?',opts:['Altera√ß√£o vocal por les√£o lar√≠ngea','Altera√ß√£o vocal fisiol√≥gica pelo envelhecimento','Disfonia por uso excessivo da voz','Paralisia de prega vocal'],correct:1},
     {q:'O que √© calcifica√ß√£o das cartilagens lar√≠ngeas?',opts:['Processo inflamat√≥rio','Altera√ß√£o estrutural do envelhecimento','Tumor benigno','Rea√ß√£o al√©rgica'],correct:1},
     {q:'Qual exame diferencia presbifonia de patologias superimpostas?',opts:['Resson√¢ncia magn√©tica','Tomografia','Videoestroboscopia lar√≠ngea','Audiometria'],correct:2}
   ]},
  {id:'5d',name:'Processamento Auditivo Central',words:160,
   title:'Transtorno do Processamento Auditivo Central: Diagn√≥stico e Interven√ß√£o',subtitle:'N√≠vel 5 ¬∑ Expert ¬∑ Audiologia ¬∑ Processamento auditivo',
   content:'O transtorno do processamento auditivo central, designado pela sigla TPAC, caracteriza-se por dificuldades no processamento das informa√ß√µes ac√∫sticas pelo sistema nervoso auditivo central, na presen√ßa de limiares auditivos perif√©ricos dentro dos padr√µes de normalidade. O diagn√≥stico diferencial entre TPAC e outros transtornos do neurodesenvolvimento, como o transtorno do d√©ficit de aten√ß√£o e hiperatividade e o transtorno do espectro autista, representa um dos maiores desafios cl√≠nicos contempor√¢neos, dado que esses quadros compartilham manifesta√ß√µes funcionais e podem coexistir. A avalia√ß√£o do processamento auditivo central inclui testes comportamentais de escuta dic√≥tica, resolu√ß√£o temporal, localiza√ß√£o sonora e processamento de padr√µes tonais e de dura√ß√£o. Testes eletrofisiol√≥gicos como o potencial evocado auditivo de longa lat√™ncia e o mismatch negativity fornecem dados objetivos sobre o processamento cortical do est√≠mulo ac√∫stico. As abordagens de interven√ß√£o incluem terapia fonoaudiol√≥gica direta com treino auditivo formal, modifica√ß√µes ambientais para melhora do campo ac√∫stico e o uso de sistemas de frequ√™ncia modulada em contextos educacionais. A plasticidade auditiva cortical fornece o substrato neurobiol√≥gico para os efeitos do tratamento.',
   questions:[
     {q:'O que caracteriza o TPAC?',opts:['Surdez perif√©rica','Dificuldade no processamento central com audi√ß√£o perif√©rica normal','Perda auditiva condutiva','Altera√ß√£o do nervo auditivo'],correct:1},
     {q:'O que avalia o teste de escuta dic√≥tica?',opts:['Limiares de audi√ß√£o pura','Processamento de sons em ambas as orelhas simultaneamente','Reflexo c√≥cleo-palpebral','Emiss√µes otoac√∫sticas'],correct:1},
     {q:'O que fornece substrato para os efeitos do tratamento do TPAC?',opts:['Medica√ß√£o espec√≠fica','Cirurgia lar√≠ngea','Plasticidade auditiva cortical','Amplifica√ß√£o sonora'],correct:2}
   ]}
],
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê N√çVEL 6 ¬∑ EXTREMO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
6:[
  {id:'6a',name:'Fonologia Extrema',words:143,
   title:'Processamento Fonol√≥gico em Transtornos Complexos da Comunica√ß√£o',subtitle:'N√≠vel 6 ¬∑ EXTREMO ¬∑ Articula√ß√£o m√°xima ¬∑ Trava-l√≠nguas cl√≠nicos',
   content:'O fonoaudi√≥logo, avaliando a fonoarticula√ß√£o do paciente, solicitou: "Pronuncie pseudopalavras polisil√°bicas: frangip√¢nzila, xifop√°gio, estrelitzia, psicotronismo, zaraguat√£o, esternocleidomastoideo, feocromocitoma, hepatoesplenomegalia." O processamento fonol√≥gico suprassegmental pressup√µe representa√ß√µes lexicais especificadas com tra√ßos distintivos de sonoridade, vozeamento, ponto e modo de articula√ß√£o precisa. Fricativas sibilantes interdentais, africadas palatoalveolares, consoantes nasais velares: cada fonema demanda coordena√ß√£o neuromuscular entre laringe, v√©u palatino, l√≠ngua √°pice e dorso, e l√°bios. Transtornos fonol√≥gicos inconsistentes caracterizam-se por variabilidade imprevis√≠vel nos padr√µes de erro, distinguindo-se da dispraxia verbal desenvolvimental pela preserva√ß√£o relativa da praxis n√£o-verbal orofacial. A estimulabilidade para sons-alvo ausentes do invent√°rio fonol√≥gico prediz o progn√≥stico terap√™utico com razo√°vel precis√£o. Avalie: "O peito-azul-grande piou para o pica-pau-an√£o que protegia seus pintinhos no p√© do ip√™-de-jardim purp√∫reo." Respire, controle o fluxo expirat√≥rio subgl√≥tico, coordene a fona√ß√£o com a articula√ß√£o supragl√≥tica.',
   questions:[
     {q:'O que distingue o transtorno fonol√≥gico inconsistente da dispraxia?',opts:['Maior n√∫mero de erros','Preserva√ß√£o relativa da praxis n√£o-verbal','Altera√ß√£o na voz','Comprometimento auditivo'],correct:1},
     {q:'O que √© estimulabilidade?',opts:['Capacidade de imitar sons com modelo','For√ßa muscular da l√≠ngua','Discrimina√ß√£o auditiva','Velocidade de fala'],correct:0},
     {q:'Quais tra√ßos distintivos s√£o citados?',opts:['Tom e ritmo','Sonoridade, vozeamento, ponto e modo','Frequ√™ncia e amplitude','Jitter e shimmer'],correct:1}
   ]},
  {id:'6b',name:'Texto Multissist√™mico',words:158,
   title:'Avalia√ß√£o Multidimensional dos Subsistemas da Fala',subtitle:'N√≠vel 6 ¬∑ EXTREMO ¬∑ Pros√≥dia ¬∑ Articula√ß√£o ¬∑ Flu√™ncia ¬∑ Voz ¬∑ Cogni√ß√£o',
   content:'Subsistemas da fala ‚Äî respira√ß√£o, fona√ß√£o, resson√¢ncia, articula√ß√£o, pros√≥dia ‚Äî operam em sinergia neuromuscular que pressup√µe integridade dos nervos cranianos cinco, sete, nove, dez, onze e doze, do nervo fr√™nico e dos nervos intercostais. Leia em voz alta mantendo qualidade vocal, taxa de fala adequada e pros√≥dia expressiva variada: pseudopseudohipoparatiroidismo, esternocleidomastoideo, hepatoesplenomegalia, feocromocitoma, pneumonoultramicroscopicosilicovolcanoconiose. Agora com √™nfase expressiva e entoa√ß√£o ascendente-descendente: "O xenof√≥bico xerife extraordinariamente exc√™ntrico exigiu que expulsassem extemporaneamente os exploradores estrangeiros experientes." Com ritmo metricamente regular: "Tr√™s pratos de trigo para tr√™s tigres tristes e magros." Mais complexo ainda: "O rato roeu a roupa do rei de Roma enquanto a rainha com raiva rasgava o restante." Avalie agora sua pr√≥pria pros√≥dia: variou adequadamente o tom? Manteve a velocidade regular? Controlou pausas sint√°ticas? A leitura oral de textos tecnicamente densos exige integra√ß√£o simult√¢nea entre processamento fonol√≥gico, morfossint√°tico, sem√¢ntico e pragm√°tico.',
   questions:[
     {q:'Quantos subsistemas da fala s√£o citados?',opts:['3','4','5','6'],correct:2},
     {q:'Quais nervos cranianos s√£o mencionados?',opts:['1,2,3,4,5','5,7,9,10,11,12','3,4,5,6,7,8','7,8,9,10,11,12'],correct:1},
     {q:'O que a leitura de textos densos exige?',opts:['Apenas mem√≥ria','Integra√ß√£o de m√∫ltiplos processamentos simult√¢neos','Velocidade m√°xima','Apenas articula√ß√£o'],correct:1}
   ]},
  {id:'6c',name:'Disfun√ß√µes Neuromotoras da Fala',words:165,
   title:'Disartrias: Classifica√ß√£o Neuromotora e Biomec√¢nica da Fala Comprometida',subtitle:'N√≠vel 6 ¬∑ EXTREMO ¬∑ Neurologia ¬∑ Motricidade orofacial ¬∑ Densidade m√°xima',
   content:'As disartrias constituem um conjunto heterog√™neo de dist√∫rbios motores da fala decorrentes de les√µes do sistema nervoso central ou perif√©rico que afetam a execu√ß√£o neuromuscular dos subsistemas fonat√≥rio, articulat√≥rio, velofar√≠ngeo e respirat√≥rio. A classifica√ß√£o de Mayo, sistematizada por Darley, Aronson e Brown na d√©cada de sessenta, distingue seis subtipos: fl√°cida, esp√°stica, at√°xica, hipocin√©tica, hipercin√©tica e mista. A disartria fl√°cida resulta de les√£o do neur√¥nio motor inferior, caracterizando-se por hipotonia, flacidez muscular, voz soprosa, hipernasalidade e articula√ß√£o distorcida por redu√ß√£o da for√ßa muscular. A disartria esp√°stica, associada a les√µes bilaterais do neur√¥nio motor superior, apresenta hipertonia, voz for√ßada e estrangulada, articula√ß√£o imprecisa e taxa de fala reduzida. A disartria at√°xica, resultante de les√£o cerebelar, caracteriza-se por pros√≥dia irregular, articula√ß√£o explosiva e instabilidade de frequ√™ncia e intensidade. A avalia√ß√£o fonoaudiol√≥gica das disartrias utiliza protocolos como o Frenchay Dysarthria Assessment e exige an√°lise perceptivo-auditiva sistem√°tica aliada √† mensura√ß√£o ac√∫stica de par√¢metros como o Diadococinesia Articulat√≥ria, avaliado pela rapidez e regularidade de sequ√™ncias sil√°bicas repetidas como pataca e badaga.',
   questions:[
     {q:'Qual subclassifica√ß√£o resulta de les√£o do neur√¥nio motor inferior?',opts:['Esp√°stica','At√°xica','Fl√°cida','Hipocin√©tica'],correct:2},
     {q:'O que avalia a Diadococinesia Articulat√≥ria?',opts:['Qualidade vocal','Rapidez e regularidade de s√≠labas repetidas','Compreens√£o auditiva','Flu√™ncia'],correct:1},
     {q:'Qual sistema √© afetado na disartria at√°xica?',opts:['Neur√¥nio motor inferior','Sistema piramidal','Cerebelo','G√¢nglios da base'],correct:2}
   ]},
  {id:'6d',name:'Consci√™ncia Fonol√≥gica Avan√ßada',words:152,
   title:'Consci√™ncia Fonol√≥gica, Dislexia e Interven√ß√£o Neuropsicopedag√≥gica',subtitle:'N√≠vel 6 ¬∑ EXTREMO ¬∑ Leitura ¬∑ Fonologia ¬∑ Dislexia ¬∑ Neuropsicologia',
   content:'A consci√™ncia fonol√≥gica, entendida como a capacidade metalingu√≠stica de refletir e manipular os segmentos sonoros da fala, constitui o preditor mais robusto do sucesso na aprendizagem da leitura e da escrita em sistemas alfab√©ticos. Sua estrutura hier√°rquica compreende habilidades de consci√™ncia sil√°bica, intrassil√°bica e fon√™mica, sendo esta √∫ltima a mais relacionada √† decodifica√ß√£o grafof√¥nica. A dislexia desenvolvimental, classificada como transtorno espec√≠fico de aprendizagem com preju√≠zo na leitura no DSM-5 e na CID-11, manifesta-se por dificuldades persistentes e inesperadas na decodifica√ß√£o fonol√≥gica, na flu√™ncia leitora e na soletra√ß√£o, n√£o explicadas por d√©ficits intelectuais, sensoriais ou de oportunidade educacional. O modelo de dupla rota da leitura, proposto por Coltheart, distingue a via lexical ou visual, respons√°vel pelo reconhecimento global de palavras familiares, da via fonol√≥gica ou sublexical, utilizada para a decodifica√ß√£o de palavras desconhecidas e pseudopalavras. Interven√ß√µes fonoaudiol√≥gicas baseadas em evid√™ncia para dislexia incluem o treino expl√≠cito e sistematizado da consci√™ncia fon√™mica, combinado ao ensino da correspond√™ncia grafema-fonema e √† pr√°tica de leitura repetida cronometrada com feedback corretivo imediato, em frequ√™ncia m√≠nima de tr√™s a quatro sess√µes semanais para efeitos neuropl√°sticos mensur√°veis.',
   questions:[
     {q:'O que √© o preditor mais robusto de sucesso na leitura?',opts:['Mem√≥ria visual','Consci√™ncia fonol√≥gica','Vocabul√°rio oral','Intelig√™ncia geral'],correct:1},
     {q:'O que distingue a via lexical da via fonol√≥gica na leitura?',opts:['A velocidade de leitura','Lexical reconhece palavras familiares; fonol√≥gica decodifica novas','O tipo de letra usada','A compreens√£o do texto'],correct:1},
     {q:'Qual frequ√™ncia m√≠nima de interven√ß√£o √© recomendada para efeitos neuropl√°sticos?',opts:['1 vez por semana','2 vezes por semana','3 a 4 vezes por semana','Diariamente'],correct:2}
   ]}
]
};

const LVLNAMES = {1:'F√°cil',2:'M√©dio',3:'Dif√≠cil',4:'Avan√ßado',5:'Expert',6:'Extremo',custom:'Personalizado'};
const NORMAS_PPM = {
  1:{label:'N√≠vel 1 ‚Äì F√°cil',p25:55,p50:85,p75:115,refBR:'Capovilla et al., 2011 ‚Äì normas brasileiras'},
  2:{label:'N√≠vel 2 ‚Äì M√©dio',p25:75,p50:105,p75:135,refBR:'Alves & Capovilla, 2014'},
  3:{label:'N√≠vel 3 ‚Äì Dif√≠cil',p25:90,p50:120,p75:150,refBR:'Cunha & Capellini, 2016'},
  4:{label:'N√≠vel 4 ‚Äì Avan√ßado',p25:105,p50:135,p75:165,refBR:'Seabra & Navas, 2012'},
  5:{label:'N√≠vel 5 ‚Äì Expert',p25:115,p50:145,p75:180,refBR:'Stivanin & Scheuer, 2008'},
  6:{label:'N√≠vel 6 ‚Äì Extremo',p25:120,p50:150,p75:185,refBR:'Adaptado de normas internacionais'},
  custom:{label:'Personalizado',p25:90,p50:120,p75:150,refBR:'Sem norma de refer√™ncia'}
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let currentLevel = 1;
let currentText = null;
let timerInterval = null;
let elapsedSec = 0;
let timerRunning = false;
let timerStarted = false;
let markMode = 'error';
let wordElements = [];
let marks = {}; // idx -> type
let mediaRecorder = null;
let audioChunks = [];
let audioBlob = null;
let isRecording = false;
let fsFontSize_ = 26;
let comprehAnswers = {};
let sessionId = 'SES-' + Date.now().toString(36).toUpperCase().slice(0,8);
let customTexts = JSON.parse(localStorage.getItem('pb_custom') || '[]');

document.getElementById('sess-badge').textContent = sessionId;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PANEL NAVIGATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showPanel(id, btn) {
  document.querySelectorAll('.ttab').forEach(t => t.classList.remove('on'));
  btn.classList.add('on');
  document.getElementById('panel-avaliacao').style.display = id === 'avaliacao' ? 'flex' : 'none';
  document.getElementById('panel-historico').style.display = 'none';
  document.getElementById('panel-evolucao').style.display = 'none';
  if (id === 'historico') { document.getElementById('panel-historico').style.display = 'flex'; renderHistory(); }
  if (id === 'evolucao') { document.getElementById('panel-evolucao').style.display = 'flex'; renderEvolution(); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LEVEL + TEXT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function selectLevel(lvl, btn) {
  currentLevel = lvl;
  document.querySelectorAll('.lvl-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('text-list-section').style.display = lvl === 'custom' ? 'none' : 'block';
  document.getElementById('custom-form').style.display = lvl === 'custom' ? 'block' : 'none';
  if (lvl !== 'custom') renderTextList();
  selectText(null);
}

function renderTextList() {
  const texts = TEXTS[currentLevel] || [];
  document.getElementById('text-list-container').innerHTML = texts.map(t =>
    `<div class="text-item" id="ti-${t.id}" onclick="selectText('${t.id}')">
      <div class="text-item-name">${t.name}</div>
      <div class="text-item-meta">${t.words} palavras ¬∑ N√≠vel ${currentLevel}</div>
    </div>`
  ).join('');
}

function selectText(id) {
  resetTimer(); clearAll(); marks = {}; comprehAnswers = {};
  if (!id) {
    currentText = null;
    document.getElementById('empty-state').style.display = 'block';
    document.getElementById('text-content').style.display = 'none';
    document.getElementById('btn-start').disabled = true;
    document.getElementById('btn-fs').disabled = true;
    return;
  }
  const arr = TEXTS[currentLevel] || [];
  currentText = arr.find(t => t.id === id) || currentText;
  document.querySelectorAll('.text-item').forEach(el => el.classList.remove('selected'));
  const el = document.getElementById('ti-' + id);
  if (el) el.classList.add('selected');
  document.getElementById('empty-state').style.display = 'none';
  document.getElementById('text-content').style.display = 'block';
  document.getElementById('tc-title').textContent = currentText.title;
  document.getElementById('tc-sub').textContent = currentText.subtitle;
  document.getElementById('ann-notes').value = '';
  document.getElementById('audio-player').classList.remove('visible');
  audioBlob = null;
  renderWords();
  renderComprehension();
  document.getElementById('btn-start').disabled = false;
  document.getElementById('btn-fs').disabled = false;
  document.getElementById('btn-report').disabled = true;
}

function renderWords() {
  const container = document.getElementById('tc-words');
  wordElements = currentText.content.split(/\s+/);
  container.innerHTML = wordElements.map((w, i) =>
    `<span class="word" id="w${i}" onclick="markWord(${i})">${w}</span> `
  ).join('');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CUSTOM TEXT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function loadCustomText() {
  const title = document.getElementById('custom-title').value.trim() || 'Texto Personalizado';
  const body = document.getElementById('custom-body').value.trim();
  if (!body) return;
  currentText = {id:'custom_tmp',name:title,title,subtitle:'N√≠vel Personalizado',content:body,
    words:body.split(/\s+/).length,questions:[]};
  document.getElementById('empty-state').style.display = 'none';
  document.getElementById('text-content').style.display = 'block';
  document.getElementById('tc-title').textContent = title;
  document.getElementById('tc-sub').textContent = 'Texto personalizado ¬∑ ' + body.split(/\s+/).length + ' palavras';
  document.getElementById('compreh-section').innerHTML = '';
  marks = {}; comprehAnswers = {};
  resetTimer(); clearAll();
  renderWords();
  document.getElementById('btn-start').disabled = false;
  document.getElementById('btn-fs').disabled = false;
  document.getElementById('btn-report').disabled = true;
}

function saveCustomText() {
  const title = document.getElementById('custom-title').value.trim() || 'Texto Personalizado';
  const body = document.getElementById('custom-body').value.trim();
  if (!body) return;
  customTexts.push({id:'c'+Date.now(),name:title,title,subtitle:'Personalizado',content:body,words:body.split(/\s+/).length,questions:[]});
  localStorage.setItem('pb_custom', JSON.stringify(customTexts));
  alert('Texto salvo na biblioteca!');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   COMPREHENSION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderComprehension() {
  const qs = currentText.questions || [];
  if (!qs.length) { document.getElementById('compreh-section').innerHTML = ''; return; }
  document.getElementById('compreh-section').innerHTML = `
    <div class="compreh-section">
      <div class="compreh-title">Compreens√£o Leitora ‚Äî Responda ap√≥s a leitura</div>
      ${qs.map((q, qi) => `
        <div class="compreh-q">
          <div class="compreh-q-text"><strong>${qi+1}.</strong> ${q.q}</div>
          <div class="compreh-opts">
            ${q.opts.map((opt, oi) => `
              <div class="compreh-opt" id="opt-${qi}-${oi}" onclick="answerQ(${qi},${oi})">
                <span class="opt-letter">${['A','B','C','D'][oi]}</span> ${opt}
              </div>`).join('')}
          </div>
        </div>`).join('')}
      <div class="compreh-score" id="compreh-score" style="display:none"></div>
    </div>`;
}

function answerQ(qi, oi) {
  const q = currentText.questions[qi];
  comprehAnswers[qi] = oi;
  // Show feedback
  document.querySelectorAll(`[id^="opt-${qi}-"]`).forEach((el, idx) => {
    el.className = 'compreh-opt';
    if (idx === q.correct) el.classList.add('show-correct');
    if (idx === oi && oi !== q.correct) el.classList.add('selected-wrong');
    if (idx === oi && oi === q.correct) el.classList.add('selected-correct');
  });
  // Score
  const answered = Object.keys(comprehAnswers).length;
  const total = currentText.questions.length;
  if (answered === total) {
    const correct = Object.entries(comprehAnswers).filter(([qi, oi]) => oi === currentText.questions[qi].correct).length;
    const pct = Math.round((correct/total)*100);
    const el = document.getElementById('compreh-score');
    el.style.display = 'block';
    el.innerHTML = `Compreens√£o: <strong style="color:${pct>=80?'var(--grn)':pct>=60?'var(--amb)':'var(--red)'}">${correct}/${total} (${pct}%)</strong>`;
  }
}

function getComprehenionScore() {
  if (!currentText || !currentText.questions || !currentText.questions.length) return null;
  const total = currentText.questions.length;
  const answered = Object.keys(comprehAnswers).length;
  if (!answered) return null;
  const correct = Object.entries(comprehAnswers).filter(([qi, oi]) => Number(oi) === currentText.questions[Number(qi)].correct).length;
  return {correct, total, pct: Math.round((correct/total)*100)};
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MARKS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function setMark(mode) {
  markMode = mode;
  document.querySelectorAll('.mark-btn').forEach(b => b.classList.remove('active'));
  const map = {error:'mb-err',hesit:'mb-hes',subst:'mb-sub',omiss:'mb-omi',add:'mb-add'};
  if (map[mode]) document.getElementById(map[mode]).classList.add('active');
  if (mode === 'clear') document.querySelectorAll('.mark-btn.clr').forEach(b => b.classList.add('active'));
}

function markWord(idx) {
  idx = Number(idx); // SEMPRE n√∫mero para evitar bug de string vs n√∫mero
  const el = document.getElementById('w' + idx);
  if (!el) return;
  const typeClass = {error:'w-error',hesit:'w-hesit',subst:'w-subst',omiss:'w-omiss',add:'w-add'};
  if (markMode === 'clear') {
    delete marks[idx];
    el.className = 'word';
  } else {
    if (marks[idx] === markMode) {
      delete marks[idx];
      el.className = 'word';
    } else {
      marks[idx] = markMode;
      el.className = 'word ' + (typeClass[markMode] || '');
    }
  }
  updateMetrics();
}

function clearAll() {
  marks = {};
  // Resetar visualmente TODAS as palavras do texto atual
  const container = document.getElementById('tc-words');
  if (container) container.querySelectorAll('.word').forEach(el => { el.className = 'word'; });
  updateMetrics();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TIMER
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function startTimer() {
  if (!currentText) return;
  timerRunning = timerStarted = true;
  document.getElementById('btn-start').disabled = true;
  document.getElementById('btn-pause').disabled = false;
  document.getElementById('btn-stop').disabled = false;
  document.getElementById('timer-display').className = 'timer-display running';
  timerInterval = setInterval(() => { elapsedSec++; updateTimerDisplay(); updateMetrics(); }, 1000);
}
function pauseTimer() {
  if (!timerRunning) return;
  clearInterval(timerInterval); timerRunning = false;
  document.getElementById('btn-start').disabled = false;
  document.getElementById('btn-pause').disabled = true;
  document.getElementById('timer-display').className = 'timer-display';
}
function stopTimer() {
  clearInterval(timerInterval); timerRunning = false;
  document.getElementById('btn-start').disabled = true;
  document.getElementById('btn-pause').disabled = true;
  document.getElementById('btn-stop').disabled = true;
  document.getElementById('timer-display').className = 'timer-display stopped';
  if (timerStarted) document.getElementById('btn-report').disabled = false;
  // Stop recording too
  if (isRecording) toggleRecording();
  updateMetrics();
}
function resetTimer() {
  clearInterval(timerInterval); timerRunning = timerStarted = false; elapsedSec = 0;
  updateTimerDisplay();
  document.getElementById('timer-display').className = 'timer-display';
  document.getElementById('btn-start').disabled = !currentText;
  document.getElementById('btn-pause').disabled = true;
  document.getElementById('btn-stop').disabled = true;
  document.getElementById('btn-report').disabled = true;
  document.getElementById('m-wpm').textContent = '‚Äî';
  document.getElementById('m-accuracy').textContent = '‚Äî';
  document.getElementById('progress-fill').style.width = '0%';
}
function updateTimerDisplay() {
  const m = Math.floor(elapsedSec/60), s = elapsedSec%60;
  const str = String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
  document.getElementById('timer-display').textContent = str;
  document.getElementById('fs-timer').textContent = str;
}
function updateMetrics() {
  const vals = Object.values(marks);
  const errCnt = vals.filter(v => v === 'error').length;
  const hesCnt = vals.filter(v => v === 'hesit').length;
  const subCnt = vals.filter(v => v === 'subst').length;
  const omiCnt = vals.filter(v => v === 'omiss').length;
  const addCnt = vals.filter(v => v === 'add').length;
  const totalErr = errCnt + subCnt + omiCnt + addCnt; // hesita√ß√£o n√£o √© erro de precis√£o
  document.getElementById('m-errors').textContent = totalErr;
  document.getElementById('m-hesit').textContent = hesCnt;
  if (elapsedSec > 0 && currentText) {
    const total = wordElements.length;
    const wpm = Math.round((total / elapsedSec) * 60);
    const acc = Math.max(0, Math.round(((total - totalErr) / total) * 100));
    document.getElementById('m-wpm').textContent = wpm;
    document.getElementById('m-accuracy').textContent = acc + '%';
    const prog = Math.min(100, Math.round((elapsedSec / Math.max(30, elapsedSec)) * 100));
    document.getElementById('progress-fill').style.width = prog + '%';
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUDIO RECORDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
async function toggleRecording() {
  const btn = document.getElementById('btn-rec');
  const ind = document.getElementById('rec-ind');
  if (!isRecording) {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({audio:true});
      mediaRecorder = new MediaRecorder(stream);
      audioChunks = [];
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
      mediaRecorder.onstop = () => {
        audioBlob = new Blob(audioChunks, {type:'audio/webm'});
        const url = URL.createObjectURL(audioBlob);
        document.getElementById('audio-elem').src = url;
        document.getElementById('audio-player').classList.add('visible');
        stream.getTracks().forEach(t => t.stop());
      };
      mediaRecorder.start();
      isRecording = true;
      btn.classList.add('recording');
      btn.textContent = '‚èπ Parar Grav.';
      ind.classList.add('on');
    } catch(e) {
      alert('Microfone n√£o dispon√≠vel. Verifique as permiss√µes do navegador.');
    }
  } else {
    mediaRecorder.stop();
    isRecording = false;
    btn.classList.remove('recording');
    btn.textContent = '‚è∫ Gravar';
    ind.classList.remove('on');
  }
}
function deleteRecording() {
  audioBlob = null;
  document.getElementById('audio-elem').src = '';
  document.getElementById('audio-player').classList.remove('visible');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   FULLSCREEN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openFullscreen() {
  if (!currentText) return;
  document.getElementById('fs-title').textContent = currentText.title;
  document.getElementById('fs-text').textContent = currentText.content;
  document.getElementById('fs-text').style.fontSize = fsFontSize_ + 'px';
  document.getElementById('fs-overlay').classList.add('on');
  document.getElementById('fs-start-btn').textContent = timerRunning ? '‚è∏ Pausar' : '‚ñ∂ Iniciar';
}
function closeFullscreen() {
  document.getElementById('fs-overlay').classList.remove('on');
}
function fsToggleTimer() {
  if (timerRunning) { pauseTimer(); document.getElementById('fs-start-btn').textContent = '‚ñ∂ Retomar'; }
  else { startTimer(); document.getElementById('fs-start-btn').textContent = '‚è∏ Pausar'; }
}
function fsFontSize(delta) {
  fsFontSize_ = Math.max(16, Math.min(48, fsFontSize_ + delta));
  document.getElementById('fs-text').style.fontSize = fsFontSize_ + 'px';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   REPORT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openReport() {
  if (!currentText) return;
  buildReport();
  document.getElementById('report-modal').classList.add('open');
}
function closeReport() {
  document.getElementById('report-modal').classList.remove('open');
}

function buildReport() {
  const total = wordElements.length;
  const errCnt = Object.values(marks).filter(v=>'error'===v).length;
  const hesCnt = Object.values(marks).filter(v=>'hesit'===v).length;
  const subCnt = Object.values(marks).filter(v=>'subst'===v).length;
  const omiCnt = Object.values(marks).filter(v=>'omiss'===v).length;
  const addCnt = Object.values(marks).filter(v=>'add'===v).length;
  const totalErrors = errCnt + subCnt + omiCnt + addCnt;
  const wpm = elapsedSec > 0 ? Math.round((total/elapsedSec)*60) : 0;
  const accuracy = Math.round(((total-totalErrors)/total)*100);
  const hesRate = Math.round((hesCnt/total)*100);
  const errRate = Math.round((totalErrors/total)*100);
  const timeStr = String(Math.floor(elapsedSec/60)).padStart(2,'0') + ':' + String(elapsedSec%60).padStart(2,'0');

  const patName = document.getElementById('pat-name').value || '‚Äî';
  const patFono = document.getElementById('pat-fono').value || '‚Äî';
  const patDiag = document.getElementById('pat-diag').value || '‚Äî';
  const patEscola = document.getElementById('pat-escola').value || '‚Äî';
  const patDob = document.getElementById('pat-dob').value;
  const notes = document.getElementById('ann-notes').value;
  const vasPre = document.getElementById('vas-pre').value;
  const vasPost = document.getElementById('vas-post').value;
  const vasFat = document.getElementById('vas-fat').value;
  const compreh = getComprehenionScore();

  let ageStr = '‚Äî';
  if (patDob) { const age = Math.floor((new Date()-new Date(patDob))/31557600000); ageStr = age + ' anos'; }
  const today = new Date().toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric'});
  const hour = new Date().toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});

  // Classification
  const norm = NORMAS_PPM[currentLevel] || NORMAS_PPM[1];
  let classif, classifType, classifDesc;
  if (accuracy >= 97 && hesRate <= 2) { classif='N√≠vel Independente'; classifType='good'; classifDesc='Precis√£o excelente. O paciente l√™ com autonomia neste n√≠vel.'; }
  else if (accuracy >= 90) { classif='N√≠vel Instrucional'; classifType=''; classifDesc='Adequado para instru√ß√£o com suporte fonoaudiol√≥gico. Progress√£o indicada com monitoramento.'; }
  else if (accuracy >= 80) { classif='N√≠vel Frustracional'; classifType='warn'; classifDesc='Dificuldade significativa. Considerar redu√ß√£o do n√≠vel ou maior suporte terap√™utico.'; }
  else { classif='N√≠vel Cr√≠tico'; classifType='crit'; classifDesc='Dificuldade severa. Investiga√ß√£o aprofundada indicada. Considerar avalia√ß√£o multidisciplinar.'; }

  // WPM classification vs norms
  let wpmClass;
  if (wpm >= norm.p75) wpmClass = 'Acima do P75 (fluente)';
  else if (wpm >= norm.p50) wpmClass = 'P50‚ÄìP75 (adequado)';
  else if (wpm >= norm.p25) wpmClass = 'P25‚ÄìP50 (abaixo da m√©dia)';
  else wpmClass = 'Abaixo do P25 (lento)';

  // Intelligibility estimate
  const intelligibility = Math.max(0, Math.min(100, accuracy - (hesCnt * 0.5)));

  // Error words by type
  const errWords = Object.entries(marks).filter(([,v])=>v==='error').map(([i])=>wordElements[Number(i)]).filter(Boolean);
  const hesWords = Object.entries(marks).filter(([,v])=>v==='hesit').map(([i])=>wordElements[Number(i)]).filter(Boolean);
  const subWords = Object.entries(marks).filter(([,v])=>v==='subst').map(([i])=>wordElements[Number(i)]).filter(Boolean);
  const omiWords = Object.entries(marks).filter(([,v])=>v==='omiss').map(([i])=>wordElements[Number(i)]).filter(Boolean);
  const addWords = Object.entries(marks).filter(([,v])=>v==='add').map(([i])=>wordElements[Number(i)]).filter(Boolean);

  // Phonological analysis
  const allErrWords = [...errWords, ...subWords, ...omiWords];
  const fricCount = allErrWords.filter(w=>/[szxfv√ß]/i.test(w)).length;
  const polissil = allErrWords.filter(w=>w.replace(/[^aeiou√°√©√≠√≥√∫√¢√™√Æ√¥√ª√£√µ]/gi,'').length>=4).length;
  const clusters = allErrWords.filter(w=>/[bcdfghjklmnpqrstvwxyz]{3}/i.test(w)).length;
  const nasais = allErrWords.filter(w=>/[√£√µ]|[mn][aeiou]/i.test(w)).length;

  // Clinical impressions
  const impressions = [];
  if (accuracy >= 97) impressions.push({type:'good',t:`<strong>Precis√£o excelente (${accuracy}%):</strong> Taxa de erros compat√≠vel com leitura independente. Representa√ß√µes fonol√≥gicas e lexicais consolidadas para este n√≠vel.`});
  else if (accuracy >= 90) impressions.push({type:'',t:`<strong>Precis√£o adequada (${accuracy}%):</strong> N√≠vel instrucional. Erros pontuais podem refletir lacunas lexicais espec√≠ficas ou demanda cognitiva aumentada.`});
  else if (accuracy >= 80) impressions.push({type:'warn',t:`<strong>Precis√£o lim√≠trofe (${accuracy}%):</strong> Investigar processamento fonol√≥gico, decodifica√ß√£o grafema-fonema e mem√≥ria de trabalho verbal. Considerar rastreio de dislexia.`});
  else impressions.push({type:'crit',t:`<strong>Precis√£o cr√≠tica (${accuracy}%):</strong> Comprometimento funcional severo. Avalia√ß√£o multidisciplinar recomendada. Hip√≥teses: dislexia, transtorno fonol√≥gico, d√©ficit de linguagem.`});
  if (wpm >= norm.p75) impressions.push({type:'good',t:`<strong>Velocidade elevada (${wpm} PPM ‚â• P75):</strong> Acima da mediana normativa. Avaliar compreens√£o leitora ‚Äî velocidade elevada pode coexistir com d√©ficit de compreens√£o.`});
  else if (wpm >= norm.p50) impressions.push({type:'',t:`<strong>Velocidade adequada (${wpm} PPM, P50‚ÄìP75):</strong> Taxa de leitura oral dentro do esperado para o n√≠vel.`});
  else if (wpm >= norm.p25) impressions.push({type:'warn',t:`<strong>Velocidade reduzida (${wpm} PPM, P25‚ÄìP50):</strong> Abaixo da mediana. Verificar se h√° dificuldade de decodifica√ß√£o, aten√ß√£o ou estrat√©gias de autorregula√ß√£o excessiva.`});
  else impressions.push({type:'crit',t:`<strong>Velocidade muito reduzida (${wpm} PPM < P25):</strong> Clinicamente relevante. Investigar substrato neurol√≥gico e processamento fonol√≥gico de baixo n√≠vel.`});
  if (hesCnt > 0) impressions.push({type: hesRate > 10 ? 'crit' : 'warn', t:`<strong>Hesita√ß√µes (${hesCnt} ocorr√™ncias, ${hesRate}%):</strong> ${hesRate > 10 ? 'Alta taxa. Considerar investiga√ß√£o de gagueira, dispraxia verbal ou disflu√™ncias neurog√™nicas.' : 'Taxa moderada. Avaliar se h√° padr√£o consistente de palavras ou estruturas associadas √†s pausas.'}`});
  if (subCnt > 0) impressions.push({type:'warn',t:`<strong>Substitui√ß√µes (${subCnt}):</strong> Trocas de palavras podem indicar estrat√©gia de compensa√ß√£o lexical, paralexia sem√¢ntica ou processamento fonol√≥gico inconsistente.`});
  if (omiCnt > 0) impressions.push({type:'warn',t:`<strong>Omiss√µes (${omiCnt}):</strong> Omiss√£o de palavras pode refletir leitura preditiva com saltos, processamento sint√°tico insuficiente ou d√©ficit atencional.`});

  const vasDiff = parseInt(vasPost) - parseInt(vasPre);

  // Save to history
  saveSession({patName, patFono, patDiag, textTitle: currentText.title, level: currentLevel, wpm, accuracy, errCnt: totalErrors, hesCnt, wpmClass, classif, compreh, timeStr, vasPre, vasPost, vasFat, date: today, hour});

  document.getElementById('report-body').innerHTML = `
  <div class="r-section">
    <div class="r-sec-title">Identifica√ß√£o</div>
    <div class="r-grid3">
      <div class="rstat"><div class="rstat-val">${patName}</div><div class="rstat-lbl">Paciente</div></div>
      <div class="rstat"><div class="rstat-val">${ageStr}</div><div class="rstat-lbl">Idade</div></div>
      <div class="rstat"><div class="rstat-val">${today} ¬∑ ${hour}</div><div class="rstat-lbl">Data / Hora</div></div>
    </div>
    <div class="r-grid3">
      <div class="rstat"><div class="rstat-val">${patFono}</div><div class="rstat-lbl">Fonoaudi√≥logo(a)</div></div>
      <div class="rstat"><div class="rstat-val">${patEscola}</div><div class="rstat-lbl">Escolaridade</div></div>
      <div class="rstat"><div class="rstat-val">${patDiag || '‚Äî'}</div><div class="rstat-lbl">Diagn√≥stico / Hip√≥tese</div></div>
    </div>
    <div class="rstat" style="margin-top:7px">
      <div class="rstat-val" style="font-size:14px">${currentText.title}</div>
      <div class="rstat-lbl">Texto avaliado ¬∑ N√≠vel ${LVLNAMES[currentLevel]}</div>
    </div>
  </div>

  <div class="r-section">
    <div class="r-sec-title">Classifica√ß√£o Geral</div>
    <div class="classif-badge" style="color:${classifType==='good'?'var(--grn)':classifType==='warn'?'var(--amb)':classifType==='crit'?'var(--red)':'var(--cyan)'};border-color:${classifType==='good'?'rgba(0,229,160,.3)':classifType==='warn'?'rgba(255,179,64,.3)':classifType==='crit'?'rgba(255,79,107,.3)':'rgba(0,212,255,.3)'}">
      ‚óè ${classif} ¬∑ N√≠vel ${LVLNAMES[currentLevel]}
    </div>
    <div class="rblock ${classifType}">${classifDesc}</div>
  </div>

  <div class="r-section">
    <div class="r-sec-title">Indicadores Quantitativos</div>
    <div class="r-grid3">
      <div class="rstat"><div class="rstat-val">${wpm}<span class="rstat-unit">PPM</span></div><div class="rstat-lbl">Palavras por minuto</div></div>
      <div class="rstat"><div class="rstat-val">${accuracy}<span class="rstat-unit">%</span></div><div class="rstat-lbl">Precis√£o leitora</div></div>
      <div class="rstat"><div class="rstat-val">${timeStr}</div><div class="rstat-lbl">Tempo total</div></div>
    </div>
    <div class="r-grid3">
      <div class="rstat"><div class="rstat-val">${totalErrors}</div><div class="rstat-lbl">Total de erros</div></div>
      <div class="rstat"><div class="rstat-val">${hesCnt}</div><div class="rstat-lbl">Hesita√ß√µes</div></div>
      <div class="rstat"><div class="rstat-val">${Math.round(intelligibility)}<span class="rstat-unit">%</span></div><div class="rstat-lbl">Inteligibilidade est.</div></div>
    </div>
    ${buildBar('Precis√£o leitora', accuracy, 100, accuracy>=97?'var(--grn)':accuracy>=90?'var(--cyan)':accuracy>=80?'var(--amb)':'var(--red)', accuracy+'%')}
    ${buildBar('Velocidade vs. P50', Math.min(100,Math.round((wpm/(norm.p50||120))*100)), 100, wpm>=norm.p50?'var(--grn)':wpm>=norm.p25?'var(--amb)':'var(--red)', wpm+' PPM')}
    ${buildBar('Flu√™ncia (inv. hesita√ß√£o)', Math.max(0,100-(hesRate*5)), 100, hesRate<=2?'var(--grn)':hesRate<=8?'var(--amb)':'var(--red)', hesRate+'% hes.')}
    ${buildBar('Inteligibilidade estimada', Math.round(intelligibility), 100, intelligibility>=90?'var(--grn)':intelligibility>=75?'var(--amb)':'var(--red)', Math.round(intelligibility)+'%')}
  </div>

  <div class="r-section">
    <div class="r-sec-title">Compara√ß√£o com Normas Brasileiras</div>
    <table class="norma-table">
      <tr><th>Refer√™ncia</th><th>P25</th><th>P50 (mediana)</th><th>P75</th><th>Paciente</th></tr>
      <tr class="highlight">
        <td>${norm.label}</td>
        <td>${norm.p25} PPM</td>
        <td>${norm.p50} PPM</td>
        <td>${norm.p75} PPM</td>
        <td class="you">${wpm} PPM ¬∑ ${wpmClass}</td>
      </tr>
    </table>
    <div style="font-family:'IBM Plex Mono',monospace;font-size:7px;color:var(--t3);margin-top:5px;letter-spacing:1px">Ref: ${norm.refBR}</div>
  </div>

  <div class="r-section">
    <div class="r-sec-title">An√°lise por Tipo de Erro</div>
    <div class="r-grid3">
      <div class="rstat"><div class="rstat-val" style="color:var(--red)">${errCnt}</div><div class="rstat-lbl">Erros (geral)</div></div>
      <div class="rstat"><div class="rstat-val" style="color:var(--pur)">${subCnt}</div><div class="rstat-lbl">Substitui√ß√µes</div></div>
      <div class="rstat"><div class="rstat-val" style="color:var(--rose)">${omiCnt}</div><div class="rstat-lbl">Omiss√µes</div></div>
    </div>
    <div class="r-grid2">
      <div class="rstat"><div class="rstat-val" style="color:var(--amb)">${hesCnt}</div><div class="rstat-lbl">Hesita√ß√µes</div></div>
      <div class="rstat"><div class="rstat-val" style="color:var(--cyan)">${addCnt}</div><div class="rstat-lbl">Adi√ß√µes</div></div>
    </div>
    ${errWords.length ? `<div style="margin-top:8px"><div style="font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--red);margin-bottom:4px">ERROS</div><div>${errWords.map(w=>`<span class="etag err">${w}</span>`).join('')}</div></div>` : ''}
    ${hesWords.length ? `<div style="margin-top:6px"><div style="font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--amb);margin-bottom:4px">HESITA√á√ïES</div><div>${hesWords.map(w=>`<span class="etag hes">${w}</span>`).join('')}</div></div>` : ''}
    ${subWords.length ? `<div style="margin-top:6px"><div style="font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--pur);margin-bottom:4px">SUBSTITUI√á√ïES</div><div>${subWords.map(w=>`<span class="etag sub">${w}</span>`).join('')}</div></div>` : ''}
    ${omiWords.length ? `<div style="margin-top:6px"><div style="font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--rose);margin-bottom:4px">OMISS√ïES</div><div>${omiWords.map(w=>`<span class="etag omi">${w}</span>`).join('')}</div></div>` : ''}
    ${addWords.length ? `<div style="margin-top:6px"><div style="font-family:'IBM Plex Mono',monospace;font-size:8px;color:var(--cyan);margin-bottom:4px">ADI√á√ïES</div><div>${addWords.map(w=>`<span class="etag add">${w}</span>`).join('')}</div></div>` : ''}
    ${!totalErrors && !hesCnt ? '<div class="rblock good">Nenhum erro ou hesita√ß√£o registrado nesta sess√£o.</div>' : ''}
  </div>

  <div class="r-section">
    <div class="r-sec-title">An√°lise Fonol√≥gica Qualitativa</div>
    <div class="phono-grid">
      <div class="phono-item"><div class="phono-left"><div class="phono-name">Fricativas</div><div class="phono-sub">/s/, /z/, /f/, /v/, / É/, / í/</div></div><div class="phono-right" style="color:${fricCount>2?'var(--amb)':'var(--grn)'}">${fricCount}</div></div>
      <div class="phono-item"><div class="phono-left"><div class="phono-name">Poliss√≠labas</div><div class="phono-sub">4+ s√≠labas</div></div><div class="phono-right" style="color:${polissil>2?'var(--red)':'var(--grn)'}">${polissil}</div></div>
      <div class="phono-item"><div class="phono-left"><div class="phono-name">Grupos consonantais</div><div class="phono-sub">Encontros complexos</div></div><div class="phono-right" style="color:${clusters>1?'var(--amb)':'var(--grn)'}">${clusters}</div></div>
      <div class="phono-item"><div class="phono-left"><div class="phono-name">Vogais nasais</div><div class="phono-sub">/√£/, /√µ/ e variantes</div></div><div class="phono-right" style="color:${nasais>1?'var(--amb)':'var(--grn)'}">${nasais}</div></div>
    </div>
  </div>

  ${compreh ? `
  <div class="r-section">
    <div class="r-sec-title">Compreens√£o Leitora</div>
    <div class="compreh-report">
      <div class="compreh-report-score">
        <div class="compreh-report-val" style="color:${compreh.pct>=80?'var(--grn)':compreh.pct>=60?'var(--amb)':'var(--red)'}">${compreh.pct}%</div>
        <div class="compreh-report-lbl">${compreh.correct}/${compreh.total} quest√µes corretas</div>
      </div>
      <div class="rblock ${compreh.pct>=80?'good':compreh.pct>=60?'warn':'crit'}">
        ${compreh.pct>=80 ? 'Compreens√£o preservada. Leitura com decodifica√ß√£o e compreens√£o adequadas.' : compreh.pct>=60 ? 'Compreens√£o parcial. Pode indicar leitura decodificativa sem compreens√£o plena do texto.' : 'Compreens√£o comprometida. Investigar estrat√©gias de compreens√£o, vocabul√°rio e mem√≥ria de trabalho verbal.'}
      </div>
    </div>
  </div>` : ''}

  <div class="r-section">
    <div class="r-sec-title">Escala de Esfor√ßo Vocal (VAS 0‚Äì10)</div>
    <div class="r-grid3">
      <div class="rstat"><div class="rstat-val">${vasPre}<span class="rstat-unit">/10</span></div><div class="rstat-lbl">Esfor√ßo pr√©-leitura</div></div>
      <div class="rstat"><div class="rstat-val">${vasPost}<span class="rstat-unit">/10</span></div><div class="rstat-lbl">Esfor√ßo p√≥s-leitura</div></div>
      <div class="rstat"><div class="rstat-val" style="color:${vasDiff>3?'var(--red)':vasDiff>1?'var(--amb)':'var(--grn)'}">${vasDiff>0?'+':''}${vasDiff}</div><div class="rstat-lbl">Varia√ß√£o esfor√ßo</div></div>
    </div>
    <div class="rstat" style="margin-top:7px"><div class="rstat-val">${vasFat}<span class="rstat-unit">/10</span></div><div class="rstat-lbl">Fadiga vocal autorrelatada</div></div>
    ${vasDiff > 3 ? '<div class="rblock crit" style="margin-top:8px"><strong>Aumento significativo de esfor√ßo vocal:</strong> Delta ‚â•4 sugere tens√£o lar√≠ngea, uso vocal inadequado ou patologia subjacente. Indicado exame laringosc√≥pico.</div>' : vasDiff > 1 ? '<div class="rblock warn" style="margin-top:8px"><strong>Aumento moderado de esfor√ßo:</strong> Monitorar fadiga vocal em sess√µes prolongadas. Orientar higiene vocal.</div>' : '<div class="rblock good" style="margin-top:8px">Esfor√ßo vocal est√°vel. Sem sinais de fadiga vocal significativa nesta sess√£o.</div>'}
  </div>

  <div class="r-section">
    <div class="r-sec-title">Impress√£o Cl√≠nica</div>
    ${impressions.map(i => `<div class="rblock ${i.type}">${i.t}</div>`).join('')}
  </div>

  ${notes ? `
  <div class="r-section">
    <div class="r-sec-title">Observa√ß√µes do Fonoaudi√≥logo</div>
    <div class="rblock info">${notes.replace(/\n/g,'<br>')}</div>
  </div>` : ''}

  <div class="r-section">
    <div class="r-sec-title">Recomenda√ß√µes Terap√™uticas</div>
    ${genRecs(accuracy, wpm, norm, hesRate, errRate, currentLevel, compreh).map(r=>`<div class="rblock ${r.type}"><strong>${r.title}:</strong> ${r.text}</div>`).join('')}
  </div>

  <div class="print-actions">
    <button class="print-btn blue" onclick="window.print()">üñ® Imprimir / PDF</button>
    <button class="print-btn green" onclick="exportTXT()">‚¨á Exportar TXT</button>
  </div>
  <div class="watermark">PHONOBASE 2.0 ¬∑ Protocolo de Avalia√ß√£o de Leitura Oral ¬∑ Sess√£o ${sessionId} ¬∑ ${today} ${hour}</div>
  `;
}

function buildBar(label, value, max, color, display) {
  const pct = Math.min(100, Math.max(0, Math.round((value/max)*100)));
  return `<div class="sbar-wrap">
    <div class="sbar-label"><span class="sbar-name">${label}</span><span class="sbar-val">${display}</span></div>
    <div class="sbar"><div class="sbar-fill" style="width:${pct}%;background:${color}"></div></div>
  </div>`;
}

function genRecs(accuracy, wpm, norm, hesRate, errRate, level, compreh) {
  const r = [];
  if (accuracy >= 97 && wpm >= norm.p50 && hesRate <= 2) r.push({type:'good',title:'Progress√£o',text:`Desempenho compat√≠vel com avan√ßo para N√≠vel ${Math.min(6,parseInt(level)+1)} (${LVLNAMES[Math.min(6,parseInt(level)+1)]}). Manter monitoramento longitudinal mensal.`});
  if (accuracy < 90) r.push({type:'warn',title:'Decodifica√ß√£o fonol√≥gica',text:'Aplicar protocolo de consci√™ncia fonol√≥gica. Investigar correspond√™ncia grafema-fonema. Considerar avalia√ß√£o neuropsicol√≥gica e rastreio de dislexia com testes padronizados (TCLPP, PROLEC-R adaptado).'});
  if (wpm < norm.p25) r.push({type:'crit',title:'Flu√™ncia leitora',text:'Implementar Leitura Repetida Cronometrada (3x por semana). Registrar PPM semanalmente. Grafique a curva de progresso. Investigar processamento fonol√≥gico de baixo n√≠vel.'});
  if (hesRate > 8) r.push({type:'warn',title:'Avalia√ß√£o de flu√™ncia',text:'Alta taxa de hesita√ß√£o. Aplicar SSI-4 (Stuttering Severity Instrument). Diferenciar disflu√™ncias t√≠picas de at√≠picas. Investigar gagueira desenvolvimental ou neurog√™nica.'});
  if (compreh && compreh.pct < 70) r.push({type:'warn',title:'Compreens√£o leitora',text:'Trabalhar estrat√©gias metacognitivas de compreens√£o: ativa√ß√£o de conhecimento pr√©vio, infer√™ncia e monitoramento da compreens√£o. Aplicar Prova de Compreens√£o Leitora (PCL) padronizada.'});
  r.push({type:'',title:'Reavalia√ß√£o',text:`Reavaliar em ${accuracy<90?'1':'2'} semana(s) com texto alternativo do mesmo n√≠vel. Registrar PPM, precis√£o e hesita√ß√µes para constru√ß√£o do gr√°fico de evolu√ß√£o. Comparar com normas brasileiras por faixa et√°ria e escolaridade.`});
  return r;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   HISTORY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function saveSession(data) {
  const sessions = JSON.parse(localStorage.getItem('pb_sessions') || '[]');
  sessions.unshift({...data, id: Date.now()});
  if (sessions.length > 50) sessions.splice(50);
  localStorage.setItem('pb_sessions', JSON.stringify(sessions));
}

function renderHistory() {
  const sessions = JSON.parse(localStorage.getItem('pb_sessions') || '[]');
  const container = document.getElementById('history-list');
  if (!sessions.length) { container.innerHTML = '<div class="hist-empty">Nenhuma sess√£o salva ainda.<br>Complete uma avalia√ß√£o e abra o Relat√≥rio.</div>'; return; }
  container.innerHTML = sessions.map(s => `
    <div class="hist-card" id="hc-${s.id}">
      <div class="hist-card-header">
        <div class="hist-card-name">${s.patName || 'Paciente n√£o identificado'}</div>
        <div class="hist-card-date">${s.date} ¬∑ ${s.hour}</div>
      </div>
      <div class="hist-card-meta">
        <span class="hist-chip">${s.textTitle || '‚Äî'}</span>
        <span class="hist-chip">N√≠vel ${LVLNAMES[s.level] || s.level}</span>
        <span class="hist-chip ${s.classif==='N√≠vel Independente'?'good':s.classif==='N√≠vel Instrucional'?'':s.classif==='N√≠vel Frustracional'?'warn':'bad'}">${s.classif}</span>
      </div>
      <div class="hist-bars">
        <div class="hist-bar-item"><div class="hist-bar-val">${s.wpm}</div><div class="hist-bar-lbl">PPM</div></div>
        <div class="hist-bar-item"><div class="hist-bar-val">${s.accuracy}%</div><div class="hist-bar-lbl">Precis√£o</div></div>
        <div class="hist-bar-item"><div class="hist-bar-val">${s.errCnt}</div><div class="hist-bar-lbl">Erros</div></div>
      </div>
      <div class="hist-actions">
        <button class="hist-del" onclick="delSession(${s.id})">‚úï Excluir</button>
      </div>
    </div>`).join('');
}

function delSession(id) {
  let sessions = JSON.parse(localStorage.getItem('pb_sessions') || '[]');
  sessions = sessions.filter(s => s.id !== id);
  localStorage.setItem('pb_sessions', JSON.stringify(sessions));
  renderHistory();
  renderEvolution();
}
function clearHistory() {
  if (confirm('Excluir todo o hist√≥rico?')) { localStorage.removeItem('pb_sessions'); renderHistory(); renderEvolution(); }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EVOLUTION CHARTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderEvolution() {
  const sessions = JSON.parse(localStorage.getItem('pb_sessions') || '[]').reverse();
  const noData = document.getElementById('evo-no-data');
  if (!sessions.length) { noData.style.display = 'block'; return; }
  noData.style.display = 'none';

  const labels = sessions.map((s,i) => s.date ? s.date.slice(0,5) : 'S'+(i+1));
  const wpms = sessions.map(s => s.wpm);
  const accs = sessions.map(s => s.accuracy);
  const errs = sessions.map(s => s.errCnt);

  drawChart('evo-chart', labels, [
    {label:'PPM', data:wpms, color:'rgba(0,212,255,1)', fill:'rgba(0,212,255,0.1)'},
    {label:'Precis√£o %', data:accs, color:'rgba(0,229,160,1)', fill:'rgba(0,229,160,0.08)'}
  ], 'PPM e Precis√£o (%)');

  drawChart('evo-chart2', labels, [
    {label:'Erros', data:errs, color:'rgba(255,79,107,1)', fill:'rgba(255,79,107,0.1)'}
  ], 'Erros por Sess√£o');
}

function drawChart(canvasId, labels, datasets, title) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 600;
  const H = canvas.offsetHeight || 200;
  canvas.width = W; canvas.height = H;

  const pad = {top:32,right:20,bottom:36,left:44};
  const cW = W - pad.left - pad.right;
  const cH = H - pad.top - pad.bottom;

  ctx.clearRect(0,0,W,H);
  ctx.fillStyle = '#0e1118';
  ctx.fillRect(0,0,W,H);

  // Title
  ctx.fillStyle = '#4a566e';
  ctx.font = '10px IBM Plex Mono, monospace';
  ctx.fillText(title, pad.left, 18);

  if (!labels.length) return;

  // All values for scale
  const allVals = datasets.flatMap(d => d.data);
  const maxV = Math.max(...allVals, 10);
  const minV = 0;

  // Grid
  const steps = 4;
  for (let i = 0; i <= steps; i++) {
    const y = pad.top + cH - (i/steps)*cH;
    ctx.strokeStyle = 'rgba(255,255,255,0.05)';
    ctx.lineWidth = 1;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(pad.left+cW, y); ctx.stroke();
    ctx.fillStyle = '#252d3f';
    ctx.font = '9px IBM Plex Mono, monospace';
    ctx.fillText(Math.round(minV + (i/steps)*(maxV-minV)), 2, y+3);
  }

  // X labels
  labels.forEach((l, i) => {
    const x = pad.left + (i/(labels.length-1||1))*cW;
    ctx.fillStyle = '#252d3f';
    ctx.font = '8px IBM Plex Mono, monospace';
    ctx.fillText(l, x - 12, H - 8);
  });

  // Lines
  datasets.forEach(ds => {
    const pts = ds.data.map((v, i) => ({
      x: pad.left + (i/(labels.length-1||1))*cW,
      y: pad.top + cH - ((v-minV)/(maxV-minV))*cH
    }));

    // Fill
    ctx.beginPath();
    ctx.moveTo(pts[0].x, pad.top+cH);
    pts.forEach(p => ctx.lineTo(p.x, p.y));
    ctx.lineTo(pts[pts.length-1].x, pad.top+cH);
    ctx.closePath();
    ctx.fillStyle = ds.fill;
    ctx.fill();

    // Line
    ctx.beginPath();
    pts.forEach((p,i) => i===0 ? ctx.moveTo(p.x,p.y) : ctx.lineTo(p.x,p.y));
    ctx.strokeStyle = ds.color;
    ctx.lineWidth = 2;
    ctx.stroke();

    // Dots
    pts.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, 3, 0, Math.PI*2);
      ctx.fillStyle = ds.color;
      ctx.fill();
    });
  });
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EXPORT TXT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function exportTXT() {
  const body = document.getElementById('report-body');
  const text = body ? body.innerText : '';
  const blob = new Blob([text], {type:'text/plain;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'phonobase-relatorio-' + Date.now() + '.txt';
  a.click();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INIT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
selectLevel(1, document.querySelector('.lvl-btn[data-lvl="1"]'));
setMark('error');
document.getElementById('panel-avaliacao').style.display = 'flex';
document.getElementById('panel-historico').style.display = 'none';
document.getElementById('panel-evolucao').style.display = 'none';
</script>
</body>
</html>
