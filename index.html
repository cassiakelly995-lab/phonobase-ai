<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LeituraPRO ‚Äî Treine sua Leitura</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900;1,700&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&family=DM+Mono:wght@400;500&display=swap');

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #faf8f4;
  --paper: #fffef9;
  --ink: #1a1410;
  --ink2: #4a4030;
  --ink3: #9a8870;
  --line: #e8e0d0;
  --easy: #2d7a3a;
  --easy-bg: #eaf7ec;
  --medio: #b06a00;
  --medio-bg: #fff4e0;
  --dificil: #c0392b;
  --dificil-bg: #fdecea;
  --avancado: #6a1fc2;
  --avancado-bg: #f3eaff;
  --extremo: #0a0a0a;
  --extremo-bg: #1a1410;
  --accent: #e85d04;
  --accent-light: #fff0e8;
}

html { font-size: 15px; }

body {
  background: var(--bg);
  color: var(--ink);
  font-family: 'DM Sans', sans-serif;
  min-height: 100vh;
}

/* ---- TELA INICIAL ---- */
#screen-home, #screen-reading, #screen-result, #screen-custom {
  display: none;
  min-height: 100vh;
}
#screen-home.active, #screen-reading.active, #screen-result.active, #screen-custom.active {
  display: block;
}

/* TOP BAR */
.topbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 56px;
  background: rgba(250,248,244,0.92);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--line);
  display: flex;
  align-items: center;
  padding: 0 24px;
  gap: 16px;
  z-index: 100;
}

.brand {
  font-family: 'Playfair Display', serif;
  font-size: 1.2rem;
  font-weight: 900;
  color: var(--ink);
  letter-spacing: -0.02em;
}
.brand em { color: var(--accent); font-style: italic; }

.topbar-right {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 10px;
}

.btn {
  font-family: 'DM Sans', sans-serif;
  font-size: 0.8rem;
  font-weight: 600;
  padding: 8px 18px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  transition: all 0.18s;
  letter-spacing: 0.01em;
}
.btn-ghost {
  background: transparent;
  color: var(--ink2);
  border: 1.5px solid var(--line);
}
.btn-ghost:hover { border-color: var(--ink3); color: var(--ink); }

.btn-solid {
  background: var(--ink);
  color: #fff;
}
.btn-solid:hover { background: var(--accent); transform: translateY(-1px); }

.btn-accent {
  background: var(--accent);
  color: #fff;
  font-size: 0.9rem;
  padding: 12px 28px;
  border-radius: 10px;
}
.btn-accent:hover { background: #c44a00; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(232,93,4,0.3); }

/* ---- HOME ---- */
.home-wrap {
  padding-top: 80px;
  max-width: 900px;
  margin: 0 auto;
  padding-left: 24px;
  padding-right: 24px;
  padding-bottom: 60px;
}

.home-hero {
  text-align: center;
  padding: 48px 0 40px;
  border-bottom: 1px solid var(--line);
  margin-bottom: 36px;
}

.home-hero h1 {
  font-family: 'Playfair Display', serif;
  font-size: 3rem;
  font-weight: 900;
  letter-spacing: -0.04em;
  line-height: 1.1;
  margin-bottom: 14px;
}
.home-hero h1 em { color: var(--accent); font-style: italic; }

.home-hero p {
  font-size: 1rem;
  color: var(--ink2);
  font-weight: 300;
  max-width: 480px;
  margin: 0 auto 28px;
  line-height: 1.7;
}

.stats-row {
  display: flex;
  justify-content: center;
  gap: 32px;
  margin-top: 28px;
}
.stat-item { text-align: center; }
.stat-num {
  font-family: 'Playfair Display', serif;
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--ink);
  display: block;
}
.stat-label {
  font-size: 0.72rem;
  color: var(--ink3);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

/* Levels grid */
.section-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.4rem;
  font-weight: 700;
  letter-spacing: -0.02em;
  margin-bottom: 6px;
}
.section-sub {
  font-size: 0.82rem;
  color: var(--ink3);
  margin-bottom: 20px;
}

.levels-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  margin-bottom: 36px;
}

.level-card {
  border-radius: 12px;
  padding: 16px 12px;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.2s;
  text-align: center;
  position: relative;
  overflow: hidden;
}
.level-card.selected { border-width: 2px; transform: translateY(-3px); }
.level-card:hover { transform: translateY(-2px); }

.level-card.easy { background: var(--easy-bg); }
.level-card.easy.selected { border-color: var(--easy); box-shadow: 0 6px 20px rgba(45,122,58,0.15); }
.level-card.medio { background: var(--medio-bg); }
.level-card.medio.selected { border-color: var(--medio); box-shadow: 0 6px 20px rgba(176,106,0,0.15); }
.level-card.dificil { background: var(--dificil-bg); }
.level-card.dificil.selected { border-color: var(--dificil); box-shadow: 0 6px 20px rgba(192,57,43,0.15); }
.level-card.avancado { background: var(--avancado-bg); }
.level-card.avancado.selected { border-color: var(--avancado); box-shadow: 0 6px 20px rgba(106,31,194,0.15); }
.level-card.extremo { background: var(--extremo-bg); }
.level-card.extremo.selected { border-color: #555; box-shadow: 0 6px 20px rgba(0,0,0,0.3); }

.level-emoji { font-size: 1.6rem; display: block; margin-bottom: 6px; }
.level-name {
  font-weight: 600;
  font-size: 0.8rem;
  display: block;
  margin-bottom: 3px;
}
.level-card.easy .level-name { color: var(--easy); }
.level-card.medio .level-name { color: var(--medio); }
.level-card.dificil .level-name { color: var(--dificil); }
.level-card.avancado .level-name { color: var(--avancado); }
.level-card.extremo .level-name { color: #fff; }
.level-card.extremo .level-desc { color: #888; }

.level-desc {
  font-size: 0.68rem;
  color: var(--ink3);
  line-height: 1.3;
}

/* Text selector */
.text-selector {
  background: var(--paper);
  border: 1px solid var(--line);
  border-radius: 14px;
  overflow: hidden;
  margin-bottom: 20px;
}

.text-tabs {
  display: flex;
  border-bottom: 1px solid var(--line);
  background: var(--bg);
}
.text-tab {
  padding: 12px 20px;
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--ink3);
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.15s;
  white-space: nowrap;
}
.text-tab.active {
  color: var(--ink);
  border-bottom-color: var(--accent);
  background: var(--paper);
}

.text-tab-content { display: none; padding: 16px; }
.text-tab-content.active { display: block; }

.text-list { display: flex; flex-direction: column; gap: 8px; }

.text-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  border-radius: 10px;
  border: 1.5px solid transparent;
  cursor: pointer;
  transition: all 0.18s;
  background: var(--bg);
}
.text-item:hover { border-color: var(--line); background: var(--paper); }
.text-item.selected { border-color: var(--accent); background: var(--accent-light); }

.text-item-badge {
  font-size: 0.62rem;
  font-weight: 600;
  padding: 3px 8px;
  border-radius: 20px;
  white-space: nowrap;
  flex-shrink: 0;
  font-family: 'DM Mono', monospace;
}
.badge-easy { background: var(--easy-bg); color: var(--easy); }
.badge-medio { background: var(--medio-bg); color: var(--medio); }
.badge-dificil { background: var(--dificil-bg); color: var(--dificil); }
.badge-avancado { background: var(--avancado-bg); color: var(--avancado); }
.badge-extremo { background: #1a1410; color: #ccc; }

.text-item-info { flex: 1; }
.text-item-title {
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 2px;
}
.text-item-meta {
  font-size: 0.7rem;
  color: var(--ink3);
  font-family: 'DM Mono', monospace;
}

/* Custom textarea */
.custom-area {
  width: 100%;
  min-height: 160px;
  border: 1.5px solid var(--line);
  border-radius: 10px;
  padding: 14px;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.9rem;
  color: var(--ink);
  background: var(--paper);
  resize: vertical;
  transition: border-color 0.15s;
  outline: none;
  line-height: 1.6;
}
.custom-area:focus { border-color: var(--accent); }
.custom-area::placeholder { color: var(--ink3); }

.custom-meta {
  display: flex;
  gap: 12px;
  margin-top: 10px;
  align-items: center;
}
.custom-input {
  border: 1.5px solid var(--line);
  border-radius: 8px;
  padding: 8px 12px;
  font-family: 'DM Sans', sans-serif;
  font-size: 0.82rem;
  color: var(--ink);
  background: var(--paper);
  outline: none;
  flex: 1;
}
.custom-input:focus { border-color: var(--accent); }

.char-count {
  font-size: 0.72rem;
  color: var(--ink3);
  font-family: 'DM Mono', monospace;
  margin-left: auto;
}

.start-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-top: 8px;
}

/* ---- READING SCREEN ---- */
.reading-wrap {
  padding-top: 56px;
  max-width: 760px;
  margin: 0 auto;
  padding-left: 24px;
  padding-right: 24px;
}

.reading-header {
  padding: 20px 0 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--line);
  margin-bottom: 24px;
}

.reading-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.timer-display {
  font-family: 'DM Mono', monospace;
  font-size: 2.2rem;
  font-weight: 500;
  color: var(--ink);
  letter-spacing: -0.02em;
  min-width: 110px;
}
.timer-display.running { color: var(--accent); }
.timer-display.paused { color: var(--ink3); }

.timer-controls { display: flex; gap: 8px; align-items: center; }

.ctrl {
  border: none;
  cursor: pointer;
  border-radius: 8px;
  font-family: 'DM Sans', sans-serif;
  font-weight: 600;
  font-size: 0.78rem;
  padding: 8px 16px;
  transition: all 0.15s;
}
.ctrl-start { background: var(--accent); color: #fff; }
.ctrl-start:hover { background: #c44a00; }
.ctrl-pause { background: var(--line); color: var(--ink2); }
.ctrl-pause:hover { background: #ddd; }
.ctrl-stop { background: var(--dificil-bg); color: var(--dificil); border: 1.5px solid var(--dificil); }
.ctrl-stop:hover { background: var(--dificil); color: #fff; }

.reading-meta {
  display: flex;
  gap: 20px;
  font-size: 0.72rem;
  color: var(--ink3);
  font-family: 'DM Mono', monospace;
}

/* Text display area */
.reading-level-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 0.72rem;
  font-weight: 600;
  padding: 4px 12px;
  border-radius: 20px;
  margin-bottom: 16px;
  font-family: 'DM Mono', monospace;
}

.text-title-display {
  font-family: 'Playfair Display', serif;
  font-size: 1.6rem;
  font-weight: 700;
  letter-spacing: -0.02em;
  margin-bottom: 20px;
  line-height: 1.2;
}

.text-body {
  font-family: 'DM Sans', sans-serif;
  font-size: 1.05rem;
  line-height: 1.9;
  color: var(--ink);
  font-weight: 300;
  padding-bottom: 80px;
  user-select: none;
}
.text-body.level-extremo {
  font-size: 0.9rem;
  line-height: 1.7;
  font-weight: 400;
}

/* Progress bar */
.progress-bar-wrap {
  position: fixed;
  top: 56px;
  left: 0; right: 0;
  height: 3px;
  background: var(--line);
  z-index: 99;
}
.progress-bar-fill {
  height: 100%;
  background: var(--accent);
  transition: width 0.3s;
  width: 0%;
}

/* ---- RESULT SCREEN ---- */
.result-wrap {
  padding-top: 80px;
  max-width: 760px;
  margin: 0 auto;
  padding-left: 24px;
  padding-right: 24px;
  padding-bottom: 60px;
}

.result-hero {
  text-align: center;
  padding: 36px 0 32px;
  border-bottom: 1px solid var(--line);
  margin-bottom: 32px;
}

.result-grade {
  font-family: 'Playfair Display', serif;
  font-size: 5rem;
  font-weight: 900;
  letter-spacing: -0.05em;
  line-height: 1;
  margin-bottom: 8px;
}

.result-label {
  font-size: 1rem;
  color: var(--ink2);
  font-weight: 300;
}

.result-cards {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
  margin-bottom: 28px;
}

.result-card {
  background: var(--paper);
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 18px 14px;
  text-align: center;
}

.result-card-val {
  font-family: 'Playfair Display', serif;
  font-size: 1.8rem;
  font-weight: 700;
  letter-spacing: -0.03em;
  margin-bottom: 4px;
  display: block;
}

.result-card-label {
  font-size: 0.7rem;
  color: var(--ink3);
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

/* WPM gauge */
.wpm-gauge {
  background: var(--paper);
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 20px;
}

.gauge-title {
  font-weight: 600;
  font-size: 0.85rem;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.gauge-scale {
  position: relative;
  height: 40px;
}
.gauge-track {
  height: 10px;
  border-radius: 6px;
  background: linear-gradient(to right, var(--easy-bg) 0%, var(--easy) 20%, var(--medio) 40%, var(--dificil) 60%, var(--avancado) 80%, #000 100%);
  position: relative;
  margin-top: 14px;
}
.gauge-marker {
  position: absolute;
  top: -14px;
  transform: translateX(-50%);
  transition: left 1s cubic-bezier(0.34,1.56,0.64,1);
}
.gauge-arrow {
  width: 0; height: 0;
  border-left: 7px solid transparent;
  border-right: 7px solid transparent;
  border-top: 10px solid var(--accent);
  margin: 0 auto;
}
.gauge-marker-val {
  font-family: 'DM Mono', monospace;
  font-size: 0.7rem;
  font-weight: 500;
  white-space: nowrap;
  text-align: center;
  color: var(--accent);
  margin-bottom: 2px;
}
.gauge-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 6px;
  font-size: 0.62rem;
  color: var(--ink3);
  font-family: 'DM Mono', monospace;
}

/* Analysis */
.analysis-box {
  background: var(--paper);
  border: 1px solid var(--line);
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 20px;
}
.analysis-box h3 {
  font-family: 'Playfair Display', serif;
  font-size: 1.1rem;
  font-weight: 700;
  margin-bottom: 16px;
}
.analysis-item {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 10px 0;
  border-bottom: 1px solid var(--line);
  font-size: 0.84rem;
  line-height: 1.5;
  color: var(--ink2);
}
.analysis-item:last-child { border-bottom: none; }
.analysis-icon { font-size: 1rem; flex-shrink: 0; margin-top: 1px; }

.result-actions {
  display: flex;
  gap: 10px;
  justify-content: center;
  padding-top: 8px;
}

/* ---- HISTORY ---- */
.history-list { display: flex; flex-direction: column; gap: 8px; }
.history-item {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 12px 16px;
  background: var(--paper);
  border: 1px solid var(--line);
  border-radius: 10px;
  font-size: 0.82rem;
}
.history-wpm {
  font-family: 'Playfair Display', serif;
  font-size: 1.3rem;
  font-weight: 700;
  min-width: 60px;
}
.history-info { flex: 1; }
.history-title { font-weight: 500; margin-bottom: 2px; }
.history-meta { font-size: 0.7rem; color: var(--ink3); font-family: 'DM Mono', monospace; }
.history-grade {
  font-size: 0.7rem;
  font-weight: 700;
  padding: 3px 10px;
  border-radius: 20px;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--ink);
  color: #fff;
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 0.82rem;
  font-weight: 500;
  z-index: 999;
  transform: translateY(80px);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
.toast.show { transform: translateY(0); opacity: 1; }

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}
.result-card { animation: fadeIn 0.4s ease both; }
.result-card:nth-child(1){animation-delay:0.05s}
.result-card:nth-child(2){animation-delay:0.1s}
.result-card:nth-child(3){animation-delay:0.15s}
.result-card:nth-child(4){animation-delay:0.2s}

/* Responsive */
@media(max-width:650px) {
  .levels-grid { grid-template-columns: repeat(3,1fr); }
  .result-cards { grid-template-columns: repeat(2,1fr); }
  .home-hero h1 { font-size: 2rem; }
  .timer-display { font-size: 1.6rem; }
}
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- ===== HOME ===== -->
<div id="screen-home" class="active">
  <div class="topbar">
    <div class="brand">Leitura<em>PRO</em></div>
    <div class="topbar-right">
      <button class="btn btn-ghost" onclick="showHistory()">üìä Hist√≥rico</button>
    </div>
  </div>

  <div class="home-wrap">
    <div class="home-hero">
      <h1>Treine sua<br><em>velocidade de leitura</em></h1>
      <p>Cronometre, analise e evolua ‚Äî do texto f√°cil ao desafio extremo. Acompanhe suas palavras por minuto e veja seu progresso.</p>
      <div class="stats-row" id="globalStats">
        <div class="stat-item"><span class="stat-num" id="statSessions">0</span><span class="stat-label">Sess√µes</span></div>
        <div class="stat-item"><span class="stat-num" id="statAvgWPM">‚Äî</span><span class="stat-label">M√©d. PPM</span></div>
        <div class="stat-item"><span class="stat-num" id="statBestWPM">‚Äî</span><span class="stat-label">Melhor PPM</span></div>
      </div>
    </div>

    <!-- N√çVEIS -->
    <div style="margin-bottom:10px">
      <div class="section-title">Escolha o N√≠vel</div>
      <div class="section-sub">Do relaxante ao extremamente desafiador</div>
    </div>
    <div class="levels-grid" id="levelsGrid">
      <div class="level-card easy selected" data-level="easy" onclick="selectLevel('easy')">
        <span class="level-emoji">üå±</span>
        <span class="level-name">F√°cil</span>
        <span class="level-desc">Textos curtos e simples</span>
      </div>
      <div class="level-card medio" data-level="medio" onclick="selectLevel('medio')">
        <span class="level-emoji">üìñ</span>
        <span class="level-name">M√©dio</span>
        <span class="level-desc">Vocabul√°rio variado</span>
      </div>
      <div class="level-card dificil" data-level="dificil" onclick="selectLevel('dificil')">
        <span class="level-emoji">‚ö°</span>
        <span class="level-name">Dif√≠cil</span>
        <span class="level-desc">Textos densos e t√©cnicos</span>
      </div>
      <div class="level-card avancado" data-level="avancado" onclick="selectLevel('avancado')">
        <span class="level-emoji">üß†</span>
        <span class="level-name">Avan√ßado</span>
        <span class="level-desc">Linguagem complexa</span>
      </div>
      <div class="level-card extremo" data-level="extremo" onclick="selectLevel('extremo')">
        <span class="level-emoji">üíÄ</span>
        <span class="level-name">Extremo</span>
        <span class="level-desc">M√°ximo desafio</span>
      </div>
    </div>

    <!-- SELETOR DE TEXTO -->
    <div style="margin-bottom:10px">
      <div class="section-title">Escolha o Texto</div>
      <div class="section-sub">Textos prontos ou insira o seu</div>
    </div>
    <div class="text-selector">
      <div class="text-tabs">
        <div class="text-tab active" onclick="switchTab('library')">üìö Biblioteca</div>
        <div class="text-tab" onclick="switchTab('custom')">‚úèÔ∏è Meu Texto</div>
      </div>

      <div class="text-tab-content active" id="tab-library">
        <div class="text-list" id="textList">
          <!-- populated by JS -->
        </div>
      </div>

      <div class="text-tab-content" id="tab-custom">
        <textarea class="custom-area" id="customText" placeholder="Cole ou escreva seu texto aqui..." oninput="updateCharCount()"></textarea>
        <div class="custom-meta">
          <input type="text" class="custom-input" id="customTitle" placeholder="T√≠tulo do texto (opcional)">
          <span class="char-count" id="charCount">0 palavras</span>
        </div>
      </div>
    </div>

    <div class="start-row">
      <div style="font-size:0.8rem;color:var(--ink3)">Texto selecionado: <strong id="selectedTextName" style="color:var(--ink)">Nenhum</strong></div>
      <button class="btn btn-accent" onclick="startReading()">‚ñ∂ Come√ßar Leitura</button>
    </div>
  </div>
</div>

<!-- ===== LEITURA ===== -->
<div id="screen-reading">
  <div class="topbar">
    <div class="brand">Leitura<em>PRO</em></div>
    <div class="topbar-right">
      <button class="btn btn-ghost" onclick="goHome()">‚Üê Voltar</button>
    </div>
  </div>
  <div class="progress-bar-wrap"><div class="progress-bar-fill" id="progressBar"></div></div>

  <div class="reading-wrap">
    <div class="reading-header">
      <div class="reading-info">
        <div class="timer-display" id="timerDisplay">00:00</div>
        <div class="reading-meta">
          <span id="wpmLive">‚Äî PPM</span>
          <span id="wordCount">0 palavras</span>
        </div>
      </div>
      <div class="timer-controls">
        <button class="ctrl ctrl-start" id="btnStart" onclick="startTimer()">‚ñ∂ Iniciar</button>
        <button class="ctrl ctrl-pause" id="btnPause" onclick="pauseTimer()" style="display:none">‚è∏ Pausar</button>
        <button class="ctrl ctrl-stop" id="btnStop" onclick="stopTimer()">‚ñ† Finalizar</button>
      </div>
    </div>

    <div id="readingLevelBadge" class="reading-level-badge"></div>
    <div class="text-title-display" id="readingTitle"></div>
    <div class="text-body" id="readingBody"></div>
  </div>
</div>

<!-- ===== RESULTADO ===== -->
<div id="screen-result">
  <div class="topbar">
    <div class="brand">Leitura<em>PRO</em></div>
    <div class="topbar-right">
      <button class="btn btn-ghost" onclick="goHome()">‚Üê In√≠cio</button>
    </div>
  </div>

  <div class="result-wrap">
    <div class="result-hero">
      <div class="result-grade" id="resultGrade">A</div>
      <div class="result-label" id="resultLabel">Excelente desempenho!</div>
    </div>

    <div class="result-cards">
      <div class="result-card">
        <span class="result-card-val" id="res-wpm">‚Äî</span>
        <span class="result-card-label">Palavras/min</span>
      </div>
      <div class="result-card">
        <span class="result-card-val" id="res-time">‚Äî</span>
        <span class="result-card-label">Tempo Total</span>
      </div>
      <div class="result-card">
        <span class="result-card-val" id="res-words">‚Äî</span>
        <span class="result-card-label">Palavras</span>
      </div>
      <div class="result-card">
        <span class="result-card-val" id="res-level">‚Äî</span>
        <span class="result-card-label">N√≠vel</span>
      </div>
    </div>

    <div class="wpm-gauge">
      <div class="gauge-title">
        Velocidade de Leitura
        <span style="font-size:0.72rem;color:var(--ink3);font-family:'DM Mono',monospace">M√©dia adulta: 200-300 PPM</span>
      </div>
      <div class="gauge-scale">
        <div class="gauge-marker" id="gaugeMarker" style="left:30%">
          <div class="gauge-marker-val" id="gaugeVal">‚Äî</div>
          <div class="gauge-arrow"></div>
        </div>
        <div class="gauge-track"></div>
      </div>
      <div class="gauge-labels">
        <span>0</span><span>100</span><span>200</span><span>300</span><span>400</span><span>500+</span>
      </div>
    </div>

    <div class="analysis-box">
      <h3>An√°lise Detalhada</h3>
      <div id="analysisItems"></div>
    </div>

    <div class="result-actions">
      <button class="btn btn-ghost" onclick="goHome()">üè† In√≠cio</button>
      <button class="btn btn-solid" onclick="tryAgain()">üîÑ Tentar Novamente</button>
      <button class="btn btn-accent" onclick="nextText()">‚Üí Pr√≥ximo Texto</button>
    </div>
  </div>
</div>

<script>
// ===== DATA =====
const TEXTS = {
  easy: [
    {
      id:'e1', title:'O Jardim da Vov√≥', level:'easy',
      body:`A vov√≥ Maria acordava todos os dias √†s seis da manh√£ para cuidar do seu jardim. Ela regava as flores com carinho, tirava o mato ruim e conversava com os passarinhos que vinham cantar nas √°rvores.

Seu jardim era famoso em toda a rua. As rosas vermelhas eram as mais bonitas, e o jasmim perfumava o ar de um jeito que todo mundo parava para sentir.

Um dia, a neta Ana foi visitar a vov√≥. Ela ficou encantada com tantas cores e cheiros. A vov√≥ ensinou a menina a plantar uma semente. Juntas, elas cuidaram da terra com amor.

Semanas depois, uma flor pequenininha nasceu. Ana ficou feliz demais e prometeu que tamb√©m teria um jardim um dia.`
    },
    {
      id:'e2', title:'A Viagem de Trem', level:'easy',
      body:`Pedro nunca tinha andado de trem. Quando sua m√£e disse que iam viajar para a cidade da av√≥ de trem, ele ficou animado de um jeito que mal conseguia dormir na noite anterior.

Na esta√ß√£o, o trem estava enorme. As rodas de ferro brilhavam e a fuma√ßa sa√≠a com um barulho forte. Pedro segurou a m√£o da m√£e com for√ßa enquanto subiam as escadas.

Dentro do trem, a janela era grande. Pedro ficou colado no vidro olhando as casas, as √°rvores e os campos passarem rapidinho. Uma vez, at√© viu um cavalo correndo junto com o trem.

A viagem durou tr√™s horas, mas para Pedro pareceu um sonho. Quando chegaram, ele j√° queria voltar de trem de novo.`
    },
    {
      id:'e3', title:'O Cachorro e o Osso', level:'easy',
      body:`Tobi era um cachorro pequeno e muito esperto. Ele morava numa casa verde no fim da rua e adorava brincar no quintal. Seu dono, seu Z√©, sempre lhe dava um osso depois do jantar.

Numa tarde quente, Tobi pegou seu osso e foi at√© o quintal. Quando passava pela cerca, escorregou e o osso caiu num buraco fundo. Tobi ficou olhando tristinho para o buraco.

Ele foi at√© a garagem, pegou um graveto no bico e voltou ao buraco. Enfiou o graveto devagarzinho e, depois de muito tentar, conseguiu empurrar o osso para um lado e pegar com a patinha.

Seu Z√© viu tudo da janela e deu uma gargalhada. Chamou a fam√≠lia toda para contar a fa√ßanha do cachorrinho mais esperto que ele j√° tinha conhecido.`
    }
  ],
  medio: [
    {
      id:'m1', title:'O Mercado das Mem√≥rias', level:'medio',
      body:`Existia na cidade velha um mercado que a maioria das pessoas nem sabia que existia. Ficava numa viela estreita entre dois pr√©dios antigos, e s√≥ aparecia nas tardes de s√°bado quando a luz batia de um jeito diferente na pedra do cal√ßamento.

L√° vendiam de tudo: um pote de cheiro de chuva engarrafada, o som de uma risada que voc√™ j√° ouviu e esqueceu, a sensa√ß√£o exata de acordar cedo num dia frio de f√©rias escolares.

A moeda era mem√≥ria. Voc√™ entrava, escolhia algo, e pagava com uma lembran√ßa que abria m√£o de ter. N√£o do√≠a. Simplesmente, num estalo, aquele momento deixava de existir dentro de voc√™.

Marina entrou pela primeira vez numa tarde de mar√ßo. Saiu com o cheiro do cabelo da m√£e que havia morrido dois anos antes, e deixou para tr√°s o √∫ltimo desentendimento que tiveram. Pareceu um neg√≥cio justo.

O mercado estava l√° na semana seguinte. Mas Marina n√£o lembrava mais do caminho para chegar at√© ele.`
    },
    {
      id:'m2', title:'Carta ao Oceano', level:'medio',
      body:`Nunca fui de escrever cartas, mas voc√™ n√£o tem endere√ßo de e-mail e seria estranho te mandar uma mensagem no celular. Por isso escrevo no papel, com caneta, do jeito que aprendi que cartas devem ser escritas.

Nos vimos h√° tr√™s ver√µes. Eu estava naquele penhasco de pedra vermelha e voc√™ estava sendo voc√™ mesmo ‚Äî imenso, barulhento, absolutamente indiferente. Joguei um pedregulho em voc√™ e voc√™ nem percebeu.

Foi a√≠ que entendi o que os fil√≥sofos tentam dizer sobre a nossa irrelev√¢ncia. N√£o como uma tristeza, mas como um al√≠vio. Ningu√©m era t√£o importante quanto pensava. Nem eu, nem minhas preocupa√ß√µes de vinte e tr√™s anos.

Hoje tenho vinte e oito. As preocupa√ß√µes mudaram, mas o tamanho delas parece o mesmo. Quando fico pequeno demais pra cabe√ßa, lembro de voc√™. Aquela imensid√£o azul que simplesmente continua.

Obrigado por existir. Sei que voc√™ n√£o leu isso. Mas escrevi mesmo assim.`
    },
    {
      id:'m3', title:'A √öltima Livraria', level:'medio',
      body:`A cidade tinha uma √∫nica livraria ainda aberta, e ela resistia com a teimosia t√≠pica das coisas velhas que recusam morrer de vez. As paredes eram de madeira escurecida pelo tempo, os livros se empilhavam sem muita ordem l√≥gica, e o dono, seu Benedito, tinha setenta e tr√™s anos e a mem√≥ria de um catalogador de museu.

Voc√™ entrava e dizia o que estava sentindo ‚Äî n√£o o que queria ler, mas o que estava sentindo ‚Äî e Benedito ia at√© algum canto do labirinto de prateleiras e voltava com um livro. Sempre o certo.

Para a mo√ßa que chorava sem saber por qu√™, ele trouxe um conto curto de Clarice. Para o rapaz que estava com raiva do pai, uma biografia de algu√©m que tamb√©m teve. Para a crian√ßa que sentia medo do escuro, um livro de astronomia sobre como as estrelas s√£o feitas de explos√µes.

A prefeitura queria o espa√ßo para construir um estacionamento. Benedito disse que esperariam ele morrer. E ele, por pura teimosia liter√°ria, se recusava a morrer antes de ter lido tudo que ainda restava.`
    }
  ],
  dificil: [
    {
      id:'d1', title:'Sobre a Dissolu√ß√£o do Tempo Percebido', level:'dificil',
      body:`A percep√ß√£o humana do tempo √©, por defini√ß√£o, uma constru√ß√£o retroativa. O instante presente ‚Äî aquilo que designamos coloquialmente como "agora" ‚Äî √©, em sentido estrito, inacess√≠vel √† consci√™ncia no momento em que ocorre. O que percebemos como presente √©, invariavelmente, um passado imediato processado e reconstru√≠do pelo aparato cognitivo em fra√ß√µes de segundo.

William James, ao cunhar o conceito de "presente especioso", j√° intu√≠a essa defasagem constitutiva entre evento e percep√ß√£o. O que a neuroci√™ncia contempor√¢nea confirma, com aparato experimental que James n√£o dispunha, √© que essa lacuna varia conforme estado emocional, n√≠vel de aten√ß√£o e at√© temperatura corporal.

H√° uma implica√ß√£o filos√≥fica perturbadora nessa constata√ß√£o: se o presente √© ilus√≥rio, e o passado irrecuper√°vel enquanto evento bruto, e o futuro apenas proje√ß√£o probabil√≠stica, em que registro ontol√≥gico habitamos? A resposta mais honesta √©: no registro da narrativa. Somos, antes de tudo, animais que constroem coer√™ncia onde h√° apenas fluxo.

A mem√≥ria, nesse contexto, n√£o √© arquivo ‚Äî √© fic√ß√£o com pretens√£o documental. Cada vez que lembramos, reescrevemos. A vers√£o acessada n√£o √© o evento original, mas a √∫ltima vers√£o que lembramos, j√° ela mesma uma vers√£o anterior reescrita. A fidelidade decai a cada itera√ß√£o.

Isso n√£o √© trag√©dia epistemol√≥gica, √©, talvez, a condi√ß√£o de possibilidade da identidade. Somos o ac√∫mulo das nossas revis√µes.`
    },
    {
      id:'d2', title:'A Geometria das Decis√µes Irrevers√≠veis', level:'dificil',
      body:`Existe uma categoria espec√≠fica de decis√£o que os te√≥ricos da escolha racional insistem em subestimar: a decis√£o cujo custo n√£o √© mensur√°vel antes de ser tomada, porque o custo √© precisamente a impossibilidade de tom√°-la novamente. Chama-se, em alguns contextos, de "ponto de bifurca√ß√£o existencial" ‚Äî embora o termo carregue um peso dram√°tico que nem sempre corresponde √† dimens√£o dos eventos em quest√£o.

Aceitar um emprego em outra cidade. N√£o ligar numa madrugada quando se deveria ter ligado. Dizer uma palavra que n√£o pode ser d√©sagendada do registro de outra pessoa. Essas s√£o as decis√µes que n√£o cabem em matrizes de utilidade esperada, porque seu horizonte temporal √© indefinido e seus efeitos, frequentemente, se manifestam em dimens√µes que n√£o estavam no conjunto de vari√°veis consideradas no momento da escolha.

O que torna esses momentos geometricamente interessantes ‚Äî e psicologicamente √°rduos ‚Äî √© que eles possuem a estrutura topol√≥gica de um n√≥: uma vez atravessado, o espa√ßo de possibilidades se reconfigura de maneira irredut√≠vel. N√£o √© que o caminho n√£o percorrido desapare√ßa; ele persiste como espectro contrafactual, presente exatamente por sua aus√™ncia, habitando a consci√™ncia com a for√ßa das coisas que n√£o aconteceram.

A sabedoria convencional aconselha a "n√£o olhar para tr√°s". A sabedoria n√£o convencional reconhece que olhar para tr√°s com lucidez ‚Äî sem nostalgia paralisante, mas tamb√©m sem a amn√©sia conveniente ‚Äî √© precisamente o que permite que o pr√≥ximo ponto de bifurca√ß√£o seja navegado com maior integridade.`
    }
  ],
  avancado: [
    {
      id:'a1', title:'Fenomenologia da Incompreens√£o M√∫tua', level:'avancado',
      body:`A incompreens√£o entre sujeitos n√£o √©, como frequentemente se sup√µe no imagin√°rio popular, um d√©ficit comunicativo remedi√°vel pela adi√ß√£o de palavras. √â, antes, uma propriedade estrutural da intersubjetividade ‚Äî condi√ß√£o que Husserl denominaria a "alteridade irredut√≠vel" do outro e que Wittgenstein abordaria obliquamente ao afirmar que, mesmo que um le√£o pudesse falar, n√£o o compreender√≠amos.

O problema n√£o reside na insufici√™ncia do c√≥digo lingu√≠stico compartilhado, mas na assimetria constitutiva das perspectivas fenomenol√≥gicas. Cada sujeito habita um horizonte intencional constru√≠do a partir de sedimenta√ß√µes biogr√°ficas, afetivas e corporais que s√£o, por princ√≠pio, intransmiss√≠veis em sua integralidade. A linguagem funciona, nesse registro, n√£o como canal de transposi√ß√£o de conte√∫do, mas como dispositivo de coordena√ß√£o de comportamentos e negocia√ß√£o de aproxima√ß√µes suficientemente funcionais ‚Äî o que Wittgenstein chamaria de "jogos de linguagem" ‚Äî nunca como ve√≠culo de coincid√™ncia mental.

Da√≠ a paradoxalidade fundamental das rela√ß√µes humanas mais intensas: quanto maior a intimidade, mais vis√≠vel se torna a opacidade do outro. O estranho pode ser tratado como cifra temporariamente ileg√≠vel ‚Äî cuja decifra√ß√£o se projeta no horizonte do poss√≠vel. O pr√≥ximo, cujo horizonte parcialmente conhecemos, revela por exatamente essa proximidade os contornos do que permanece e permanecer√° inacess√≠vel.

Amar algu√©m, nessa perspectiva fenomenol√≥gica, n√£o seria eliminar essa dist√¢ncia ‚Äî projeto imposs√≠vel e, se poss√≠vel, sufocante ‚Äî mas aprender a habit√°-la com toler√¢ncia, √†s vezes com rever√™ncia. A incompreens√£o que subsiste n√£o como falha, mas como signo de que h√° ali, irredut√≠vel, um outro.`
    },
    {
      id:'a2', title:'Entropia, Informa√ß√£o e o Custo da Ordem', level:'avancado',
      body:`A segunda lei da termodin√¢mica tem uma beleza austera que transcende a f√≠sica e contamina, com raz√£o, a teoria da informa√ß√£o, a biologia evolutiva e, com alguma licen√ßa metaf√≥rica controlada, a filosofia da hist√≥ria. Em sua formula√ß√£o mais geral: sistemas isolados tendem espontaneamente a estados de maior entropia ‚Äî maior desordem, menor disponibilidade energ√©tica, maior distribui√ß√£o homog√™nea.

Shannon, ao desenvolver a teoria matem√°tica da comunica√ß√£o em 1948, realizou um movimento epistemol√≥gico de consequ√™ncias inesperadas: utilizou o mesmo formalismo matem√°tico da entropia termodin√¢mica para medir a informa√ß√£o. Nessa formula√ß√£o, informa√ß√£o √© precisamente a quantidade de surpresa ‚Äî ou improbabilidade ‚Äî de uma mensagem. Uma mensagem completamente previs√≠vel n√£o transmite informa√ß√£o. √â o inesperado, o improv√°vel, que carrega conte√∫do informacional.

H√° uma ironia estrutural nisso: a ordem ‚Äî baixa entropia ‚Äî √© o que torna poss√≠vel a comunica√ß√£o (requer c√≥digos est√°veis, estruturas reconhec√≠veis), mas √© exatamente a desordem relativa ‚Äî o desvio da expectativa ‚Äî que constitui a informa√ß√£o em si. Comunicar √©, portanto, dan√ßar no limite entre estrutura suficiente para ser compreendido e varia√ß√£o suficiente para dizer algo.

Para sistemas biol√≥gicos, a implica√ß√£o √© ainda mais perturbadora. Manter a organiza√ß√£o ‚Äî a baixa entropia local que caracteriza um organismo vivo ‚Äî exige importa√ß√£o cont√≠nua de energia do ambiente e exporta√ß√£o de entropia para fora do sistema. Viver √©, literalmente, adiar o equil√≠brio termodin√¢mico ‚Äî que √© a morte ‚Äî √†s custas do ambiente. Somos bols√µes tempor√°rios de improv√°vel ordem num universo que caminha inexoravelmente para a homogeneidade.`
    }
  ],
  extremo: [
    {
      id:'x1', title:'Aporia da Autodetermina√ß√£o em Sistemas Reflexivos', level:'extremo',
      body:`A quest√£o da autodetermina√ß√£o ‚Äî entendida como capacidade de um sistema de estabelecer, a partir de si mesmo, as condi√ß√µes normativas de sua pr√≥pria opera√ß√£o ‚Äî constitui um dos n√≥s gordianos da filosofia pr√°tica contempor√¢nea, particularmente quando confrontada com as descobertas das ci√™ncias cognitivas sobre os mecanismos subpessoais que subjazem ao que fenomenologicamente se apresenta como decis√£o deliberada.

Libet e colaboradores demonstraram experimentalmente, nos anos oitenta, que a atividade neural precursora de um movimento volunt√°rio (o "Bereitschaftspotential") antecede em aproximadamente trezentos a quinhentos milissegundos a consci√™ncia subjetiva de ter decidido mover-se. Se a decis√£o consciente √© epifen√¥meno de processos que j√° determinaram seu conte√∫do antes de emergir √† consci√™ncia, em que sentido ontol√≥gico o sujeito √© autor de suas a√ß√µes?

As respostas deflacion√°rias ‚Äî de que o livre-arb√≠trio √© simplesmente compat√≠vel com o determinismo neurol√≥gico porque se refere a uma capacidade de n√≠vel de descri√ß√£o diferente ‚Äî preservam o vocabul√°rio pr√°tico da ag√™ncia √†s custas de esvaziar seu conte√∫do intuitivo. O sujeito que "poderia ter agido de outra forma" nessa leitura compatibilista significa apenas que, em condi√ß√µes contrafactuais diferentes (outros estados cerebrais), a a√ß√£o resultante seria diferente ‚Äî o que √© trivialmente verdadeiro e n√£o restaura a intui√ß√£o que se buscava preservar.

A alternativa incompatibilista ‚Äî que o livre-arb√≠trio genu√≠no requer a possibilidade real de alternativas causais ‚Äî esbarra tanto no determinismo quanto, paradoxalmente, no indeterminismo qu√¢ntico: aleatoriedade n√£o √© autonomia. Um evento causado por flutua√ß√µes qu√¢nticas n√£o √© mais "meu" do que um causado por condicionamento determin√≠stico.

O que permanece quando se dissolve a ilus√£o de uma ag√™ncia metafisicamente robusta? Talvez o que Strawson chamou de "atitudes reativas" ‚Äî a gram√°tica pr√°tica do elogio, da culpa, do ressentimento e da gratid√£o ‚Äî que n√£o requer funda√ß√£o metaf√≠sica para ser operacionalmente indispens√°vel. A responsabilidade como pr√°tica social, n√£o como correspond√™ncia a um fato ontol√≥gico.

Mas isso n√£o responde √† quest√£o; apenas a transloca. A pergunta deixa de ser "somos realmente livres?" e se torna "que tipo de criatura √© aquela que, mesmo n√£o sendo metafisicamente livre, n√£o pode deixar de se experimentar como tal, e organiza toda a sua vida moral a partir dessa experi√™ncia?"`,
    },
    {
      id:'x2', title:'Colapso Epist√™mico e a Pragm√°tica da Certeza Funcional', level:'extremo',
      body:`A epistemologia tradicional, desde Descartes, operou sob a premissa impl√≠cita de que a tarefa do conhecimento √© a elimina√ß√£o da d√∫vida ‚Äî a funda√ß√£o de cren√ßas em bases indubit√°veis que sirvam de ancoragem para uma estrutura cognitiva est√°vel. O projeto cartesiano, mesmo em suas revis√µes p√≥s-kantianas e anal√≠ticas, preservou essa orienta√ß√£o fundamentalista: conhecer bem √© conhecer com garantias.

O pragmatismo americano ‚Äî de Peirce a Dewey, com a radicaliza√ß√£o posterior de Rorty ‚Äî subverteu essa orienta√ß√£o ao propor que a pergunta relevante n√£o √© "o que justifica esta cren√ßa?" mas "que diferen√ßa faz t√™-la?". Verdade, nessa perspectiva, n√£o √© correspond√™ncia entre proposi√ß√£o e estado de coisas independente, mas propriedade funcional de cren√ßas que funcionam bem ‚Äî que permitem navegar o ambiente, coordenar a√ß√£o com outros agentes, resolver problemas.

Wittgenstein, em "Da Certeza", chegou a uma posi√ß√£o estruturalmente an√°loga por caminho diferente. Analisando as chamadas "proposi√ß√µes de dobradi√ßa" ‚Äî aquelas que n√£o s√£o verificadas, mas que sustentam a verifica√ß√£o de outras ‚Äî concluiu que a base do edif√≠cio epist√™mico n√£o √© conhecimento, mas a√ß√£o. "No come√ßo era o ato." Certas cren√ßas n√£o s√£o justificadas porque s√£o incorrig√≠veis; s√£o incorrig√≠veis porque sua revis√£o desestabilizaria o sistema inteiro de pr√°ticas no qual o conhecimento se insere.

Isso tem implica√ß√µes radicais para a racionalidade em condi√ß√µes de incerteza genu√≠na ‚Äî que √© a condi√ß√£o normal de decis√£o, n√£o uma patologia excepcional. Se a certeza fundacional √© inacess√≠vel e a demanda por ela √© paralisante, a alternativa racional √© desenvolver o que poder√≠amos chamar de "certeza funcional calibrada": comprometimento operacional com premissas suficientemente bem-testadas para sustentar a√ß√£o, combinado com disposi√ß√£o estrutural para revis√£o quando as consequ√™ncias pr√°ticas sinalizam inadequa√ß√£o do modelo.

A diferen√ßa entre dogmatismo e racionalidade n√£o est√°, nessa perspectiva, na aus√™ncia versus presen√ßa de comprometimentos n√£o totalmente justificados ‚Äî ambos os t√™m. Est√° na qualidade da disposi√ß√£o para revisar: o dogm√°tico protege a cren√ßa das evid√™ncias; o racional recalibra a cren√ßa a partir delas, mantendo ao mesmo tempo o comprometimento operacional que torna a a√ß√£o poss√≠vel.`
    }
  ]
};

// ===== STATE =====
let currentLevel = 'easy';
let currentTextId = null;
let currentText = null;
let isCustom = false;
let timerSeconds = 0;
let timerInterval = null;
let timerRunning = false;
let timerStarted = false;
let timerPaused = false;
let history = JSON.parse(localStorage.getItem('leitura_history') || '[]');

// ===== INIT =====
function init() {
  updateStats();
  renderTextList();
}

function updateStats() {
  document.getElementById('statSessions').textContent = history.length;
  if (history.length === 0) return;
  const wpms = history.map(h => h.wpm);
  document.getElementById('statAvgWPM').textContent = Math.round(wpms.reduce((a,b)=>a+b,0)/wpms.length);
  document.getElementById('statBestWPM').textContent = Math.max(...wpms);
}

function renderTextList() {
  const list = document.getElementById('textList');
  list.innerHTML = '';
  const texts = TEXTS[currentLevel] || [];
  texts.forEach(t => {
    const wordCount = t.body.trim().split(/\s+/).length;
    const el = document.createElement('div');
    el.className = 'text-item' + (currentTextId === t.id ? ' selected' : '');
    el.onclick = () => selectText(t);
    const lvlLabels = {easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};
    el.innerHTML = `
      <span class="text-item-badge badge-${t.level}">${lvlLabels[t.level]}</span>
      <div class="text-item-info">
        <div class="text-item-title">${t.title}</div>
        <div class="text-item-meta">${wordCount} palavras ¬∑ ~${Math.ceil(wordCount/200)} min de leitura</div>
      </div>
    `;
    list.appendChild(el);
  });
}

function selectLevel(l) {
  currentLevel = l;
  currentTextId = null;
  document.getElementById('selectedTextName').textContent = 'Nenhum';
  document.querySelectorAll('.level-card').forEach(c => c.classList.remove('selected'));
  document.querySelector(`.level-card[data-level="${l}"]`).classList.add('selected');
  renderTextList();
  document.querySelector('.text-tab[onclick="switchTab(\'library\')"]').click();
}

function switchTab(tab) {
  document.querySelectorAll('.text-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.text-tab-content').forEach(t => t.classList.remove('active'));
  if (tab === 'library') {
    document.querySelectorAll('.text-tab')[0].classList.add('active');
    document.getElementById('tab-library').classList.add('active');
    isCustom = false;
  } else {
    document.querySelectorAll('.text-tab')[1].classList.add('active');
    document.getElementById('tab-custom').classList.add('active');
    isCustom = true;
    currentTextId = '__custom__';
    document.getElementById('selectedTextName').textContent = 'Meu texto';
  }
}

function selectText(t) {
  currentTextId = t.id;
  currentText = t;
  isCustom = false;
  document.querySelectorAll('.text-item').forEach(el => el.classList.remove('selected'));
  event.currentTarget.classList.add('selected');
  document.getElementById('selectedTextName').textContent = t.title;
}

function updateCharCount() {
  const v = document.getElementById('customText').value.trim();
  const words = v ? v.split(/\s+/).length : 0;
  document.getElementById('charCount').textContent = words + ' palavras';
}

// ===== START READING =====
function startReading() {
  if (isCustom) {
    const body = document.getElementById('customText').value.trim();
    if (!body) { showToast('Cole seu texto antes de come√ßar!'); return; }
    const title = document.getElementById('customTitle').value.trim() || 'Meu Texto';
    currentText = { id: '__custom__', title, level: currentLevel, body };
  } else {
    if (!currentTextId) { showToast('Selecione um texto antes de come√ßar!'); return; }
  }

  // Setup reading screen
  const lvlMap = {
    easy: {label:'üå± F√°cil', cls:'badge-easy', bg:'var(--easy-bg)', color:'var(--easy)'},
    medio: {label:'üìñ M√©dio', cls:'badge-medio', bg:'var(--medio-bg)', color:'var(--medio)'},
    dificil: {label:'‚ö° Dif√≠cil', cls:'badge-dificil', bg:'var(--dificil-bg)', color:'var(--dificil)'},
    avancado: {label:'üß† Avan√ßado', cls:'badge-avancado', bg:'var(--avancado-bg)', color:'var(--avancado)'},
    extremo: {label:'üíÄ Extremo', cls:'badge-extremo', bg:'var(--extremo-bg)', color:'#ccc'}
  };
  const lvl = lvlMap[currentText.level] || lvlMap.easy;

  const badge = document.getElementById('readingLevelBadge');
  badge.textContent = lvl.label;
  badge.style.background = lvl.bg;
  badge.style.color = lvl.color;

  document.getElementById('readingTitle').textContent = currentText.title;
  const body = document.getElementById('readingBody');
  body.textContent = currentText.body;
  body.className = 'text-body' + (currentText.level === 'extremo' ? ' level-extremo' : '');

  const words = currentText.body.trim().split(/\s+/).length;
  document.getElementById('wordCount').textContent = words + ' palavras';

  // reset timer
  timerSeconds = 0;
  timerRunning = false;
  timerStarted = false;
  timerPaused = false;
  clearInterval(timerInterval);
  document.getElementById('timerDisplay').textContent = '00:00';
  document.getElementById('timerDisplay').className = 'timer-display';
  document.getElementById('wpmLive').textContent = '‚Äî PPM';
  document.getElementById('progressBar').style.width = '0%';
  document.getElementById('btnStart').style.display = '';
  document.getElementById('btnPause').style.display = 'none';

  showScreen('reading');
  window.scrollTo(0,0);
}

// ===== TIMER =====
function startTimer() {
  if (timerStarted && !timerPaused) return;
  timerRunning = true;
  timerStarted = true;
  timerPaused = false;
  document.getElementById('timerDisplay').className = 'timer-display running';
  document.getElementById('btnStart').style.display = 'none';
  document.getElementById('btnPause').style.display = '';
  timerInterval = setInterval(() => {
    timerSeconds++;
    updateTimerDisplay();
  }, 1000);
}

function pauseTimer() {
  if (!timerRunning) return;
  clearInterval(timerInterval);
  timerRunning = false;
  timerPaused = true;
  document.getElementById('timerDisplay').className = 'timer-display paused';
  document.getElementById('btnPause').style.display = 'none';
  document.getElementById('btnStart').textContent = '‚ñ∂ Continuar';
  document.getElementById('btnStart').style.display = '';
}

function stopTimer() {
  if (!timerStarted) { showToast('Inicie o cron√¥metro primeiro!'); return; }
  clearInterval(timerInterval);
  timerRunning = false;
  showResult();
}

function updateTimerDisplay() {
  const m = Math.floor(timerSeconds / 60);
  const s = timerSeconds % 60;
  document.getElementById('timerDisplay').textContent =
    String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');

  if (timerSeconds > 5) {
    const words = currentText.body.trim().split(/\s+/).length;
    const wpm = Math.round((words / timerSeconds) * 60);
    document.getElementById('wpmLive').textContent = wpm + ' PPM';
  }

  // progress (estimated by time vs expected)
  const words = currentText.body.trim().split(/\s+/).length;
  const avgWPM = 200;
  const expectedSecs = (words / avgWPM) * 60;
  const prog = Math.min(100, (timerSeconds / expectedSecs) * 100);
  document.getElementById('progressBar').style.width = prog + '%';
}

// ===== RESULT =====
function showResult() {
  const words = currentText.body.trim().split(/\s+/).length;
  const wpm = timerSeconds > 0 ? Math.round((words / timerSeconds) * 60) : 0;

  const m = Math.floor(timerSeconds / 60);
  const s = timerSeconds % 60;
  const timeStr = String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');

  // Grade
  let grade, gradeLabel, gradeColor;
  const lvlBonus = {easy:0, medio:20, dificil:50, avancado:80, extremo:120};
  const bonus = lvlBonus[currentText.level] || 0;
  const adjWPM = wpm + bonus;

  if (adjWPM >= 350) { grade='S'; gradeLabel='Leitura excepcional!'; gradeColor='#c8ff00'; }
  else if (adjWPM >= 280) { grade='A'; gradeLabel='Excelente desempenho!'; gradeColor=var('--easy'); }
  else if (adjWPM >= 220) { grade='B'; gradeLabel='Bom desempenho!'; gradeColor='#2d7a3a'; }
  else if (adjWPM >= 160) { grade='C'; gradeLabel='Desempenho m√©dio'; gradeColor='#b06a00'; }
  else if (adjWPM >= 100) { grade='D'; gradeLabel='Continue praticando!'; gradeColor='#c0392b'; }
  else { grade='F'; gradeLabel='Pratique mais!'; gradeColor='#888'; }

  document.getElementById('resultGrade').textContent = grade;
  document.getElementById('resultGrade').style.color = gradeColor;
  document.getElementById('resultLabel').textContent = gradeLabel;

  document.getElementById('res-wpm').textContent = wpm;
  document.getElementById('res-time').textContent = timeStr;
  document.getElementById('res-words').textContent = words;
  const lvlNames = {easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};
  document.getElementById('res-level').textContent = lvlNames[currentText.level] || '‚Äî';

  // Gauge
  const maxWPM = 500;
  const pct = Math.min(98, Math.max(2, (wpm / maxWPM) * 100));
  setTimeout(() => {
    document.getElementById('gaugeMarker').style.left = pct + '%';
    document.getElementById('gaugeVal').textContent = wpm + ' PPM';
  }, 300);

  // Analysis
  const items = buildAnalysis(wpm, timerSeconds, words, currentText.level);
  const aiDiv = document.getElementById('analysisItems');
  aiDiv.innerHTML = '';
  items.forEach(item => {
    const d = document.createElement('div');
    d.className = 'analysis-item';
    d.innerHTML = `<span class="analysis-icon">${item.icon}</span><div>${item.text}</div>`;
    aiDiv.appendChild(d);
  });

  // Save history
  history.unshift({ wpm, time: timeStr, words, level: currentText.level, title: currentText.title, grade, date: new Date().toLocaleDateString('pt-BR') });
  if (history.length > 50) history.pop();
  localStorage.setItem('leitura_history', JSON.stringify(history));

  showScreen('result');
  window.scrollTo(0,0);
}

function var_(name) { return getComputedStyle(document.documentElement).getPropertyValue(name); }

function buildAnalysis(wpm, secs, words, level) {
  const items = [];

  // WPM category
  if (wpm < 100) items.push({icon:'üê¢', text:`Sua velocidade de <strong>${wpm} PPM</strong> est√° abaixo da m√©dia. A maioria dos adultos l√™ entre 200‚Äì300 PPM. Com pr√°tica di√°ria, voc√™ pode dobrar essa marca em semanas.`});
  else if (wpm < 200) items.push({icon:'üö∂', text:`<strong>${wpm} PPM</strong> ‚Äî ritmo lento a moderado. Est√° dentro do normal para leitura atenta. Trabalhe na elimina√ß√£o da subvocaliza√ß√£o (o "dizer as palavras mentalmente") para ganhar velocidade.`});
  else if (wpm < 300) items.push({icon:'üèÉ', text:`<strong>${wpm} PPM</strong> ‚Äî velocidade m√©dia de adulto educado. Voc√™ est√° numa boa faixa. Para avan√ßar, tente ampliar o "span visual" ‚Äî capturar grupos de palavras em vez de uma por vez.`});
  else if (wpm < 400) items.push({icon:'‚ö°', text:`<strong>${wpm} PPM</strong> ‚Äî leitura acima da m√©dia! Voc√™ est√° na faixa de leitores √°vidos e profissionais. Manter a compreens√£o nessa velocidade √© o pr√≥ximo desafio.`});
  else items.push({icon:'üöÄ', text:`<strong>${wpm} PPM</strong> ‚Äî leitura excepcional! Voc√™ est√° entre os 10% mais r√°pidos. Verifique se a compreens√£o acompanha ‚Äî velocidade sem compreens√£o n√£o √© leitura.`});

  // Time insight
  const mins = secs / 60;
  if (mins < 2) items.push({icon:'‚è±', text:`Sess√£o muito curta (<strong>${Math.round(mins)} min</strong>). Textos curtos s√£o bons para aquecimento, mas sess√µes de 10‚Äì20 minutos trazem mais benef√≠cio para o treino de leitura.`});
  else if (mins < 10) items.push({icon:'‚è±', text:`Boa sess√£o de <strong>${Math.round(mins)} minutos</strong>. Voc√™ manteve o foco pelo tempo suficiente para criar um dado confi√°vel de PPM.`});
  else items.push({icon:'‚è±', text:`Excelente resist√™ncia! <strong>${Math.round(mins)} minutos</strong> de leitura concentrada. Isso treina n√£o s√≥ velocidade, mas mem√≥ria de trabalho e compreens√£o de textos longos.`});

  // Level insight
  const lvlInsights = {
    easy: 'Textos f√°ceis s√£o ideais para aquecer e medir sua velocidade base sem sobrecarga cognitiva.',
    medio: 'N√≠vel m√©dio equilibra desafio e fluidez ‚Äî √≥timo para progress√£o consistente.',
    dificil: 'Textos dif√≠ceis exigem mais processamento sem√¢ntico, o que pode reduzir a PPM. Isso √© normal e desej√°vel para desenvolver compreens√£o profunda.',
    avancado: 'Excelente escolha desafiadora. Leitura de textos avan√ßados expande vocabul√°rio ativo e capacidade de racioc√≠nio abstrato.',
    extremo: 'N√≠vel extremo: voc√™ enfrentou vocabul√°rio t√©cnico denso e estruturas argumentativas complexas. A PPM mais baixa aqui √© esperada ‚Äî o ganho √© de compreens√£o, n√£o velocidade.'
  };
  items.push({icon:'üìä', text: lvlInsights[level] || ''});

  // Comparison
  items.push({icon:'üìö', text:`Para refer√™ncia: leitores casuais ficam em torno de <strong>150‚Äì200 PPM</strong>, profissionais entre <strong>300‚Äì400 PPM</strong>, e leitores treinados em speed reading podem chegar a <strong>600‚Äì800 PPM</strong> (com menor compreens√£o). Seu foco deve ser o ponto √≥timo entre velocidade e entendimento.`});

  return items;
}

// ===== NAVIGATION =====
function showScreen(name) {
  document.querySelectorAll('[id^="screen-"]').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
}

function goHome() {
  clearInterval(timerInterval);
  timerRunning = false;
  showScreen('home');
  updateStats();
}

function tryAgain() {
  startReading();
}

function nextText() {
  const texts = TEXTS[currentLevel] || [];
  const idx = texts.findIndex(t => t.id === currentTextId);
  const next = texts[(idx + 1) % texts.length];
  if (next) {
    currentTextId = next.id;
    currentText = next;
    startReading();
  } else {
    goHome();
  }
}

function showHistory() {
  if (history.length === 0) { showToast('Nenhum hist√≥rico ainda. Fa√ßa sua primeira leitura!'); return; }
  const lvlNames = {easy:'F√°cil',medio:'M√©dio',dificil:'Dif√≠cil',avancado:'Avan√ßado',extremo:'Extremo'};
  const gradeColors = {S:'#c8ff00',A:'#2d7a3a',B:'#4caf50',C:'#b06a00',D:'#c0392b',F:'#888'};
  const html = history.slice(0,10).map(h => `
    <div class="history-item">
      <div class="history-wpm" style="color:${gradeColors[h.grade]||'#333'}">${h.wpm}</div>
      <div class="history-info">
        <div class="history-title">${h.title}</div>
        <div class="history-meta">${h.date} ¬∑ ${lvlNames[h.level]||h.level} ¬∑ ${h.time}</div>
      </div>
      <div class="history-grade" style="background:${gradeColors[h.grade]}22;color:${gradeColors[h.grade]}">${h.grade}</div>
    </div>
  `).join('');

  const win = window.open('','_blank','width=560,height=600');
  win.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Hist√≥rico</title>
  <style>body{font-family:DM Sans,sans-serif;background:#faf8f4;padding:24px;color:#1a1410}
  h2{font-family:Playfair Display,serif;font-size:1.5rem;margin-bottom:20px}
  .history-item{display:flex;align-items:center;gap:14px;padding:12px 16px;background:#fff;border:1px solid #e8e0d0;border-radius:10px;margin-bottom:8px}
  .history-wpm{font-family:Playfair Display,serif;font-size:1.3rem;font-weight:700;min-width:60px}
  .history-info{flex:1}.history-title{font-weight:500;margin-bottom:2px;font-size:.85rem}
  .history-meta{font-size:.7rem;color:#9a8870;font-family:monospace}
  .history-grade{font-size:.7rem;font-weight:700;padding:3px 10px;border-radius:20px}
  @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=DM+Sans:wght@400;500&display=swap');
  </style></head><body><h2>üìä Hist√≥rico de Leituras</h2>${html}</body></html>`);
}

// ===== TOAST =====
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}

// ===== RUN =====
init();
</script>
</body>
</html>
