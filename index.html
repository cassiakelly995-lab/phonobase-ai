<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHONOBASE CLINICAL ‚Äî Esta√ß√£o de Trabalho Fonoaudiol√≥gica 2026</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600&family=IBM+Plex+Serif:ital,wght@0,300;0,400;0,600;1,300;1,400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}

:root{
  --bg:        #0b0e13;
  --panel:     #111318;
  --panel2:    #161a21;
  --panel3:    #1c2029;
  --border:    #252a35;
  --border2:   #2e3445;
  --text:      #c8cdd8;
  --text2:     #7a8099;
  --text3:     #454d63;
  --accent:    #4a9eff;
  --accent-d:  rgba(74,158,255,.1);
  --accent-d2: rgba(74,158,255,.05);
  --green:     #3ecf6a;
  --green-d:   rgba(62,207,106,.08);
  --amber:     #f0a500;
  --amber-d:   rgba(240,165,0,.1);
  --red:       #e05252;
  --red-d:     rgba(224,82,82,.1);
  --purple:    #9b72cf;
  --purple-d:  rgba(155,114,207,.08);
  --teal:      #2ec4b6;
  --teal-d:    rgba(46,196,182,.08);
}

body{
  background:var(--bg);
  color:var(--text);
  font-family:'IBM Plex Sans',sans-serif;
  font-size:13px;
  line-height:1.5;
}

/* ‚ïê‚ïê‚ïê LAYOUT SHELL ‚ïê‚ïê‚ïê */
.shell{
  display:grid;
  grid-template-rows:40px 1fr;
  height:100vh;
}

/* ‚ïê‚ïê‚ïê TOPBAR ‚ïê‚ïê‚ïê */
.topbar{
  background:var(--panel);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;
  padding:0 16px;gap:0;
  position:relative;z-index:100;
}
.tb-logo{
  font-family:'IBM Plex Mono',monospace;
  font-size:11px;font-weight:600;letter-spacing:3px;
  text-transform:uppercase;color:var(--text);
  margin-right:24px;padding-right:24px;
  border-right:1px solid var(--border);
  white-space:nowrap;
}
.tb-logo em{color:var(--accent);font-style:normal;}
.tb-tabs{display:flex;gap:0;flex:1;}
.tb-tab{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  font-weight:400;letter-spacing:1px;text-transform:uppercase;
  padding:0 16px;height:40px;display:flex;align-items:center;
  background:none;border:none;color:var(--text3);
  cursor:pointer;transition:all .15s;border-bottom:2px solid transparent;
  white-space:nowrap;
}
.tb-tab:hover{color:var(--text2);}
.tb-tab.active{color:var(--accent);border-bottom-color:var(--accent);}

.tb-right{
  display:flex;align-items:center;gap:12px;margin-left:auto;
}
.key-indicator{
  display:flex;align-items:center;gap:6px;
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:1px;text-transform:uppercase;
  padding:4px 10px;border:1px solid var(--border2);
  cursor:pointer;transition:all .2s;
}
.key-indicator.on{color:var(--green);border-color:rgba(62,207,106,.3);}
.key-indicator.off{color:var(--amber);}
.key-indicator:hover{border-color:var(--accent);}
.kdot{width:5px;height:5px;border-radius:50%;flex-shrink:0;}
.kdot-on{background:var(--green);}
.kdot-off{background:var(--amber);animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;}50%{opacity:.3;}}
.tb-time{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  color:var(--text3);letter-spacing:1px;
}

/* ‚ïê‚ïê‚ïê WORKSPACE ‚ïê‚ïê‚ïê */
.workspace{
  display:grid;
  grid-template-columns:220px 1fr 280px;
  overflow:hidden;
}

/* ‚ïê‚ïê‚ïê LEFT SIDEBAR ‚ïê‚ïê‚ïê */
.sidebar-l{
  background:var(--panel);
  border-right:1px solid var(--border);
  overflow-y:auto;display:flex;flex-direction:column;
}
.sidebar-l::-webkit-scrollbar{width:2px;}
.sidebar-l::-webkit-scrollbar-thumb{background:var(--border2);}

.sl-section{border-bottom:1px solid var(--border);}
.sl-header{
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:3px;text-transform:uppercase;color:var(--text3);
  padding:10px 14px 6px;
}
.sl-item{
  display:flex;align-items:center;gap:10px;
  padding:7px 14px;cursor:pointer;transition:all .15s;
  font-size:12px;color:var(--text2);border-left:2px solid transparent;
}
.sl-item:hover{background:var(--panel2);color:var(--text);}
.sl-item.active{background:var(--accent-d2);color:var(--accent);border-left-color:var(--accent);}
.sl-icon{width:14px;height:14px;flex-shrink:0;opacity:.6;font-size:12px;line-height:14px;text-align:center;}
.sl-item.active .sl-icon{opacity:1;}
.sl-badge{
  margin-left:auto;font-family:'IBM Plex Mono',monospace;
  font-size:8px;padding:1px 5px;border-radius:2px;
}
.badge-new{background:var(--accent-d);color:var(--accent);}
.badge-warn{background:var(--amber-d);color:var(--amber);}

/* ‚ïê‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê‚ïê */
.main{
  overflow:hidden;display:flex;flex-direction:column;
}
.panel-content{
  display:none;flex:1;overflow:hidden;
  flex-direction:column;
}
.panel-content.active{display:flex;}

/* ‚îÄ PANEL HEADER ‚îÄ */
.panel-header{
  padding:12px 20px;border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  flex-shrink:0;background:var(--panel);
}
.ph-title{
  font-family:'IBM Plex Mono',monospace;font-size:11px;
  font-weight:600;letter-spacing:2px;text-transform:uppercase;
  color:var(--text);
}
.ph-sub{font-size:11px;color:var(--text3);margin-top:1px;}
.ph-actions{display:flex;gap:6px;}
.ph-btn{
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:2px;text-transform:uppercase;
  padding:5px 12px;border:1px solid var(--border2);
  background:none;color:var(--text2);cursor:pointer;transition:all .15s;
}
.ph-btn:hover{border-color:var(--accent);color:var(--accent);}
.ph-btn.primary{background:var(--accent);color:#000;border-color:var(--accent);font-weight:500;}
.ph-btn.primary:hover{background:#6ab5ff;transform:none;}

/* ‚ïê‚ïê‚ïê ANALISADOR DE FALA ‚ïê‚ïê‚ïê */
.analyzer-layout{
  display:grid;grid-template-columns:1fr 1fr;
  flex:1;overflow:hidden;
}
.analyzer-left{
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;
}
.analyzer-right{
  display:flex;flex-direction:column;overflow:hidden;
}

/* context bar */
.ctx-bar{
  display:flex;gap:0;border-bottom:1px solid var(--border);
  flex-shrink:0;overflow-x:auto;background:var(--panel);
}
.ctx-bar::-webkit-scrollbar{height:2px;}
.ctx-tab{
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:1px;text-transform:uppercase;
  padding:8px 14px;background:none;border:none;
  color:var(--text3);cursor:pointer;transition:all .15s;
  white-space:nowrap;border-bottom:2px solid transparent;flex-shrink:0;
}
.ctx-tab:hover{color:var(--text2);}
.ctx-tab.active{color:var(--accent);border-bottom-color:var(--accent);background:var(--accent-d2);}

/* input zone */
.input-zone{
  flex:1;display:flex;flex-direction:column;
  padding:16px;gap:10px;overflow:hidden;
}
.iz-label{
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:3px;text-transform:uppercase;color:var(--text3);
}
.speech-ta{
  flex:1;background:var(--panel2);
  border:1px solid var(--border);
  color:var(--text);font-family:'IBM Plex Serif',serif;
  font-size:15px;line-height:1.75;
  padding:16px;outline:none;resize:none;
  transition:border-color .2s;
}
.speech-ta:focus{border-color:var(--accent);}
.speech-ta::placeholder{color:var(--text3);font-style:italic;font-size:13px;}

.action-row{
  display:flex;align-items:center;justify-content:space-between;
  gap:12px;flex-wrap:wrap;flex-shrink:0;
}
.examples-row{display:flex;flex-wrap:wrap;gap:4px;}
.ex-chip{
  font-size:11px;padding:3px 9px;
  border:1px solid var(--border2);background:none;
  color:var(--text3);cursor:pointer;transition:all .15s;
}
.ex-chip:hover{border-color:var(--accent);color:var(--accent);}

.run-btn{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  font-weight:500;letter-spacing:2px;text-transform:uppercase;
  padding:9px 20px;background:var(--accent);color:#000;
  border:none;cursor:pointer;transition:all .2s;
  display:flex;align-items:center;gap:8px;flex-shrink:0;
}
.run-btn:hover{background:#6ab5ff;}
.run-btn:disabled{opacity:.4;cursor:not-allowed;}

/* result zone */
.result-zone{
  flex:1;overflow-y:auto;
}
.result-zone::-webkit-scrollbar{width:3px;}
.result-zone::-webkit-scrollbar-thumb{background:var(--border2);}

.result-empty{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  height:100%;gap:8px;
}
.re-icon{font-size:32px;opacity:.2;}
.re-msg{font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text3);}

/* loading */
.result-loading{
  display:flex;align-items:center;gap:12px;padding:20px;
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:2px;text-transform:uppercase;color:var(--text3);
}
.spin{
  width:14px;height:14px;border:2px solid var(--border2);
  border-top-color:var(--accent);border-radius:50%;
  animation:sp .6s linear infinite;flex-shrink:0;
}
@keyframes sp{to{transform:rotate(360deg);}}

/* result blocks */
.r-score-row{
  display:grid;grid-template-columns:100px 1fr;
  border-bottom:1px solid var(--border);
}
.r-score-block{
  padding:16px;border-right:1px solid var(--border);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
}
.score-n{
  font-family:'IBM Plex Mono',monospace;font-size:48px;
  font-weight:600;line-height:1;
}
.score-lbl{
  font-family:'IBM Plex Mono',monospace;font-size:8px;
  letter-spacing:2px;text-transform:uppercase;color:var(--text3);
  margin-top:3px;text-align:center;
}
.s-high{color:var(--red);}
.s-mid{color:var(--amber);}
.s-low{color:var(--green);}
.s-none{color:var(--text2);}

.r-verdict{padding:16px;}
.rv-lbl{
  font-family:'IBM Plex Mono',monospace;font-size:8px;
  letter-spacing:3px;text-transform:uppercase;color:var(--text3);
  margin-bottom:6px;
}
.rv-txt{
  font-family:'IBM Plex Mono',monospace;font-size:16px;
  font-weight:600;line-height:1.2;
}
.v-high{color:var(--red);}
.v-mid{color:var(--amber);}
.v-low{color:var(--green);}
.v-none{color:var(--text2);}

.r-blocks{display:flex;flex-direction:column;gap:0;}
.r-block{
  border-bottom:1px solid var(--border);padding:14px 16px;
}
.rb-label{
  font-family:'IBM Plex Mono',monospace;font-size:8px;
  letter-spacing:3px;text-transform:uppercase;color:var(--text3);
  margin-bottom:8px;display:flex;align-items:center;gap:6px;
}
.rb-dot{width:4px;height:4px;border-radius:50%;flex-shrink:0;}
.rb-content{font-size:12px;color:var(--text2);line-height:1.75;white-space:pre-wrap;}
.rb-content strong{color:var(--text);}

.markers-list{display:flex;flex-direction:column;gap:4px;}
.marker{
  display:flex;align-items:flex-start;gap:8px;
  font-size:12px;color:var(--text2);line-height:1.5;
  padding:5px 8px;background:var(--panel2);border-left:2px solid var(--accent);
}
.marker::before{content:'‚Üó';color:var(--accent);flex-shrink:0;font-size:10px;margin-top:2px;font-family:'IBM Plex Mono',monospace;}

.alt-block{
  background:var(--green-d);border-left:2px solid var(--green);
  padding:10px 12px;
  font-family:'IBM Plex Serif',serif;font-size:14px;font-style:italic;
  color:#a0f0b8;line-height:1.5;margin-bottom:8px;
}

/* honesty bar */
.honesty-bar{
  background:var(--panel2);border-top:1px solid var(--border);
  padding:10px 16px;flex-shrink:0;
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:1px;color:var(--text3);
  display:flex;align-items:center;gap:8px;
}
.hb-dot{width:5px;height:5px;border-radius:50%;background:var(--amber);flex-shrink:0;}

/* ‚ïê‚ïê‚ïê PESQUISAS ‚ïê‚ïê‚ïê */
.research-layout{
  flex:1;overflow:hidden;
  display:grid;grid-template-columns:200px 1fr;
}
.research-nav{
  border-right:1px solid var(--border);
  background:var(--panel);
  overflow-y:auto;
}
.rn-item{
  padding:10px 14px;cursor:pointer;transition:all .15s;
  font-size:11px;color:var(--text2);
  border-bottom:1px solid var(--border);
  border-left:2px solid transparent;
}
.rn-item:hover{background:var(--panel2);color:var(--text);}
.rn-item.active{color:var(--accent);border-left-color:var(--accent);background:var(--accent-d2);}
.rn-year{
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  color:var(--text3);margin-bottom:2px;
}
.rn-title{font-size:11px;line-height:1.35;}

.research-detail{
  overflow-y:auto;padding:24px 28px;
}
.research-detail::-webkit-scrollbar{width:3px;}
.research-detail::-webkit-scrollbar-thumb{background:var(--border2);}
.rd-empty{
  height:100%;display:flex;align-items:center;justify-content:center;
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:2px;text-transform:uppercase;color:var(--text3);
}
.rd-year{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:3px;color:var(--amber);text-transform:uppercase;
  margin-bottom:8px;display:flex;align-items:center;gap:8px;
}
.rd-title{
  font-family:'IBM Plex Serif',serif;font-size:28px;font-weight:400;
  line-height:1.2;margin-bottom:6px;color:var(--text);
}
.rd-author{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:1px;color:var(--text3);margin-bottom:20px;
}
.rd-section{margin-bottom:16px;}
.rd-section-lbl{
  font-family:'IBM Plex Mono',monospace;font-size:8px;
  letter-spacing:3px;text-transform:uppercase;color:var(--text3);
  margin-bottom:6px;padding-bottom:6px;border-bottom:1px solid var(--border);
}
.rd-section-txt{
  font-size:13px;color:var(--text2);line-height:1.8;
}
.rd-section-txt strong{color:var(--text);}
.rd-badges{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px;}
.rd-badge{
  font-family:'IBM Plex Mono',monospace;font-size:8px;
  letter-spacing:2px;text-transform:uppercase;
  padding:3px 8px;border:1px solid;
}
.b-lost{color:var(--red);border-color:var(--red);background:var(--red-d);}
.b-voice{color:var(--teal);border-color:var(--teal);background:var(--teal-d);}
.b-fluency{color:var(--purple);border-color:var(--purple);background:var(--purple-d);}
.b-aphasia{color:var(--green);border-color:var(--green);background:var(--green-d);}
.b-swallow{color:var(--amber);border-color:var(--amber);background:var(--amber-d);}
.b-hearing{color:var(--text2);border-color:var(--border2);background:var(--panel2);}
.b-infant{color:#cf9b50;border-color:#cf9b50;background:rgba(207,155,80,.08);}
.b-lang{color:#72a8cf;border-color:#72a8cf;background:rgba(114,168,207,.08);}

/* ‚ïê‚ïê‚ïê CONSULTA IA ‚ïê‚ïê‚ïê */
.consult-layout{
  flex:1;overflow:hidden;
  display:flex;flex-direction:column;
}
.consult-input{
  border-bottom:1px solid var(--border);
  padding:12px 16px;background:var(--panel);
  flex-shrink:0;
}
.ci-row{display:flex;gap:8px;align-items:flex-start;}
.ci-context{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:1px;text-transform:uppercase;
  padding:8px 12px;border:1px solid var(--border2);
  background:var(--panel2);color:var(--text2);cursor:pointer;
  transition:all .15s;flex-shrink:0;align-self:stretch;
}
.ci-context.sel{border-color:var(--accent);color:var(--accent);background:var(--accent-d);}
.ci-ta{
  flex:1;background:var(--panel2);border:1px solid var(--border);
  color:var(--text);font-family:'IBM Plex Serif',serif;font-size:14px;
  padding:9px 12px;outline:none;resize:none;min-height:38px;
  transition:border-color .2s;line-height:1.5;
}
.ci-ta:focus{border-color:var(--accent);}
.ci-ta::placeholder{color:var(--text3);font-style:italic;font-size:12px;}
.ci-send{
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:2px;text-transform:uppercase;
  padding:9px 16px;background:var(--accent);color:#000;
  border:none;cursor:pointer;font-weight:500;flex-shrink:0;
  align-self:flex-end;transition:all .2s;
}
.ci-send:hover{background:#6ab5ff;}
.ci-send:disabled{opacity:.4;cursor:not-allowed;}

.chips-row{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px;}
.chip{
  font-size:10px;padding:3px 8px;
  border:1px solid var(--border2);background:none;
  color:var(--text3);cursor:pointer;transition:all .15s;
  font-family:'IBM Plex Mono',monospace;letter-spacing:.5px;
}
.chip:hover{border-color:var(--accent);color:var(--accent);}

.consult-output{
  flex:1;overflow-y:auto;padding:20px 24px;
}
.consult-output::-webkit-scrollbar{width:3px;}
.consult-output::-webkit-scrollbar-thumb{background:var(--border2);}

.co-entry{
  border-bottom:1px solid var(--border);
  padding-bottom:20px;margin-bottom:20px;
}
.co-q{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:1px;color:var(--text3);
  margin-bottom:8px;padding:8px 10px;
  background:var(--panel2);border-left:2px solid var(--accent);
}
.co-a{
  font-size:13px;color:var(--text2);line-height:1.85;
  white-space:pre-wrap;
}
.co-a strong{color:var(--text);}
.caret{
  display:inline-block;width:2px;height:.85em;
  background:var(--accent);animation:pulse .8s infinite;
  vertical-align:middle;margin-left:1px;
}
.co-placeholder{
  display:flex;flex-direction:column;gap:6px;
  padding:24px 0;
}
.cop-msg{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:2px;text-transform:uppercase;color:var(--text3);
}

/* ‚ïê‚ïê‚ïê MODULES ‚ïê‚ïê‚ïê */
.modules-grid{
  flex:1;overflow-y:auto;padding:16px;
  display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:8px;align-content:start;
}
.modules-grid::-webkit-scrollbar{width:3px;}
.modules-grid::-webkit-scrollbar-thumb{background:var(--border2);}
.mod-card{
  background:var(--panel);border:1px solid var(--border);
  padding:16px;cursor:pointer;transition:all .2s;
  position:relative;overflow:hidden;
}
.mod-card:hover{border-color:var(--border2);background:var(--panel2);}
.mod-card.active-mod{border-color:var(--accent);background:var(--accent-d2);}
.mc-tag{
  font-family:'IBM Plex Mono',monospace;font-size:8px;
  letter-spacing:2px;text-transform:uppercase;color:var(--text3);
  margin-bottom:8px;
}
.mc-icon{font-size:20px;margin-bottom:8px;}
.mc-title{
  font-size:13px;font-weight:500;color:var(--text);
  margin-bottom:4px;line-height:1.3;
}
.mc-desc{font-size:11px;color:var(--text3);line-height:1.5;}
.mc-status{
  position:absolute;top:10px;right:10px;
  font-family:'IBM Plex Mono',monospace;font-size:7px;
  letter-spacing:2px;text-transform:uppercase;
  padding:2px 6px;border:1px solid;
}
.ms-live{color:var(--green);border-color:rgba(62,207,106,.3);}
.ms-ai{color:var(--accent);border-color:var(--accent-d);}
.ms-beta{color:var(--amber);border-color:var(--amber-d);}

/* ‚ïê‚ïê‚ïê RIGHT SIDEBAR ‚ïê‚ïê‚ïê */
.sidebar-r{
  background:var(--panel);
  border-left:1px solid var(--border);
  display:flex;flex-direction:column;overflow:hidden;
}
.sr-tab-row{
  display:flex;gap:0;border-bottom:1px solid var(--border);flex-shrink:0;
}
.sr-tab{
  flex:1;font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:1px;text-transform:uppercase;
  padding:9px 6px;background:none;border:none;
  color:var(--text3);cursor:pointer;transition:all .15s;
  border-bottom:2px solid transparent;
}
.sr-tab:hover{color:var(--text2);}
.sr-tab.active{color:var(--accent);border-bottom-color:var(--accent);}

.sr-content{flex:1;overflow-y:auto;padding:14px;}
.sr-content::-webkit-scrollbar{width:2px;}
.sr-content::-webkit-scrollbar-thumb{background:var(--border2);}

/* info widgets */
.info-block{
  background:var(--panel2);border:1px solid var(--border);
  margin-bottom:8px;overflow:hidden;
}
.ib-header{
  padding:8px 12px;border-bottom:1px solid var(--border);
  display:flex;justify-content:space-between;align-items:center;
}
.ib-title{
  font-family:'IBM Plex Mono',monospace;font-size:8px;
  letter-spacing:2px;text-transform:uppercase;color:var(--text3);
}
.ib-badge{
  font-family:'IBM Plex Mono',monospace;font-size:7px;
  letter-spacing:1px;padding:1px 5px;
}
.ib-body{padding:10px 12px;}

.stat-row{
  display:flex;justify-content:space-between;align-items:center;
  padding:4px 0;border-bottom:1px solid var(--border);
}
.stat-row:last-child{border-bottom:none;}
.sr-lbl{font-size:11px;color:var(--text3);}
.sr-val{
  font-family:'IBM Plex Mono',monospace;font-size:11px;
  color:var(--text);font-weight:500;
}
.sr-val.hi{color:var(--amber);}
.sr-val.ok{color:var(--green);}
.sr-val.crit{color:var(--red);}

.ref-item{
  padding:8px 0;border-bottom:1px solid var(--border);
  cursor:pointer;transition:all .15s;
}
.ref-item:last-child{border-bottom:none;}
.ref-item:hover .ref-title{color:var(--accent);}
.ref-year{
  font-family:'IBM Plex Mono',monospace;font-size:8px;
  color:var(--amber);letter-spacing:1px;margin-bottom:2px;
}
.ref-title{font-size:11px;color:var(--text2);line-height:1.35;transition:color .15s;}

/* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
.modal-ov{
  position:fixed;inset:0;background:rgba(11,14,19,.85);
  z-index:1000;display:flex;align-items:center;justify-content:center;
  backdrop-filter:blur(8px);
}
.modal{
  background:var(--panel);border:1px solid var(--border2);
  width:460px;padding:28px;
  animation:fadein .2s ease;
}
@keyframes fadein{from{opacity:0;transform:translateY(-8px);}to{opacity:1;transform:none;}}
.modal-title{
  font-family:'IBM Plex Mono',monospace;font-size:12px;
  font-weight:600;letter-spacing:2px;text-transform:uppercase;
  color:var(--text);margin-bottom:4px;
}
.modal-sub{font-size:12px;color:var(--text3);margin-bottom:20px;line-height:1.6;}
.modal-steps{
  border-left:2px solid var(--accent);padding:12px 16px;
  background:var(--panel2);margin-bottom:16px;
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:.5px;color:var(--text2);line-height:2.2;
}
.modal-steps a{color:var(--accent);text-decoration:none;}
.modal-steps a:hover{text-decoration:underline;}
.modal-steps strong{color:var(--text);}
.kinp-row{display:flex;gap:0;margin-bottom:10px;}
.kinp{
  flex:1;background:var(--panel2);border:1px solid var(--border2);border-right:none;
  color:var(--text);font-family:'IBM Plex Mono',monospace;font-size:12px;
  padding:10px 14px;outline:none;
}
.kinp:focus{border-color:var(--accent);}
.keye{
  background:var(--panel2);border:1px solid var(--border2);
  padding:10px 12px;cursor:pointer;color:var(--text2);font-size:14px;
}
.modal-note{
  font-family:'IBM Plex Mono',monospace;font-size:9px;
  letter-spacing:.5px;color:var(--text3);
  line-height:2.0;margin-bottom:16px;
}
.modal-note strong{color:var(--text2);}
.modal-btns{display:flex;gap:8px;}
.mbtn-s{
  flex:1;font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:2px;text-transform:uppercase;
  padding:11px;background:var(--accent);color:#000;border:none;cursor:pointer;
  font-weight:500;transition:all .2s;
}
.mbtn-s:hover{background:#6ab5ff;}
.mbtn-c{
  font-family:'IBM Plex Mono',monospace;font-size:10px;
  letter-spacing:2px;text-transform:uppercase;
  padding:11px 16px;background:none;color:var(--text3);
  border:1px solid var(--border2);cursor:pointer;transition:all .2s;
}
.mbtn-c:hover{border-color:var(--text2);color:var(--text2);}

/* RESPONSIVE / SMALL SCREENS */
@media(max-width:1100px){
  .workspace{grid-template-columns:180px 1fr 240px;}
}
@media(max-width:860px){
  .workspace{grid-template-columns:1fr;}
  .sidebar-l,.sidebar-r{display:none;}
  .analyzer-layout{grid-template-columns:1fr;}
  .analyzer-left{border-right:none;border-bottom:1px solid var(--border);min-height:300px;}
  html,body{overflow:auto;}
  .shell{height:auto;}
  .workspace,.main,.panel-content,.analyzer-layout{overflow:visible;height:auto;}
  .speech-ta{min-height:140px;}
}
</style>
</head>
<body>

<div class="shell">

  <!-- ‚ïê‚ïê‚ïê TOPBAR ‚ïê‚ïê‚ïê -->
  <div class="topbar">
    <div class="tb-logo">PHONO<em>BASE</em>&nbsp;CLINICAL</div>
    <div class="tb-tabs">
      <button class="tb-tab active" onclick="showPanel('analisador')" id="tab-analisador">Analisador de Fala</button>
      <button class="tb-tab" onclick="showPanel('pesquisas')" id="tab-pesquisas">Pesquisas Hist√≥ricas</button>
      <button class="tb-tab" onclick="showPanel('consulta')" id="tab-consulta">Consulta IA</button>
      <button class="tb-tab" onclick="showPanel('modulos')" id="tab-modulos">M√≥dulos</button>
    </div>
    <div class="tb-right">
      <div class="key-indicator off" id="ki" onclick="openModal()">
        <span class="kdot kdot-off" id="ki-dot"></span>
        <span id="ki-txt">Ativar IA</span>
      </div>
      <div class="tb-time" id="clock">--:--</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê WORKSPACE ‚ïê‚ïê‚ïê -->
  <div class="workspace">

    <!-- ‚îÄ LEFT SIDEBAR ‚îÄ -->
    <div class="sidebar-l">
      <div class="sl-section">
        <div class="sl-header">An√°lise</div>
        <div class="sl-item active" onclick="showPanel('analisador');setSub('infantil')">
          <span class="sl-icon">üó£</span> Fala Infantilizada
          <span class="sl-badge badge-new">NOVO</span>
        </div>
        <div class="sl-item" onclick="showPanel('analisador');setSub('voz')">
          <span class="sl-icon">üéô</span> Padr√£o Vocal
        </div>
        <div class="sl-item" onclick="showPanel('analisador');setSub('fluencia')">
          <span class="sl-icon">üí¨</span> Flu√™ncia
        </div>
        <div class="sl-item" onclick="showPanel('analisador');setSub('linguagem')">
          <span class="sl-icon">üìù</span> Linguagem
        </div>
        <div class="sl-item" onclick="showPanel('analisador');setSub('degluti√ß√£o')">
          <span class="sl-icon">üçΩ</span> Relato de Degluti√ß√£o
        </div>
        <div class="sl-item" onclick="showPanel('analisador');setSub('afasia')">
          <span class="sl-icon">üß†</span> Afasia / Neuro
        </div>
      </div>
      <div class="sl-section">
        <div class="sl-header">Base Cient√≠fica</div>
        <div class="sl-item" onclick="showPanel('pesquisas')">
          <span class="sl-icon">üìö</span> Pesquisas Hist√≥ricas
        </div>
        <div class="sl-item" onclick="showPanel('consulta')">
          <span class="sl-icon">ü§ñ</span> Consulta IA
        </div>
      </div>
      <div class="sl-section">
        <div class="sl-header">Ferramentas</div>
        <div class="sl-item" onclick="showPanel('modulos')">
          <span class="sl-icon">‚öô</span> M√≥dulos Cl√≠nicos
        </div>
      </div>
      <div style="margin-top:auto;padding:14px;border-top:1px solid var(--border);">
        <div style="font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:6px;">Aviso cl√≠nico</div>
        <div style="font-size:11px;color:var(--text3);line-height:1.6;">Esta plataforma √© suporte de decis√£o ‚Äî n√£o substitui avalia√ß√£o fonoaudiol√≥gica presencial.</div>
      </div>
    </div>

    <!-- ‚îÄ MAIN ‚îÄ -->
    <div class="main">

      <!-- ‚ïê‚ïê ANALISADOR ‚ïê‚ïê -->
      <div class="panel-content active" id="panel-analisador">
        <div class="panel-header">
          <div>
            <div class="ph-title">Analisador de Fala</div>
            <div class="ph-sub" id="ph-sub-txt">Cole ou transcreva a fala do paciente para an√°lise cl√≠nica com IA</div>
          </div>
          <div class="ph-actions">
            <button class="ph-btn" onclick="clearAnalyzer()">Limpar</button>
            <button class="ph-btn primary" onclick="runAnalysis()">Analisar</button>
          </div>
        </div>

        <div class="analyzer-layout">
          <!-- INPUT SIDE -->
          <div class="analyzer-left">
            <!-- context tabs -->
            <div class="ctx-bar">
              <button class="ctx-tab active" data-ctx="infantil" onclick="pickCtx(this)">Fala Infantilizada</button>
              <button class="ctx-tab" data-ctx="voz" onclick="pickCtx(this)">Padr√£o Vocal</button>
              <button class="ctx-tab" data-ctx="fluencia" onclick="pickCtx(this)">Flu√™ncia</button>
              <button class="ctx-tab" data-ctx="linguagem" onclick="pickCtx(this)">Linguagem</button>
              <button class="ctx-tab" data-ctx="degluticao" onclick="pickCtx(this)">Degluti√ß√£o</button>
              <button class="ctx-tab" data-ctx="afasia" onclick="pickCtx(this)">Afasia / Neuro</button>
            </div>

            <div class="input-zone">
              <div class="iz-label" id="iz-lbl">Transcri√ß√£o da fala / texto a analisar:</div>
              <textarea class="speech-ta" id="speech-ta" rows="8"
                placeholder="Cole aqui a transcri√ß√£o da fala, relato do paciente, ou texto a ser analisado‚Ä¶"></textarea>
              <div class="action-row">
                <div>
                  <div style="font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:5px;">Exemplos</div>
                  <div class="examples-row" id="examples-row"></div>
                </div>
                <button class="run-btn" id="run-btn" onclick="runAnalysis()">
                  <div class="spin" id="run-spin" style="display:none;"></div>
                  <span id="run-txt">Analisar</span>
                </button>
              </div>
            </div>

            <div class="honesty-bar">
              <span class="hb-dot"></span>
              A an√°lise identifica apenas padr√µes presentes no texto. Aus√™ncia de marcadores n√£o descarta patologia. Avalia√ß√£o presencial √© insubstitu√≠vel.
            </div>
          </div>

          <!-- RESULT SIDE -->
          <div class="analyzer-right">
            <div style="padding:10px 14px;border-bottom:1px solid var(--border);background:var(--panel);flex-shrink:0;">
              <div style="font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--text3);">Resultado da An√°lise</div>
            </div>
            <div class="result-zone" id="result-zone">
              <div class="result-empty" id="result-empty">
                <div class="re-icon">‚óà</div>
                <div class="re-msg">Aguardando an√°lise</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê PESQUISAS ‚ïê‚ïê -->
      <div class="panel-content" id="panel-pesquisas">
        <div class="panel-header">
          <div>
            <div class="ph-title">Pesquisas Hist√≥ricas</div>
            <div class="ph-sub">Descobertas esquecidas com aplica√ß√£o cl√≠nica real ¬∑ 1854‚Äì2026</div>
          </div>
          <div class="ph-actions">
            <select id="re-filter" onchange="filterResearch()" style="font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:1px;text-transform:uppercase;background:var(--panel2);color:var(--text2);border:1px solid var(--border2);padding:5px 10px;outline:none;cursor:pointer;">
              <option value="all">Todas as √°reas</option>
              <option value="lost">Esquecidas / Perdidas</option>
              <option value="voice">Voz & Laringe</option>
              <option value="fluency">Flu√™ncia</option>
              <option value="aphasia">Afasia & Neuro</option>
              <option value="swallow">Degluti√ß√£o</option>
              <option value="hearing">Audi√ß√£o</option>
              <option value="infant">Fala Infantilizada</option>
              <option value="lang">Linguagem</option>
            </select>
          </div>
        </div>
        <div class="research-layout">
          <div class="research-nav" id="research-nav"></div>
          <div class="research-detail" id="research-detail">
            <div class="rd-empty">Selecione uma pesquisa ao lado</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê CONSULTA ‚ïê‚ïê -->
      <div class="panel-content" id="panel-consulta">
        <div class="panel-header">
          <div>
            <div class="ph-title">Consulta IA Cl√≠nica</div>
            <div class="ph-sub">Fonoaudiologia baseada em evid√™ncia ¬∑ 170 anos de pesquisa</div>
          </div>
          <div class="ph-actions">
            <button class="ph-btn" id="mode-clinica" onclick="setConsultMode('clinica',this)">Protocolo</button>
            <button class="ph-btn" id="mode-historica" onclick="setConsultMode('historica',this)">Hist√≥rico</button>
            <button class="ph-btn" id="mode-brasil" onclick="setConsultMode('brasil',this)">Brasil</button>
          </div>
        </div>
        <div class="consult-layout">
          <div class="consult-input">
            <div class="ci-row">
              <textarea class="ci-ta" id="ci-ta" rows="2"
                placeholder="Ex: Paciente 68 anos, rouquid√£o h√° 3 meses, sem dor, fumante 30 anos ‚Äî hip√≥teses diagn√≥sticas e conduta?"
                onkeydown="if(event.ctrlKey&&event.key==='Enter')runConsult()"></textarea>
              <button class="ci-send" id="ci-send" onclick="runConsult()">Enviar</button>
            </div>
            <div class="chips-row">
              <button class="chip" onclick="setConsultQ('Crit√©rios diagn√≥sticos e conduta em presbifonia: quando indicar terapia vs. cirurgia?')">Presbifonia</button>
              <button class="chip" onclick="setConsultQ('Como diferenciar disfonia funcional de disfonia organofuncional na anamnese?')">Disfonia</button>
              <button class="chip" onclick="setConsultQ('Protocolo de triagem de disfagia p√≥s-AVC: quais sinais de alerta e quando encaminhar para FEES?')">Disfagia p√≥s-AVC</button>
              <button class="chip" onclick="setConsultQ('Gagueira em adulto: quando indica terapia flu√™ncia-shaping vs. stuttering modification?')">Gagueira adulto</button>
              <button class="chip" onclick="setConsultQ('Afasia de Broca vs. Wernicke: diferen√ßas cl√≠nicas na avalia√ß√£o informal √† beira do leito?')">Afasia beira leito</button>
              <button class="chip" onclick="setConsultQ('M√©todo Mastigado de Froeschels 1924: protocolo cl√≠nico, indica√ß√µes e contraindica√ß√µes?')">Froeschels</button>
              <button class="chip" onclick="setConsultQ('Quais pesquisas hist√≥ricas de fonoaudiologia foram esquecidas e t√™m aplica√ß√£o cl√≠nica hoje?')">Pesquisas esquecidas</button>
              <button class="chip" onclick="setConsultQ('Elderspeak: como treinar uma equipe de ILPI em 4 horas segundo Williams 2004?')">Treinar ILPI</button>
            </div>
          </div>
          <div class="consult-output" id="consult-output">
            <div class="co-placeholder">
              <div class="cop-msg">‚óà &nbsp; Aguardando consulta</div>
              <div style="font-size:11px;color:var(--text3);margin-top:4px;">Use Ctrl+Enter para enviar ¬∑ Escolha o modo no cabe√ßalho</div>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê M√ìDULOS ‚ïê‚ïê -->
      <div class="panel-content" id="panel-modulos">
        <div class="panel-header">
          <div>
            <div class="ph-title">M√≥dulos Cl√≠nicos</div>
            <div class="ph-sub">Ferramentas especializadas de avalia√ß√£o e suporte</div>
          </div>
        </div>
        <div class="modules-grid">
          <div class="mod-card" onclick="showPanel('analisador');pickCtxByName('infantil')">
            <div class="mc-status ms-ai">IA</div>
            <div class="mc-tag">01 ¬∑ Linguagem</div>
            <div class="mc-icon">üó£</div>
            <div class="mc-title">Analisador de Fala Infantilizada</div>
            <div class="mc-desc">Detecta patronizing speech, elderspeak e infantiliza√ß√£o em todos os contextos adultos.</div>
          </div>
          <div class="mod-card" onclick="showPanel('analisador');pickCtxByName('voz')">
            <div class="mc-status ms-ai">IA</div>
            <div class="mc-tag">02 ¬∑ Voz</div>
            <div class="mc-icon">üéô</div>
            <div class="mc-title">Analisador de Padr√£o Vocal</div>
            <div class="mc-desc">Identifica padr√µes de disfonia funcional, comportamentos compensat√≥rios e sinais de alerta em transcri√ß√µes.</div>
          </div>
          <div class="mod-card" onclick="showPanel('analisador');pickCtxByName('fluencia')">
            <div class="mc-status ms-ai">IA</div>
            <div class="mc-tag">03 ¬∑ Flu√™ncia</div>
            <div class="mc-icon">üí¨</div>
            <div class="mc-title">Analisador de Flu√™ncia</div>
            <div class="mc-desc">Tipifica disflu√™ncias, calcula taxa aproximada e diferencia gagueira de disflu√™ncia comum.</div>
          </div>
          <div class="mod-card" onclick="showPanel('analisador');pickCtxByName('linguagem')">
            <div class="mc-status ms-ai">IA</div>
            <div class="mc-tag">04 ¬∑ Linguagem</div>
            <div class="mc-icon">üìù</div>
            <div class="mc-title">An√°lise de Linguagem</div>
            <div class="mc-desc">Avalia complexidade sint√°tica, coer√™ncia discursiva, marcadores de altera√ß√£o de linguagem.</div>
          </div>
          <div class="mod-card" onclick="showPanel('analisador');pickCtxByName('degluticao')">
            <div class="mc-status ms-ai">IA</div>
            <div class="mc-tag">05 ¬∑ Degluti√ß√£o</div>
            <div class="mc-icon">üçΩ</div>
            <div class="mc-title">Triagem de Disfagia por Relato</div>
            <div class="mc-desc">Analisa relato de sintomas de degluti√ß√£o e identifica sinais de risco para encaminhamento.</div>
          </div>
          <div class="mod-card" onclick="showPanel('analisador');pickCtxByName('afasia')">
            <div class="mc-status ms-ai">IA</div>
            <div class="mc-tag">06 ¬∑ Neurologia</div>
            <div class="mc-icon">üß†</div>
            <div class="mc-title">An√°lise de Afasia</div>
            <div class="mc-desc">Identifica padr√µes compat√≠veis com diferentes tipos de afasia a partir de amostras de fala.</div>
          </div>
          <div class="mod-card" onclick="showPanel('pesquisas')">
            <div class="mc-status ms-live">Ativo</div>
            <div class="mc-tag">07 ¬∑ Refer√™ncia</div>
            <div class="mc-icon">üìö</div>
            <div class="mc-title">Banco de Pesquisas Hist√≥ricas</div>
            <div class="mc-desc">Descobertas esquecidas de 1854 a 2026 com aplica√ß√£o cl√≠nica documentada.</div>
          </div>
          <div class="mod-card" onclick="showPanel('consulta')">
            <div class="mc-status ms-ai">IA</div>
            <div class="mc-tag">08 ¬∑ IA</div>
            <div class="mc-icon">ü§ñ</div>
            <div class="mc-title">Consulta IA Cl√≠nica</div>
            <div class="mc-desc">Suporte de decis√£o baseado em evid√™ncia para diagn√≥stico diferencial e conduta.</div>
          </div>
        </div>
      </div>

    </div><!-- /main -->

    <!-- ‚îÄ RIGHT SIDEBAR ‚îÄ -->
    <div class="sidebar-r">
      <div class="sr-tab-row">
        <button class="sr-tab active" onclick="showSrTab('info',this)">Info</button>
        <button class="sr-tab" onclick="showSrTab('refs',this)">Refs</button>
        <button class="sr-tab" onclick="showSrTab('stats',this)">Stats</button>
      </div>

      <div class="sr-content" id="sr-info">
        <div class="info-block">
          <div class="ib-header">
            <div class="ib-title">Contexto ativo</div>
            <div class="ib-badge ms-ai">IA</div>
          </div>
          <div class="ib-body">
            <div id="sr-ctx-name" style="font-size:12px;color:var(--text);margin-bottom:4px;font-weight:500;">Fala Infantilizada</div>
            <div id="sr-ctx-desc" style="font-size:11px;color:var(--text3);line-height:1.6;">Detecta patronizing speech, elderspeak e condescending communication em qualquer texto adulto.</div>
          </div>
        </div>
        <div class="info-block">
          <div class="ib-header"><div class="ib-title">Refer√™ncia r√°pida</div></div>
          <div class="ib-body">
            <div class="stat-row"><span class="sr-lbl">Kemper 1994</span><span class="sr-val">Elderspeak</span></div>
            <div class="stat-row"><span class="sr-lbl">Ryan 1986</span><span class="sr-val">Predicament</span></div>
            <div class="stat-row"><span class="sr-lbl">Williams 2003</span><span class="sr-val">84% ILPI</span></div>
            <div class="stat-row"><span class="sr-lbl">Williams 2004</span><span class="sr-val">‚àí58% treino</span></div>
          </div>
        </div>
        <div class="info-block">
          <div class="ib-header"><div class="ib-title">Importante</div></div>
          <div class="ib-body">
            <div style="font-size:11px;color:var(--text3);line-height:1.7;">
              A IA analisa apenas o que est√° no texto.<br>
              <strong style="color:var(--amber);">N√£o inventa dados.</strong><br>
              Se o texto for insuficiente, o resultado dir√° isso.
            </div>
          </div>
        </div>
      </div>

      <div class="sr-content" id="sr-refs" style="display:none;">
        <div style="font-family:'IBM Plex Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--text3);margin-bottom:12px;">Refer√™ncias r√°pidas</div>
        <div id="refs-list"></div>
      </div>

      <div class="sr-content" id="sr-stats" style="display:none;">
        <div class="info-block">
          <div class="ib-header"><div class="ib-title">Sess√£o atual</div></div>
          <div class="ib-body">
            <div class="stat-row"><span class="sr-lbl">An√°lises</span><span class="sr-val" id="stat-analyses">0</span></div>
            <div class="stat-row"><span class="sr-lbl">Consultas IA</span><span class="sr-val" id="stat-consults">0</span></div>
            <div class="stat-row"><span class="sr-lbl">√öltimo score</span><span class="sr-val" id="stat-last-score">‚Äî</span></div>
          </div>
        </div>
        <div class="info-block">
          <div class="ib-header"><div class="ib-title">Preval√™ncia (evid√™ncia)</div></div>
          <div class="ib-body">
            <div class="stat-row"><span class="sr-lbl">Elderspeak ILPI</span><span class="sr-val hi">84%</span></div>
            <div class="stat-row"><span class="sr-lbl">Disfagia p√≥s-AVC</span><span class="sr-val hi">65‚Äì78%</span></div>
            <div class="stat-row"><span class="sr-lbl">Disfonia funcional</span><span class="sr-val hi">~40% disfonias</span></div>
            <div class="stat-row"><span class="sr-lbl">Gagueira (pop.)</span><span class="sr-val ok">~1%</span></div>
            <div class="stat-row"><span class="sr-lbl">Afasia p√≥s-AVC</span><span class="sr-val hi">~30%</span></div>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /workspace -->
</div><!-- /shell -->

<!-- MODAL -->
<div class="modal-ov" id="modal" style="display:none" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-title">Configurar Chave Gemini AI</div>
    <div class="modal-sub">Necess√°rio para todas as fun√ß√µes de IA. Chave gratuita do Google AI Studio.</div>
    <div class="modal-steps">
      1 ‚Üí <a href="https://aistudio.google.com/apikey" target="_blank">aistudio.google.com/apikey</a><br>
      2 ‚Üí Login com conta Google<br>
      3 ‚Üí Clique em <strong>"Create API Key"</strong><br>
      4 ‚Üí Cole a chave abaixo (come√ßa com <strong>AIza‚Ä¶</strong>)
    </div>
    <div class="kinp-row">
      <input type="password" class="kinp" id="kinp" placeholder="AIzaSy‚Ä¶" autocomplete="off">
      <button class="keye" onclick="document.getElementById('kinp').type=document.getElementById('kinp').type==='password'?'text':'password'">üëÅ</button>
    </div>
    <div class="modal-note">
      üîí <strong>Salva s√≥ no navegador</strong> ‚Äî n√£o √© enviada a terceiros<br>
      üÜì <strong>Gratuita</strong> ‚Äî 1.500 consultas/dia<br>
      üóë Para apagar: localStorage.removeItem no console do navegador
    </div>
    <div class="modal-btns">
      <button class="mbtn-s" onclick="saveKey()">Salvar e Ativar</button>
      <button class="mbtn-c" onclick="closeModal()">Cancelar</button>
    </div>
  </div>
</div>

<script>
'use strict';

/* ‚îÄ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ‚îÄ */
function tick(){
  const n=new Date();
  document.getElementById('clock').textContent=
    String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0')+':'+String(n.getSeconds()).padStart(2,'0');
}
tick();setInterval(tick,1000);

/* ‚îÄ‚îÄ‚îÄ SESSION STATS ‚îÄ‚îÄ‚îÄ */
let sessionStats={analyses:0,consults:0,lastScore:'‚Äî'};
function updateStats(){
  document.getElementById('stat-analyses').textContent=sessionStats.analyses;
  document.getElementById('stat-consults').textContent=sessionStats.consults;
  document.getElementById('stat-last-score').textContent=sessionStats.lastScore;
}

/* ‚îÄ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ */
function showPanel(name){
  document.querySelectorAll('.panel-content').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tb-tab').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.sl-item').forEach(b=>b.classList.remove('active'));
  const p=document.getElementById('panel-'+name);
  const t=document.getElementById('tab-'+name);
  if(p)p.classList.add('active');
  if(t)t.classList.add('active');
}
function setSub(name){
  // also switch ctx tab
  const tab=document.querySelector(`.ctx-tab[data-ctx="${name}"]`);
  if(tab)tab.click();
}
function showSrTab(name,btn){
  document.querySelectorAll('.sr-content').forEach(c=>c.style.display='none');
  document.querySelectorAll('.sr-tab').forEach(b=>b.classList.remove('active'));
  document.getElementById('sr-'+name).style.display='block';
  btn.classList.add('active');
}

/* ‚îÄ‚îÄ‚îÄ API KEY ‚îÄ‚îÄ‚îÄ */
const KS='phonobase_cli_2026';
const getKey=()=>localStorage.getItem(KS)||'';
function openModal(){
  document.getElementById('kinp').value=getKey();
  document.getElementById('kinp').type='password';
  document.getElementById('modal').style.display='flex';
  setTimeout(()=>document.getElementById('kinp').focus(),80);
}
function closeModal(){document.getElementById('modal').style.display='none';}
document.getElementById('kinp').addEventListener('keydown',e=>{if(e.key==='Enter')saveKey();});
function saveKey(){
  const k=document.getElementById('kinp').value.trim();
  if(!k){alert('Insira a chave.');return;}
  if(!k.startsWith('AIza')){alert('Chave inv√°lida ‚Äî deve come√ßar com AIza');return;}
  localStorage.setItem(KS,k);updateKeyUI();closeModal();
}
function updateKeyUI(){
  const k=getKey();
  const ki=document.getElementById('ki');
  const kd=document.getElementById('ki-dot');
  const kt=document.getElementById('ki-txt');
  if(k){
    ki.className='key-indicator on';
    kd.className='kdot kdot-on';
    kt.textContent='IA ¬∑ '+k.slice(0,8)+'‚Ä¶';
  } else {
    ki.className='key-indicator off';
    kd.className='kdot kdot-off';
    kt.textContent='Ativar IA';
  }
}
updateKeyUI();


/* ‚îÄ‚îÄ‚îÄ GEMINI ‚îÄ‚îÄ‚îÄ */
async function gemini(prompt){
  const k=getKey();
  if(!k){openModal();return null;}

  const MODELS=['gemini-1.5-flash','gemini-2.0-flash'];
  let lastErr='Sem resposta da API.';

  for(const model of MODELS){
    let res,json;
    try{
      res=await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${k}`,
        {method:'POST',headers:{'Content-Type':'application/json'},
         body:JSON.stringify({
           contents:[{parts:[{text:prompt}]}],
           generationConfig:{maxOutputTokens:800,temperature:0.3}
         })}
      );
      json=await res.json().catch(()=>({}));
    }catch(e){
      lastErr=`Erro de rede: ${e.message}`;
      continue;
    }

    if(!res.ok){
      const code=res.status;
      const msg=(json?.error?.message||'').slice(0,200);
      // 400 = chave/request inv√°lido ‚Äî n√£o adianta tentar outro modelo
      if(code===400)return`‚ùå Chave inv√°lida ou request malformado (400).\n${msg}\n\nGere uma nova chave em aistudio.google.com/apikey`;
      // 403 = sem permiss√£o ‚Äî tenta pr√≥ximo modelo
      if(code===403){lastErr=`‚ùå Sem permiss√£o para ${model} (403).\n${msg}`;continue;}
      // 429 = cota ‚Äî tenta pr√≥ximo modelo
      if(code===429){lastErr=`‚ùå Cota esgotada em ${model} (429).\n${msg||'Aguarde ~1 minuto e tente novamente. Plano gratuito: 15 req/min.'}`;continue;}
      // 5xx ‚Äî tenta pr√≥ximo
      if(code>=500){lastErr=`‚ùå Servidor Google inst√°vel (${code}). Tente novamente.`;continue;}
      lastErr=`‚ùå Erro ${code}: ${msg}`;
      continue;
    }

    const text=json?.candidates?.[0]?.content?.parts?.[0]?.text;
    if(text)return text;

    // finish_reason pode ser SAFETY ou MAX_TOKENS
    const reason=json?.candidates?.[0]?.finishReason;
    if(reason==='SAFETY')return'‚ùå Conte√∫do bloqueado por filtros de seguran√ßa do Google.';
    if(reason==='MAX_TOKENS')return'‚ùå Resposta cortada (limite de tokens). Tente um texto menor.';
    lastErr='Resposta vazia do modelo.';
  }
  return lastErr;
}

/* ‚îÄ‚îÄ‚îÄ CONTEXTS ‚îÄ‚îÄ‚îÄ */
// Cada contexto define: label, desc, placeholder, exemplos, refs, e a fun√ß√£o prompt(txt)->string
const CTX={
  infantil:{
    label:'Fala Infantilizada',
    desc:'Detecta patronizing speech, elderspeak e condescending communication. Analisa padr√µes lingu√≠sticos ‚Äî tom de voz real n√£o √© avali√°vel por texto.',
    ph:'Cole a transcri√ß√£o da fala do cuidador, familiar, colega ou profissional de sa√∫de‚Ä¶',
    ex:['Vovozinha, a gente vai tomar o remedinho agora, t√° bem meu amor?','Deixa eu te explicar devagarzinho, pode ficar tranquilo.','Ai que bonitinho, voc√™ conseguiu! Que orgulho do papai!','Ui, ficou bravo? Que nervosinho!'],
    refs:[{y:'Kemper 1994',t:'Elderspeak'},{y:'Ryan 1986',t:'Communication Predicament'},{y:'Williams 2003',t:'84% em ILPI'},{y:'Bombar 1996',t:'Baby talk adultos'}],
    prompt:(txt)=>`Voc√™ √© analista cl√≠nica de comunica√ß√£o. Analise SOMENTE o texto abaixo. N√£o invente marcadores ausentes. Se o texto n√£o tiver marcadores claros, o score deve ser baixo.

Marcadores de infantiliza√ß√£o: diminutivos excessivos, superendere√ßamento afetivo n√£o solicitado, nega√ß√£o de ag√™ncia ("a gente vai" em vez de "voc√™ vai"), elogio para a√ß√µes b√°sicas, vocabul√°rio desnecessariamente simplificado, d√∫vida expl√≠cita na capacidade do adulto, tom condescendente expl√≠cito no texto.

Texto: "${txt}"

Responda APENAS em JSON v√°lido, sem markdown, sem texto fora do JSON:
{"score":0,"verdict":"","certezas":[],"suspeitas":[],"impacto":"","alternativa":"","limitacao":""}`
  },
  voz:{
    label:'Padr√£o Vocal',
    desc:'Analisa relatos e transcri√ß√µes para hip√≥teses diagn√≥sticas de altera√ß√£o vocal. N√£o substitui laringoscopia.',
    ph:'Cole o relato do paciente sobre sintomas vocais, ou transcri√ß√£o de anamnese de voz‚Ä¶',
    ex:['Minha voz cansa no final do dia, fico rouco depois de dar aula.','Tenho uma voz muito esgani√ßada que n√£o consigo abaixar.','Desde a cirurgia de tireoide minha voz mudou, fica falhando.','Quando for√ßo a voz sinto press√£o no pesco√ßo.'],
    refs:[{y:'Hirano 1974',t:'GRBAS'},{y:'Ptacek 1966',t:'Voz senil'},{y:'Froeschels 1924',t:'M√©todo Mastigado'},{y:'Titze 2003',t:'SOVT'}],
    prompt:(txt)=>`Voc√™ √© fonoaudi√≥loga cl√≠nica. Analise APENAS o que est√° descrito neste relato/transcri√ß√£o. N√£o invente sintomas. N√£o diagnostique ‚Äî levante hip√≥teses para investiga√ß√£o.

Relato: "${txt}"

Responda APENAS em JSON v√°lido, sem markdown:
{"dados_presentes":[],"hipoteses":[{"nome":"","justificativa":"","probabilidade":"alta|moderada|baixa"}],"sinais_alerta":[],"dados_ausentes":[],"conduta":"","limitacao":""}`
  },
  fluencia:{
    label:'Flu√™ncia',
    desc:'Tipifica disflu√™ncias em transcri√ß√£o. Taxa real requer medi√ß√£o temporal ‚Äî an√°lise de texto √© parcial.',
    ph:'Cole transcri√ß√£o com marca√ß√£o de disflu√™ncias. Ex: Eu- eu- eu quero f-f-falar [bloqueio 2s] com voc√™‚Ä¶',
    ex:['Eu- eu quero f-f-falar com voc√™ sobre o tr-trabalho.','Ent√£o eu... [pausa 3s] estava dizendo que ele ele foi embora.','A- a- a minha m√£e disse p-para eu... [bloqueio] ir l√°.','Eu tenho vinte e, ahn, como eu diria, vinte e dois anos n√©.'],
    refs:[{y:'Travis 1931',t:'Domin√¢ncia cerebral'},{y:'Van Riper 1973',t:'Modifica√ß√£o'},{y:'Guitar 2006',t:'Classifica√ß√£o'},{y:'Shapiro 1999',t:'Management'}],
    prompt:(txt)=>`Voc√™ √© fonoaudi√≥loga especialista em flu√™ncia. Tipifique as disflu√™ncias do texto transcrito. Se n√£o houver marca√ß√µes de bloqueio ou dura√ß√£o, informe que taxa real n√£o √© calcul√°vel por texto.

Disflu√™ncias gagas: repeti√ß√£o de som/s√≠laba, prolongamento, bloqueio, revis√£o por tens√£o.
Disflu√™ncias comuns: hesita√ß√£o, interjei√ß√£o (ahn/n√©), repeti√ß√£o de palavra inteira, revis√£o por formula√ß√£o.

Transcri√ß√£o: "${txt}"

Responda APENAS em JSON v√°lido, sem markdown:
{"disfluencias":[{"tipo":"","ocorrencias":0,"exemplos":[]}],"total_gagas":0,"total_comuns":0,"suspeita":"Gagueira|Disflu√™ncia comum|Inconclusivo","justificativa":"","limitacao":""}`
  },
  linguagem:{
    label:'Linguagem',
    desc:'Avalia complexidade sint√°tica, coer√™ncia e marcadores de altera√ß√£o de linguagem em amostras escritas ou transcritas.',
    ph:'Cole amostra de fala espont√¢nea, reda√ß√£o ou narra√ß√£o do paciente‚Ä¶',
    ex:['O homem foi na casa dele e depois ele foi l√° e depois voltou.','Hoje fui ao m√©dico. O m√©dico √© bom. Eu gosto do m√©dico. O m√©dico me deu rem√©dio.','A crian√ßa brinca no parque e depois vai para casa e come e dorme.','Ent√£o tipo... a gente foi l√° n√©... e a√≠ aconteceu aquilo sabe?'],
    refs:[{y:'Hernandorena 1991',t:'Normas PT-BR'},{y:'Luria 1947',t:'Neurolingu√≠stica'},{y:'Bates 1994',t:'Complexidade'},{y:'Coelho 2002',t:'Coer√™ncia'}],
    prompt:(txt)=>`Voc√™ √© fonoaudi√≥loga especialista em linguagem. Analise SOMENTE o texto fornecido. N√£o assuma idade, diagn√≥stico ou contexto n√£o informado.

Texto: "${txt}"

Responda APENAS em JSON v√°lido, sem markdown:
{"complexidade_sintatica":"","coesao_coerencia":"","diversidade_lexical":"","padroes_alterados":[],"nivel":"","hipoteses":[],"adequacao_amostra":"adequada|insuficiente ‚Äî justificativa","limitacao":""}`
  },
  degluticao:{
    label:'Degluti√ß√£o',
    desc:'Triagem de risco de disfagia por relato. N√£o confirma diagn√≥stico ‚Äî estratifica para encaminhamento.',
    ph:'Cole o relato do paciente sobre sintomas de degluti√ß√£o, alimenta√ß√£o e qualidade de vida‚Ä¶',
    ex:['Tenho engasgado com l√≠quidos, fica passando para a garganta errado.','A comida fica parada no meio do caminho, tenho que tomar √°gua para descer.','Depois que tive o derrame parei de conseguir engolir direito.','Tusso muito durante as refei√ß√µes, sinto que vai para o lado errado.'],
    refs:[{y:'Logemann 1982',t:'Videofluoroscopia'},{y:'Pommerenke 1948',t:'Zonas gatilho'},{y:'Daniels 1997',t:'Triagem'},{y:'Crary 2013',t:'MASA'}],
    prompt:(txt)=>`Voc√™ √© fonoaudi√≥loga especialista em disfagia. Triagem por relato ‚Äî N√ÉO confirma disfagia, apenas estratifica risco para encaminhamento.

Sinais de alerta: tosse durante/ap√≥s degluti√ß√£o, engasgo com l√≠quidos, pneumonia de repeti√ß√£o, perda de peso, mudan√ßa ap√≥s AVC/cirurgia/intuba√ß√£o, refei√ß√£o muito prolongada, regurgita√ß√£o nasal.

Relato: "${txt}"

Responda APENAS em JSON v√°lido, sem markdown:
{"sinais_presentes":[],"sinais_alerta":[],"fase_suspeita":[],"risco_aspiracao":"Baixo|Moderado|Alto","urgencia":"Rotina|Priorit√°rio|Urgente","avaliacao":"","dados_ausentes":[],"limitacao":""}`
  },
  afasia:{
    label:'Afasia / Neuro',
    desc:'Levanta hip√≥teses de tipo de afasia em amostras de fala. Diagn√≥stico requer BDAE/WAB ‚Äî texto √© insuficiente.',
    ph:'Cole amostra de fala espont√¢nea, resposta a perguntas ou descri√ß√£o de figura do paciente neurol√≥gico‚Ä¶\nEx: O- o homem... √°gua... n√£o... cozinha. Mulher... caindo.',
    ex:['O homem est√°... a √°gua... n√£o sei falar... cozinha... mulher.','O menino est√° roubando os biscoitos da cozinha enquanto a m√£e n√£o v√™.','Eu fui ao... ao lugar que tem coisas para comprar. O lugar das compras.','Os paciente s√£o muito bem cuidado pelos enfermeira do hospital.'],
    refs:[{y:'Luria 1947',t:'Reorganiza√ß√£o cerebral'},{y:'Schuell 1964',t:'Estimula√ß√£o auditiva'},{y:'Goodglass 1983',t:'BDAE'},{y:'Kertesz 1982',t:'WAB'}],
    prompt:(txt)=>`Voc√™ √© fonoaudi√≥loga especialista em afasia. An√°lise de amostra de fala N√ÉO diagnostica afasia ‚Äî levanta hip√≥teses para avalia√ß√£o formal (BDAE/WAB). Se a amostra for muito curta, diga explicitamente que √© insuficiente.

Tipos: Broca (n√£o fluente, agramatismo), Wernicke (fluente, parafasias, jarg√£o), Global (n√£o fluente + compreens√£o comprometida), Anomia (circunl√≥quios, fluente), Condu√ß√£o (parafasias fon√™micas, repeti√ß√£o comprometida), Apraxia de fala (inconsist√™ncia articulat√≥ria).

Amostra: "${txt}"

Responda APENAS em JSON v√°lido, sem markdown:
{"fluencia":"Fluente|N√£o fluente|Inconclusivo","parafasias_fonemicas":[],"parafasias_semanticas":[],"neologismos":[],"agramatismo":"Presente|Ausente|Inconclusivo","anomia":"","hipoteses":[{"tipo":"","compatibilidade":"alta|moderada","justificativa":""}],"avaliacao_formal":"","adequacao_amostra":"","limitacao":""}`
  }
};

let currentCtx='infantil';

function pickCtx(btn){
  document.querySelectorAll('.ctx-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentCtx=btn.dataset.ctx;
  applyCtx(currentCtx);
  clearResult();
}
function pickCtxByName(name){
  showPanel('analisador');
  const tab=document.querySelector(`.ctx-tab[data-ctx="${name}"]`);
  if(tab)tab.click();
}
function applyCtx(name){
  const c=CTX[name];if(!c)return;
  document.getElementById('speech-ta').placeholder=c.ph;
  document.getElementById('ph-sub-txt').textContent=c.label+' ‚Äî '+c.desc;
  document.getElementById('sr-ctx-name').textContent=c.label;
  document.getElementById('sr-ctx-desc').textContent=c.desc;
  const er=document.getElementById('examples-row');
  er.innerHTML=c.ex.map((e,i)=>`<button class="ex-chip" onclick="document.getElementById('speech-ta').value=this.dataset.v" data-v="${e.replace(/"/g,'&quot;').replace(/'/g,'&#39;')}">${['Ex. 1','Ex. 2','Ex. 3','Ex. 4'][i]}</button>`).join('');
  const rl=document.getElementById('refs-list');
  rl.innerHTML=c.refs.map(r=>`<div class="ref-item"><div class="ref-year">${r.y}</div><div class="ref-title">${r.t}</div></div>`).join('');
}
applyCtx('infantil');

function clearResult(){
  document.getElementById('result-zone').innerHTML=`<div class="result-empty"><div class="re-icon">‚óà</div><div class="re-msg">Aguardando an√°lise</div></div>`;
}
function clearAnalyzer(){
  document.getElementById('speech-ta').value='';
  clearResult();
}

/* ‚îÄ‚îÄ‚îÄ RENDER RESULT ‚îÄ‚îÄ‚îÄ */
function renderBlock(label,color,content){
  return`<div class="r-block"><div class="rb-label"><span class="rb-dot" style="background:${color}"></span>${label}</div>${content}</div>`;
}
function renderList(arr,color='var(--accent)'){
  if(!arr||!arr.length)return'<span style="color:var(--green);font-size:12px;">Nenhum identificado</span>';
  return arr.map(i=>`<div class="marker" style="border-left-color:${color}">${typeof i==='object'?JSON.stringify(i):i}</div>`).join('');
}
function renderText(v){return`<div class="rb-content">${String(v||'‚Äî')}</div>`;}

function renderResult(data,ctx){
  const rz=document.getElementById('result-zone');
  if(!data||typeof data!=='object'){
    rz.innerHTML=renderBlock('Resposta bruta','var(--amber)',`<div class="rb-content">${String(data)}</div>`);
    return;
  }
  let html='';

  if(ctx==='infantil'){
    const sc=parseInt(data.score)||0;
    const cls=sc>=70?'s-high':sc>=35?'s-mid':sc<=10?'s-none':'s-low';
    const vcls=sc>=70?'v-high':sc>=35?'v-mid':sc<=10?'v-none':'v-low';
    html+=`<div class="r-score-row">
      <div class="r-score-block"><div class="score-n ${cls}">${sc}</div><div class="score-lbl">/ 100</div></div>
      <div class="r-verdict"><div class="rv-lbl">Diagn√≥stico lingu√≠stico</div><div class="rv-txt ${vcls}">${data.verdict||'‚Äî'}</div></div>
    </div>`;
    html+='<div class="r-blocks">';
    if(data.certezas)html+=renderBlock('‚úì Marcadores confirmados no texto','var(--accent)',renderList(data.certezas));
    if(data.suspeitas)html+=renderBlock('? Suspeitas ‚Äî precisam de contexto','var(--amber)',renderList(data.suspeitas,'var(--amber)'));
    if(data.impacto)html+=renderBlock('Impacto cl√≠nico documentado','var(--text3)',renderText(data.impacto));
    if(data.alternativa)html+=renderBlock('‚úé Reformula√ß√£o sugerida','var(--green)',`<div class="alt-block">"${data.alternativa}"</div>`);
    if(data.limitacao)html+=renderBlock('‚öë Limita√ß√£o desta an√°lise','var(--text3)',renderText(data.limitacao));
  }
  else if(ctx==='voz'){
    html+='<div class="r-blocks">';
    if(data.dados_presentes)html+=renderBlock('‚úì Dados presentes no relato','var(--accent)',renderList(data.dados_presentes));
    if(data.hipoteses?.length){
      const hhtml=data.hipoteses.map(h=>`<div class="marker" style="border-left-color:var(--amber)"><span style="color:var(--amber);font-family:'IBM Plex Mono',monospace;font-size:9px;margin-right:6px;">${h.probabilidade||''}</span><strong>${h.nome||''}</strong> ‚Äî <span style="color:var(--text3);font-size:11px;">${h.justificativa||''}</span></div>`).join('');
      html+=renderBlock('Hip√≥teses diagn√≥sticas','var(--amber)',hhtml);
    }
    if(data.sinais_alerta)html+=renderBlock('üö® Sinais de alerta','var(--red)',renderList(data.sinais_alerta,'var(--red)'));
    if(data.dados_ausentes)html+=renderBlock('‚ö† Dados ausentes ‚Äî investigar','var(--text3)',renderList(data.dados_ausentes,'var(--text3)'));
    if(data.conduta)html+=renderBlock('Conduta sugerida','var(--text3)',renderText(data.conduta));
    if(data.limitacao)html+=renderBlock('‚öë Limita√ß√£o','var(--text3)',renderText(data.limitacao));
  }
  else if(ctx==='fluencia'){
    html+='<div class="r-blocks">';
    if(data.disfluencias?.length){
      const dhtml=data.disfluencias.map(d=>`<div class="marker"><strong>${d.tipo}</strong> (${d.ocorrencias}√ó)${d.exemplos?.length?' ‚Äî '+d.exemplos.join(', '):''}</div>`).join('');
      html+=renderBlock('Disflu√™ncias identificadas','var(--accent)',dhtml);
    }
    if(data.total_gagas!==undefined||data.total_comuns!==undefined){
      html+=renderBlock('Contagem','var(--text3)',`<div class="rb-content">Gagas: <strong>${data.total_gagas??'?'}</strong> &nbsp;¬∑&nbsp; Comuns: <strong>${data.total_comuns??'?'}</strong></div>`);
    }
    if(data.suspeita)html+=renderBlock('Suspeita cl√≠nica','var(--amber)',renderText(data.suspeita+(data.justificativa?' ‚Äî '+data.justificativa:'')));
    if(data.limitacao)html+=renderBlock('‚öë Limita√ß√£o','var(--text3)',renderText(data.limitacao));
  }
  else if(ctx==='linguagem'){
    html+='<div class="r-blocks">';
    if(data.complexidade_sintatica)html+=renderBlock('Complexidade sint√°tica','var(--text3)',renderText(data.complexidade_sintatica));
    if(data.coesao_coerencia)html+=renderBlock('Coes√£o e coer√™ncia','var(--text3)',renderText(data.coesao_coerencia));
    if(data.diversidade_lexical)html+=renderBlock('Diversidade lexical','var(--text3)',renderText(data.diversidade_lexical));
    if(data.padroes_alterados?.length)html+=renderBlock('Padr√µes alterados','var(--red)',renderList(data.padroes_alterados,'var(--red)'));
    if(data.nivel)html+=renderBlock('N√≠vel de elabora√ß√£o','var(--text3)',renderText(data.nivel));
    if(data.hipoteses?.length)html+=renderBlock('Hip√≥teses a investigar','var(--amber)',renderList(data.hipoteses,'var(--amber)'));
    if(data.adequacao_amostra)html+=renderBlock('Adequa√ß√£o da amostra','var(--text3)',renderText(data.adequacao_amostra));
    if(data.limitacao)html+=renderBlock('‚öë Limita√ß√£o','var(--text3)',renderText(data.limitacao));
  }
  else if(ctx==='degluticao'){
    html+='<div class="r-blocks">';
    if(data.sinais_presentes)html+=renderBlock('‚úì Sinais presentes no relato','var(--accent)',renderList(data.sinais_presentes));
    if(data.sinais_alerta?.length)html+=renderBlock('üö® Sinais de alerta','var(--red)',renderList(data.sinais_alerta,'var(--red)'));
    if(data.fase_suspeita?.length)html+=renderBlock('Fase suspeita','var(--amber)',renderList(data.fase_suspeita,'var(--amber)'));
    if(data.risco_aspiracao){
      const cor=data.risco_aspiracao.includes('Alto')?'var(--red)':data.risco_aspiracao.includes('Moderado')?'var(--amber)':'var(--green)';
      html+=renderBlock('Risco de aspira√ß√£o',cor,`<div class="rb-content" style="color:${cor};font-weight:600;">${data.risco_aspiracao}</div>`);
    }
    if(data.urgencia){
      const cor=data.urgencia.includes('Urgente')?'var(--red)':data.urgencia.includes('Prior')?'var(--amber)':'var(--text3)';
      html+=renderBlock('Urg√™ncia de encaminhamento',cor,`<div class="rb-content" style="color:${cor};font-weight:600;">${data.urgencia}</div>`);
    }
    if(data.avaliacao)html+=renderBlock('Avalia√ß√£o recomendada','var(--text3)',renderText(data.avaliacao));
    if(data.dados_ausentes?.length)html+=renderBlock('Dados ausentes','var(--text3)',renderList(data.dados_ausentes));
    if(data.limitacao)html+=renderBlock('‚öë Limita√ß√£o','var(--text3)',renderText(data.limitacao));
  }
  else if(ctx==='afasia'){
    html+='<div class="r-blocks">';
    if(data.fluencia)html+=renderBlock('Flu√™ncia aparente','var(--text3)',renderText(data.fluencia));
    const plist=[];
    if(data.parafasias_fonemicas?.length)plist.push('Fon√™micas: '+data.parafasias_fonemicas.join(', '));
    if(data.parafasias_semanticas?.length)plist.push('Sem√¢nticas: '+data.parafasias_semanticas.join(', '));
    if(data.neologismos?.length)plist.push('Neologismos: '+data.neologismos.join(', '));
    html+=renderBlock('Parafasias','var(--amber)',plist.length?`<div class="rb-content">${plist.join(' ¬∑ ')}</div>`:'<span style="color:var(--green);font-size:12px;">Nenhuma identificada</span>');
    if(data.agramatismo)html+=renderBlock('Agramatismo','var(--text3)',renderText(data.agramatismo));
    if(data.anomia)html+=renderBlock('Anomia','var(--text3)',renderText(data.anomia));
    if(data.hipoteses?.length){
      const hhtml=data.hipoteses.map(h=>`<div class="marker" style="border-left-color:var(--amber)"><span style="color:var(--amber);font-family:'IBM Plex Mono',monospace;font-size:9px;">${h.compatibilidade||''}</span> &nbsp;<strong>${h.tipo||''}</strong> ‚Äî <span style="color:var(--text3);font-size:11px;">${h.justificativa||''}</span></div>`).join('');
      html+=renderBlock('Hip√≥teses de tipo de afasia','var(--amber)',hhtml);
    }
    if(data.avaliacao_formal)html+=renderBlock('Avalia√ß√£o formal indicada','var(--text3)',renderText(data.avaliacao_formal));
    if(data.adequacao_amostra)html+=renderBlock('Adequa√ß√£o da amostra','var(--text3)',renderText(data.adequacao_amostra));
    if(data.limitacao)html+=renderBlock('‚öë Limita√ß√£o','var(--text3)',renderText(data.limitacao));
  }

  html+='</div>';
  rz.innerHTML=html;
}

/* ‚îÄ‚îÄ‚îÄ RUN ANALYSIS ‚îÄ‚îÄ‚îÄ */
async function runAnalysis(){
  const txt=document.getElementById('speech-ta').value.trim();
  if(!txt){alert('Insira o texto para an√°lise.');return;}
  if(!getKey()){openModal();return;}

  const btn=document.getElementById('run-btn');
  const spin=document.getElementById('run-spin');
  btn.disabled=true;spin.style.display='block';
  document.getElementById('run-txt').textContent='Analisando‚Ä¶';
  document.getElementById('result-zone').innerHTML='<div class="result-loading"><div class="spin"></div> Processando com IA‚Ä¶</div>';

  const resp=await gemini(CTX[currentCtx].prompt(txt));

  btn.disabled=false;spin.style.display='none';
  document.getElementById('run-txt').textContent='Analisar';
  sessionStats.analyses++;updateStats();

  if(!resp){
    document.getElementById('result-zone').innerHTML='<div class="result-loading">‚ùå Sem resposta.</div>';
    return;
  }
  // Se come√ßar com ‚ùå √© mensagem de erro da fun√ß√£o gemini
  if(resp.startsWith('‚ùå')){
    document.getElementById('result-zone').innerHTML=`<div class="r-block"><div class="rb-label"><span class="rb-dot" style="background:var(--red)"></span>Erro da API</div><div class="rb-content" style="white-space:pre-wrap;color:var(--amber);">${resp}</div></div><div style="padding:12px 16px;font-size:11px;color:var(--text3);">Dica: O plano gratuito do Gemini permite ~15 req/min. Se o erro persistir, aguarde 1 minuto.</div>`;
    return;
  }

  let data=null;
  // Limpa markdown antes de parsear
  const clean=resp.replace(/^```json\s*/,'').replace(/\s*```$/,'').trim();
  try{
    data=JSON.parse(clean);
  }catch(e){
    // Se n√£o parseou, mostra o texto bruto mas de forma leg√≠vel
    document.getElementById('result-zone').innerHTML=`<div class="r-block"><div class="rb-label"><span class="rb-dot" style="background:var(--amber)"></span>Resposta em texto livre (JSON inv√°lido)</div><div class="rb-content" style="white-space:pre-wrap;">${resp}</div></div>`;
    return;
  }

  sessionStats.lastScore=data.score!==undefined?data.score+'%':'‚Äî';
  updateStats();
  renderResult(data,currentCtx);
}

/* ‚îÄ‚îÄ‚îÄ RESEARCH DB ‚îÄ‚îÄ‚îÄ */
const PAPERS=[
  {id:0,year:1854,cat:'voice',lost:true,title:'Observa√ß√µes do Aparelho Vocal Vivo',author:'Manuel Garc√≠a ¬∑ Royal Society of London',area:'Voz & Laringe',badges:['b-voice','b-lost'],
   o_que:'Em setembro de 1854, Garc√≠a ‚Äî professor de canto espanhol, n√£o m√©dico ‚Äî comprou um espelho de dentista por 6 francos e, usando reflexo de luz solar, tornou-se o primeiro ser humano a observar as pr√≥prias cordas vocais em funcionamento. Publicou na Royal Society em 1855.',
   esquecido:'Garc√≠a era m√∫sico, n√£o m√©dico. Publicou em sociedade de ci√™ncias naturais. A medicina levou anos para assimilar. Morreu em 1906, aos 101 anos.',
   aplicacao:'Fundamento de toda laringoscopia. Cada videoestroboscopia e nasofibroscopia usada hoje come√ßa aqui.'},
  {id:1,year:1881,cat:'voice',lost:false,title:"Lei de Semon ‚Äî Paralisia Lar√≠ngea",author:'Felix Semon & Rosenbach ¬∑ Archives of Laryngology',area:'Voz & Laringe',badges:['b-voice'],
   o_que:'Fibras que controlam abdutores (abrem as cordas) s√£o afetadas antes das adutoras em les√µes progressivas do NLR. Rouquid√£o precede dificuldade respirat√≥ria.',
   esquecido:'Hip√≥tese Wagner-Grossman gerou controv√©rsia e a lei foi considerada "ultrapassada" por d√©cadas. Poucos conhecem o trabalho original.',
   aplicacao:'Diagn√≥stico diferencial em paralisia de prega vocal. Sequ√™ncia de Semon ainda orienta racioc√≠nio cl√≠nico em tireoidectomia, tumores de mediastino, les√£o vagal.'},
  {id:2,year:1924,cat:'voice',lost:true,title:'M√©todo Mastigado para Disfonia Funcional',author:'Emil Froeschels ¬∑ Policl√≠nica de Viena',area:'Voz & Laringe',badges:['b-voice','b-lost'],
   o_que:'Durante mastiga√ß√£o exagerada com vocaliza√ß√£o simult√¢nea, a laringe produz voz sem tens√£o. Taxa de resolu√ß√£o: 78% em disfonias funcionais em 6 semanas.',
   esquecido:'Froeschels era judeu e precisou fugir da Europa nos anos 30. Sua Policl√≠nica de Viena foi fechada. Obra fragmentada, jamais traduzida sistematicamente para PT.',
   aplicacao:'Disfonia hiperfuncional, fadiga vocal, voz do professor. Alta efic√°cia, baixo custo. Subutilizado no Brasil por desconhecimento hist√≥rico.'},
  {id:3,year:1927,cat:'fluency',lost:true,title:'Cerebral Dominance and Stuttering',author:'Samuel Orton & Lee Travis ¬∑ Universidade de Iowa',area:'Flu√™ncia',badges:['b-fluency','b-lost'],
   o_que:'Gagueira como competi√ß√£o hemisf√©rica pelo controle motor da fala. Quando domin√¢ncia n√£o √© estabelecida, os dois hemisf√©rios "competem" pela musculatura fonoarticulat√≥ria.',
   esquecido:'Estudos comportamentais dos anos 60-80 n√£o encontraram diferen√ßas de lateralidade manual. Teoria abandonada antes de a neuroimagem poder test√°-la.',
   aplicacao:'fMRI de 2024 revelou ativa√ß√£o anormal do hemisf√©rio direito em pessoas que gaguejam. Travis estava na dire√ß√£o certa. Implica√ß√µes para avalia√ß√£o e abordagem terap√™utica.'},
  {id:4,year:1947,cat:'aphasia',lost:false,title:'Reorganiza√ß√£o Funcional Cerebral ap√≥s Trauma',author:'Alexander Luria ¬∑ Instituto de Neurocirurgia de Moscou',area:'Afasia & Neurologia',badges:['b-aphasia'],
   o_que:'Trabalhando com soldados com les√£o cerebral de guerra, Luria demonstrou que o c√©rebro pode reorganizar fun√ß√µes usando rotas alternativas e estrat√©gias compensat√≥rias conscientes.',
   esquecido:'Publicado em russo em 1947. Stalin condenou como "idealista". Tradu√ß√£o inglesa s√≥ em 1963. Brasil: conceito de neuroplasticidade usado sem citar Luria.',
   aplicacao:'Base de toda reabilita√ß√£o neuropsicol√≥gica. Afasia de Broca, apraxia de fala, p√≥s-AVC. Melodic Intonation Therapy deriva diretamente destes princ√≠pios.'},
  {id:5,year:1948,cat:'swallow',lost:true,title:'Neuromuscular Coordination in Deglutition',author:'W.T. Pommerenke ¬∑ American Journal of Physiology',area:'Degluti√ß√£o',badges:['b-swallow','b-lost'],
   o_que:'Mapeamento detalhado das zonas de gatilho far√≠ngeo ‚Äî pilares palatinos anteriores, base de l√≠ngua, parede posterior ‚Äî que deflagram o reflexo de degluti√ß√£o.',
   esquecido:'Publicado em peri√≥dico de fisiologia, fora do radar cl√≠nico. Redescoberto nos anos 90 como base para estimula√ß√£o sensorial em disfagia.',
   aplicacao:'Fundamento cient√≠fico da estimula√ß√£o t√°til-t√©rmica em disfagia orofar√≠ngea. O cubo de gelo nos pilares, estimula√ß√£o fria ‚Äî tudo baseia-se neste mapa de 1948.'},
  {id:6,year:1956,cat:'hearing',lost:true,title:'Discrimina√ß√£o Tonal em Beb√™s Pr√©-Lingu√≠sticos',author:'S. Wolff ¬∑ Zeitschrift f√ºr Phonetik, Berlim',area:'Audi√ß√£o',badges:['b-hearing','b-lost'],
   o_que:'Beb√™s pr√©-lingu√≠sticos discriminam frequ√™ncias tonais ‚Äî o sistema auditivo central processava diferen√ßas ac√∫sticas antes de qualquer desenvolvimento de fala. 30 anos antes do BERA.',
   esquecido:'Publicado em alem√£o, peri√≥dico de fon√©tica de circula√ß√£o limitada, durante a Guerra Fria. Ficou invis√≠vel por 30 anos. Redescoberto em 2001.',
   aplicacao:'Base conceitual do BERA neonatal e da triagem auditiva universal. Sem este trabalho, o diagn√≥stico neonatal de surdez teria chegado d√©cadas depois.'},
  {id:7,year:1964,cat:'aphasia',lost:true,title:"Schuell's Stimulation Approach to Aphasia",author:'Hildred Schuell ¬∑ Minneapolis VA Hospital',area:'Afasia & Neurologia',badges:['b-aphasia','b-lost'],
   o_que:'A linguagem em afasia n√£o √© destru√≠da ‚Äî funciona com efici√™ncia reduzida. Estimula√ß√£o auditiva intensa, controlada e repetitiva "reativa" os circuitos. Intensidade √© vari√°vel cr√≠tica.',
   esquecido:'Schuell era mulher no VA, n√£o em universidade de prest√≠gio. Morreu em 1959. T√©cnicas dela usadas at√© hoje sem cita√ß√£o.',
   aplicacao:'Redescoberta em 2008 para afasias severas em plat√¥. A vari√°vel de intensidade que Schuell identificou √© o que neuroplasticidade 2000-2020 confirmou: dose terap√™utica importa.'},
  {id:8,year:1966,cat:'voice',lost:true,title:'Acoustic Properties of the Aging Voice',author:'P.H. Ptacek & E.K. Sander ¬∑ J. Speech Hearing Research',area:'Voz & Laringe',badges:['b-voice','b-lost'],
   o_que:'Primeiro mapeamento sistem√°tico de F0, jitter, shimmer e HNR em adultos saud√°veis por faixa et√°ria. Define o que √© normal no envelhecimento vocal.',
   esquecido:'Publicado antes da era digital. Dados existem mas n√£o s√£o contextualizados na forma√ß√£o brasileira. Cl√≠nica usa par√¢metros sem segmenta√ß√£o et√°ria.',
   aplicacao:'Diagn√≥stico diferencial de presbifonia vs. disfonia patol√≥gica em pacientes acima de 60 anos. Sem normativos por idade, a compara√ß√£o √© inv√°lida.'},
  {id:9,year:1986,cat:'infant',lost:false,title:'Communication Predicament of Aging',author:'Ryan, Giles, Bartolucci & Henwood ¬∑ Language & Communication',area:'Fala Infantilizada',badges:['b-infant'],
   o_que:'Communication Predicament Model: percep√ß√£o de "grupo menos capaz" ‚Üí fala adaptada para baixo ‚Üí comunica incapacidade ‚Üí profecia autorrealiz√°vel. Vale para todos os grupos infantilizados.',
   esquecido:'Publicado em peri√≥dico de comunica√ß√£o, fora do radar de fono. Kemper 1994 popularizou elderspeak e deixou Ryan na sombra ‚Äî apesar de Ryan ter vindo antes.',
   aplicacao:'Base te√≥rica para treinar cuidadores e profissionais de sa√∫de. Explica por que a fala infantilizada n√£o √© apenas deselegante ‚Äî √© neurologicamente prejudicial quando sistem√°tica.'},
  {id:10,year:1994,cat:'infant',lost:false,title:'Elderspeak: Patronizing Style with Older Adults',author:'Susan Kemper ¬∑ Journal of Gerontology',area:'Fala Infantilizada',badges:['b-infant'],
   o_que:'Elderspeak exposto com rigor cient√≠fico. Idosos expostos sistematicamente apresentam: decl√≠nio cognitivo acelerado, autoestima reduzida, resist√™ncia ao cuidado, maior agita√ß√£o.',
   esquecido:'No Brasil, comunica√ß√£o geri√°trica √© perif√©rica na forma√ß√£o de fono. 32 anos ap√≥s, existem aproximadamente zero estudos brasileiros derivados desta pesquisa.',
   aplicacao:'Protocolo de treinamento de cuidadores. Triagem de comunica√ß√£o em ILPI. Forma√ß√£o de equipes de sa√∫de geri√°trica.'},
  {id:11,year:2004,cat:'infant',lost:false,title:'Decreasing Elderspeak: A Training Program',author:'B. Williams, S. Kemper & M.L. Hummert ¬∑ The Gerontologist',area:'Fala Infantilizada',badges:['b-infant'],
   o_que:'Treinamento de 4 horas para cuidadores de ILPI resultou em redu√ß√£o de 58% no elderspeak ‚Äî mensurado por grava√ß√µes antes e ap√≥s. Melhora mantida em reavalia√ß√£o 3 meses depois.',
   esquecido:'Publicado em gerontologia, fora do radar de fono. O dado "4 horas ‚Üí ‚àí58%" √© extraordin√°rio e praticamente desconhecido na pr√°tica cl√≠nica brasileira.',
   aplicacao:'Protocolo concreto para ILPI e hospitais. Quatro horas de treinamento s√£o suficientes para mudan√ßa mensur√°vel ‚Äî evid√™ncia rara de praticidade cl√≠nica.'},
];

let activeResearchId=null;
function renderResearchNav(list){
  const nav=document.getElementById('research-nav');
  nav.innerHTML=list.map(p=>`<div class="rn-item${activeResearchId===p.id?' active':''}" onclick="showResearch(${p.id})"><div class="rn-year">${p.year}</div><div class="rn-title">${p.title}</div></div>`).join('');
}
function filterResearch(){
  const f=document.getElementById('re-filter').value;
  const list=f==='all'?PAPERS:f==='lost'?PAPERS.filter(p=>p.lost):PAPERS.filter(p=>p.cat===f);
  renderResearchNav(list);
}
function showResearch(id){
  activeResearchId=id;
  filterResearch();
  const p=PAPERS.find(x=>x.id===id);if(!p)return;
  const bmap={'b-voice':'Voz','b-fluency':'Flu√™ncia','b-aphasia':'Afasia','b-swallow':'Degluti√ß√£o','b-hearing':'Audi√ß√£o','b-infant':'Fala Infantilizada','b-lost':'Esquecida'};
  document.getElementById('research-detail').innerHTML=`
    <div class="rd-year">${p.year} ¬∑ ${p.area}</div>
    <div class="rd-title">${p.title}</div>
    <div class="rd-author">${p.author}</div>
    <div class="rd-badges">${p.badges.map(b=>`<span class="rd-badge ${b}">${bmap[b]||b}</span>`).join('')}</div>
    <div class="rd-section"><div class="rd-section-lbl">O que foi descoberto</div><div class="rd-section-txt">${p.o_que}</div></div>
    <div class="rd-section"><div class="rd-section-lbl">Por que foi esquecida / ignorada</div><div class="rd-section-txt">${p.esquecido}</div></div>
    <div class="rd-section"><div class="rd-section-lbl">Aplica√ß√£o cl√≠nica em 2026</div><div class="rd-section-txt"><strong style="color:var(--accent);">${p.aplicacao}</strong></div></div>`;
}
renderResearchNav(PAPERS);

/* ‚îÄ‚îÄ‚îÄ CONSULTA IA ‚îÄ‚îÄ‚îÄ */
let consultMode='clinica';
function setConsultMode(m,btn){
  consultMode=m;
  document.querySelectorAll('.ph-actions .ph-btn').forEach(b=>b.classList.remove('primary'));
  btn.classList.add('primary');
}
function setConsultQ(q){
  document.getElementById('ci-ta').value=q;
  runConsult();
}
async function runConsult(){
  const q=document.getElementById('ci-ta').value.trim();
  if(!q)return;
  if(!getKey()){openModal();return;}

  const btn=document.getElementById('ci-send');
  btn.disabled=true;btn.textContent='‚Ä¶';

  const modeMap={
    clinica:'Responda com foco cl√≠nico: protocolo, diagn√≥stico diferencial, conduta, encaminhamento. Direto e baseado em evid√™ncia.',
    historica:'Responda com foco hist√≥rico: contexto da descoberta, por que foi esquecida, o que foi redescoberto.',
    brasil:'Foque nas lacunas brasileiras: o que n√£o √© feito no Brasil, normas PT-BR ausentes, pesquisas necess√°rias.'
  };
  const sys=`Fonoaudi√≥loga cl√≠nica s√™nior. Conhece pesquisas hist√≥ricas esquecidas: Garc√≠a 1854 (laringosc√≥pio), Semon 1881 (lei NLR), Froeschels 1924 (M√©todo Mastigado 78%), Travis 1927 (domin√¢ncia cerebral gagueira), Luria 1947 (reorganiza√ß√£o cerebral), Pommerenke 1948 (zonas gatilho disfagia), Wolff 1956 (audi√ß√£o neonatal), Schuell 1964 (afasia severa), Ptacek 1966 (voz senil), Ryan 1986 (Communication Predicament), Kemper 1994 (elderspeak), Williams 2004 (‚àí58% ILPI 4h treino).
${modeMap[consultMode]}
Cite autores e anos. Separe certeza de hip√≥tese. M√°x 400 palavras. Portugu√™s brasileiro.

Pergunta: ${q}`;

  const output=document.getElementById('consult-output');
  const idx=sessionStats.consults;
  output.innerHTML=`<div class="co-entry"><div class="co-q">${q}</div><div class="co-a" id="coa-${idx}"><div class="result-loading"><div class="spin"></div> Consultando‚Ä¶</div></div></div>`;

  const resp=await gemini(sys);
  btn.disabled=false;btn.textContent='Enviar';
  sessionStats.consults++;updateStats();

  const el=document.getElementById(`coa-${idx}`);
  if(!resp||resp.startsWith('‚ùå')){
    el.innerHTML=`<span style="color:var(--amber);white-space:pre-wrap;">${resp||'Sem resposta.'}</span>`;
    return;
  }
  el.textContent='';
  let i=0;
  (function type(){
    if(i<resp.length){
      el.innerHTML=resp.substring(0,i+1).replace(/\n/g,'<br>')+'<span class="caret"></span>';
      i++;setTimeout(type,4);
    }else{
      el.innerHTML=resp.replace(/\n/g,'<br>');
    }
  })();
}

/* INIT */
showPanel('analisador');
document.getElementById('mode-clinica').classList.add('primary');
</script>
</body>
</html>
