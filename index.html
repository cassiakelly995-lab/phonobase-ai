<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHONOBASE CLINICAL 2026</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&family=Fraunces:ital,wght@0,300;0,400;1,300;1,400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#07090e;--s1:#0c0f16;--s2:#11151f;--s3:#161c29;--s4:#1d2535;
  --b1:rgba(255,255,255,.06);--b2:rgba(255,255,255,.03);
  --t0:#e6ecf8;--t1:#8e9ab8;--t2:#454e6e;--t3:#272e48;
  --blu:#4c8ef5;--blu2:rgba(76,142,245,.14);--blu3:rgba(76,142,245,.06);
  --grn:#35c97c;--grn2:rgba(53,201,124,.12);
  --amb:#e8a020;--amb2:rgba(232,160,32,.12);
  --red:#e05050;--red2:rgba(224,80,80,.12);
  --pur:#9b6ef5;
}
html,body{height:100%;background:var(--bg);color:var(--t0);font-family:'Space Grotesk',sans-serif;font-size:13px;overflow:hidden}
::-webkit-scrollbar{width:3px;height:3px}
::-webkit-scrollbar-thumb{background:var(--s4)}

.app{display:grid;grid-template-rows:46px 1fr;height:100vh}

.top{background:var(--s1);border-bottom:1px solid var(--b1);display:flex;align-items:center;padding:0 18px;gap:0;z-index:50;position:relative}
.brand{font-family:'Space Mono',monospace;font-weight:700;font-size:12px;letter-spacing:2px;color:var(--t0);padding-right:16px;margin-right:4px;border-right:1px solid var(--b1);white-space:nowrap}
.brand em{color:var(--blu);font-style:normal}
.tabs{display:flex;overflow-x:auto;flex:1}
.tabs::-webkit-scrollbar{height:0}
.tab{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;padding:0 14px;height:46px;display:flex;align-items:center;background:none;border:none;color:var(--t3);cursor:pointer;transition:color .15s;border-bottom:2px solid transparent;white-space:nowrap;flex-shrink:0}
.tab:hover{color:var(--t1)}
.tab.on{color:var(--blu);border-bottom-color:var(--blu)}
.top-r{display:flex;align-items:center;gap:8px;margin-left:auto;padding-left:14px}
.kbtn{display:flex;align-items:center;gap:6px;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;padding:6px 11px;border:1px solid var(--b1);background:none;color:var(--t2);cursor:pointer;transition:all .15s}
.kbtn:hover{border-color:var(--blu);color:var(--blu)}
.kbtn.on{color:var(--grn);border-color:rgba(53,201,124,.4)}
.dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.dot-off{background:var(--amb);animation:bl 2s infinite}
.dot-on{background:var(--grn)}
@keyframes bl{0%,100%{opacity:1}50%{opacity:.2}}

.body{display:grid;grid-template-columns:190px 1fr;overflow:hidden}
.nav{background:var(--s1);border-right:1px solid var(--b1);overflow-y:auto;display:flex;flex-direction:column}
.nsec{border-bottom:1px solid var(--b2)}
.nsl{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2.5px;text-transform:uppercase;color:var(--t3);padding:11px 13px 5px}
.ni{display:flex;align-items:center;gap:8px;padding:7px 13px;cursor:pointer;transition:all .12s;font-size:11px;color:var(--t2);border-left:2px solid transparent;white-space:nowrap}
.ni:hover{background:var(--s2);color:var(--t1)}
.ni.on{background:var(--blu3);color:var(--blu);border-left-color:var(--blu)}
.nav-foot{margin-top:auto;padding:12px 13px;border-top:1px solid var(--b2);font-size:10px;color:var(--t3);line-height:1.65}

.main{overflow:hidden;display:flex;flex-direction:column}
.panel{display:none;flex:1;overflow:hidden;flex-direction:column}
.panel.on{display:flex}

.ph{padding:12px 18px;border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;background:var(--s1);gap:12px}
.ph-ttl{font-size:14px;font-weight:600;color:var(--t0);margin-bottom:2px}
.ph-sub{font-family:'Space Mono',monospace;font-size:9px;color:var(--t3)}
.ph-r{display:flex;gap:5px;flex-shrink:0}
.btn{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:1.5px;text-transform:uppercase;padding:6px 13px;border:1px solid var(--b1);background:none;color:var(--t2);cursor:pointer;transition:all .15s}
.btn:hover{border-color:var(--t1);color:var(--t0)}
.btn.pri{background:var(--blu);color:#fff;border-color:var(--blu)}
.btn.pri:hover{background:#70a8ff}
.btn.danger{background:var(--red);color:#fff;border-color:var(--red)}
.btn.success{background:var(--grn);color:#000;border-color:var(--grn)}
.btn:disabled{opacity:.35;cursor:not-allowed}

/* ANALISADOR */
.az{flex:1;overflow:hidden;display:grid;grid-template-columns:1fr 1fr}
.az-l{border-right:1px solid var(--b1);display:flex;flex-direction:column;overflow:hidden}
.az-r{display:flex;flex-direction:column;overflow:hidden}
.ctabs{display:flex;overflow-x:auto;border-bottom:1px solid var(--b1);flex-shrink:0;background:var(--s1)}
.ctabs::-webkit-scrollbar{height:0}
.ct{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:1px;text-transform:uppercase;padding:9px 12px;background:none;border:none;color:var(--t3);cursor:pointer;transition:all .15s;border-bottom:2px solid transparent;flex-shrink:0;white-space:nowrap}
.ct:hover{color:var(--t1)}
.ct.on{color:var(--blu);border-bottom-color:var(--blu);background:var(--blu3)}
.az-inp{flex:1;display:flex;flex-direction:column;padding:12px;gap:8px;overflow:hidden}
.inplbl{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3)}
.ta{flex:1;background:var(--s2);border:1px solid var(--b1);color:var(--t0);font-family:'Fraunces',serif;font-size:15px;line-height:1.78;padding:13px;outline:none;resize:none;transition:border-color .18s}
.ta:focus{border-color:var(--blu)}
.ta::placeholder{color:var(--t3);font-style:italic;font-size:13px}
.az-foot{display:flex;align-items:flex-end;justify-content:space-between;gap:10px;flex-wrap:wrap;flex-shrink:0}
.exlbl{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);margin-bottom:4px}
.exs{display:flex;flex-wrap:wrap;gap:3px}
.ex{font-family:'Space Mono',monospace;font-size:9px;padding:3px 8px;border:1px solid var(--b1);background:none;color:var(--t3);cursor:pointer;transition:all .15s}
.ex:hover{border-color:var(--blu);color:var(--blu)}
.runbtn{font-size:11px;font-weight:600;padding:10px 20px;background:var(--blu);color:#fff;border:none;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:8px;flex-shrink:0}
.runbtn:hover{background:#70a8ff}
.runbtn:disabled{opacity:.35;cursor:not-allowed}
.sp{width:13px;height:13px;border-radius:50%;border:2px solid rgba(255,255,255,.25);border-top-color:#fff;animation:spin .65s linear infinite;flex-shrink:0}
@keyframes spin{to{transform:rotate(360deg)}}
.az-warn{padding:8px 12px;border-top:1px solid var(--b2);font-family:'Space Mono',monospace;font-size:9px;color:var(--t3);line-height:1.5;flex-shrink:0;display:flex;gap:6px;background:var(--s1)}
.az-rhd{padding:9px 13px;border-bottom:1px solid var(--b1);font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);flex-shrink:0;background:var(--s1)}
.res{flex:1;overflow-y:auto}
.r-empty{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:8px}
.r-empty-ico{font-size:26px;opacity:.12}
.r-empty-msg{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--t3)}
.r-load{display:flex;align-items:center;gap:10px;padding:18px;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--t3)}
.spb{width:13px;height:13px;border-radius:50%;border:2px solid var(--s4);border-top-color:var(--blu);animation:spin .65s linear infinite;flex-shrink:0}
.r-score{display:grid;grid-template-columns:85px 1fr;border-bottom:1px solid var(--b1)}
.r-sn{padding:14px;border-right:1px solid var(--b1);display:flex;flex-direction:column;align-items:center;justify-content:center}
.snum{font-family:'Space Mono',monospace;font-weight:700;font-size:46px;line-height:1}
.slbl{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:1px;color:var(--t3);margin-top:2px}
.r-verd{padding:14px}
.vl{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);margin-bottom:5px}
.vv{font-size:16px;font-weight:600;line-height:1.2}
.hi{color:var(--red)}.md{color:var(--amb)}.lo{color:var(--grn)}.nn{color:var(--t1)}
.r-blocks{display:flex;flex-direction:column}
.rb{padding:11px 12px;border-bottom:1px solid var(--b2)}
.rblbl{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);margin-bottom:6px;display:flex;align-items:center;gap:5px}
.rbdot{width:4px;height:4px;border-radius:50%;flex-shrink:0}
.rbtxt{font-size:12px;color:var(--t1);line-height:1.72;white-space:pre-wrap}
.ri{display:flex;align-items:flex-start;gap:7px;padding:5px 8px;background:var(--s2);border-left:2px solid var(--blu);margin-bottom:3px;font-size:11px;color:var(--t1);line-height:1.5}
.ri::before{content:'‚Üó';color:var(--blu);font-family:'Space Mono',monospace;font-size:10px;flex-shrink:0;margin-top:1px}
.ri.w{border-left-color:var(--amb)}.ri.w::before{color:var(--amb);content:'!'}
.ri.d{border-left-color:var(--red)}.ri.d::before{color:var(--red);content:'‚ö†'}
.r-alt{background:var(--grn2);border-left:2px solid var(--grn);padding:10px 12px;margin-bottom:3px;font-family:'Fraunces',serif;font-size:14px;font-style:italic;color:#80f0b0;line-height:1.55}
.r-err{margin:12px;padding:14px;font-family:'Space Mono',monospace;font-size:11px;color:var(--amb);line-height:1.75;white-space:pre-wrap;background:var(--amb2);border-left:2px solid var(--amb)}
.hipo{padding:7px 9px;background:var(--s2);margin-bottom:3px;border-left:2px solid var(--amb)}
.hipo-n{font-size:12px;color:var(--t0);font-weight:500;margin-bottom:2px}
.hipo-p{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;padding:1px 6px;border:1px solid;display:inline-block;margin-bottom:3px}
.pa{color:var(--red);border-color:var(--red)}.pm{color:var(--amb);border-color:var(--amb)}.pb{color:var(--t2);border-color:var(--t2)}
.hipo-j{font-size:11px;color:var(--t2);line-height:1.5}
.badge{display:inline-block;padding:4px 10px;font-family:'Space Mono',monospace;font-weight:700;font-size:12px}
.ba{background:var(--red2);color:var(--red)}.bm{background:var(--amb2);color:var(--amb)}.bb{background:var(--grn2);color:var(--grn)}

/* GRAVA√á√ÉO */
.grav-wrap{flex:1;overflow:hidden;display:grid;grid-template-columns:1fr 1fr}
.grav-l{border-right:1px solid var(--b1);display:flex;flex-direction:column;overflow:hidden}
.grav-r{display:flex;flex-direction:column;overflow:hidden}
.ctx-chips{display:flex;gap:3px;flex-wrap:wrap;padding:10px 12px;border-bottom:1px solid var(--b1);background:var(--s1);flex-shrink:0}
.ctx-chip{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:1px;text-transform:uppercase;padding:4px 10px;border:1px solid var(--b1);background:none;color:var(--t3);cursor:pointer;transition:all .15s}
.ctx-chip:hover{border-color:var(--blu);color:var(--blu)}
.ctx-chip.on{background:var(--blu2);color:var(--blu);border-color:rgba(76,142,245,.4)}
.mic-area{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px;gap:16px;flex-shrink:0}
.wave-box{display:flex;align-items:center;justify-content:center;gap:3px;height:36px}
.wb{width:3px;background:var(--s4);border-radius:2px;height:4px;transition:height .1s}
.wb.act{animation:wave .8s ease-in-out infinite}
.wb:nth-child(1){animation-delay:0s}.wb:nth-child(2){animation-delay:.08s}.wb:nth-child(3){animation-delay:.16s}
.wb:nth-child(4){animation-delay:.24s}.wb:nth-child(5){animation-delay:.32s}.wb:nth-child(6){animation-delay:.24s}
.wb:nth-child(7){animation-delay:.16s}.wb:nth-child(8){animation-delay:.08s}
@keyframes wave{0%,100%{height:4px}50%{height:28px}}
.mic-btn{width:80px;height:80px;border-radius:50%;border:2px solid var(--b1);background:var(--s2);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:30px;transition:all .2s}
.mic-btn:hover{border-color:var(--blu);background:var(--blu3)}
.mic-btn.rec{border-color:var(--red);background:var(--red2);animation:pulse 1.2s infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 0 0 rgba(224,80,80,.4)}50%{box-shadow:0 0 0 14px rgba(224,80,80,0)}}
.mic-timer{font-family:'Space Mono',monospace;font-size:28px;font-weight:700;color:var(--t0);letter-spacing:4px}
.mic-timer.rec{color:var(--red)}
.mic-status{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);text-align:center}
.mic-status.rec{color:var(--red)}
.grav-transcript{flex:1;overflow:hidden;display:flex;flex-direction:column;border-top:1px solid var(--b1)}
.gt-hd{padding:8px 12px;border-bottom:1px solid var(--b2);font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);display:flex;justify-content:space-between;align-items:center;flex-shrink:0;background:var(--s1)}
.gt-body{flex:1;overflow-y:auto;padding:12px}
.tt{font-family:'Fraunces',serif;font-size:15px;line-height:1.8;color:var(--t0);min-height:60px;word-wrap:break-word}
.tt-interim{color:var(--t2);font-style:italic}
.grav-footer{padding:10px 12px;border-top:1px solid var(--b2);display:flex;gap:5px;flex-shrink:0;background:var(--s1);flex-wrap:wrap}

/* LEITURA */
.leit-wrap{flex:1;overflow:hidden;display:grid;grid-template-columns:300px 1fr}
.leit-l{border-right:1px solid var(--b1);display:flex;flex-direction:column;overflow-y:auto}
.leit-r{display:flex;flex-direction:column;overflow:hidden}
.text-list{padding:8px;display:flex;flex-direction:column;gap:5px}
.text-item{padding:10px 12px;border:1px solid var(--b1);background:var(--s2);cursor:pointer;transition:all .15s}
.text-item:hover{border-color:rgba(76,142,245,.3);background:var(--s3)}
.text-item.on{border-color:var(--blu);background:var(--blu3)}
.ti-hd{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:4px;gap:8px}
.ti-ttl{font-size:12px;font-weight:500;color:var(--t0);line-height:1.3}
.ti-diff{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;padding:2px 6px;border:1px solid;flex-shrink:0}
.df{color:var(--grn);border-color:rgba(53,201,124,.4)}
.dm{color:var(--amb);border-color:rgba(232,160,32,.4)}
.dd{color:var(--red);border-color:rgba(224,80,80,.4)}
.ti-info{font-family:'Space Mono',monospace;font-size:9px;color:var(--t3)}
.reading-ctrl{padding:12px 16px;border-bottom:1px solid var(--b1);display:flex;align-items:center;gap:10px;flex-shrink:0;background:var(--s1);flex-wrap:wrap}
.timer{font-family:'Space Mono',monospace;font-size:28px;font-weight:700;color:var(--t0);letter-spacing:3px;min-width:80px}
.timer.run{color:var(--blu)}
.timer.done{color:var(--grn)}
.prog{flex:1;height:4px;background:var(--s3);min-width:60px}
.prog-fill{height:100%;background:var(--blu);transition:width .3s;width:0%}
.reading-body{flex:1;overflow-y:auto;padding:28px 32px}
.reading-txt{font-family:'Fraunces',serif;font-size:20px;line-height:2.1;color:var(--t0);max-width:640px}
.reading-txt .w{transition:all .15s;padding:1px 2px;border-radius:2px}
.reading-txt .w.said{background:var(--grn2);color:var(--grn)}
.reading-txt .w.cur{background:var(--blu2);color:var(--blu)}
.reading-txt .w.err{background:var(--red2);color:var(--red);text-decoration:underline wavy var(--red)}
.reading-result{padding:14px 16px;border-top:1px solid var(--b1);flex-shrink:0;background:var(--s1)}
.rr-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:10px}
.rr-stat{background:var(--s2);padding:10px;text-align:center}
.rr-val{font-family:'Space Mono',monospace;font-size:20px;font-weight:700;color:var(--t0)}
.rr-lbl{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;color:var(--t3);margin-top:3px}

/* PESQUISAS */
.re-wrap{flex:1;overflow:hidden;display:flex;flex-direction:column}
.refb{display:flex;flex-wrap:wrap;gap:3px;padding:9px 12px;border-bottom:1px solid var(--b1);background:var(--s1);flex-shrink:0}
.rf{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;padding:4px 10px;border:1px solid var(--b1);background:none;color:var(--t3);cursor:pointer;transition:all .15s}
.rf:hover{border-color:var(--t2);color:var(--t1)}
.rf.on{background:var(--s3);color:var(--t0);border-color:var(--s4)}
.re-inner{flex:1;overflow:hidden;display:grid;grid-template-columns:200px 1fr}
.renav{border-right:1px solid var(--b1);background:var(--s1);overflow-y:auto}
.rni{padding:10px 12px;cursor:pointer;transition:all .12s;border-bottom:1px solid var(--b2);border-left:2px solid transparent}
.rni:hover{background:var(--s2)}
.rni.on{background:var(--blu3);border-left-color:var(--blu)}
.rni-y{font-family:'Space Mono',monospace;font-size:9px;color:var(--amb);letter-spacing:1px;margin-bottom:2px}
.rni-t{font-size:11px;color:var(--t1);line-height:1.3}
.rni.on .rni-t{color:var(--blu)}
.redet{overflow-y:auto;padding:26px 30px}
.re-emp{height:100%;display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--t3)}
.red-y{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--amb);margin-bottom:7px}
.red-ttl{font-size:22px;font-weight:700;color:var(--t0);margin-bottom:4px;line-height:1.2}
.red-aut{font-family:'Space Mono',monospace;font-size:9px;color:var(--t3);margin-bottom:14px}
.red-tags{display:flex;gap:5px;flex-wrap:wrap;margin-bottom:18px}
.rtag{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;padding:2px 8px;border:1px solid}
.tv{color:var(--blu);border-color:rgba(76,142,245,.4)}.tflu{color:var(--pur);border-color:rgba(155,110,245,.4)}.tafa{color:var(--grn);border-color:rgba(53,201,124,.4)}.tde{color:var(--amb);border-color:rgba(232,160,32,.4)}.tau{color:var(--t1);border-color:var(--b1)}.tinf{color:#f09060;border-color:rgba(240,144,96,.4)}.tl{color:var(--red);border-color:rgba(224,80,80,.4)}
.red-sec{margin-bottom:16px}
.red-slbl{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);margin-bottom:7px;padding-bottom:5px;border-bottom:1px solid var(--b2)}
.red-stxt{font-family:'Fraunces',serif;font-size:14px;color:var(--t1);line-height:1.85}
.red-app{background:var(--blu3);border-left:2px solid var(--blu);padding:12px 15px;font-family:'Fraunces',serif;font-size:14px;color:#90bbff;line-height:1.75}

/* CONSULTA */
.ci{flex:1;overflow:hidden;display:flex;flex-direction:column}
.ci-top{padding:10px 16px;border-bottom:1px solid var(--b1);background:var(--s1);flex-shrink:0}
.ci-row{display:flex;gap:7px;align-items:flex-end}
.cita{flex:1;background:var(--s2);border:1px solid var(--b1);color:var(--t0);font-family:'Fraunces',serif;font-size:14px;padding:9px 12px;outline:none;resize:none;min-height:38px;max-height:90px;transition:border-color .18s;line-height:1.5}
.cita:focus{border-color:var(--blu)}
.cita::placeholder{color:var(--t3);font-style:italic;font-size:12px}
.ci-send{font-size:11px;font-weight:600;padding:9px 16px;background:var(--blu);color:#fff;border:none;cursor:pointer;transition:all .2s;flex-shrink:0}
.ci-send:hover{background:#70a8ff}
.ci-send:disabled{opacity:.35;cursor:not-allowed}
.modes{display:flex;gap:3px;margin-top:7px}
.mc{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;padding:4px 10px;border:1px solid var(--b1);background:none;color:var(--t3);cursor:pointer;transition:all .15s}
.mc:hover{border-color:var(--t2);color:var(--t1)}
.mc.on{background:var(--s3);color:var(--t0);border-color:var(--s4)}
.chips{display:flex;gap:3px;flex-wrap:wrap;margin-top:7px}
.chip{font-family:'Space Mono',monospace;font-size:9px;padding:3px 8px;border:1px solid var(--b1);background:none;color:var(--t3);cursor:pointer;transition:all .15s}
.chip:hover{border-color:var(--blu);color:var(--blu)}
.ci-out{flex:1;overflow-y:auto;padding:18px 20px}
.co-ph{color:var(--t3);padding-top:18px}
.co-ph-t{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:2px;text-transform:uppercase}
.co-ph-s{font-size:11px;margin-top:3px}
.co-e{margin-bottom:22px}
.co-q{font-family:'Space Mono',monospace;font-size:10px;color:var(--t3);padding:7px 10px;background:var(--s2);border-left:2px solid var(--blu);margin-bottom:9px}
.co-a{font-family:'Fraunces',serif;font-size:14px;color:var(--t1);line-height:1.88;white-space:pre-wrap}
.caret{display:inline-block;width:2px;height:.85em;background:var(--blu);animation:bl .8s infinite;vertical-align:middle}

/* M√ìDULOS */
.mod-grid{flex:1;overflow-y:auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(210px,1fr));gap:1px;background:var(--b1);align-content:start}
.mc-card{background:var(--s1);padding:18px;cursor:pointer;transition:background .2s}
.mc-card:hover{background:var(--s2)}
.mc-tag{font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3);margin-bottom:8px}
.mc-ico{font-size:20px;margin-bottom:8px}
.mc-ttl{font-size:13px;font-weight:600;color:var(--t0);margin-bottom:4px;line-height:1.2}
.mc-desc{font-size:11px;color:var(--t3);line-height:1.6}
.mc-bdg{display:inline-block;margin-top:8px;font-family:'Space Mono',monospace;font-size:8px;letter-spacing:1px;text-transform:uppercase;padding:2px 7px;border:1px solid rgba(76,142,245,.4);color:var(--blu)}

/* MODAL */
.ov{position:fixed;inset:0;background:rgba(7,9,14,.9);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(14px)}
.modal{background:var(--s1);border:1px solid var(--b1);width:100%;max-width:450px;padding:28px;animation:up .2s ease}
@keyframes up{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:none}}
.m-ttl{font-size:18px;font-weight:700;color:var(--t0);margin-bottom:3px}
.m-sub{font-family:'Space Mono',monospace;font-size:10px;color:var(--t3);margin-bottom:18px;line-height:1.6}
.m-steps{background:var(--s2);border-left:2px solid var(--blu);padding:11px 13px;margin-bottom:14px;font-family:'Space Mono',monospace;font-size:10px;color:var(--t1);line-height:2.2}
.m-steps a{color:var(--blu)}.m-steps strong{color:var(--t0)}
.kirow{display:flex;margin-bottom:10px}
.ki{flex:1;background:var(--s2);border:1px solid var(--b1);border-right:none;color:var(--t0);font-family:'Space Mono',monospace;font-size:12px;padding:9px 12px;outline:none}
.ki:focus{border-color:var(--blu)}
.eye{background:var(--s2);border:1px solid var(--b1);padding:9px 12px;cursor:pointer;color:var(--t2);font-size:14px}
.m-note{font-family:'Space Mono',monospace;font-size:9px;color:var(--t3);line-height:2.1;margin-bottom:16px}
.m-note strong{color:var(--t2)}
.m-btns{display:flex;gap:7px}
.m-ok{flex:1;font-size:11px;font-weight:600;padding:11px;background:var(--blu);color:#fff;border:none;cursor:pointer;transition:background .2s}
.m-ok:hover{background:#70a8ff}
.m-cancel{font-family:'Space Mono',monospace;font-size:9px;letter-spacing:1px;padding:11px 14px;background:none;color:var(--t3);border:1px solid var(--b1);cursor:pointer;transition:all .2s}
.m-cancel:hover{border-color:var(--t2);color:var(--t1)}
.notif{position:fixed;bottom:20px;right:20px;background:var(--s2);border:1px solid var(--b1);padding:10px 16px;font-family:'Space Mono',monospace;font-size:10px;color:var(--t1);z-index:300;animation:up .2s ease;max-width:300px}

@media(max-width:860px){
  .body{grid-template-columns:1fr}.nav{display:none}
  .az,.grav-wrap,.leit-wrap{grid-template-columns:1fr}
  .az-l,.grav-l{border-right:none;border-bottom:1px solid var(--b1);min-height:240px}
  .leit-l{display:none}
  html,body{overflow:auto}.app{height:auto}
  .body,.main,.panel,.az,.grav-wrap,.leit-wrap{overflow:visible;height:auto}
  .ta{min-height:120px}.re-inner{grid-template-columns:1fr}.renav{display:none}
}
</style>
</head>
<body>
<div class="app">
<div class="top">
  <div class="brand">PHONO<em>BASE</em></div>
  <div class="tabs">
    <button class="tab on" data-p="analisador" onclick="goP(this)">Analisador</button>
    <button class="tab" data-p="gravacao" onclick="goP(this)">Grava√ß√£o de Voz</button>
    <button class="tab" data-p="leitura" onclick="goP(this)">Leitura Cronometrada</button>
    <button class="tab" data-p="pesquisas" onclick="goP(this)">Pesquisas</button>
    <button class="tab" data-p="consulta" onclick="goP(this)">Consulta IA</button>
    <button class="tab" data-p="modulos" onclick="goP(this)">M√≥dulos</button>
  </div>
  <div class="top-r">
    <button class="kbtn" id="kb" onclick="openModal()">
      <span class="dot dot-off" id="kd"></span><span id="kt">Ativar IA</span>
    </button>
  </div>
</div>
<div class="body">
<div class="nav">
  <div class="nsec">
    <div class="nsl">An√°lise de texto</div>
    <div class="ni on" onclick="goP2('analisador','infantil')">üó£ Fala Infantilizada</div>
    <div class="ni" onclick="goP2('analisador','voz')">üéô Padr√£o Vocal</div>
    <div class="ni" onclick="goP2('analisador','fluencia')">üí¨ Flu√™ncia</div>
    <div class="ni" onclick="goP2('analisador','linguagem')">üìù Linguagem</div>
    <div class="ni" onclick="goP2('analisador','degluticao')">üçΩ Degluti√ß√£o</div>
    <div class="ni" onclick="goP2('analisador','afasia')">üß† Afasia / Neuro</div>
  </div>
  <div class="nsec">
    <div class="nsl">Voz ao vivo</div>
    <div class="ni" onclick="goP2('gravacao')">üé§ Grava√ß√£o de Voz</div>
    <div class="ni" onclick="goP2('leitura')">‚è± Leitura Cronometrada</div>
  </div>
  <div class="nsec">
    <div class="nsl">Refer√™ncia</div>
    <div class="ni" onclick="goP2('pesquisas')">üìö Pesquisas Hist√≥ricas</div>
    <div class="ni" onclick="goP2('consulta')">ü§ñ Consulta IA</div>
  </div>
  <div class="nav-foot">Suporte de decis√£o cl√≠nica.<br>N√£o substitui avalia√ß√£o presencial.</div>
</div>
<div class="main">

<!-- ANALISADOR -->
<div class="panel on" id="p-analisador">
  <div class="ph">
    <div><div class="ph-ttl">Analisador de Fala</div><div class="ph-sub" id="az-sub">Selecione o contexto e cole o texto</div></div>
    <div class="ph-r"><button class="btn" onclick="clrAz()">Limpar</button><button class="btn pri" onclick="runAz()">Analisar</button></div>
  </div>
  <div class="az">
    <div class="az-l">
      <div class="ctabs">
        <button class="ct on" data-c="infantil" onclick="setC(this)">Fala Infantilizada</button>
        <button class="ct" data-c="voz" onclick="setC(this)">Padr√£o Vocal</button>
        <button class="ct" data-c="fluencia" onclick="setC(this)">Flu√™ncia</button>
        <button class="ct" data-c="linguagem" onclick="setC(this)">Linguagem</button>
        <button class="ct" data-c="degluticao" onclick="setC(this)">Degluti√ß√£o</button>
        <button class="ct" data-c="afasia" onclick="setC(this)">Afasia</button>
      </div>
      <div class="az-inp">
        <div class="inplbl" id="az-lbl">Transcri√ß√£o ou relato:</div>
        <textarea class="ta" id="az-ta" placeholder="Cole a transcri√ß√£o da fala, relato do paciente ou texto‚Ä¶"></textarea>
        <div class="az-foot">
          <div><div class="exlbl">Exemplos</div><div class="exs" id="az-exs"></div></div>
          <button class="runbtn" id="runbtn" onclick="runAz()">
            <div class="sp" id="rsp" style="display:none"></div><span id="rtxt">Analisar</span>
          </button>
        </div>
      </div>
      <div class="az-warn"><span style="color:var(--amb)">‚öë</span> Identifica padr√µes no texto ‚Äî n√£o substitui avalia√ß√£o presencial.</div>
    </div>
    <div class="az-r">
      <div class="az-rhd">Resultado</div>
      <div class="res" id="res"><div class="r-empty"><div class="r-empty-ico">‚óà</div><div class="r-empty-msg">Aguardando an√°lise</div></div></div>
    </div>
  </div>
</div>

<!-- GRAVA√á√ÉO DE VOZ -->
<div class="panel" id="p-gravacao">
  <div class="ph">
    <div><div class="ph-ttl">Grava√ß√£o e An√°lise de Voz</div><div class="ph-sub">Grave ¬∑ transcri√ß√£o autom√°tica em PT-BR ¬∑ an√°lise com IA</div></div>
    <div class="ph-r">
      <button class="btn" onclick="clrGrav()">Limpar</button>
      <button class="btn pri" id="grav-ai-btn" onclick="analyzeGrav()" style="display:none">Analisar com IA</button>
    </div>
  </div>
  <div class="grav-wrap">
    <div class="grav-l">
      <div class="ctx-chips">
        <button class="ctx-chip on" data-gc="fluencia" onclick="setGC(this)">Flu√™ncia</button>
        <button class="ctx-chip" data-gc="voz" onclick="setGC(this)">Padr√£o Vocal</button>
        <button class="ctx-chip" data-gc="linguagem" onclick="setGC(this)">Linguagem</button>
        <button class="ctx-chip" data-gc="infantil" onclick="setGC(this)">Fala Infantilizada</button>
        <button class="ctx-chip" data-gc="afasia" onclick="setGC(this)">Afasia</button>
      </div>
      <div class="mic-area">
        <div class="wave-box" id="wave-box">
          <div class="wb"></div><div class="wb"></div><div class="wb"></div><div class="wb"></div>
          <div class="wb"></div><div class="wb"></div><div class="wb"></div><div class="wb"></div>
        </div>
        <button class="mic-btn" id="mic-btn" onclick="toggleMic()">üé§</button>
        <div class="mic-timer" id="mic-timer">00:00</div>
        <div class="mic-status" id="mic-status">Clique para gravar</div>
      </div>
      <div class="grav-transcript">
        <div class="gt-hd">
          <span>Transcri√ß√£o em tempo real</span>
          <button class="btn" style="padding:3px 8px;font-size:8px" onclick="copyTxt()">Copiar</button>
        </div>
        <div class="gt-body">
          <div class="tt" id="tt"><span style="color:var(--t3);font-style:italic;font-size:13px">A transcri√ß√£o aparecer√° aqui enquanto voc√™ fala‚Ä¶</span></div>
        </div>
        <div class="grav-footer">
          <button class="btn" onclick="sendToAz()">‚Üí Enviar ao Analisador</button>
        </div>
      </div>
    </div>
    <div class="grav-r">
      <div class="az-rhd">An√°lise da fala gravada</div>
      <div class="res" id="grav-res">
        <div class="r-empty"><div class="r-empty-ico">üé§</div><div class="r-empty-msg">Grave e clique em "Analisar com IA"</div></div>
      </div>
    </div>
  </div>
</div>

<!-- LEITURA CRONOMETRADA -->
<div class="panel" id="p-leitura">
  <div class="ph">
    <div><div class="ph-ttl">Leitura Cronometrada</div><div class="ph-sub">Paciente l√™ em voz alta ¬∑ sistema transcreve e compara ¬∑ identifica erros</div></div>
    <div class="ph-r">
      <button class="btn" id="leit-start-btn" onclick="toggleLeit()">üé§ Iniciar</button>
      <button class="btn" id="leit-reset-btn" onclick="resetLeit()" style="display:none">‚Ü∫ Reiniciar</button>
    </div>
  </div>
  <div class="leit-wrap">
    <div class="leit-l">
      <div style="padding:10px 10px 6px;font-family:'Space Mono',monospace;font-size:8px;letter-spacing:2px;text-transform:uppercase;color:var(--t3)">Selecione o texto</div>
      <div class="text-list" id="text-list"></div>
    </div>
    <div class="leit-r">
      <div class="reading-ctrl">
        <div class="timer" id="leit-timer">00:00</div>
        <div class="prog"><div class="prog-fill" id="leit-prog"></div></div>
        <div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--t3)" id="leit-wpm">‚Äî PPM</div>
        <div style="font-family:'Space Mono',monospace;font-size:9px;color:var(--t2)" id="leit-status">Selecione um texto para come√ßar</div>
      </div>
      <div class="reading-body">
        <div class="reading-txt" id="reading-txt">
          <span style="color:var(--t3);font-family:'Space Mono',monospace;font-size:12px">‚Üê Selecione um texto ao lado para come√ßar</span>
        </div>
      </div>
      <div class="reading-result" id="reading-result" style="display:none">
        <div class="rr-grid" id="rr-grid"></div>
        <button class="btn pri" onclick="analyzeReading()">Analisar com IA</button>
        <div id="rr-ai-result"></div>
      </div>
    </div>
  </div>
</div>

<!-- PESQUISAS -->
<div class="panel" id="p-pesquisas">
  <div class="ph"><div><div class="ph-ttl">Pesquisas Hist√≥ricas</div><div class="ph-sub">Descobertas esquecidas com aplica√ß√£o cl√≠nica real ¬∑ 1854‚Äì2026</div></div></div>
  <div class="re-wrap">
    <div class="refb" id="refb"></div>
    <div class="re-inner">
      <div class="renav" id="renav"></div>
      <div class="redet" id="redet"><div class="re-emp">Selecione uma pesquisa ao lado</div></div>
    </div>
  </div>
</div>

<!-- CONSULTA IA -->
<div class="panel" id="p-consulta">
  <div class="ph"><div><div class="ph-ttl">Consulta IA Cl√≠nica</div><div class="ph-sub">170 anos de pesquisa fonoaudiol√≥gica ¬∑ PT-BR ¬∑ Gemini</div></div></div>
  <div class="ci">
    <div class="ci-top">
      <div class="ci-row">
        <textarea class="cita" id="cita" rows="2" placeholder="Ex: Paciente 68 anos, rouquid√£o h√° 3 meses, fumante ‚Äî hip√≥teses e conduta?" onkeydown="if(event.ctrlKey&&event.key==='Enter')runCI()"></textarea>
        <button class="ci-send" id="cisend" onclick="runCI()">Enviar</button>
      </div>
      <div class="modes">
        <button class="mc on" id="mc-c" onclick="setM('c',this)">Protocolo cl√≠nico</button>
        <button class="mc" id="mc-h" onclick="setM('h',this)">Hist√≥rico / pesquisa</button>
        <button class="mc" id="mc-b" onclick="setM('b',this)">Lacunas no Brasil</button>
      </div>
      <div class="chips">
        <button class="chip" onclick="askCI('Presbifonia ‚Äî crit√©rios, conduta, terapia vs. cirurgia?')">Presbifonia</button>
        <button class="chip" onclick="askCI('Diferenciar disfonia funcional de organofuncional na anamnese?')">Disfonia funcional</button>
        <button class="chip" onclick="askCI('Triagem de disfagia p√≥s-AVC ‚Äî alertas e indica√ß√£o de FEES?')">Disfagia p√≥s-AVC</button>
        <button class="chip" onclick="askCI('Gagueira adulto: fluency shaping vs. stuttering modification?')">Gagueira adulto</button>
        <button class="chip" onclick="askCI('Afasia de Broca vs. Wernicke √† beira do leito?')">Afasia beira leito</button>
        <button class="chip" onclick="askCI('M√©todo Mastigado de Froeschels 1924 ‚Äî protocolo e indica√ß√µes?')">Froeschels 1924</button>
        <button class="chip" onclick="askCI('Schuell 1964 para afasias severas em plat√¥ ‚Äî como aplicar hoje?')">Schuell 1964</button>
        <button class="chip" onclick="askCI('Treinar equipe de ILPI para reduzir elderspeak ‚Äî Williams 2004?')">Treino ILPI</button>
        <button class="chip" onclick="askCI('Quais pesquisas hist√≥ricas de fono foram esquecidas e t√™m aplica√ß√£o hoje?')">Pesquisas esquecidas</button>
        <button class="chip" onclick="askCI('Lacunas de pesquisa em fonoaudiologia no Brasil em 2026?')">Lacunas Brasil</button>
      </div>
    </div>
    <div class="ci-out" id="ciout"><div class="co-ph"><div class="co-ph-t">‚óà Aguardando consulta</div><div class="co-ph-s">Ctrl+Enter para enviar ¬∑ Escolha o modo acima</div></div></div>
  </div>
</div>

<!-- M√ìDULOS -->
<div class="panel" id="p-modulos">
  <div class="ph"><div><div class="ph-ttl">M√≥dulos Cl√≠nicos</div><div class="ph-sub">Todas as ferramentas dispon√≠veis</div></div></div>
  <div class="mod-grid">
    <div class="mc-card" onclick="goP2('analisador','infantil')"><div class="mc-tag">01 ¬∑ Texto</div><div class="mc-ico">üó£</div><div class="mc-ttl">Fala Infantilizada</div><div class="mc-desc">Detecta patronizing speech e elderspeak. Score 0‚Äì100 com reformula√ß√£o sugerida.</div><span class="mc-bdg">Kemper 1994 ¬∑ Ryan 1986</span></div>
    <div class="mc-card" onclick="goP2('analisador','voz')"><div class="mc-tag">02 ¬∑ Texto</div><div class="mc-ico">üéô</div><div class="mc-ttl">Padr√£o Vocal</div><div class="mc-desc">Hip√≥teses diagn√≥sticas vocais com probabilidade e conduta a partir de relato.</div><span class="mc-bdg">GRBAS ¬∑ Froeschels 1924</span></div>
    <div class="mc-card" onclick="goP2('analisador','fluencia')"><div class="mc-tag">03 ¬∑ Texto</div><div class="mc-ico">üí¨</div><div class="mc-ttl">Flu√™ncia</div><div class="mc-desc">Tipifica e conta disflu√™ncias gagas vs. comuns em transcri√ß√£o marcada.</div><span class="mc-bdg">Van Riper ¬∑ Guitar 2006</span></div>
    <div class="mc-card" onclick="goP2('analisador','linguagem')"><div class="mc-tag">04 ¬∑ Texto</div><div class="mc-ico">üìù</div><div class="mc-ttl">Linguagem</div><div class="mc-desc">Complexidade sint√°tica, coer√™ncia e padr√µes como agramatismo e persevera√ß√£o.</div><span class="mc-bdg">Luria 1947</span></div>
    <div class="mc-card" onclick="goP2('analisador','degluticao')"><div class="mc-tag">05 ¬∑ Texto</div><div class="mc-ico">üçΩ</div><div class="mc-ttl">Triagem de Disfagia</div><div class="mc-desc">Estratifica risco de aspira√ß√£o e urg√™ncia de encaminhamento por relato.</div><span class="mc-bdg">Logemann ¬∑ Pommerenke 1948</span></div>
    <div class="mc-card" onclick="goP2('analisador','afasia')"><div class="mc-tag">06 ¬∑ Texto</div><div class="mc-ico">üß†</div><div class="mc-ttl">Afasia / Neuro</div><div class="mc-desc">Hip√≥teses de tipo de afasia em amostras de fala. Indica BDAE/WAB.</div><span class="mc-bdg">Schuell 1964 ¬∑ Luria 1947</span></div>
    <div class="mc-card" onclick="goP2('gravacao')"><div class="mc-tag">07 ¬∑ Voz ao vivo</div><div class="mc-ico">üé§</div><div class="mc-ttl">Grava√ß√£o de Voz</div><div class="mc-desc">Grava a fala do paciente com transcri√ß√£o em tempo real e an√°lise com IA.</div><span class="mc-bdg">Web Speech API ¬∑ PT-BR</span></div>
    <div class="mc-card" onclick="goP2('leitura')"><div class="mc-tag">08 ¬∑ Voz ao vivo</div><div class="mc-ico">‚è±</div><div class="mc-ttl">Leitura Cronometrada</div><div class="mc-desc">6 textos com cron√¥metro ‚Äî grava, transcreve, marca erros de leitura e calcula PPM.</div><span class="mc-bdg">Web Speech API ¬∑ PPM ¬∑ IA</span></div>
    <div class="mc-card" onclick="goP2('pesquisas')"><div class="mc-tag">09 ¬∑ Refer√™ncia</div><div class="mc-ico">üìö</div><div class="mc-ttl">Banco Hist√≥rico</div><div class="mc-desc">12 pesquisas esquecidas de 1854 a 2026 com aplica√ß√£o cl√≠nica documentada.</div><span class="mc-bdg">12 pesquisas ¬∑ todas as √°reas</span></div>
    <div class="mc-card" onclick="goP2('consulta')"><div class="mc-tag">10 ¬∑ IA</div><div class="mc-ico">ü§ñ</div><div class="mc-ttl">Consulta IA Cl√≠nica</div><div class="mc-desc">Suporte de decis√£o com 170 anos de pesquisa. 3 modos: cl√≠nico, hist√≥rico, Brasil.</div><span class="mc-bdg">Gemini ¬∑ PT-BR</span></div>
  </div>
</div>

</div></div></div>

<!-- MODAL CHAVE -->
<div class="ov" id="modal" style="display:none" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="m-ttl">Chave Gemini AI</div>
    <div class="m-sub">Gratuita ¬∑ 1.500 consultas/dia ¬∑ Necess√°ria para an√°lise com IA</div>
    <div class="m-steps">
      1 ‚Üí Acesse <a href="https://aistudio.google.com/apikey" target="_blank">aistudio.google.com/apikey</a><br>
      2 ‚Üí Login com conta Google<br>
      3 ‚Üí Clique em <strong>"Create API Key"</strong><br>
      4 ‚Üí Cole abaixo (come√ßa com <strong>AIza‚Ä¶</strong>)
    </div>
    <div class="kirow">
      <input type="password" class="ki" id="ki" placeholder="AIzaSy‚Ä¶" autocomplete="off">
      <button class="eye" onclick="document.getElementById('ki').type=document.getElementById('ki').type==='password'?'text':'password'">üëÅ</button>
    </div>
    <div class="m-note">
      üîí <strong>Salva s√≥ no navegador</strong> ‚Äî n√£o enviada a terceiros<br>
      üÜì <strong>Gratuita</strong> ‚Äî 15 req/min, 1.500/dia<br>
      üóë Apagar: F12 ‚Üí Console ‚Üí <code>localStorage.clear()</code>
    </div>
    <div class="m-btns">
      <button class="m-ok" onclick="saveKey()">Salvar e ativar</button>
      <button class="m-cancel" onclick="closeModal()">Cancelar</button>
    </div>
  </div>
</div>

<script>
'use strict';

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
function goP(tab){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('on'));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('on'));
  tab.classList.add('on');
  document.getElementById('p-'+tab.dataset.p).classList.add('on');
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('on'));
}
function goP2(p,c){
  const t=document.querySelector('.tab[data-p="'+p+'"]');
  if(t)goP(t);
  if(c){const ct=document.querySelector('.ct[data-c="'+c+'"]');if(ct)setC(ct);}
}

/* ‚îÄ‚îÄ KEY ‚îÄ‚îÄ */
const KID='phono26';
const gk=()=>localStorage.getItem(KID)||'';
function openModal(){document.getElementById('ki').value=gk();document.getElementById('ki').type='password';document.getElementById('modal').style.display='flex';setTimeout(()=>document.getElementById('ki').focus(),60);}
function closeModal(){document.getElementById('modal').style.display='none';}
document.getElementById('ki').addEventListener('keydown',e=>{if(e.key==='Enter')saveKey();});
function saveKey(){
  const k=document.getElementById('ki').value.trim();
  if(!k){alert('Cole a chave.');return;}
  if(!k.startsWith('AIza')){alert('Chave inv√°lida ‚Äî deve come√ßar com AIza');return;}
  localStorage.setItem(KID,k);updK();closeModal();
}
function updK(){
  const k=gk(),kb=document.getElementById('kb'),kd=document.getElementById('kd'),kt=document.getElementById('kt');
  if(k){kb.className='kbtn on';kd.className='dot dot-on';kt.textContent='IA: '+k.slice(0,8)+'‚Ä¶';}
  else{kb.className='kbtn';kd.className='dot dot-off';kt.textContent='Ativar IA';}
}
updK();

/* ‚îÄ‚îÄ GEMINI ‚îÄ‚îÄ */
async function callAI(prompt){
  const key=gk();
  if(!key){openModal();return null;}
  for(const model of['gemini-1.5-flash','gemini-2.0-flash']){
    let r,b;
    try{
      r=await fetch('https://generativelanguage.googleapis.com/v1beta/models/'+model+':generateContent?key='+key,{
        method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({contents:[{parts:[{text:prompt}]}],generationConfig:{maxOutputTokens:700,temperature:0.2}})
      });
      b=await r.json().catch(()=>({}));
    }catch(e){continue;}
    if(!r.ok){
      const s=r.status,m=(b?.error?.message||'').slice(0,200);
      if(s===400)return{e:true,m:'Chave inv√°lida (400)\n'+m+'\n\nGere nova em aistudio.google.com/apikey'};
      if(s===403){continue;}
      if(s===429){if(model==='gemini-2.0-flash')return{e:true,m:'Cota esgotada (429)\n'+(m||'Aguarde ~1 min. Limite gratuito: 15 req/min.')};continue;}
      if(s>=500){continue;}
      return{e:true,m:'Erro '+s+': '+m};
    }
    const fin=b?.candidates?.[0]?.finishReason;
    if(fin==='SAFETY')return{e:true,m:'Conte√∫do bloqueado pelo Google.'};
    if(fin==='MAX_TOKENS')return{e:true,m:'Resposta cortada ‚Äî use texto menor.'};
    const txt=b?.candidates?.[0]?.content?.parts?.[0]?.text||'';
    if(txt)return{e:false,t:txt};
  }
  return{e:true,m:'Sem resposta. Verifique conex√£o.'};
}
function pJSON(raw){
  const c=raw.replace(/^```(?:json)?\s*/,'').replace(/\s*```\s*$/,'').trim();
  try{return{ok:true,d:JSON.parse(c)};}catch(_){return{ok:false,raw};}
}
function notify(msg){
  const n=document.createElement('div');n.className='notif';n.textContent=msg;
  document.body.appendChild(n);setTimeout(()=>n.remove(),3000);
}

/* ‚îÄ‚îÄ RENDER HELPERS ‚îÄ‚îÄ */
function rB(lbl,col,inner){return'<div class="rb"><div class="rblbl"><span class="rbdot" style="background:'+col+'"></span>'+lbl+'</div>'+inner+'</div>';}
function rL(arr,cls){
  if(!arr||!arr.length)return'<span style="color:var(--grn);font-size:11px;">Nenhum identificado</span>';
  return arr.map(i=>'<div class="ri '+(cls||'')+'">'+(typeof i==='object'?JSON.stringify(i):String(i))+'</div>').join('');
}
function rT(v){return'<div class="rbtxt">'+String(v||'‚Äî')+'</div>';}

function renderRes(data,ctx,elId){
  const el=document.getElementById(elId||'res');
  if(!data){el.innerHTML='<div class="r-err">Sem dados.</div>';return;}
  let h='';
  if(ctx==='infantil'){
    const sc=parseInt(data.score)||0;
    const cc=sc>=70?'hi':sc>=35?'md':sc<=10?'nn':'lo';
    h='<div class="r-score"><div class="r-sn"><div class="snum '+cc+'">'+sc+'</div><div class="slbl">/ 100</div></div><div class="r-verd"><div class="vl">Diagn√≥stico lingu√≠stico</div><div class="vv '+cc+'">'+(data.verdict||'‚Äî')+'</div></div></div>';
    h+='<div class="r-blocks">';
    if(data.certezas)h+=rB('‚úì Confirmados','var(--blu)',rL(data.certezas,''));
    if(data.suspeitas)h+=rB('? Suspeitas','var(--amb)',rL(data.suspeitas,'w'));
    if(data.impacto)h+=rB('Impacto cl√≠nico','var(--t3)',rT(data.impacto));
    if(data.alternativa)h+=rB('‚úé Reformula√ß√£o','var(--grn)','<div class="r-alt">"'+data.alternativa+'"</div>');
    if(data.limitacao)h+=rB('‚öë Limita√ß√£o','var(--t3)',rT(data.limitacao));
    h+='</div>';
  }else if(ctx==='voz'){
    h='<div class="r-blocks">';
    if(data.dados?.length)h+=rB('‚úì Dados no relato','var(--blu)',rL(data.dados,''));
    if(data.hipoteses?.length){const hh=data.hipoteses.map(hp=>'<div class="hipo"><div class="hipo-n">'+(hp.nome||String(hp))+'</div><span class="hipo-p p'+(hp.prob?hp.prob[0].toLowerCase():'b')+'">'+(hp.prob||'')+'</span><div class="hipo-j">'+(hp.just||'')+'</div></div>').join('');h+=rB('Hip√≥teses','var(--amb)',hh);}
    if(data.alertas?.length)h+=rB('üö® Alertas','var(--red)',rL(data.alertas,'d'));
    if(data.ausentes?.length)h+=rB('‚ö† Dados ausentes','var(--t2)',rL(data.ausentes,'w'));
    if(data.conduta)h+=rB('Conduta','var(--t3)',rT(data.conduta));
    if(data.limitacao)h+=rB('‚öë Limita√ß√£o','var(--t3)',rT(data.limitacao));
    h+='</div>';
  }else if(ctx==='fluencia'){
    h='<div class="r-blocks">';
    const all=[...(data.gagas||[]),...(data.comuns||[])];
    if(all.length)h+=rB('Disflu√™ncias','var(--blu)',all.map(d=>'<div class="ri">'+(d.tipo||String(d))+' ('+(d.n||0)+'√ó)'+(d.ex?.length?' ‚Äî '+d.ex.join(', '):'')+'</div>').join(''));
    if(data.total_g!==undefined)h+=rB('Contagem','var(--t3)','<div class="rbtxt">Gagas: <strong>'+data.total_g+'</strong> ¬∑ Comuns: <strong>'+data.total_c+'</strong></div>');
    if(data.suspeita)h+=rB('Suspeita','var(--amb)',rT(data.suspeita+(data.just?' ‚Äî '+data.just:'')));
    if(data.limitacao)h+=rB('‚öë Limita√ß√£o','var(--t3)',rT(data.limitacao));
    h+='</div>';
  }else if(ctx==='linguagem'){
    h='<div class="r-blocks">';
    if(data.sint)h+=rB('Complexidade sint√°tica','var(--t3)',rT(data.sint));
    if(data.coesao)h+=rB('Coes√£o','var(--t3)',rT(data.coesao));
    if(data.coerencia)h+=rB('Coer√™ncia','var(--t3)',rT(data.coerencia));
    if(data.lexical)h+=rB('Diversidade lexical','var(--t3)',rT(data.lexical));
    if(data.alterados?.length)h+=rB('Padr√µes alterados','var(--red)',rL(data.alterados,'d'));
    if(data.nivel)h+=rB('N√≠vel','var(--t3)',rT(data.nivel));
    if(data.hipoteses?.length)h+=rB('Hip√≥teses','var(--amb)',rL(data.hipoteses,'w'));
    if(data.amostra)h+=rB('Amostra','var(--t3)',rT(data.amostra));
    if(data.limitacao)h+=rB('‚öë Limita√ß√£o','var(--t3)',rT(data.limitacao));
    h+='</div>';
  }else if(ctx==='degluticao'){
    h='<div class="r-blocks">';
    if(data.sinais?.length)h+=rB('‚úì Sinais','var(--blu)',rL(data.sinais,''));
    if(data.alertas?.length)h+=rB('üö® Alertas','var(--red)',rL(data.alertas,'d'));
    if(data.fase?.length)h+=rB('Fase suspeita','var(--amb)',rL(data.fase,'w'));
    if(data.risco){const rc=data.risco.includes('Alto')?'a':data.risco.includes('od')?'m':'b';h+=rB('Risco','var(--t3)','<span class="badge b'+rc+'">'+data.risco+'</span>');}
    if(data.urgencia){const uc=data.urgencia.includes('Urgente')?'a':data.urgencia.includes('Prior')?'m':'b';h+=rB('Urg√™ncia','var(--t3)','<span class="badge b'+uc+'">'+data.urgencia+'</span>');}
    if(data.avaliacao)h+=rB('Avalia√ß√£o','var(--t3)',rT(data.avaliacao));
    if(data.ausentes?.length)h+=rB('Dados ausentes','var(--t2)',rL(data.ausentes,''));
    if(data.limitacao)h+=rB('‚öë Limita√ß√£o','var(--t3)',rT(data.limitacao));
    h+='</div>';
  }else if(ctx==='afasia'){
    h='<div class="r-blocks">';
    if(data.fluencia)h+=rB('Flu√™ncia aparente','var(--t3)',rT(data.fluencia));
    const pf=[...(data.par_fon||[]),...(data.par_sem||[]),...(data.neolog||[])];
    h+=rB('Parafasias','var(--amb)',pf.length?rL(pf,'w'):'<span style="color:var(--grn);font-size:11px;">Nenhuma identificada</span>');
    if(data.agramatismo)h+=rB('Agramatismo','var(--t3)',rT(data.agramatismo));
    if(data.anomia)h+=rB('Anomia','var(--t3)',rT(data.anomia));
    if(data.hipoteses?.length){const hh=data.hipoteses.map(hp=>'<div class="hipo"><div class="hipo-n">'+(hp.tipo||String(hp))+'</div><span class="hipo-p p'+(hp.compat?hp.compat[0].toLowerCase():'b')+'">'+(hp.compat||'')+'</span><div class="hipo-j">'+(hp.just||'')+'</div></div>').join('');h+=rB('Hip√≥teses de afasia','var(--amb)',hh);}
    if(data.avaliacao)h+=rB('Avalia√ß√£o formal','var(--t3)',rT(data.avaliacao));
    if(data.amostra)h+=rB('Adequa√ß√£o da amostra','var(--t3)',rT(data.amostra));
    if(data.limitacao)h+=rB('‚öë Limita√ß√£o','var(--t3)',rT(data.limitacao));
    h+='</div>';
  }else{
    h='<div class="r-blocks">'+rB('Resultado','var(--blu)','<div class="rbtxt" style="white-space:pre-wrap">'+JSON.stringify(data,null,2)+'</div>')+'</div>';
  }
  el.innerHTML=h||'<div class="r-err">Nenhum campo reconhecido.</div>';
}

/* ‚îÄ‚îÄ ANALISADOR ‚îÄ‚îÄ */
const CTX={
  infantil:{sub:'Fala Infantilizada ‚Äî detecta patronizing speech e elderspeak',ph:'Cole a transcri√ß√£o da fala do cuidador, colega ou familiar dirigida a um adulto‚Ä¶',ex:['Vovozinha, a gente vai tomar o remedinho agora, t√° bem?','Deixa eu te explicar devagarzinho, fica tranquilo.','Que bonitinho! Voc√™ conseguiu! Que orgulho do papai!'],p:t=>'Analise o texto quanto a fala infantilizada dirigida a adultos.\nMarcadores: diminutivos excessivos, superendere√ßamento afetivo n√£o solicitado, nega√ß√£o de ag√™ncia, elogio para a√ß√µes b√°sicas, simplifica√ß√£o desnecess√°ria.\nUSE SOMENTE o texto. Score baixo (0-15) se n√£o houver marcadores claros.\nTexto: "'+t+'"\nJSON sem markdown:\n{"score":0,"verdict":"Sem marcadores|Tra√ßos leves|Moderado|Severo","certezas":[],"suspeitas":[],"impacto":"","alternativa":"","limitacao":""}'},
  voz:{sub:'Padr√£o Vocal ‚Äî hip√≥teses a partir de relato de sintomas',ph:'Cole o relato do paciente sobre sintomas vocais ou transcri√ß√£o de anamnese‚Ä¶',ex:['Minha voz cansa no fim do dia, fico rouco depois de dar aula.','Tenho voz esgani√ßada que n√£o consigo abaixar, h√° 2 anos.','Desde a tireoidectomia minha voz mudou, fica falhando.'],p:t=>'Analise este relato de sintomas vocais. USE SOMENTE o que est√° descrito. Levante hip√≥teses, n√£o diagn√≥stico.\nConsidere: disfonia hiperfuncional, DTM, n√≥dulos, p√≥lipo, paralisia de prega vocal, edema de Reinke, presbifonia, refluxo laringofar√≠ngeo.\nRelato: "'+t+'"\nJSON sem markdown:\n{"dados":[],"hipoteses":[{"nome":"","prob":"alta|moderada|baixa","just":""}],"alertas":[],"ausentes":[],"conduta":"","limitacao":""}'},
  fluencia:{sub:'An√°lise de Flu√™ncia ‚Äî tipifica disflu√™ncias em transcri√ß√£o',ph:'Cole transcri√ß√£o marcada. Ex: Eu- eu- eu quero f-f-falar [bloqueio 2s] com voc√™‚Ä¶',ex:['Eu- eu quero f-f-falar com voc√™ sobre o tr-trabalho.','Ent√£o eu... [pausa longa] estava dizendo que ele ele foi embora.','A- a- a minha m√£e disse p-para eu... [bloqueio] ir l√°.'],p:t=>'Tipifique as disflu√™ncias. GAGAS: repeti√ß√£o de som/s√≠laba, prolongamento, bloqueio, revis√£o por tens√£o. COMUNS: hesita√ß√£o, repeti√ß√£o de palavra inteira, revis√£o por formula√ß√£o.\nTranscri√ß√£o: "'+t+'"\nJSON sem markdown:\n{"gagas":[{"tipo":"","n":0,"ex":[]}],"comuns":[{"tipo":"","n":0,"ex":[]}],"total_g":0,"total_c":0,"suspeita":"Gagueira|Disflu√™ncia comum|Inconclusivo","just":"","limitacao":""}'},
  linguagem:{sub:'An√°lise de Linguagem ‚Äî complexidade sint√°tica, coer√™ncia e padr√µes alterados',ph:'Cole amostra de fala espont√¢nea, reda√ß√£o ou narra√ß√£o do paciente‚Ä¶',ex:['O homem foi na casa dele e depois ele foi l√° e depois voltou.','Hoje fui ao m√©dico. O m√©dico √© bom. Eu gosto do m√©dico.','Ent√£o tipo... a gente foi l√° n√©... e a√≠ aconteceu aquilo sabe?'],p:t=>'Analise padr√µes lingu√≠sticos. USE SOMENTE o texto fornecido.\nAvalie: complexidade sint√°tica, coes√£o, coer√™ncia, diversidade lexical, padr√µes alterados (persevera√ß√£o, agramatismo, neologismo, tangencialidade).\nTexto: "'+t+'"\nJSON sem markdown:\n{"sint":"","coesao":"","coerencia":"","lexical":"","alterados":[],"nivel":"","hipoteses":[],"amostra":"adequada|insuficiente","limitacao":""}'},
  degluticao:{sub:'Triagem de Disfagia ‚Äî estratifica risco por relato',ph:'Cole o relato do paciente sobre sintomas de degluti√ß√£o e alimenta√ß√£o‚Ä¶',ex:['Tenho engasgado com l√≠quidos, fica passando para a garganta errado.','A comida fica parada no meio do caminho, preciso de √°gua.','Depois do derrame parei de engolir direito, emagreci 4kg.'],p:t=>'Triagem de risco de disfagia. N√ÉO confirma disfagia ‚Äî estratifica risco.\nAlertas: tosse durante/ap√≥s degluti√ß√£o, engasgo com l√≠quidos, pneumonia de repeti√ß√£o, perda de peso, mudan√ßa ap√≥s AVC.\nRelato: "'+t+'"\nJSON sem markdown:\n{"sinais":[],"alertas":[],"fase":[],"risco":"Baixo|Moderado|Alto","urgencia":"Rotina|Priorit√°rio|Urgente","avaliacao":"","ausentes":[],"limitacao":""}'},
  afasia:{sub:'Afasia / Neurologia ‚Äî hip√≥teses de tipo em amostras de fala',ph:'Cole amostra de fala espont√¢nea do paciente neurol√≥gico‚Ä¶\nEx: O homem... √°gua... n√£o... cozinha.',ex:['O homem est√°... a √°gua... n√£o sei falar... mulher.','Eu fui ao... ao lugar das compras... o lugar que tem coisas.','Os paciente s√£o muito bem cuidado pelos enfermeira.'],p:t=>'Hip√≥teses de afasia. N√ÉO diagnostica. Se amostra curta, diga.\nTipos: Broca (n√£o fluente, agramatismo), Wernicke (fluente, parafasias), Global, Anomia, Condu√ß√£o, Apraxia.\nAmostra: "'+t+'"\nJSON sem markdown:\n{"fluencia":"Fluente|N√£o fluente|Inconclusivo","par_fon":[],"par_sem":[],"neolog":[],"agramatismo":"","anomia":"","hipoteses":[{"tipo":"","compat":"alta|moderada","just":""}],"avaliacao":"","amostra":"","limitacao":""}'}
};
let curC='infantil';
function setC(btn){document.querySelectorAll('.ct').forEach(b=>b.classList.remove('on'));btn.classList.add('on');curC=btn.dataset.c;applyC(curC);clrRes();}
function applyC(n){
  const c=CTX[n];if(!c)return;
  document.getElementById('az-ta').placeholder=c.ph;
  document.getElementById('az-sub').textContent=c.sub;
  document.getElementById('az-exs').innerHTML=c.ex.map((e,i)=>'<button class="ex" onclick="document.getElementById(\'az-ta\').value=this.dataset.v" data-v="'+e.replace(/"/g,'&quot;').replace(/\n/g,' ')+'">Ex.'+(i+1)+'</button>').join('');
}
applyC('infantil');
function clrRes(){document.getElementById('res').innerHTML='<div class="r-empty"><div class="r-empty-ico">‚óà</div><div class="r-empty-msg">Aguardando an√°lise</div></div>';}
function clrAz(){document.getElementById('az-ta').value='';clrRes();}
async function runAz(){
  const txt=document.getElementById('az-ta').value.trim();
  if(!txt){alert('Insira o texto.');return;}
  if(!gk()){openModal();return;}
  const rb=document.getElementById('runbtn'),rs=document.getElementById('rsp');
  rb.disabled=true;rs.style.display='block';document.getElementById('rtxt').textContent='Analisando‚Ä¶';
  document.getElementById('res').innerHTML='<div class="r-load"><div class="spb"></div>Processando‚Ä¶</div>';
  const res=await callAI(CTX[curC].p(txt));
  rb.disabled=false;rs.style.display='none';document.getElementById('rtxt').textContent='Analisar';
  if(!res||res.e){document.getElementById('res').innerHTML='<div class="r-err">'+(res?.m||'Sem resposta.')+'</div>';return;}
  const p=pJSON(res.t);
  if(!p.ok){document.getElementById('res').innerHTML='<div class="r-blocks">'+rB('Resposta texto','var(--amb)','<div class="rbtxt" style="white-space:pre-wrap">'+res.t+'</div>')+'</div>';return;}
  renderRes(p.d,curC,'res');
}

/* ‚îÄ‚îÄ GRAVA√á√ÉO DE VOZ ‚îÄ‚îÄ */
let recog=null,isRec=false,recTimer=null,recSecs=0;
let finalTxt='',interimTxt='',gravCtx='fluencia';

function setGC(btn){document.querySelectorAll('.ctx-chip').forEach(b=>b.classList.remove('on'));btn.classList.add('on');gravCtx=btn.dataset.gc;}

function makeRecog(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR)return null;
  const r=new SR();
  r.lang='pt-BR';r.continuous=true;r.interimResults=true;r.maxAlternatives=1;
  r.onresult=e=>{
    interimTxt='';
    for(let i=e.resultIndex;i<e.results.length;i++){
      if(e.results[i].isFinal)finalTxt+=e.results[i][0].transcript+' ';
      else interimTxt+=e.results[i][0].transcript;
    }
    updTT();
    if(finalTxt.trim())document.getElementById('grav-ai-btn').style.display='';
  };
  r.onerror=e=>{
    if(e.error==='not-allowed'){alert('Permiss√£o de microfone negada. Autorize nas configura√ß√µes do navegador.');stopRec();}
    if(e.error==='no-speech')return;
    console.warn('Speech error:',e.error);
  };
  r.onend=()=>{if(isRec){try{r.start();}catch(_){}}};
  return r;
}

function updTT(){
  const el=document.getElementById('tt');
  el.innerHTML=finalTxt.replace(/\n/g,'<br>')+'<span class="tt-interim">'+interimTxt+'</span>';
  el.scrollTop=el.scrollHeight;
}

function toggleMic(){if(isRec)stopRec();else startRec();}

function startRec(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){alert('Use Chrome ou Edge para reconhecimento de voz.');return;}
  recog=makeRecog();
  if(!recog)return;
  try{recog.start();}catch(e){alert('Erro ao iniciar microfone: '+e.message);return;}
  isRec=true;
  document.getElementById('mic-btn').classList.add('rec');
  document.getElementById('mic-btn').textContent='‚èπ';
  document.getElementById('mic-status').className='mic-status rec';
  document.getElementById('mic-status').textContent='Gravando‚Ä¶';
  document.getElementById('mic-timer').className='mic-timer rec';
  document.querySelectorAll('.wb').forEach(b=>b.classList.add('act'));
  recSecs=0;
  recTimer=setInterval(()=>{
    recSecs++;
    document.getElementById('mic-timer').textContent=
      String(Math.floor(recSecs/60)).padStart(2,'0')+':'+String(recSecs%60).padStart(2,'0');
  },1000);
}

function stopRec(){
  if(recog){try{recog.stop();}catch(_){}}
  recog=null;isRec=false;clearInterval(recTimer);
  document.getElementById('mic-btn').classList.remove('rec');
  document.getElementById('mic-btn').textContent='üé§';
  document.getElementById('mic-status').className='mic-status';
  document.getElementById('mic-status').textContent='Grava√ß√£o conclu√≠da';
  document.getElementById('mic-timer').className='mic-timer';
  document.querySelectorAll('.wb').forEach(b=>b.classList.remove('act'));
}

function clrGrav(){
  stopRec();finalTxt='';interimTxt='';
  document.getElementById('tt').innerHTML='<span style="color:var(--t3);font-style:italic;font-size:13px">A transcri√ß√£o aparecer√° aqui enquanto voc√™ fala‚Ä¶</span>';
  document.getElementById('grav-res').innerHTML='<div class="r-empty"><div class="r-empty-ico">üé§</div><div class="r-empty-msg">Grave e clique em "Analisar com IA"</div></div>';
  document.getElementById('grav-ai-btn').style.display='none';
  recSecs=0;document.getElementById('mic-timer').textContent='00:00';
  document.getElementById('mic-status').textContent='Clique para gravar';
}

function copyTxt(){
  if(!finalTxt.trim()){notify('Nada para copiar.');return;}
  navigator.clipboard.writeText(finalTxt.trim()).then(()=>notify('Transcri√ß√£o copiada!'));
}

function sendToAz(){
  if(!finalTxt.trim()){notify('Grave algo primeiro.');return;}
  document.getElementById('az-ta').value=finalTxt.trim();
  const ct=document.querySelector('.ct[data-c="'+gravCtx+'"]');
  if(ct)setC(ct);
  goP2('analisador',gravCtx);
  notify('Enviado ao Analisador!');
}

async function analyzeGrav(){
  const txt=finalTxt.trim();
  if(!txt){notify('Nada para analisar.');return;}
  if(!gk()){openModal();return;}
  const btn=document.getElementById('grav-ai-btn');
  btn.disabled=true;
  document.getElementById('grav-res').innerHTML='<div class="r-load"><div class="spb"></div>Analisando‚Ä¶</div>';
  const res=await callAI(CTX[gravCtx].p(txt));
  btn.disabled=false;
  if(!res||res.e){document.getElementById('grav-res').innerHTML='<div class="r-err">'+(res?.m||'Sem resposta.')+'</div>';return;}
  const p=pJSON(res.t);
  if(!p.ok){document.getElementById('grav-res').innerHTML='<div class="r-blocks">'+rB('Resultado','var(--amb)','<div class="rbtxt" style="white-space:pre-wrap">'+res.t+'</div>')+'</div>';return;}
  renderRes(p.d,gravCtx,'grav-res');
}

/* ‚îÄ‚îÄ LEITURA CRONOMETRADA ‚îÄ‚îÄ */
const TEXTOS=[
  {id:0,title:'O Parque',diff:'f',n:60,alvo:45,ref:'Flu√™ncia b√°sica',texto:'O menino correu pelo parque e viu um cachorro brincando com uma bola vermelha. Ele parou e olhou para o animal. O cachorro latiu e abanou o rabo. O menino sorriu e jogou a bola para o cachorro. Os dois brincaram at√© o sol come√ßar a se p√¥r no horizonte azul.'},
  {id:1,title:'A Cidade e o Rio',diff:'f',n:72,alvo:52,ref:'Narrativa simples',texto:'A cidade cresceu ao lado do rio. As pessoas pescavam e lavavam roupas nas suas margens. Com o tempo, f√°bricas foram constru√≠das e a √°gua ficou escura. Os peixes sumiram e as crian√ßas pararam de nadar. Hoje, um projeto tenta devolver a vida ao rio que um dia foi o cora√ß√£o da cidade.'},
  {id:2,title:'Fonoaudiologia',diff:'m',n:65,alvo:50,ref:'Vocabul√°rio t√©cnico',texto:'A fonoaudiologia estuda a comunica√ß√£o humana e seus dist√∫rbios. O profissional avalia, diagnostica e trata altera√ß√µes da voz, da fala, da linguagem, da audi√ß√£o e da degluti√ß√£o. A atua√ß√£o ocorre em hospitais, escolas, cl√≠nicas e centros de reabilita√ß√£o, atendendo pessoas de todas as idades.'},
  {id:3,title:'O Velho Pescador',diff:'m',n:85,alvo:65,ref:'Prosodia e ritmo',texto:'Era uma vez um velho pescador que sa√≠a ao mar todas as manh√£s. Certo dia, ao lan√ßar suas redes, sentiu algo pesado preso nas malhas. Com esfor√ßo, puxou a rede e encontrou uma garrafa de vidro verde com um papel dentro. A mensagem dizia apenas: continue. O pescador n√£o entendeu o que aquilo significava, mas guardou o papel no bolso. Naquele dia, pescou mais do que nunca.'},
  {id:4,title:'Texto Cient√≠fico',diff:'d',n:72,alvo:58,ref:'Terminologia especializada',texto:'A neuroplasticidade √© a capacidade do sistema nervoso central de se reorganizar funcionalmente ap√≥s les√µes ou experi√™ncias. Alexander Luria demonstrou que regi√µes encef√°licas intactas podem assumir fun√ß√µes de √°reas lesadas. Este princ√≠pio fundamenta toda a reabilita√ß√£o neuropsicol√≥gica contempor√¢nea e explica como a terapia fonoaudiol√≥gica intensiva produz resultados mensur√°veis.'},
  {id:5,title:'Encontros Consonantais',diff:'d',n:78,alvo:68,ref:'Precis√£o articulat√≥ria',texto:'A transi√ß√£o primaveril transformou a plan√≠cie. Borboletas esvoa√ßavam entre as flores desabrochadas enquanto o vento fresco trazia o cheiro de terra molhada. As crian√ßas, despreparadas para o frio repentino, correram em busca de agasalhos. A tempestade aproximou-se rapidamente, trazendo trov√µes e rel√¢mpagos que iluminaram o c√©u escurecido.'},
];

let lSel=null,lRecog=null,lIsRec=false,lTimer=null,lSecs=0;
let lWords=[],lIdx=0,lTranscript='',lStartTime=null;

function buildTextList(){
  const dlbl={f:'F√°cil',m:'M√©dio',d:'Dif√≠cil'};
  const dcls={f:'df',m:'dm',d:'dd'};
  document.getElementById('text-list').innerHTML=TEXTOS.map(t=>
    '<div class="text-item" id="ti'+t.id+'" onclick="selText('+t.id+')">'+
    '<div class="ti-hd"><div class="ti-ttl">'+t.title+'</div><span class="ti-diff '+dcls[t.diff]+'">'+dlbl[t.diff]+'</span></div>'+
    '<div class="ti-info">'+t.n+' palavras ¬∑ ~'+t.alvo+'s ¬∑ '+t.ref+'</div></div>'
  ).join('');
}
buildTextList();

function selText(id){
  if(lIsRec)return;
  document.querySelectorAll('.text-item').forEach(t=>t.classList.remove('on'));
  document.getElementById('ti'+id).classList.add('on');
  lSel=TEXTOS.find(t=>t.id===id);
  resetLeit();
  renderRdgTxt();
  document.getElementById('leit-status').textContent='Pronto ‚Äî clique em "Iniciar"';
  document.getElementById('leit-start-btn').style.display='';
  document.getElementById('leit-reset-btn').style.display='none';
  document.getElementById('reading-result').style.display='none';
}

function renderRdgTxt(){
  if(!lSel)return;
  lWords=lSel.texto.split(/\s+/);
  document.getElementById('reading-txt').innerHTML=lWords.map((w,i)=>'<span class="w" id="lw'+i+'">'+w+'</span> ').join('');
}

function toggleLeit(){if(!lSel){notify('Selecione um texto primeiro.');return;}if(lIsRec)stopLeit();else startLeit();}

function startLeit(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){alert('Use Chrome ou Edge para reconhecimento de voz.');return;}
  lRecog=new SR();
  lRecog.lang='pt-BR';lRecog.continuous=true;lRecog.interimResults=true;
  lRecog.onresult=e=>{
    let interim='';
    for(let i=e.resultIndex;i<e.results.length;i++){
      if(e.results[i].isFinal){lTranscript+=e.results[i][0].transcript+' ';matchWords();}
      else interim+=e.results[i][0].transcript;
    }
    document.getElementById('leit-status').textContent='Ouvindo: "'+interim.slice(-40)+'"';
    updWPM();
  };
  lRecog.onerror=e=>{if(e.error==='not-allowed')alert('Permiss√£o de microfone negada.');if(e.error!=='no-speech')stopLeit();};
  lRecog.onend=()=>{if(lIsRec)try{lRecog.start();}catch(_){}};
  try{lRecog.start();}catch(e){alert('Erro ao iniciar microfone.');return;}
  lIsRec=true;lTranscript='';lIdx=0;lStartTime=Date.now();
  document.getElementById('leit-start-btn').textContent='‚èπ Parar';
  document.getElementById('leit-start-btn').className='btn danger';
  document.getElementById('leit-reset-btn').style.display='';
  document.getElementById('leit-timer').className='timer run';
  lSecs=0;
  lTimer=setInterval(()=>{
    lSecs++;
    document.getElementById('leit-timer').textContent=
      String(Math.floor(lSecs/60)).padStart(2,'0')+':'+String(lSecs%60).padStart(2,'0');
    updProg();
  },1000);
}

function stopLeit(){
  if(lRecog){try{lRecog.stop();}catch(_){}}
  lRecog=null;lIsRec=false;clearInterval(lTimer);
  document.getElementById('leit-start-btn').textContent='üé§ Iniciar';
  document.getElementById('leit-start-btn').className='btn';
  document.getElementById('leit-timer').className='timer done';
  document.getElementById('leit-status').textContent='Conclu√≠do';
  showLeitRes();
}

function norm(s){return s.toLowerCase().replace(/[^a-z√°√†√¢√£√©√®√™√≠√Ø√≥√¥√µ√∂√∫√º√ß]/g,'').trim();}

function levenshtein(a,b){
  const m=a.length,n=b.length;
  if(!m)return n;if(!n)return m;
  const d=[];
  for(let i=0;i<=m;i++){d[i]=[i];for(let j=1;j<=n;j++)d[i][j]=i===0?j:0;}
  for(let j=1;j<=n;j++)d[0][j]=j;
  for(let i=1;i<=m;i++)for(let j=1;j<=n;j++)
    d[i][j]=a[i-1]===b[j-1]?d[i-1][j-1]:1+Math.min(d[i-1][j],d[i][j-1],d[i-1][j-1]);
  return d[m][n];
}

function matchWords(){
  const spoken=norm(lTranscript).split(/\s+/).filter(w=>w.length>0);
  // reset classes
  lWords.forEach((_,i)=>{const el=document.getElementById('lw'+i);if(el)el.className='w';});
  let si=0;
  for(let wi=0;wi<lWords.length&&si<spoken.length;wi++){
    const exp=norm(lWords[wi]);
    const said=spoken[si]||'';
    const el=document.getElementById('lw'+wi);
    if(exp===said||levenshtein(exp,said)<=1){
      if(el)el.className='w said';si++;lIdx=wi+1;
    }else if(si<spoken.length-2){
      if(el)el.className='w err';si++;
    }
  }
  const cur=document.getElementById('lw'+lIdx);
  if(cur&&cur.className==='w'){cur.className='w cur';try{cur.scrollIntoView({behavior:'smooth',block:'center'});}catch(_){}}
  updProg();
  if(lIdx>=lWords.length-1)setTimeout(stopLeit,800);
}

function updProg(){
  if(!lSel)return;
  document.getElementById('leit-prog').style.width=Math.min(100,(lIdx/lWords.length)*100)+'%';
}
function updWPM(){
  if(!lStartTime||!lIdx)return;
  const m=(Date.now()-lStartTime)/60000;
  document.getElementById('leit-wpm').textContent=Math.round(lIdx/m)+' PPM';
}

function showLeitRes(){
  if(!lSel)return;
  const said=document.querySelectorAll('.w.said').length;
  const errs=document.querySelectorAll('.w.err').length;
  const mins=lSecs/60;
  const wpm=mins>0?Math.round(said/mins):0;
  const acc=said+errs>0?Math.round(said/(said+errs)*100):100;
  const dif=lSecs-lSel.alvo;
  const wRef=lSel.diff==='f'?[100,150]:lSel.diff==='m'?[80,130]:[60,110];
  const wC=wpm<wRef[0]?'hi':wpm>wRef[1]?'md':'ok';
  const aC=acc<85?'hi':acc<95?'md':'ok';
  document.getElementById('rr-grid').innerHTML=
    '<div class="rr-stat"><div class="rr-val '+wC+'">'+wpm+'</div><div class="rr-lbl">PPM</div></div>'+
    '<div class="rr-stat"><div class="rr-val '+aC+'">'+acc+'%</div><div class="rr-lbl">Precis√£o</div></div>'+
    '<div class="rr-stat"><div class="rr-val '+(errs>5?'hi':errs>2?'md':'ok')+'">'+errs+'</div><div class="rr-lbl">Erros</div></div>'+
    '<div class="rr-stat"><div class="rr-val '+(Math.abs(dif)>15?'md':'ok')+'">'+(dif>=0?'+':'')+dif+'s</div><div class="rr-lbl">vs. meta</div></div>';
  document.getElementById('rr-ai-result').innerHTML='';
  document.getElementById('reading-result').style.display='';
}

function resetLeit(){
  stopLeit();lTranscript='';lIdx=0;lSecs=0;
  document.getElementById('leit-timer').textContent='00:00';
  document.getElementById('leit-timer').className='timer';
  document.getElementById('leit-wpm').textContent='‚Äî PPM';
  document.getElementById('leit-prog').style.width='0%';
  document.getElementById('reading-result').style.display='none';
  document.getElementById('leit-reset-btn').style.display='none';
  document.getElementById('leit-start-btn').textContent='üé§ Iniciar';
  document.getElementById('leit-start-btn').className='btn';
  if(lSel)renderRdgTxt();
}

async function analyzeReading(){
  if(!lSel||!lTranscript.trim()){notify('Fa√ßa a leitura primeiro.');return;}
  if(!gk()){openModal();return;}
  const said=document.querySelectorAll('.w.said').length;
  const errs=document.querySelectorAll('.w.err').length;
  const errWords=[];lWords.forEach((w,i)=>{const el=document.getElementById('lw'+i);if(el&&el.classList.contains('err'))errWords.push(w);});
  const mins=lSecs/60;const wpm=mins>0?Math.round(said/mins):0;
  const acc=said+errs>0?Math.round(said/(said+errs)*100):100;
  const prompt='Analise esta sess√£o de leitura cronometrada como fonoaudi√≥loga especialista.\n\nTexto original ('+lSel.n+' palavras, dificuldade '+lSel.diff+', refer√™ncia: '+lSel.ref+'):\n"'+lSel.texto+'"\n\nTranscri√ß√£o do paciente:\n"'+lTranscript.trim()+'"\n\nM√©tricas: velocidade='+wpm+' PPM, precis√£o='+acc+'%, erros='+errs+', tempo='+lSecs+'s, meta='+lSel.alvo+'s\nPalavras com erro: '+errWords.join(', ')+'\n\nAnalise: padr√£o de erros (omiss√£o, substitui√ß√£o, adi√ß√£o, invers√£o, hesita√ß√£o), velocidade vs. esperada, flu√™ncia de leitura, hip√≥teses cl√≠nicas se houver padr√µes relevantes, recomenda√ß√µes.\n\nJSON sem markdown:\n{"velocidade":"","precisao":"","tipo_erros":[],"padroes":[],"hipoteses":[],"observacoes":"","recomendacoes":""}';
  const btn=document.querySelector('#reading-result .btn.pri');
  if(btn)btn.disabled=true;
  document.getElementById('rr-ai-result').innerHTML='<div class="r-load"><div class="spb"></div>Analisando‚Ä¶</div>';
  const res=await callAI(prompt);
  if(btn)btn.disabled=false;
  if(!res||res.e){document.getElementById('rr-ai-result').innerHTML='<div class="r-err">'+(res?.m||'Sem resposta.')+'</div>';return;}
  const p=pJSON(res.t);
  const data=p.ok?p.d:null;
  if(!data){document.getElementById('rr-ai-result').innerHTML='<div class="r-blocks">'+rB('Resultado','var(--amb)','<div class="rbtxt" style="white-space:pre-wrap">'+res.t+'</div>')+'</div>';return;}
  let h='<div class="r-blocks" style="margin-top:8px">';
  if(data.velocidade)h+=rB('Velocidade de leitura','var(--t3)',rT(data.velocidade));
  if(data.precisao)h+=rB('Precis√£o','var(--t3)',rT(data.precisao));
  if(data.tipo_erros?.length)h+=rB('Tipo de erros','var(--red)',rL(data.tipo_erros,'d'));
  if(data.padroes?.length)h+=rB('Padr√µes identificados','var(--amb)',rL(data.padroes,'w'));
  if(data.hipoteses?.length)h+=rB('Hip√≥teses cl√≠nicas','var(--pur)',rL(data.hipoteses,'w'));
  if(data.observacoes)h+=rB('Observa√ß√µes','var(--t3)',rT(data.observacoes));
  if(data.recomendacoes)h+=rB('Recomenda√ß√µes','var(--grn)',rT(data.recomendacoes));
  h+='</div>';
  document.getElementById('rr-ai-result').innerHTML=h;
}

/* ‚îÄ‚îÄ PESQUISAS ‚îÄ‚îÄ */
const PP=[
  {id:0,y:1854,cat:'voz',lost:true,title:'Observa√ß√µes do Aparelho Vocal Vivo',author:'Manuel Garc√≠a ¬∑ Royal Society of London',tags:['tv','tl'],oq:'Em setembro de 1854, Garc√≠a ‚Äî professor de canto espanhol, n√£o m√©dico ‚Äî comprou um espelho de dentista por 6 francos e, usando reflexo de luz solar entre dois espelhos, tornou-se o primeiro ser humano a observar cordas vocais em funcionamento.',es:'Garc√≠a era m√∫sico, n√£o m√©dico. Publicou em sociedade de ci√™ncias naturais. A medicina levou anos para assimilar.',ap:'Fundamento de toda laringoscopia. Cada videoestroboscopia, nasofibroscopia e videolaringoscopia tem ra√≠zes neste espelho de ‚Ç¨6.'},
  {id:1,y:1881,cat:'voz',lost:false,title:'Lei de Semon ‚Äî Paralisia Lar√≠ngea',author:'Felix Semon & Rosenbach ¬∑ Archives of Laryngology, Londres',tags:['tv'],oq:'Fibras que controlam abdutores s√£o afetadas antes das adutoras em les√µes progressivas do NLR. Rouquid√£o precede dificuldade respirat√≥ria.',es:'A hip√≥tese Wagner-Grossman gerou controv√©rsia e a lei foi considerada ultrapassada por d√©cadas.',ap:'Diagn√≥stico diferencial em paralisia de prega vocal ap√≥s tireoidectomia, compress√£o tumoral de mediastino e les√£o vagal.'},
  {id:2,y:1924,cat:'voz',lost:true,title:'M√©todo Mastigado para Disfonia Funcional',author:'Emil Froeschels ¬∑ Policl√≠nica de Viena',tags:['tv','tl'],oq:'Mastiga√ß√£o exagerada com vocaliza√ß√£o simult√¢nea produz voz sem tens√£o lar√≠ngea. Taxa de 78% de resolu√ß√£o em disfonias funcionais em 6 semanas.',es:'Froeschels fugiu da Europa nos anos 30. Sua Policl√≠nica de Viena foi fechada. Obra jamais traduzida sistematicamente para o portugu√™s.',ap:'Disfonia hiperfuncional, fadiga vocal, voz do professor. Alta efic√°cia documentada e custo zero. Subutilizado no Brasil por desconhecimento hist√≥rico.'},
  {id:3,y:1927,cat:'fluencia',lost:true,title:'Cerebral Dominance and Stuttering',author:'Samuel Orton & Lee Travis ¬∑ Universidade de Iowa',tags:['tflu','tl'],oq:'Gagueira como competi√ß√£o hemisf√©rica pelo controle motor da fala ‚Äî sem domin√¢ncia estabelecida, os dois hemisf√©rios competem pela musculatura fonoarticulat√≥ria.',es:'Abandonada antes de a neuroimagem poder test√°-la adequadamente.',ap:'fMRI de 2024 confirmou ativa√ß√£o anormal do hemisf√©rio direito em pessoas que gaguejam. Travis estava na dire√ß√£o certa, 97 anos antes.'},
  {id:4,y:1947,cat:'afasia',lost:false,title:'Reorganiza√ß√£o Funcional Cerebral ap√≥s Trauma',author:'Alexander Luria ¬∑ Instituto de Neurocirurgia de Moscou',tags:['tafa'],oq:'Regi√µes encef√°licas intactas podem assumir fun√ß√µes de √°reas lesadas. Demonstrado com soldados sovi√©ticos com les√µes cerebrais de guerra.',es:'Publicado em russo em 1947. Stalin condenou como idealista. Tradu√ß√£o inglesa s√≥ em 1963.',ap:'Fundamento de toda neuroreabilita√ß√£o. Melodic Intonation Therapy deriva diretamente destes princ√≠pios.'},
  {id:5,y:1948,cat:'deglu',lost:true,title:'Neuromuscular Coordination in Deglutition',author:'W.T. Pommerenke ¬∑ American Journal of Physiology',tags:['tde','tl'],oq:'Mapeamento das zonas de gatilho far√≠ngeo que deflagram o reflexo de degluti√ß√£o ‚Äî pilares palatinos, base de l√≠ngua, parede posterior.',es:'Publicado em fisiologia, fora do radar cl√≠nico por d√©cadas.',ap:'Fundamento da estimula√ß√£o t√°til-t√©rmica em disfagia. O cubo de gelo nos pilares se apoia neste mapa de 1948.'},
  {id:6,y:1956,cat:'audio',lost:true,title:'Discrimina√ß√£o Tonal em Beb√™s Pr√©-Lingu√≠sticos',author:'S. Wolff ¬∑ Zeitschrift f√ºr Phonetik, Berlim',tags:['tau','tl'],oq:'Beb√™s pr√©-lingu√≠sticos discriminam frequ√™ncias tonais com precis√£o ‚Äî 30 anos antes do BERA neonatal.',es:'Publicado em alem√£o, circula√ß√£o limitada, durante a Guerra Fria. Invis√≠vel por 30 anos.',ap:'Base conceitual do BERA neonatal e da triagem auditiva universal que detecta perdas auditivas no primeiro dia de vida.'},
  {id:7,y:1964,cat:'afasia',lost:true,title:"Schuell's Stimulation Approach to Aphasia",author:'Hildred Schuell ¬∑ Minneapolis VA Hospital',tags:['tafa','tl'],oq:'A linguagem em afasia funciona com efici√™ncia reduzida ‚Äî n√£o √© destru√≠da. Estimula√ß√£o auditiva intensa e repetitiva a reativa. Intensidade √© vari√°vel cr√≠tica.',es:'Schuell era mulher no VA, n√£o em universidade de prest√≠gio. Morreu em 1959. T√©cnicas usadas hoje sem que se cite o nome.',ap:'Redescoberta em 2008 para afasias severas em plat√¥. Dose terap√™utica importa tanto quanto t√©cnica.'},
  {id:8,y:1966,cat:'voz',lost:true,title:'Acoustic Properties of the Aging Voice',author:'P.H. Ptacek & E.K. Sander ¬∑ J Speech Hearing Research',tags:['tv','tl'],oq:'Primeiro mapeamento de F0, jitter, shimmer e HNR em adultos saud√°veis por faixa et√°ria. Define o que √© normal no envelhecimento vocal.',es:'Publicado antes da era digital. Ignorado na forma√ß√£o fonoaudiol√≥gica brasileira.',ap:'Diagn√≥stico diferencial de presbifonia vs. disfonia patol√≥gica acima de 60 anos. Sem normativos por idade, a compara√ß√£o √© inv√°lida.'},
  {id:9,y:1986,cat:'infantil',lost:false,title:'Communication Predicament of Aging',author:'Ryan, Giles et al. ¬∑ Language & Communication',tags:['tinf'],oq:'Fala adaptada "para baixo" comunica incapacidade ‚Üí o interlocutor pode se comportar de acordo ‚Äî profecia autorrealiz√°vel com consequ√™ncias neurol√≥gicas.',es:'Publicado em lingu√≠stica, fora do radar de fonoaudi√≥logos. Kemper 1994 popularizou e deixou Ryan na sombra.',ap:'Base te√≥rica para treinamento de cuidadores. Explica por que fala infantilizada √© neurologicamente prejudicial quando sistem√°tica.'},
  {id:10,y:1994,cat:'infantil',lost:false,title:'Elderspeak: Patronizing Style with Older Adults',author:'Susan Kemper ¬∑ Journal of Gerontology',tags:['tinf'],oq:'Idosos expostos ao elderspeak: decl√≠nio cognitivo acelerado, autoestima reduzida, resist√™ncia ao cuidado, maior agita√ß√£o.',es:'Comunica√ß√£o geri√°trica √© perif√©rica na forma√ß√£o de fono no Brasil. Zero estudos brasileiros derivados em 32 anos.',ap:'Protocolo de treinamento de cuidadores e equipes de sa√∫de geri√°trica. Base cient√≠fica do m√≥dulo de an√°lise desta plataforma.'},
  {id:11,y:2004,cat:'infantil',lost:false,title:'Decreasing Elderspeak: A Training Program',author:'Brent Williams, Susan Kemper & Mary Hummert ¬∑ The Gerontologist',tags:['tinf'],oq:'Treinamento de 4 horas ‚Üí redu√ß√£o de 58% no elderspeak, mantida em reavalia√ß√£o 3 meses depois.',es:'Publicado em gerontologia, fora do radar cl√≠nico. O dado "4h ‚Üí ‚àí58%" √© praticamente desconhecido no Brasil.',ap:'Protocolo concreto para ILPI e hospitais. Quatro horas de treinamento s√£o suficientes para mudan√ßa mensur√°vel e duradoura.'},
];
const TN={'tv':'Voz','tflu':'Flu√™ncia','tafa':'Afasia','tde':'Degluti√ß√£o','tau':'Audi√ß√£o','tinf':'Fala Infant.','tl':'Esquecida'};
let reF='all',reA=null;
function buildRF(){
  const cats=[['all','Todas'],['voz','Voz'],['fluencia','Flu√™ncia'],['afasia','Afasia'],['deglu','Degluti√ß√£o'],['audio','Audi√ß√£o'],['infantil','Fala Infant.'],['lost','Esquecidas']];
  document.getElementById('refb').innerHTML=cats.map(([c,l])=>'<button class="rf'+(c==='all'?' on':'')+'" data-cat="'+c+'" onclick="setRF(this)">'+l+'</button>').join('');
}
function setRF(btn){document.querySelectorAll('.rf').forEach(b=>b.classList.remove('on'));btn.classList.add('on');reF=btn.dataset.cat;renderRN();}
function renderRN(){
  const list=reF==='all'?PP:reF==='lost'?PP.filter(p=>p.lost):PP.filter(p=>p.cat===reF);
  document.getElementById('renav').innerHTML=list.map(p=>'<div class="rni'+(reA===p.id?' on':'')+'" onclick="showP('+p.id+')"><div class="rni-y">'+p.y+'</div><div class="rni-t">'+p.title+'</div></div>').join('');
}
function showP(id){
  reA=id;renderRN();const p=PP.find(x=>x.id===id);if(!p)return;
  document.getElementById('redet').innerHTML=
    '<div class="red-y">'+p.y+' ¬∑ '+p.tags.filter(t=>t!=='tl').map(t=>TN[t]||t).join(' ¬∑ ')+'</div>'+
    '<div class="red-ttl">'+p.title+'</div><div class="red-aut">'+p.author+'</div>'+
    '<div class="red-tags">'+p.tags.map(t=>'<span class="rtag '+t+'">'+(TN[t]||t)+'</span>').join('')+'</div>'+
    '<div class="red-sec"><div class="red-slbl">O que foi descoberto</div><div class="red-stxt">'+p.oq+'</div></div>'+
    '<div class="red-sec"><div class="red-slbl">Por que foi esquecida</div><div class="red-stxt">'+p.es+'</div></div>'+
    '<div class="red-sec"><div class="red-slbl">Aplica√ß√£o cl√≠nica em 2026</div><div class="red-app">'+p.ap+'</div></div>';
}
buildRF();renderRN();

/* ‚îÄ‚îÄ CONSULTA IA ‚îÄ‚îÄ */
let ciM='c';
function setM(m,btn){ciM=m;document.querySelectorAll('.mc').forEach(b=>b.classList.remove('on'));btn.classList.add('on');}
function askCI(q){document.getElementById('cita').value=q;runCI();}
async function runCI(){
  const q=document.getElementById('cita').value.trim();
  if(!q)return;if(!gk()){openModal();return;}
  const sb=document.getElementById('cisend');sb.disabled=true;sb.textContent='‚Ä¶';
  const mT={c:'Foco cl√≠nico: protocolo, diagn√≥stico diferencial, conduta. Direto e baseado em evid√™ncia.',h:'Foco hist√≥rico: descoberta, por que foi esquecida, o que foi redescoberto, o que ainda √© ignorado.',b:'Foco nas lacunas brasileiras: o que n√£o √© feito, normas PT-BR ausentes, pesquisas necess√°rias.'};
  const sys='Fonoaudi√≥loga cl√≠nica s√™nior brasileira. Conhece pesquisas hist√≥ricas: Garc√≠a 1854, Semon 1881, Froeschels 1924 (78% resolu√ß√£o disfonia), Travis 1927 (domin√¢ncia cerebral gagueira ‚Äî confirmada fMRI 2024), Luria 1947 (reorganiza√ß√£o cerebral), Pommerenke 1948 (zonas gatilho disfagia), Wolff 1956 (audi√ß√£o neonatal pr√©-BERA), Schuell 1964 (afasia severa plat√¥ ‚Äî redescoberta 2008), Ptacek 1966 (voz senil normativos), Ryan 1986 (Communication Predicament), Kemper 1994 (elderspeak danos cognitivos), Williams 2004 (4h ‚Üí ‚àí58% ILPI).\n'+mT[ciM]+'\nCite autores/anos. Separe certeza de hip√≥tese. M√°x 380 palavras. Portugu√™s brasileiro.\nPergunta: '+q;
  const out=document.getElementById('ciout'),idx=Date.now();
  out.innerHTML='<div class="co-e" id="ce'+idx+'"><div class="co-q">'+q+'</div><div class="co-a" id="ca'+idx+'"><div class="r-load"><div class="spb"></div>Consultando‚Ä¶</div></div></div>';
  const res=await callAI(sys);
  sb.disabled=false;sb.textContent='Enviar';
  const el=document.getElementById('ca'+idx);
  if(!res||res.e){el.innerHTML='<span style="color:var(--amb);white-space:pre-wrap">'+(res?.m||'Erro.')+'</span>';return;}
  el.textContent='';let i=0,txt=res.t;
  (function type(){if(i<txt.length){el.innerHTML=txt.slice(0,++i).replace(/\n/g,'<br>')+'<span class="caret"></span>';setTimeout(type,i<30?0:3);}else{el.innerHTML=txt.replace(/\n/g,'<br>');}})();
}
</script>
</body>
</html>
